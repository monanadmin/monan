<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPAS-analisys: src/core_atmosphere/physics/physics_wrf/module_sf_noahdrv.F Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logoMonanColor_75x75.png"/></td>
  <td id="projectalign">
   <div id="projectname">MPAS-analisys<span id="projectnumber">&#160;teste</span>
   </div>
   <div id="projectbrief">teste</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c53e21b94733dd8451b4d2db251c70bc.html">core_atmosphere</a></li><li class="navelem"><a class="el" href="dir_195703cd1d38332c0a06b72eede84187.html">physics</a></li><li class="navelem"><a class="el" href="dir_bc4ff68999f89a5d7c146546ef3424c5.html">physics_wrf</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">module_sf_noahdrv.F</div></div>
</div><!--header-->
<div class="contents">
<a href="module__sf__noahdrv_8F.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespacemodule__sf__noahdrv.html">    1</a></span><span class="keyword">MODULE</span> <a class="code hl_namespace" href="namespacemodule__sf__noahdrv.html">module_sf_noahdrv</a></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">!-------------------------------</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span>  <span class="keywordtype">USE </span><a class="code hl_namespace" href="namespacemodule__sf__noahlsm.html">module_sf_noahlsm</a>,  <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacemodule__sf__noahlsm.html#a89de2b557283473efeeec5d3d49c7e7e">sflx</a>, xlf, xlv, cp, r_d, rhowater, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ab98144204f7c38b7c42ae05ce73403b2">natural</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a901df854f3a4654ea71bfa71ad88282f">shdtbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae38d77ba0e04158bf5681f63787f5615">lutype</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#abe6654781f59a713e1ac61fda3eb633b">sltype</a>, stbolt, &amp;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span>      &amp;                         karman, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aa1474706df3973c92ce572eb5517a6ca">lucats</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#af54c396581833689886321e9937a8b6b">nrotbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aa0847a080464d5bff86f7fc48a8eae13">rstbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a0f671f01ac448828a19839c29fe2a80d">rgltbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a032dea1cb1492e469ff23cf4a34170ea">hstbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#af49267d813703d06dc522c006a0efdd8">snuptbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aaf2ec4ae19423d4c1b907274266e1f75">maxalb</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ab9a5163c0bdd9b8af04056e8b88daa4e">laimintbl</a>,   &amp;</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a2c126e8a645fbfff910ba7d7415078e5">laimaxtbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aef1bae6bfa7f8eb613369181f2ca0bcd">z0mintbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a72bf7902c4cdf8a89ad09a592be5381a">z0maxtbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a5620825a183522809f7fd87ce222bc75">albedomintbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a9cb2add5ba6296cc7aac44442d42b2d4">albedomaxtbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aa4d4ac6f0a95c2a6bce0c39cea8fe74d">emissmintbl</a>,     &amp;</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#af6a31bb1e4de31d7e62c196cbf6dc2ee">emissmaxtbl</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a9b543a894e8a65d824249871d7f936d3">topt_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a0de1ade2206d62259245f281a9751200">cmcmax_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a49b5bd6e866a73374623128552be22ec">cfactr_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a0500272007439fcc4870091db509d5e0">rsmax_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#af967731a9437616e8e2b5bb6f3e1712e">bare</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6eb802ec31e08c8d45492d3057202b09">nlus</a>,   &amp;</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a86862de601c92fc02c2501c1827c3da4">slcats</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a421c11109bef5a1c768d721cb746c495">bb</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6e407ba242e1b07a68eb56f1180447c6">drysmc</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a5394697bf41b6a406cf68211008c2c05">f11</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae7e9abc3699009623585d342ed700ea8">maxsmc</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a7a50ad4eacd814b850f723a4b67a8ead">refsmc</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a2d3913e03c9d3f6dc2f1817689a70aa7">satpsi</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a935945ddf12582dad80c67c9c88034ac">satdk</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ab26c159cdc7754b2a7c741d846fb9e28">satdw</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ab273c118cc131cacda35bba9180402f9">wltsmc</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a264ef4f6e4e0348d29a24399729c47b1">qtz</a>, &amp;</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a2b8557df16e078c40e5bea80224b951c">nsltype</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a347f1f27afb384360fada49937ebf1cc">slpcats</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae24910d9fdc3b5b4d0ed62901e8c53bd">slope_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aae70644775d8b7023c8c3a7ba90616a8">sbeta_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#acc9389a964a5c2195267b0d1b6a71ced">fxexp_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ac05feb2a0ff4bb9285433492b2eb10f4">csoil_data</a>,           &amp;</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a5e842b9c23b43bc3ccf873a9bf9612af">salp_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae3fd374e34b9af10dd489dfc1965d827">refdk_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#acbe287caffdd1287fb71954b6284d2f5">refkdt_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a786fd6e5794b80a6cbb602a290a6fd6a">frzk_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a1e5f83b829493815912f8e801edd7b17">zbot_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6c8c21728a7859d57a4e867f2df6d521">czil_data</a>,        &amp;</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a3d56b3f7eeeccda9e1d6f7d0aecfb149">smlow_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ad1881be5e002e66566e6119f6ca6e032">smhigh_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#abfdd114973412069ebbfb3a61af8d995">lvcoef_data</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a66770731f9d207f81564cc084cdcd40e">nslope</a>, &amp;</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>      &amp;                         <a class="code hl_function" href="namespacemodule__sf__noahlsm.html#a5beb42f74e1a357ccfc0e904f356b33a">frh2o</a>,<a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6eefa55e3997176fcb176348dbabfa4e">ztopvtbl</a>,<a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a5e4d45f6d99b175703cb7cf1c2485e8a">zbotvtbl</a>, &amp;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>      &amp;                         <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6029894190d9a2de7f0bfe83f84821ed">low_density_residential</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a162eaa508d912b165fd5d5b59f9c8276">high_density_residential</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a80bccc6a8e3641348467b3867a35ca00">high_intensity_industrial</a></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>  <span class="keywordtype">USE </span><a class="code hl_namespace" href="namespacemodule__sf__urban.html">module_sf_urban</a>,    <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacemodule__sf__urban.html#abe7b6fac55e8d899aaeef36db2430d27">urban</a>, <a class="code hl_variable" href="namespacemodule__sf__urban.html#a7f6ee8b847ffef398c59c26b4d7b42e7">oasis</a>, <a class="code hl_variable" href="namespacemodule__sf__urban.html#a71448e5d980be138624f3e59d6917431">iri_scheme</a></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>  <span class="keywordtype">USE </span><a class="code hl_namespace" href="namespacemodule__sf__noahlsm__glacial__only.html">module_sf_noahlsm_glacial_only</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacemodule__sf__noahlsm__glacial__only.html#afa7bc1c71f24bbd328e603892e6af3ba">sflx_glacial</a></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>  <span class="keywordtype">USE </span><a class="code hl_namespace" href="namespacemodule__sf__bep.html">module_sf_bep</a>,      <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacemodule__sf__bep.html#a4e43ca6e75172d2dc55705c6adc6ed0d">bep</a></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>  <span class="keywordtype">USE </span><a class="code hl_namespace" href="namespacemodule__sf__bep__bem.html">module_sf_bep_bem</a>,  <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacemodule__sf__bep__bem.html#a601edbeeb722b0b6d0732b33d4884462">bep_bem</a></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#if defined(mpas)</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor"></span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacempas__atmphys__date__time.html">mpas_atmphys_date_time</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacempas__atmphys__date__time.html#a45e2fa1d81544b9b5cf50beb24054503">cal_mon_day</a></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacempas__atmphys__utilities.html">mpas_atmphys_utilities</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacempas__atmphys__utilities.html#aa49abb89b6ebc760010e08cbdade2706">physics_error_fatal</a></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#define FATAL_ERROR(M) call physics_error_fatal( M )</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor"></span> <span class="keywordtype">use </span>module_ra_gfdleta,  <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacempas__atmphys__date__time.html#a45e2fa1d81544b9b5cf50beb24054503">cal_mon_day</a></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> <span class="keywordtype">use </span>module_wrf_error</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#define FATAL_ERROR(M) call wrf_error_fatal( M )</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor"></span><span class="preprocessor">#if ( WRF_CHEM == 1 )</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor"></span>  <span class="keywordtype">USE </span>module_data_gocart_dust</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor"></span><span class="comment">!-------------------------------</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">!</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="keyword">CONTAINS</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment">!</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="comment">! Urban related variable are added to arguments - urban</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="namespacemodule__sf__noahdrv.html#a4c04acb56a9d85687443946a1d0a3cfe">   39</a></span>   <span class="keyword">SUBROUTINE </span><a class="code hl_function" href="namespacemodule__sf__noahdrv.html#a4c04acb56a9d85687443946a1d0a3cfe">lsm</a>(DZ8W,QV3D,P8W3D,T3D,TSK,                      &amp;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>                  HFX,QFX,LH,GRDFLX, QGH,GSW,SWDOWN,GLW,SMSTAV,SMSTOT, &amp;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>                  SFCRUNOFF, UDRUNOFF,IVGTYP,ISLTYP,ISURBAN,ISICE,VEGFRA,    &amp;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>                  ALBEDO,ALBBCK,ZNT,Z0,TMN,XLAND,XICE,EMISS,EMBCK,   &amp;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                  SNOWC,QSFC,RAINBL,MMINLU,                     &amp;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                  num_soil_layers,DT,DZS,ITIMESTEP,             &amp;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                  SMOIS,TSLB,SNOW,CANWAT,                       &amp;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                  CHS,CHS2,CQS2,CPM,ROVCP,SR,chklowq,lai,qz0,   &amp; !H</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                  myj,frpcpn,                                   &amp;</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>                  SH2O,SNOWH,                                   &amp; !H</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                  U_PHY,V_PHY,                                  &amp; !I</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>                  SNOALB,SHDMIN,SHDMAX,                         &amp; !I</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>                  SNOTIME,                                      &amp; !?</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                  ACSNOM,ACSNOW,                                &amp; !O</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                  SNOPCX,                                       &amp; !O</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>                  POTEVP,                                       &amp; !O</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                  SMCREL,                                       &amp; !O</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>                  XICE_THRESHOLD,                               &amp;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>                  RDLAI2D,USEMONALB,                            &amp;</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>                  RIB,                                          &amp; !?</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>                  NOAHRES,opt_thcnd,                            &amp;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>! Noah UA changes</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>                  ua_phys,flx4_2d,fvb_2d,fbur_2d,fgsn_2d,       &amp;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>                  ids,ide, jds,jde, kds,kde,                    &amp;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>                  ims,ime, jms,jme, kms,kme,                    &amp;</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>                  its,ite, jts,jte, kts,kte,                    &amp;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>                  sf_urban_physics,                             &amp;</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>                  CMR_SFCDIF,CHR_SFCDIF,CMC_SFCDIF,CHC_SFCDIF,  &amp;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>                  CMGR_SFCDIF,CHGR_SFCDIF,                      &amp;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>!Optional Urban</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>                  TR_URB2D,TB_URB2D,TG_URB2D,TC_URB2D,QC_URB2D, &amp; !H urban</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>                  UC_URB2D,                                     &amp; !H urban</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>                  XXXR_URB2D,XXXB_URB2D,XXXG_URB2D,XXXC_URB2D,  &amp; !H urban</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>                  TRL_URB3D,TBL_URB3D,TGL_URB3D,                &amp; !H urban</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>                  SH_URB2D,LH_URB2D,G_URB2D,RN_URB2D,TS_URB2D,  &amp; !H urban</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>                  PSIM_URB2D,PSIH_URB2D,U10_URB2D,V10_URB2D,    &amp; !O urban</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>                  GZ1OZ0_URB2D,  AKMS_URB2D,                    &amp; !O urban</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>                  TH2_URB2D,Q2_URB2D, UST_URB2D,                &amp; !O urban</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>                  DECLIN_URB,COSZ_URB2D,OMG_URB2D,              &amp; !I urban</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>                  XLAT_URB2D,                                   &amp; !I urban</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>                  num_roof_layers, num_wall_layers,             &amp; !I urban</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>                  num_road_layers, DZR, DZB, DZG,               &amp; !I urban</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>                  CMCR_URB2D,TGR_URB2D,TGRL_URB3D,SMR_URB3D,    &amp; !H urban</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>                  DRELR_URB2D,DRELB_URB2D,DRELG_URB2D,          &amp; !H urban</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>                  FLXHUMR_URB2D,FLXHUMB_URB2D,FLXHUMG_URB2D,    &amp; !H urban</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>                  julian, julyr,                                &amp; !H urban</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>                  FRC_URB2D,UTYPE_URB2D,                        &amp; !O</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>                  num_urban_layers,                             &amp; !I multi-layer urban</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>                  num_urban_hi,                                 &amp; !I multi-layer urban</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>                  tsk_rural_bep,                                &amp; !H multi-layer urban</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                  trb_urb4d,tw1_urb4d,tw2_urb4d,tgb_urb4d,      &amp; !H multi-layer urban</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                  tlev_urb3d,qlev_urb3d,                        &amp; !H multi-layer urban</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                  tw1lev_urb3d,tw2lev_urb3d,                    &amp; !H multi-layer urban</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                  tglev_urb3d,tflev_urb3d,                      &amp; !H multi-layer urban</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                  sf_ac_urb3d,lf_ac_urb3d,cm_ac_urb3d,          &amp; !H multi-layer urban</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                  sfvent_urb3d,lfvent_urb3d,                    &amp; !H multi-layer urban</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                  sfwin1_urb3d,sfwin2_urb3d,                    &amp; !H multi-layer urban</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                  sfw1_urb3d,sfw2_urb3d,sfr_urb3d,sfg_urb3d,    &amp; !H multi-layer urban</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                  lp_urb2d,hi_urb2d,lb_urb2d,hgt_urb2d,         &amp; !H multi-layer urban</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                  mh_urb2d,stdh_urb2d,lf_urb2d,                 &amp; !SLUCM</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                  th_phy,rho,p_phy,ust,                         &amp; !I multi-layer urban</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                  gmt,julday,xlong,xlat,                        &amp; !I multi-layer urban</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                  a_u_bep,a_v_bep,a_t_bep,a_q_bep,              &amp; !O multi-layer urban</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>                  a_e_bep,b_u_bep,b_v_bep,                      &amp; !O multi-layer urban</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                  b_t_bep,b_q_bep,b_e_bep,dlg_bep,              &amp; !O multi-layer urban</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>                  dl_u_bep,sf_bep,vl_bep,sfcheadrt,INFXSRT, soldrain      &amp;   !O multi-layer urban         </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                 ,SDA_HFX, SDA_QFX, HFX_BOTH, QFX_BOTH, QNORM, fasdas     &amp;   !fasdas</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                 ,RC2,XLAI2                                               &amp;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                  )</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">! --- atmospheric (WRF generic) variables</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">!-- DT          time step (seconds)</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">!-- DZ8W        thickness of layers (m)</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment">!-- T3D         temperature (K)</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="comment">!-- QV3D        3D water vapor mixing ratio (Kg/Kg)</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment">!-- P3D         3D pressure (Pa)</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">!-- FLHC        exchange coefficient for heat (m/s)</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">!-- FLQC        exchange coefficient for moisture (m/s)</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">!-- PSFC        surface pressure (Pa)</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">!-- XLAND       land mask (1 for land, 2 for water)</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment">!-- QGH         saturated mixing ratio at 2 meter</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="comment">!-- GSW         downward short wave flux at ground surface (W/m^2)</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="comment">!-- GLW         downward long wave flux at ground surface (W/m^2)</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment">!-- History variables</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="comment">!-- CANWAT      canopy moisture content (mm)</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment">!-- TSK         surface temperature (K)</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">!-- TSLB        soil temp (k)</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment">!-- SMOIS       total soil moisture content (volumetric fraction)</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">!-- SH2O        unfrozen soil moisture content (volumetric fraction)</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment">!                note: frozen soil moisture (i.e., soil ice) = SMOIS - SH2O</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment">!-- SNOWH       actual snow depth (m)</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment">!-- SNOW        liquid water-equivalent snow depth (m)</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">!-- ALBEDO      time-varying surface albedo including snow effect (unitless fraction)</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment">!-- ALBBCK      background surface albedo (unitless fraction)</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment">!-- CHS          surface exchange coefficient for heat and moisture (m s-1);</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment">!-- CHS2        2m surface exchange coefficient for heat  (m s-1);</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="comment">!-- CQS2        2m surface exchange coefficient for moisture (m s-1);</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="comment">! --- soil variables</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="comment">!-- num_soil_layers   the number of soil layers</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="comment">!-- ZS          depths of centers of soil layers   (m)</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="comment">!-- DZS         thicknesses of soil layers (m)</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="comment">!-- SLDPTH      thickness of each soil layer (m, same as DZS)</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">!-- TMN         soil temperature at lower boundary (K)</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">!-- SMCWLT      wilting point (volumetric)</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">!-- SMCDRY      dry soil moisture threshold where direct evap from</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="comment">!               top soil layer ends (volumetric)</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="comment">!-- SMCREF      soil moisture threshold below which transpiration begins to</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="comment">!                   stress (volumetric)</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">!-- SMCMAX      porosity, i.e. saturated value of soil moisture (volumetric)</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">!-- NROOT       number of root layers, a function of veg type, determined</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">!               in subroutine redprm.</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="comment">!-- SMSTAV      Soil moisture availability for evapotranspiration (</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="comment">!                   fraction between SMCWLT and SMCMXA)</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="comment">!-- SMSTOT      Total soil moisture content frozen+unfrozen) in the soil column (mm)</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="comment">! --- snow variables</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="comment">!-- SNOWC       fraction snow coverage (0-1.0)</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">! --- vegetation variables</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="comment">!-- SNOALB      upper bound on maximum albedo over deep snow</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><span class="comment">!-- SHDMIN      minimum areal fractional coverage of annual green vegetation</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="comment">!-- SHDMAX      maximum areal fractional coverage of annual green vegetation</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="comment">!-- XLAI        leaf area index (dimensionless)</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">!-- XLAI2       leaf area index (same as XLAI) passed to output (dimensionless)</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="comment">!-- Z0BRD       Background fixed roughness length (M)</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="comment">!-- Z0          Background vroughness length (M) as function</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="comment">!-- ZNT         Time varying roughness length (M) as function</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">!-- ALBD(IVGTPK,ISN) background albedo reading from a table</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span><span class="comment">! --- LSM output</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="comment">!-- HFX         upward heat flux at the surface (W/m^2)</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="comment">!-- QFX         upward moisture flux at the surface (kg/m^2/s)</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="comment">!-- LH          upward moisture flux at the surface (W m-2)</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="comment">!-- GRDFLX(I,J) ground heat flux (W m-2)</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">!-- FDOWN       radiation forcing at the surface (W m-2) = SOLDN*(1-alb)+LWDN</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment">!----------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="comment">!-- EC          canopy water evaporation ((W m-2)</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span><span class="comment">!-- EDIR        direct soil evaporation (W m-2)</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="comment">!-- ET          plant transpiration from a particular root layer (W m-2)</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span><span class="comment">!-- ETT         total plant transpiration (W m-2)</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="comment">!-- ESNOW       sublimation from (or deposition to if &lt;0) snowpack (W m-2)</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="comment">!-- DRIP        through-fall of precip and/or dew in excess of canopy</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="comment">!                 water-holding capacity (m)</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">!-- DEW         dewfall (or frostfall for t&lt;273.15) (M)</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="comment">!-- SMAV        Soil Moisture Availability for each layer, as a fraction</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="comment">!                 between SMCWLT and SMCMAX (dimensionless fraction)</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">!-- BETA        ratio of actual/potential evap (dimensionless)</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">!-- ETP         potential evaporation (W m-2)</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="comment">!-- FLX1        precip-snow sfc (W m-2)</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="comment">!-- FLX2        freezing rain latent heat flux (W m-2)</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment">!-- FLX3        phase-change heat flux from snowmelt (W m-2)</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="comment">!-- ACSNOM      snow melt (mm) (water equivalent)</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="comment">!-- ACSNOW      accumulated snow fall (mm) (water equivalent)</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="comment">!-- SNOPCX      snow phase change heat flux (W/m^2)</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="comment">!-- POTEVP      accumulated potential evaporation (m)</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="comment">!-- RIB         Documentation needed!!!</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="comment">!-- RUNOFF1     surface runoff (m s-1), not infiltrating the surface</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="comment">!-- RUNOFF2     subsurface runoff (m s-1), drainage out bottom of last</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="comment">!                  soil layer (baseflow)</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="comment">!  important note: here RUNOFF2 is actually the sum of RUNOFF2 and RUNOFF3</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="comment">!-- RUNOFF3     numerical trunctation in excess of porosity (smcmax)</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment">!                  for a given soil layer at the end of a time step (m s-1).</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="comment">!SFCRUNOFF     Surface Runoff (mm)</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="comment">!UDRUNOFF      Total Underground Runoff (mm), which is the sum of RUNOFF2 and RUNOFF3</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment">!-- RC          canopy resistance (s m-1)</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">!-- RC2         canopy resistance (same as RC) passed to output</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">!-- PC          plant coefficient (unitless fraction, 0-1) where PC*ETP = actual transp</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">!-- RSMIN       minimum canopy resistance (s m-1)</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="comment">!-- RCS         incoming solar rc factor (dimensionless)</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="comment">!-- RCT         air temperature rc factor (dimensionless)</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="comment">!-- RCQ         atmos vapor pressure deficit rc factor (dimensionless)</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="comment">!-- RCSOIL      soil moisture rc factor (dimensionless)</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span><span class="comment">!-- EMISS       surface emissivity (between 0 and 1)</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span><span class="comment">!-- EMBCK       Background surface emissivity (between 0 and 1)</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="comment">!-- ROVCP       R/CP</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="comment">!               (R_d/R_v) (dimensionless)</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span><span class="comment">!-- ids         start index for i in domain</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment">!-- ide         end index for i in domain</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">!-- jds         start index for j in domain</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="comment">!-- jde         end index for j in domain</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="comment">!-- kds         start index for k in domain</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="comment">!-- kde         end index for k in domain</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="comment">!-- ims         start index for i in memory</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="comment">!-- ime         end index for i in memory</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="comment">!-- jms         start index for j in memory</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span><span class="comment">!-- jme         end index for j in memory</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment">!-- kms         start index for k in memory</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="comment">!-- kme         end index for k in memory</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span><span class="comment">!-- its         start index for i in tile</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span><span class="comment">!-- ite         end index for i in tile</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span><span class="comment">!-- jts         start index for j in tile</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span><span class="comment">!-- jte         end index for j in tile</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span><span class="comment">!-- kts         start index for k in tile</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><span class="comment">!-- kte         end index for k in tile</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="comment">!</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span><span class="comment">!-- SR          fraction of frozen precip (0.0 to 1.0)</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="comment">! IN only</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::     ids,ide, jds,jde, kds,kde,  &amp;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>                                    ims,ime, jms,jme, kms,kme,  &amp;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                                    its,ite, jts,jte, kts,kte</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  sf_urban_physics               <span class="comment">!urban</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  isurban</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  isice</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  julian, julyr                  <span class="comment">!urban</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="comment">!added by Wei Yu  for routing</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="keywordtype">    REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>             <span class="keywordtype">INTENT(INOUT)</span>  :: sfcheadrt,INFXSRT,soldrain </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="keywordtype">    real</span> :: etpnd1</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span><span class="comment">!end added</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            <span class="keywordtype">INTENT(IN   )</span>    ::                            TMN, &amp;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                                                         XLAND, &amp;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>                                                          XICE, &amp;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                                                        VEGFRA, &amp;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                                                        SHDMIN, &amp;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                                                        SHDMAX, &amp;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                                                        SNOALB, &amp;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                                                           GSW, &amp;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                                                        SWDOWN, &amp; <span class="comment">!added 10 jan 2007</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                                                           GLW, &amp;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                                                        RAINBL, &amp;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                                                        EMBCK,  &amp;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                                                        SR</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            <span class="keywordtype">INTENT(INOUT)</span>    ::                         ALBBCK, &amp;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                                                            Z0</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>   <span class="keywordtype">CHARACTER(LEN=*)</span>, <span class="keywordtype">INTENT(IN   )</span>    ::                 MMINLU</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>            , &amp;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>            <span class="keywordtype">INTENT(IN   )</span>    ::                           QV3D, &amp;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                                                         p8w3D, &amp;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>                                                          DZ8W, &amp;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                                                          T3D</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                    , &amp;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>             <span class="keywordtype">INTENT(IN   )</span>               ::               QGH,  &amp;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>                                                          CPM</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>            <span class="keywordtype">INTENT(IN   )</span>    ::                         IVGTYP, &amp;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                                                        ISLTYP</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>       ::     num_soil_layers,ITIMESTEP</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">INTENT(IN   )</span>   ::     DT,ROVCP</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION(1:num_soil_layers)</span>, <span class="keywordtype">INTENT(IN)</span>::DZS</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="comment">! IN and OUT</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION( ims:ime , 1:num_soil_layers, jms:jme )</span>, &amp;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>             <span class="keywordtype">INTENT(INOUT)</span>   ::                          SMOIS, &amp; <span class="comment">! total soil moisture</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                                                         SH2O,  &amp; <span class="comment">! new soil liquid</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                                                         TSLB     <span class="comment">! TSLB     STEMP</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION( ims:ime , 1:num_soil_layers, jms:jme )</span>, &amp;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>             <span class="keywordtype">INTENT(OUT)</span>     ::                         SMCREL</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>            <span class="keywordtype">INTENT(INOUT)</span>    ::                            TSK, &amp; <span class="comment">!was TGB (temperature)</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                                                           HFX, &amp;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                                                           QFX, &amp;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                                                            LH, &amp;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                                                        GRDFLX, &amp;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                                                          QSFC,&amp;</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                                                          CQS2,&amp;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                                                          CHS,   &amp;</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                                                          CHS2,&amp;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                                                          SNOW, &amp;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                                                         SNOWC, &amp;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                                                         SNOWH, &amp; <span class="comment">!new</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                                                        CANWAT, &amp;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                                                        SMSTAV, &amp;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                                                        SMSTOT, &amp;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                                                     SFCRUNOFF, &amp;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                                                      UDRUNOFF, &amp;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>                                                        ACSNOM, &amp;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                                                        ACSNOW, &amp;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                                                       SNOTIME, &amp;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                                                        SNOPCX, &amp;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                                                        EMISS,  &amp;</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                                                          RIB,  &amp;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                                                        POTEVP, &amp;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                                                        ALBEDO, &amp;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                                                           ZNT</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>            <span class="keywordtype">INTENT(OUT)</span>      ::                         NOAHRES</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>       ::                         OPT_THCND</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="comment">! Noah UA changes</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>   <span class="keywordtype">LOGICAL</span>,                                <span class="keywordtype">INTENT(IN)</span>  :: UA_PHYS</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: FLX4_2D,FVB_2D,FBUR_2D,FGSN_2D</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span><span class="keywordtype">   REAL</span>                                                :: FLX4,FVB,FBUR,FGSN</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>               <span class="keywordtype">INTENT(OUT)</span>    ::                        CHKLOWQ</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: LAI</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="keywordtype">   REAL</span>,<span class="keywordtype">DIMENSION(IMS:IME,JMS:JME)</span>,<span class="keywordtype">INTENT(IN)</span> ::        QZ0</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> ::  RC2, XLAI2</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMR_SFCDIF</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CHR_SFCDIF</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMGR_SFCDIF</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CHGR_SFCDIF</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMC_SFCDIF</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CHC_SFCDIF</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="comment">! Local variables (moved here from driver to make routine thread safe, 20031007 jm)</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span> ::  ET</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span> ::  SMAV</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span><span class="keywordtype">      REAL</span>  ::  BETA, ETP, SSOIL,EC, EDIR, ESNOW, ETT,        &amp;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                FLX1,FLX2,FLX3, DRIP,DEW,FDOWN,RC,PC,RSMIN,XLAI,  &amp;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment">!                RCS,RCT,RCQ,RCSOIL</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                rcs,rct,rcq,rcsoil,ffrozp</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <span class="keywordtype">LOGICAL</span>,    <span class="keywordtype">INTENT(IN   )</span>    ::     myj,frpcpn</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment">! DECLARATIONS - LOGICAL</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>      <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">PARAMETER</span> :: LOCAL=.false.</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>      <span class="keywordtype">LOGICAL</span> :: FRZGRA, SNOWNG</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>      <span class="keywordtype">LOGICAL</span> :: IPRINT</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="comment">! DECLARATIONS - INTEGER</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      <span class="keywordtype">INTEGER</span> :: I,J, ICE,NSOIL,SLOPETYP,SOILTYP,VEGTYP</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>      <span class="keywordtype">INTEGER</span> :: NROOT</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>      <span class="keywordtype">INTEGER</span> :: KZ ,K</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>      <span class="keywordtype">INTEGER</span> :: NS</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span><span class="comment">! DECLARATIONS - REAL</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="keywordtype">      REAL</span>  :: SHMIN,SHMAX,DQSDT2,LWDN,PRCP,PRCPRAIN,                    &amp;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>               Q2SAT,Q2SATI,SFCPRS,SFCSPD,SFCTMP,SHDFAC,SNOALB1,         &amp;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>               SOLDN,TBOT,ZLVL, Q2K,ALBBRD, ALBEDOK, ETA, ETA_KINEMATIC, &amp;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>               EMBRD,                                                    &amp;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>               Z0K,RUNOFF1,RUNOFF2,RUNOFF3,SHEAT,SOLNET,E2SAT,SFCTSNO,   &amp;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="comment">! mek, WRF testing, expanded diagnostics</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>               solup,lwup,rnet,res,q1sfc,tairv,satflg</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="comment">! MEK MAY 2007</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="keywordtype">      REAL</span> ::  FDTLIW</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="comment">! MEK JUL2007 for pot. evap.</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span><span class="keywordtype">      REAL</span> :: RIBB</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="keywordtype">      REAL</span> ::  FDTW</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="keywordtype">      REAL</span>  :: EMISSI</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="keywordtype">      REAL</span>  :: SNCOVR,SNEQV,SNOWHK,CMC, CHK,TH2</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="keywordtype">      REAL</span>  :: SMCDRY,SMCMAX,SMCREF,SMCWLT,SNOMLT,SOILM,SOILW,Q1,T1</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="keywordtype">      REAL</span>  :: SNOTIME1    <span class="comment">! LSTSNW1 INITIAL NUMBER OF TIMESTEPS SINCE LAST SNOWFALL</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="keywordtype">      REAL</span>  :: DUMMY,Z0BRD</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span><span class="comment">!</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="keywordtype">      REAL</span>  :: COSZ, SOLARDIRECT</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="comment">!</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span>::  SLDPTH, STC,SMC,SWC</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="comment">!</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span> ::     ZSOIL, RTDIS</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">PARAMETER</span>  :: TRESH=.95e0, a2=17.67,a3=273.15,a4=29.65,   &amp;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                          t0=273.16e0, elwv=2.50e6,  a23m4=a2*(a3-a4)</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="comment">! MEK MAY 2007</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">PARAMETER</span>  :: ROW=1.e3,eliw=xlf,rowliw=row*eliw</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span><span class="comment">! DECLARATIONS START - urban</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="comment">! input variables surface_driver --&gt; lsm</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: num_roof_layers</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: num_wall_layers</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: num_road_layers</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span>, <span class="keywordtype">INTENT(IN)</span> :: DZR</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION(1:num_wall_layers)</span>, <span class="keywordtype">INTENT(IN)</span> :: DZB</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION(1:num_road_layers)</span>, <span class="keywordtype">INTENT(IN)</span> :: DZG</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(IN)</span> :: DECLIN_URB</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: COSZ_URB2D</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: OMG_URB2D</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: XLAT_URB2D</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: U_PHY</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: V_PHY</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: TH_PHY</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: P_PHY</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: RHO</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: UST</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>     <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">intent(in)</span> :: rdlai2d</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>     <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">intent(in)</span> :: USEMONALB</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="comment">! input variables lsm --&gt; urban</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>     <span class="keywordtype">INTEGER</span> :: UTYPE_URB <span class="comment">! urban type [urban=1, suburban=2, rural=3]</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="keywordtype">     REAL</span> :: TA_URB       <span class="comment">! potential temp at 1st atmospheric level [K]</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span><span class="keywordtype">     REAL</span> :: QA_URB       <span class="comment">! mixing ratio at 1st atmospheric level  [kg/kg]</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span><span class="keywordtype">     REAL</span> :: UA_URB       <span class="comment">! wind speed at 1st atmospheric level    [m/s]</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span><span class="keywordtype">     REAL</span> :: U1_URB       <span class="comment">! u at 1st atmospheric level             [m/s]</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="keywordtype">     REAL</span> :: V1_URB       <span class="comment">! v at 1st atmospheric level             [m/s]</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="keywordtype">     REAL</span> :: SSG_URB      <span class="comment">! downward total short wave radiation    [W/m/m]</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="keywordtype">     REAL</span> :: LLG_URB      <span class="comment">! downward long wave radiation           [W/m/m]</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="keywordtype">     REAL</span> :: RAIN_URB     <span class="comment">! precipitation                          [mm/h]</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="keywordtype">     REAL</span> :: RHOO_URB     <span class="comment">! air density                            [kg/m^3]</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="keywordtype">     REAL</span> :: ZA_URB       <span class="comment">! first atmospheric level                [m]</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="keywordtype">     REAL</span> :: DELT_URB     <span class="comment">! time step                              [s]</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="keywordtype">     REAL</span> :: SSGD_URB     <span class="comment">! downward direct short wave radiation   [W/m/m]</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="keywordtype">     REAL</span> :: SSGQ_URB     <span class="comment">! downward diffuse short wave radiation  [W/m/m]</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="keywordtype">     REAL</span> :: XLAT_URB     <span class="comment">! latitude                               [deg]</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="keywordtype">     REAL</span> :: COSZ_URB     <span class="comment">! cosz</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="keywordtype">     REAL</span> :: OMG_URB      <span class="comment">! hour angle</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span><span class="keywordtype">     REAL</span> :: ZNT_URB      <span class="comment">! roughness length                       [m]</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="keywordtype">     REAL</span> :: TR_URB</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span><span class="keywordtype">     REAL</span> :: TB_URB</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span><span class="keywordtype">     REAL</span> :: TG_URB</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span><span class="keywordtype">     REAL</span> :: TC_URB</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="keywordtype">     REAL</span> :: QC_URB</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="keywordtype">     REAL</span> :: UC_URB</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="keywordtype">     REAL</span> :: XXXR_URB</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="keywordtype">     REAL</span> :: XXXB_URB</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="keywordtype">     REAL</span> :: XXXG_URB</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="keywordtype">     REAL</span> :: XXXC_URB</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span> :: TRL_URB  <span class="comment">! roof layer temp [K]</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_wall_layers)</span> :: TBL_URB  <span class="comment">! wall layer temp [K]</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_road_layers)</span> :: TGL_URB  <span class="comment">! road layer temp [K]</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>     <span class="keywordtype">LOGICAL</span>  :: LSOLAR_URB</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="comment">!===Yang,2014/10/08,hydrological variable for single layer UCM===</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>     <span class="keywordtype">INTEGER</span> :: jmonth, jday, tloc</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>     <span class="keywordtype">INTEGER</span> :: IRIOPTION, USOIL, DSOIL</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="keywordtype">     REAL</span> :: AOASIS, OMG</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="keywordtype">     REAL</span> :: DRELR_URB</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="keywordtype">     REAL</span> :: DRELB_URB</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="keywordtype">     REAL</span> :: DRELG_URB</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="keywordtype">     REAL</span> :: FLXHUMR_URB</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="keywordtype">     REAL</span> :: FLXHUMB_URB</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="keywordtype">     REAL</span> :: FLXHUMG_URB</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="keywordtype">     REAL</span> :: CMCR_URB</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="keywordtype">     REAL</span> :: TGR_URB</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span> :: SMR_URB  <span class="comment">! green roof layer moisture</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span> :: TGRL_URB <span class="comment">! green roof layer temp [K]</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span> </div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: DRELR_URB2D</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: DRELB_URB2D</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: DRELG_URB2D</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FLXHUMR_URB2D</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FLXHUMB_URB2D</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FLXHUMG_URB2D</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMCR_URB2D</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGR_URB2D</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGRL_URB3D</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: SMR_URB3D</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span> </div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="comment">! state variable surface_driver &lt;--&gt; lsm &lt;--&gt; urban</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TR_URB2D</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TB_URB2D</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TG_URB2D</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TC_URB2D</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: QC_URB2D</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: UC_URB2D</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXR_URB2D</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXB_URB2D</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXG_URB2D</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXC_URB2D</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: SH_URB2D</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: LH_URB2D</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: G_URB2D</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: RN_URB2D</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="comment">!</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TS_URB2D</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TRL_URB3D</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_wall_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TBL_URB3D</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_road_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGL_URB3D</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment">! output variable lsm --&gt; surface_driver</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: PSIM_URB2D</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: PSIH_URB2D</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: GZ1OZ0_URB2D</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: U10_URB2D</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: V10_URB2D</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: TH2_URB2D</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: Q2_URB2D</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="comment">!</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: AKMS_URB2D</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="comment">!</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: UST_URB2D</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: FRC_URB2D</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: UTYPE_URB2D</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span> </div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><span class="comment">! output variables urban --&gt; lsm</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span><span class="keywordtype">     REAL</span> :: TS_URB     <span class="comment">! surface radiative temperature    [K]</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span><span class="keywordtype">     REAL</span> :: QS_URB     <span class="comment">! surface humidity                 [-]</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="keywordtype">     REAL</span> :: SH_URB     <span class="comment">! sensible heat flux               [W/m/m]</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="keywordtype">     REAL</span> :: LH_URB     <span class="comment">! latent heat flux                 [W/m/m]</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="keywordtype">     REAL</span> :: LH_KINEMATIC_URB <span class="comment">! latent heat flux, kinetic  [kg/m/m/s]</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="keywordtype">     REAL</span> :: SW_URB     <span class="comment">! upward short wave radiation flux [W/m/m]</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="keywordtype">     REAL</span> :: ALB_URB    <span class="comment">! time-varying albedo            [fraction]</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="keywordtype">     REAL</span> :: LW_URB     <span class="comment">! upward long wave radiation flux  [W/m/m]</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="keywordtype">     REAL</span> :: G_URB      <span class="comment">! heat flux into the ground        [W/m/m]</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="keywordtype">     REAL</span> :: RN_URB     <span class="comment">! net radiation                    [W/m/m]</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="keywordtype">     REAL</span> :: PSIM_URB   <span class="comment">! shear f for momentum             [-]</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="keywordtype">     REAL</span> :: PSIH_URB   <span class="comment">! shear f for heat                 [-]</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="keywordtype">     REAL</span> :: GZ1OZ0_URB   <span class="comment">! shear f for heat                 [-]</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="keywordtype">     REAL</span> :: U10_URB    <span class="comment">! wind u component at 10 m         [m/s]</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span><span class="keywordtype">     REAL</span> :: V10_URB    <span class="comment">! wind v component at 10 m         [m/s]</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="keywordtype">     REAL</span> :: TH2_URB    <span class="comment">! potential temperature at 2 m     [K]</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="keywordtype">     REAL</span> :: Q2_URB     <span class="comment">! humidity at 2 m                  [-]</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span><span class="keywordtype">     REAL</span> :: CHS_URB</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="keywordtype">     REAL</span> :: CHS2_URB</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="keywordtype">     REAL</span> :: UST_URB</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="comment">! NUDAPT Parameters urban --&gt; lam</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="keywordtype">     REAL</span> :: mh_urb</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span><span class="keywordtype">     REAL</span> :: stdh_urb</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span><span class="keywordtype">     REAL</span> :: lp_urb</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="keywordtype">     REAL</span> :: hgt_urb</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(4)</span> :: lf_urb</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span><span class="comment">! Variables for multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(IN  )</span>   ::                                   GMT </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(IN  )</span> ::                               JULDAY</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN   )</span>        ::XLAT, XLONG</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN  )</span> ::                               NUM_URBAN_LAYERS</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN  )</span> ::                               NUM_URBAN_HI</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime,                     jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tsk_rural_bep</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: trb_urb4d</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw1_urb4d</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw2_urb4d</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tgb_urb4d</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tlev_urb3d</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: qlev_urb3d</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw1lev_urb3d</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw2lev_urb3d</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tglev_urb3d</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tflev_urb3d</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: lf_ac_urb3d</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sf_ac_urb3d</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: cm_ac_urb3d</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfvent_urb3d</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: lfvent_urb3d</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfwin1_urb3d</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfwin2_urb3d</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfw1_urb3d</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfw2_urb3d</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfr_urb3d</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfg_urb3d</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_hi, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: hi_urb2d</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: lp_urb2d</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: lb_urb2d</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: hgt_urb2d</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: mh_urb2d</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: stdh_urb2d</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 4, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: lf_urb2d</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_u_bep   <span class="comment">!Implicit momemtum component X-direction</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_v_bep   <span class="comment">!Implicit momemtum component Y-direction</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_t_bep   <span class="comment">!Implicit component pot. temperature</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_q_bep   <span class="comment">!Implicit momemtum component X-direction</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_e_bep   <span class="comment">!Implicit component TKE</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_u_bep   <span class="comment">!Explicit momentum component X-direction</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_v_bep   <span class="comment">!Explicit momentum component Y-direction</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_t_bep   <span class="comment">!Explicit component pot. temperature</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_q_bep   <span class="comment">!Implicit momemtum component Y-direction</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_e_bep   <span class="comment">!Explicit component TKE</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::vl_bep    <span class="comment">!Fraction air volume in grid cell</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::dlg_bep   <span class="comment">!Height above ground</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::sf_bep  <span class="comment">!Fraction air at the face of grid cell</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::dl_u_bep  <span class="comment">!Length scale</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span> </div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="comment">! Local variables for multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: HFX_RURAL,LH_RURAL,GRDFLX_RURAL <span class="comment">! ,RN_RURAL</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: QFX_RURAL <span class="comment">! ,QSFC_RURAL,UMOM_RURAL,VMOM_RURAL</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: ALB_RURAL,EMISS_RURAL,TSK_RURAL <span class="comment">! ,UST_RURAL</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="comment">!   REAL,    DIMENSION( ims:ime, jms:jme ) :: QSFC_URB</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: HFX_URB,UMOM_URB,VMOM_URB</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: QFX_URB</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span><span class="comment">!   REAL,    DIMENSION( ims:ime, jms:jme ) :: ALBEDO_URB,EMISS_URB,UMOM,VMOM,UST</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> ::EMISS_URB</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> :: RL_UP_URB</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> ::RS_ABS_URB</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> ::GRDFLX_URB</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span><span class="keywordtype">   REAL</span> :: SIGMA_SB,RL_UP_RURAL,RL_UP_TOT,RS_ABS_TOT,UMOM,VMOM</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span><span class="keywordtype">   REAL</span> :: CMR_URB, CHR_URB, CMC_URB, CHC_URB, CMGR_URB, CHGR_URB</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><span class="keywordtype">   REAL</span> :: frc_urb,lb_urb</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="keywordtype">   REAL</span> :: check </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="comment">! DECLARATIONS END - urban</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">PARAMETER</span>  :: CAPA=r_d/cp</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span><span class="keywordtype">  REAL</span> :: APELM,APES,SFCTH2,PSFC</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span> :: xice_threshold</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>  <span class="keywordtype">character(len=80)</span> :: message_text</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><span class="comment">!</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span><span class="comment">!  FASDAS</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="comment">!</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>,  <span class="keywordtype">OPTIONAL</span>,                     &amp;</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>            <span class="keywordtype">INTENT(INOUT)</span>  ::   SDA_HFX, SDA_QFX, HFX_BOTH, QFX_BOTH, QNORM</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN   )</span>  ::  fasdas</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span><span class="comment">!  local vars</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span><span class="keywordtype">   REAL</span>                    ::  XSDA_HFX, XSDA_QFX, XQNORM</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span><span class="keywordtype">   REAL</span>                    ::  HFX_PHY, QFX_PHY</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span><span class="keywordtype">   REAL</span>                    ::  DZQ</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="keywordtype">   REAL</span>                    ::  HCPCT_FASDAS</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>   hfx_phy = 0.0   <span class="comment">! initialize</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>   qfx_phy = 0.0</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>   xqnorm  = 0.0</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>   xsda_hfx = 0.0</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>   xsda_qfx = 0.0</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment">!</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="comment">!  END FASDAS</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="comment">!</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>  sigma_sb=5.67e-08</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span><span class="comment">! MEK MAY 2007</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>      fdtliw=dt/rowliw</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span><span class="comment">! MEK JUL2007</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>      fdtw=dt/(xlv*rhowater)</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span><span class="comment">! debug printout</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>         iprint=.false.</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span> </div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="comment">!      SLOPETYP=2</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>      slopetyp=1</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span><span class="comment">!      SHDMIN=0.00</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>      nsoil=num_soil_layers</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>     <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>     sldpth(ns)=dzs(ns)</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span><span class="keywordflow">     ENDDO</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>     jloop : <span class="keywordflow">DO</span> j=jts,jte</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span> </div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>      <span class="keywordflow">IF</span>(itimestep.EQ.1)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        <span class="keywordflow">DO</span> 50 i=its,ite</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span><span class="comment">!*** initialize soil conditions for IHOP 31 May case</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span><span class="comment">!         IF((XLAND(I,J)-1.5) &lt; 0.)THEN</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="comment">!            if (I==108.and.j==85) then</span></div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="comment">!                  DO NS=1,NSOIL</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="comment">!                      SMOIS(I,NS,J)=0.10</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="comment">!                      SH2O(I,NS,J)=0.10</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span><span class="comment">!                  enddo</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span><span class="comment">!             endif</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span><span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span><span class="comment">!*** SET ZERO-VALUE FOR SOME OUTPUT DIAGNOSTIC ARRAYS</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>          <span class="keywordflow">IF</span>((xland(i,j)-1.5).GE.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="comment">! check sea-ice point</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="preprocessor"></span>            <span class="keywordflow">IF</span>( xice(i,j).GE. xice_threshold .and. iprint ) print*, <span class="stringliteral">&#39; sea-ice at water point, I=&#39;</span>,i,<span class="stringliteral">&#39;J=&#39;</span>,j</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="preprocessor"></span><span class="comment">!***   Open Water Case</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>            smstav(i,j)=1.0</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            smstot(i,j)=1.0</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>            <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>              smois(i,ns,j)=1.0</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>              tslb(i,ns,j)=273.16                                          <span class="comment">!STEMP</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>              smcrel(i,ns,j)=1.0</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span><span class="keywordflow">            ENDDO</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>            <span class="keywordflow">IF</span> ( xice(i,j) .GE. xice_threshold ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span><span class="comment">!***        SEA-ICE CASE</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>              smstav(i,j)=1.0</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>              smstot(i,j)=1.0</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>              <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                smois(i,ns,j)=1.0</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                smcrel(i,ns,j)=1.0</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="keywordflow">              ENDDO</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="comment">!</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>   50   <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span><span class="keywordflow">      ENDIF</span>                                                               <span class="comment">! end of initialization over ocean</span></div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span><span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>      iloop : <span class="keywordflow">DO</span> i=its,ite</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span><span class="comment">! surface pressure</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>        psfc=p8w3d(i,1,j)</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span><span class="comment">! pressure in middle of lowest layer</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>        sfcprs=(p8w3d(i,kts+1,j)+p8w3d(i,kts,j))*0.5</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span><span class="comment">! convert from mixing ratio to specific humidity</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>         q2k=qv3d(i,1,j)/(1.0+qv3d(i,1,j))</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span><span class="comment">! initializing local variables</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        soilw=0.</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        flx4=0.</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>        fvb=0.</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        fbur=0.</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        fgsn=0.</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span><span class="comment">!</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span><span class="comment">!         Q2SAT=QGH(I,j)</span></div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>         q2sat=qgh(i,j)/(1.0+qgh(i,j))        <span class="comment">! Q2SAT is sp humidity</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span><span class="comment">! add check on myj=.true.</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span><span class="comment">!        IF((Q2K.GE.Q2SAT*TRESH).AND.Q2K.LT.QZ0(I,J))THEN</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        <span class="keywordflow">IF</span>((myj).AND.(q2k.GE.q2sat*tresh).AND.q2k.LT.qz0(i,j))<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>          satflg=0.</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>          chklowq(i,j)=0.</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>          satflg=1.0</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>          chklowq(i,j)=1.</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span> </div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>        sfctmp=t3d(i,1,j)</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>        zlvl=0.5*dz8w(i,1,j)</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span><span class="comment">!        TH2=SFCTMP+(0.0097545*ZLVL)</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="comment">! calculate SFCTH2 via Exner function vs lapse-rate (above)</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>         apes=(1.e5/psfc)**capa</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>         apelm=(1.e5/sfcprs)**capa</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>         sfcth2=sfctmp*apelm</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>         th2=sfcth2/apes</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span><span class="comment">!</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>         emissi = emiss(i,j)</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>         lwdn=glw(i,j)*emissi</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span><span class="comment">! SOLDN is total incoming solar</span></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        soldn=swdown(i,j)</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span><span class="comment">! GSW is net downward solar</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span><span class="comment">!        SOLNET=GSW(I,J)</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span><span class="comment">! use mid-day albedo to determine net downward solar (no solar zenith angle correction)</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>        solnet=soldn*(1.-albedo(i,j))</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>        prcp=rainbl(i,j)/dt</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        vegtyp=ivgtyp(i,j)</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        soiltyp=isltyp(i,j)</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>        shdfac=vegfra(i,j)/100.</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        t1=tsk(i,j)</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        chk=chs(i,j)</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        shmin=shdmin(i,j)/100. <span class="comment">!NEW</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>        shmax=shdmax(i,j)/100. <span class="comment">!NEW</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span><span class="comment">! convert snow water equivalent from mm to meter</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        sneqv=snow(i,j)*0.001</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span><span class="comment">! snow depth in meters</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>        snowhk=snowh(i,j)</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        sncovr=snowc(i,j)</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span> </div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span><span class="comment">! if &quot;SR&quot; present, set frac of frozen precip (&quot;FFROZP&quot;) = snow-ratio (&quot;SR&quot;, range:0-1)</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span><span class="comment">! SR from e.g. Ferrier microphysics</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span><span class="comment">! otherwise define from 1st atmos level temperature</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>       <span class="keywordflow">IF</span>(frpcpn) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>          ffrozp=sr(i,j)</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>          <span class="keywordflow">IF</span> (sfctmp &lt;=  273.15) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>            ffrozp = 1.0</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>      <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        ffrozp = 0.0</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span><span class="comment">!***</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <span class="keywordflow">IF</span>((xland(i,j)-1.5).GE.0.)<span class="keywordflow">THEN</span>                                  <span class="comment">! begining of land/sea if block</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="comment">! Open water points</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>          tsk_rural(i,j)=tsk(i,j)</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>          hfx_rural(i,j)=hfx(i,j)</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>          qfx_rural(i,j)=qfx(i,j)</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>          lh_rural(i,j)=lh(i,j)</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>          emiss_rural(i,j)=emiss(i,j)</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>          grdflx_rural(i,j)=grdflx(i,j)</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span> </div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>        <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span><span class="comment">! Land or sea-ice case</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>          <span class="keywordflow">IF</span> (xice(i,j) &gt;= xice_threshold) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>             <span class="comment">! Sea-ice point</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>             ice = 1</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> ( vegtyp == isice ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>             <span class="comment">! Land-ice point</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>             ice = -1</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>             <span class="comment">! Neither sea ice or land ice.</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>             ice=0</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>          dqsdt2=q2sat*a23m4/(sfctmp-a4)**2</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>          <span class="keywordflow">IF</span>(snow(i,j).GT.0.0)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="comment">! snow on surface (use ice saturation properties)</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>            sfctsno=sfctmp</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>            e2sat=611.2*exp(6174.*(1./273.15 - 1./sfctsno))</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            q2sati=0.622*e2sat/(sfcprs-e2sat)</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>            q2sati=q2sati/(1.0+q2sati)    <span class="comment">! spec. hum.</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>            <span class="keywordflow">IF</span> (t1 .GT. 273.14) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span><span class="comment">! warm ground temps, weight the saturation between ice and water according to SNOWC</span></div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>              q2sat=q2sat*(1.-snowc(i,j)) + q2sati*snowc(i,j)</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>              dqsdt2=dqsdt2*(1.-snowc(i,j)) + q2sati*6174./(sfctsno**2)*snowc(i,j)</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>            <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span><span class="comment">! cold ground temps, use ice saturation only</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>              q2sat=q2sati</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>              dqsdt2=q2sati*6174./(sfctsno**2)</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span><span class="comment">! for snow cover fraction at 0 C, ground temp will not change, so DQSDT2 effectively zero</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="comment">! V3.8 add condition for SWDOWN to restrict condition to positive forcing (JD)</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            <span class="keywordflow">IF</span>(t1 .GT. 273. .AND. snowc(i,j) .GT. 0. .AND. swdown(i,j) .GT. 10.)dqsdt2=dqsdt2*(1.-snowc(i,j))</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>          <span class="comment">! Land-ice or land points use the usual deep-soil temperature.</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>          tbot=tmn(i,j)</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span> </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>          <span class="keywordflow">IF</span>(isurban.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span><span class="comment">! assumes these only need to be set for USGS land data</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>          <span class="keywordflow">IF</span>(vegtyp.EQ.25) shdfac=0.0000</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>          <span class="keywordflow">IF</span>(vegtyp.EQ.26) shdfac=0.0000</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>          <span class="keywordflow">IF</span>(vegtyp.EQ.27) shdfac=0.0000</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>          <span class="keywordflow">IF</span>(soiltyp.EQ.14.AND.xice(i,j).EQ.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span><span class="preprocessor"></span>         <span class="keywordflow">IF</span>(iprint)print*,<span class="stringliteral">&#39; SOIL TYPE FOUND TO BE WATER AT A LAND-POINT&#39;</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>         <span class="keywordflow">IF</span>(iprint)print*,i,j,<span class="stringliteral">&#39;RESET SOIL in surfce.F&#39;</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span><span class="preprocessor"></span>            soiltyp=7</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>          snoalb1 = snoalb(i,j)</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span><span class="comment">! converts canwat in mm to CMC in meters</span></div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>          cmc=canwat(i,j)/1000.</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span><span class="comment">!-------------------------------------------</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span><span class="comment">!*** convert snow depth from mm to meter</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span><span class="comment">!</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span><span class="comment">!          IF(RDMAXALB) THEN</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span><span class="comment">!           SNOALB=ALBMAX(I,J)*0.01</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span><span class="comment">!         ELSE</span></div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span><span class="comment">!           SNOALB=MAXALB(IVGTPK)*0.01</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span><span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span><span class="comment">!        SNOALB1=0.80</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span><span class="comment">!        SHMIN=0.00</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        albbrd=albbck(i,j)</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>        z0brd=z0(i,j)</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>        embrd=embck(i,j)</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>        snotime1 = snotime(i,j)</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        ribb=rib(i,j)</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span><span class="comment">!FEI: temporaray arrays above need to be changed later by using SI</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>          <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            smc(ns)=smois(i,ns,j)</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>            stc(ns)=tslb(i,ns,j)                                          <span class="comment">!STEMP</span></div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>            swc(ns)=sh2o(i,ns,j)</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span><span class="comment">!</span></div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>          <span class="keywordflow">if</span> ( (sneqv.ne.0..AND.snowhk.eq.0.).or.(snowhk.le.sneqv) )<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>            snowhk= 5.*sneqv</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span><span class="comment">!</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span> </div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span><span class="comment">!Fei: urban. for urban surface, if calling UCM, redefine the natural surface in cities as</span></div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span><span class="comment">! the &quot;NATURAL&quot; category in the VEGPARM.TBL</span></div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>    </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>       <span class="keywordflow">IF</span>(sf_urban_physics == 1.OR. sf_urban_physics==2.OR.sf_urban_physics==3 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6029894190d9a2de7f0bfe83f84821ed">low_density_residential</a> .or. &amp;</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>                  ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a162eaa508d912b165fd5d5b59f9c8276">high_density_residential</a> .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a80bccc6a8e3641348467b3867a35ca00">high_intensity_industrial</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>         vegtyp = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ab98144204f7c38b7c42ae05ce73403b2">natural</a></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                 shdfac = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a901df854f3a4654ea71bfa71ad88282f">shdtbl</a>(<a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ab98144204f7c38b7c42ae05ce73403b2">natural</a>)</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>                 albedok =0.2         <span class="comment">!  0.2</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                 albbrd  =0.2         <span class="comment">!0.2</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                 emissi = 0.98                                 <span class="comment">!for VEGTYP=5</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>         <span class="keywordflow">IF</span> ( frc_urb2d(i,j) &lt; 0.99 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>                   <span class="keywordflow">if</span>(sf_urban_physics.eq.1)<span class="keywordflow">then</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>                     t1= ( tsk(i,j) -frc_urb2d(i,j) * ts_urb2d(i,j) )/ (1-frc_urb2d(i,j))</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>                   <span class="keywordflow">elseif</span>((sf_urban_physics.eq.2).OR.(sf_urban_physics.eq.3))<span class="keywordflow">then</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>                     t1=tsk_rural_bep(i,j)</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span><span class="keywordflow">                   endif</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>             <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>         t1 = tsk(i,j)</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span><span class="keywordflow">                 ENDIF</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>           <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>                 <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6029894190d9a2de7f0bfe83f84821ed">low_density_residential</a> .or. &amp;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>                  ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a162eaa508d912b165fd5d5b59f9c8276">high_density_residential</a> .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a80bccc6a8e3641348467b3867a35ca00">high_intensity_industrial</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>                  vegtyp = isurban</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span><span class="keywordflow">             ENDIF</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span> </div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span><span class="comment">!===Yang, 2014/10/08, hydrological processes for urban vegetation in single layer UCM===</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>           aoasis = 1.0</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>           usoil = 1</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>           dsoil = 2</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>           irioption=<a class="code hl_variable" href="namespacemodule__sf__urban.html#a71448e5d980be138624f3e59d6917431">iri_scheme</a></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>      <span class="keywordflow">IF</span>(sf_urban_physics == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>           omg= omg_urb2d(i,j)   </div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>           tloc=mod(int(omg/3.14159*180./15.+12.+0.5 ),24)</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>           <span class="keywordflow">if</span> (tloc.lt.0) tloc=tloc+24</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>           <span class="keywordflow">if</span> (tloc==0) tloc=24</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>           <span class="keyword">CALL </span><a class="code hl_function" href="namespacempas__atmphys__date__time.html#a45e2fa1d81544b9b5cf50beb24054503">cal_mon_day</a>(julian,julyr,jmonth,jday) </div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>           <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6029894190d9a2de7f0bfe83f84821ed">low_density_residential</a> .or. &amp;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>                ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a162eaa508d912b165fd5d5b59f9c8276">high_density_residential</a> .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a80bccc6a8e3641348467b3867a35ca00">high_intensity_industrial</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>            aoasis = <a class="code hl_variable" href="namespacemodule__sf__urban.html#a7f6ee8b847ffef398c59c26b4d7b42e7">oasis</a>  <span class="comment">! urban oasis effect</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                   <span class="keywordflow">IF</span> (irioption ==1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>                   <span class="keywordflow">IF</span> (tloc==21 .or. tloc==22) <span class="keywordflow">THEN</span>  <span class="comment">!irrigation on vegetaion in urban area, MAY-SEP, 9-10pm</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                   <span class="keywordflow">IF</span> (jmonth==5 .or. jmonth==6 .or. jmonth==7 .or. jmonth==8 .or. jmonth==9) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span><span class="comment">!                      IF (SMC(USOIL) .LT. SMCREF) SMC(USOIL)= SMCREF</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span><span class="comment">!                      IF (SMC(DSOIL) .LT. SMCREF) SMC(DSOIL)= SMCREF</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>                      <span class="keywordflow">IF</span> (smc(usoil) .LT. smcref) smc(usoil)= <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a7a50ad4eacd814b850f723a4b67a8ead">refsmc</a>(isltyp(i,j))                      </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>                      <span class="keywordflow">IF</span> (smc(dsoil) .LT. smcref) smc(dsoil)= <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a7a50ad4eacd814b850f723a4b67a8ead">refsmc</a>(isltyp(i,j))                    </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span> </div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>      <span class="keywordflow">IF</span>(sf_urban_physics == 2 .or. sf_urban_physics == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>          <span class="keywordflow">IF</span>(aoasis &gt; 1.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>          fatal_error(<span class="stringliteral">&#39;Urban oasis option is for SF_URBAN_PHYSICS == 1 only&#39;</span>)</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>          <span class="keywordflow">IF</span>(irioption == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>          fatal_error(<span class="stringliteral">&#39;Urban irrigation option is for SF_URBAN_PHYSICS == 1 only&#39;</span>)</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span><span class="preprocessor"></span>          <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span><span class="comment">!</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>       print*, <span class="stringliteral">&#39;BEFORE SFLX, in Noahlsm_driver&#39;</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>       print*, <span class="stringliteral">&#39;ICE&#39;</span>, ice, <span class="stringliteral">&#39;DT&#39;</span>,dt, <span class="stringliteral">&#39;ZLVL&#39;</span>,zlvl, <span class="stringliteral">&#39;NSOIL&#39;</span>, nsoil,   &amp;</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>       <span class="stringliteral">&#39;SLDPTH&#39;</span>, sldpth, <span class="stringliteral">&#39;LOCAL&#39;</span>,local, <span class="stringliteral">&#39;LUTYPE&#39;</span>,&amp;</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae38d77ba0e04158bf5681f63787f5615">lutype</a>, <span class="stringliteral">&#39;SLTYPE&#39;</span>,<a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#abe6654781f59a713e1ac61fda3eb633b">sltype</a>, <span class="stringliteral">&#39;LWDN&#39;</span>,lwdn, <span class="stringliteral">&#39;SOLDN&#39;</span>,soldn,      &amp;</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        <span class="stringliteral">&#39;SFCPRS&#39;</span>,sfcprs, <span class="stringliteral">&#39;PRCP&#39;</span>,prcp,<span class="stringliteral">&#39;SFCTMP&#39;</span>,sfctmp,<span class="stringliteral">&#39;Q2K&#39;</span>,q2k,   &amp;</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>         <span class="stringliteral">&#39;TH2&#39;</span>,th2,<span class="stringliteral">&#39;Q2SAT&#39;</span>,q2sat,<span class="stringliteral">&#39;DQSDT2&#39;</span>,dqsdt2,<span class="stringliteral">&#39;VEGTYP&#39;</span>, vegtyp,&amp;</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>         <span class="stringliteral">&#39;SOILTYP&#39;</span>,soiltyp, <span class="stringliteral">&#39;SLOPETYP&#39;</span>,slopetyp, <span class="stringliteral">&#39;SHDFAC&#39;</span>,shdfac,&amp;</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>         <span class="stringliteral">&#39;SHMIN&#39;</span>,shmin, <span class="stringliteral">&#39;ALBBRD&#39;</span>,albbrd,<span class="stringliteral">&#39;SNOALB1&#39;</span>,snoalb1,<span class="stringliteral">&#39;TBOT&#39;</span>,&amp;</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>          tbot, <span class="stringliteral">&#39;Z0BRD&#39;</span>,z0brd, <span class="stringliteral">&#39;Z0K&#39;</span>,z0k, <span class="stringliteral">&#39;CMC&#39;</span>,cmc, <span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;STC&#39;</span>,&amp;</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>          stc, <span class="stringliteral">&#39;SMC&#39;</span>,smc, <span class="stringliteral">&#39;SWC&#39;</span>,swc,<span class="stringliteral">&#39;SNOWHK&#39;</span>,snowhk,<span class="stringliteral">&#39;SNEQV&#39;</span>,sneqv,&amp;</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>          <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok,<span class="stringliteral">&#39;CHK&#39;</span>,chk,<span class="stringliteral">&#39;ETA&#39;</span>,eta,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat,      &amp;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>          <span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,eta_kinematic, <span class="stringliteral">&#39;FDOWN&#39;</span>,fdown,<span class="stringliteral">&#39;EC&#39;</span>,ec,   &amp;</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>          <span class="stringliteral">&#39;EDIR&#39;</span>,edir,<span class="stringliteral">&#39;ET&#39;</span>,et,<span class="stringliteral">&#39;ETT&#39;</span>,ett,<span class="stringliteral">&#39;ESNOW&#39;</span>,esnow,<span class="stringliteral">&#39;DRIP&#39;</span>,drip,&amp;</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>          <span class="stringliteral">&#39;DEW&#39;</span>,dew,<span class="stringliteral">&#39;BETA&#39;</span>,beta,<span class="stringliteral">&#39;ETP&#39;</span>,etp,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;FLX1&#39;</span>,flx1,&amp;</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>          <span class="stringliteral">&#39;FLX2&#39;</span>,flx2,<span class="stringliteral">&#39;FLX3&#39;</span>,flx3,<span class="stringliteral">&#39;SNOMLT&#39;</span>,snomlt,<span class="stringliteral">&#39;SNCOVR&#39;</span>,sncovr,&amp;</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>          <span class="stringliteral">&#39;RUNOFF1&#39;</span>,runoff1,<span class="stringliteral">&#39;RUNOFF2&#39;</span>,runoff2,<span class="stringliteral">&#39;RUNOFF3&#39;</span>,runoff3, &amp;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>          <span class="stringliteral">&#39;RC&#39;</span>,rc, <span class="stringliteral">&#39;PC&#39;</span>,pc,<span class="stringliteral">&#39;RSMIN&#39;</span>,rsmin,<span class="stringliteral">&#39;XLAI&#39;</span>,xlai,<span class="stringliteral">&#39;RCS&#39;</span>,rcs,  &amp;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>          <span class="stringliteral">&#39;RCT&#39;</span>,rct,<span class="stringliteral">&#39;RCQ&#39;</span>,rcq,<span class="stringliteral">&#39;RCSOIL&#39;</span>,rcsoil,<span class="stringliteral">&#39;SOILW&#39;</span>,soilw,     &amp;</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>          <span class="stringliteral">&#39;SOILM&#39;</span>,soilm,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;SMCWLT&#39;</span>,smcwlt,<span class="stringliteral">&#39;SMCDRY&#39;</span>,smcdry,&amp;</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>          <span class="stringliteral">&#39;SMCREF&#39;</span>,smcref,<span class="stringliteral">&#39;SMCMAX&#39;</span>,smcmax,<span class="stringliteral">&#39;NROOT&#39;</span>,nroot</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span><span class="keywordflow">           endif</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span><span class="preprocessor"></span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>          <span class="keywordflow">IF</span> (rdlai2d) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>             <span class="keywordflow">IF</span> (shdfac &gt; 0.0 .AND. lai(i,j) &lt;= 0.0) lai(i,j) = 0.01</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>             xlai = lai(i,j)</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span> </div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    <span class="keywordflow">IF</span> ( ice == 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>       <span class="comment">! Sea-ice case</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span> </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>       <span class="keywordflow">DO</span> ns = 1, nsoil</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>          sh2o(i,ns,j) = 1.0</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span><span class="keywordflow">       ENDDO</span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>       lai(i,j) = 0.01</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span> </div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>       cycle iloop</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span> </div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keywordflow">ELSEIF</span> (ice == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>       <span class="comment">! Non-glacial land</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span><span class="comment">!</span></div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span><span class="comment">!  FASDAS</span></div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span><span class="comment">!</span></div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>       <span class="keywordflow">IF</span>( fasdas == 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span> </div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>         dzq = dz8w(i,1,j)</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>         xsda_hfx= sda_hfx(i,j)*rho(i,1,j)*cpm(i,j)*dzq  <span class="comment">! W/m^2</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>         <span class="comment">! TWG2015 Bugfix remove factor of 1000.0 for correct units</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>         xsda_qfx= sda_qfx(i,j)*rho(i,1,j)*dzq          <span class="comment">! Kg/m2/s of water</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>         xqnorm = qnorm(i,j)</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span> </div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span><span class="keywordflow">       ENDIF</span></div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span><span class="comment">!</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span><span class="comment">!  END FASDAS</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span><span class="comment">!</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>       <span class="keyword">CALL </span><a class="code hl_function" href="namespacemodule__sf__noahlsm.html#a89de2b557283473efeeec5d3d49c7e7e">sflx</a> (i,j,ffrozp, isurban, dt,zlvl,nsoil,sldpth,       &amp;    <span class="comment">!C</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>                 local,                                            &amp;    <span class="comment">!L</span></div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>                 <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae38d77ba0e04158bf5681f63787f5615">lutype</a>, <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#abe6654781f59a713e1ac61fda3eb633b">sltype</a>,                                   &amp;    <span class="comment">!CL</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>                 lwdn,soldn,solnet,sfcprs,prcp,sfctmp,q2k,dummy,   &amp;    <span class="comment">!F</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>                 dummy,dummy, dummy,                               &amp;    <span class="comment">!F PRCPRAIN not used</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>                 th2,q2sat,dqsdt2,                                 &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>                 vegtyp,soiltyp,slopetyp,shdfac,shmin,shmax,       &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>                 albbrd, snoalb1,tbot, z0brd, z0k, emissi, embrd,  &amp;    <span class="comment">!S</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>                 cmc,t1,stc,smc,swc,snowhk,sneqv,albedok,chk,dummy,&amp;    <span class="comment">!H</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>                 eta,sheat, eta_kinematic,fdown,                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>                 ec,edir,et,ett,esnow,drip,dew,                    &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>                 beta,etp,ssoil,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>                 flx1,flx2,flx3,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>         flx4,fvb,fbur,fgsn,ua_phys,                       &amp;    <span class="comment">!UA </span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>                 snomlt,sncovr,                                    &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>                 runoff1,runoff2,runoff3,                          &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>                 rc,pc,rsmin,xlai,rcs,rct,rcq,rcsoil,              &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>                 soilw,soilm,q1,smav,                              &amp;    <span class="comment">!D</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>                 rdlai2d,usemonalb,                                &amp;</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>                 snotime1,                                         &amp;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>                 ribb,                                             &amp;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>                 smcwlt,smcdry,smcref,smcmax,nroot,                &amp;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>                 sfcheadrt(i,j),                                   &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>                 infxsrt(i,j),etpnd1,opt_thcnd,aoasis              &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>                ,xsda_qfx, hfx_phy, qfx_phy, xqnorm, fasdas, hcpct_fasdas    &amp;   <span class="comment">! fasdas</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>                 )</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span> </div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span><span class="preprocessor">#ifdef WRF_HYDRO</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span><span class="preprocessor"></span>                 soldrain(i,j) = runoff2*dt*1000.0</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span><span class="preprocessor"></span>    <span class="keywordflow">ELSEIF</span> (ice == -1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span> </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>       <span class="comment">!</span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>       <span class="comment">! Set values that the LSM is expected to update,</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>       <span class="comment">! but don&#39;t get updated for glacial points.</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>       <span class="comment">!</span></div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>       soilm = 0.0 <span class="comment">!BSINGH(PNNL)- SOILM is undefined for this case, it is used for diagnostics so setting it to zero</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>       xlai = 0.01 <span class="comment">! KWM Should this be Zero over land ice?  Does this value matter?</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>       runoff2 = 0.0</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>       runoff3 = 0.0</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>       <span class="keywordflow">DO</span> ns = 1, nsoil</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>          swc(ns) = 1.0</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>          smc(ns) = 1.0</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>          smav(ns) = 1.0</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span><span class="keywordflow">       ENDDO</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span><span class="comment">!</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span><span class="comment">!  FASDAS</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span><span class="comment">!</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>       <span class="keywordflow">IF</span>( fasdas == 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>         dzq = dz8w(i,1,j)</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>         xsda_hfx= sda_hfx(i,j)*rho(i,1,j)*cpm(i,j)*dzq  <span class="comment">! W/m^2</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>         xsda_qfx= 0.0          <span class="comment">! Kg/m2/s of water</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>         xqnorm = 0.0</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="keywordflow">       ENDIF</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="comment">!</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span><span class="comment">!  END FASDAS</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span><span class="comment">!</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span> </div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>       <span class="keyword">CALL </span><a class="code hl_function" href="namespacemodule__sf__noahlsm__glacial__only.html#afa7bc1c71f24bbd328e603892e6af3ba">sflx_glacial</a>(i,j,isice,ffrozp,dt,zlvl,nsoil,sldpth,   &amp;    <span class="comment">!C</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>            &amp;    lwdn,solnet,sfcprs,prcp,sfctmp,q2k,              &amp;    <span class="comment">!F</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>            &amp;    th2,q2sat,dqsdt2,                                &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>            &amp;    albbrd, snoalb1,tbot, z0brd, z0k, emissi, embrd, &amp;    <span class="comment">!S</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>            &amp;    t1,stc(1:nsoil),snowhk,sneqv,albedok,chk,        &amp;    <span class="comment">!H</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>            &amp;    eta,sheat,eta_kinematic,fdown,                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>            &amp;    esnow,dew,                                       &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>            &amp;    etp,ssoil,                                       &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>            &amp;    flx1,flx2,flx3,                                  &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>            &amp;    snomlt,sncovr,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>            &amp;    runoff1,                                         &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>            &amp;    q1,                                              &amp;    <span class="comment">!D</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>            &amp;    snotime1,                                        &amp;</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>            &amp;    ribb)</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span> </div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span><span class="keywordflow">    ENDIF</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>       lai(i,j) = xlai</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>       <span class="keywordflow">if</span> (<span class="keyword">present</span>(rc2) .and. <span class="keyword">present</span>(xlai2)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>       rc2(i,j) = rc                                              <span class="comment">! for output</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>       xlai2(i,j) = xlai</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span><span class="keywordflow">       endif</span></div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span> </div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span><span class="preprocessor"></span>          <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span> </div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>       print*, <span class="stringliteral">&#39;AFTER SFLX, in Noahlsm_driver&#39;</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>       print*, <span class="stringliteral">&#39;ICE&#39;</span>, ice, <span class="stringliteral">&#39;DT&#39;</span>,dt, <span class="stringliteral">&#39;ZLVL&#39;</span>,zlvl, <span class="stringliteral">&#39;NSOIL&#39;</span>, nsoil,   &amp;</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>       <span class="stringliteral">&#39;SLDPTH&#39;</span>, sldpth, <span class="stringliteral">&#39;LOCAL&#39;</span>,local, <span class="stringliteral">&#39;LUTYPE&#39;</span>,&amp;</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae38d77ba0e04158bf5681f63787f5615">lutype</a>, <span class="stringliteral">&#39;SLTYPE&#39;</span>,<a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#abe6654781f59a713e1ac61fda3eb633b">sltype</a>, <span class="stringliteral">&#39;LWDN&#39;</span>,lwdn, <span class="stringliteral">&#39;SOLDN&#39;</span>,soldn,      &amp;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <span class="stringliteral">&#39;SFCPRS&#39;</span>,sfcprs, <span class="stringliteral">&#39;PRCP&#39;</span>,prcp,<span class="stringliteral">&#39;SFCTMP&#39;</span>,sfctmp,<span class="stringliteral">&#39;Q2K&#39;</span>,q2k,   &amp;</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>         <span class="stringliteral">&#39;TH2&#39;</span>,th2,<span class="stringliteral">&#39;Q2SAT&#39;</span>,q2sat,<span class="stringliteral">&#39;DQSDT2&#39;</span>,dqsdt2,<span class="stringliteral">&#39;VEGTYP&#39;</span>, vegtyp,&amp;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>          <span class="stringliteral">&#39;SOILTYP&#39;</span>,soiltyp, <span class="stringliteral">&#39;SLOPETYP&#39;</span>,slopetyp, <span class="stringliteral">&#39;SHDFAC&#39;</span>,shdfac,&amp;</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>         <span class="stringliteral">&#39;SHDMIN&#39;</span>,shmin, <span class="stringliteral">&#39;ALBBRD&#39;</span>,albbrd,<span class="stringliteral">&#39;SNOALB&#39;</span>,snoalb1,<span class="stringliteral">&#39;TBOT&#39;</span>,&amp;</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>          tbot, <span class="stringliteral">&#39;Z0BRD&#39;</span>,z0brd, <span class="stringliteral">&#39;Z0K&#39;</span>,z0k, <span class="stringliteral">&#39;CMC&#39;</span>,cmc, <span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;STC&#39;</span>,&amp;</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>          stc, <span class="stringliteral">&#39;SMC&#39;</span>,smc, <span class="stringliteral">&#39;SWc&#39;</span>,swc,<span class="stringliteral">&#39;SNOWHK&#39;</span>,snowhk,<span class="stringliteral">&#39;SNEQV&#39;</span>,sneqv,&amp;</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>          <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok,<span class="stringliteral">&#39;CHK&#39;</span>,chk,<span class="stringliteral">&#39;ETA&#39;</span>,eta,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat,      &amp;</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>          <span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,eta_kinematic, <span class="stringliteral">&#39;FDOWN&#39;</span>,fdown,<span class="stringliteral">&#39;EC&#39;</span>,ec,   &amp;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>          <span class="stringliteral">&#39;EDIR&#39;</span>,edir,<span class="stringliteral">&#39;ET&#39;</span>,et,<span class="stringliteral">&#39;ETT&#39;</span>,ett,<span class="stringliteral">&#39;ESNOW&#39;</span>,esnow,<span class="stringliteral">&#39;DRIP&#39;</span>,drip,&amp;</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>          <span class="stringliteral">&#39;DEW&#39;</span>,dew,<span class="stringliteral">&#39;BETA&#39;</span>,beta,<span class="stringliteral">&#39;ETP&#39;</span>,etp,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;FLX1&#39;</span>,flx1,&amp;</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>          <span class="stringliteral">&#39;FLX2&#39;</span>,flx2,<span class="stringliteral">&#39;FLX3&#39;</span>,flx3,<span class="stringliteral">&#39;SNOMLT&#39;</span>,snomlt,<span class="stringliteral">&#39;SNCOVR&#39;</span>,sncovr,&amp;</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>          <span class="stringliteral">&#39;RUNOFF1&#39;</span>,runoff1,<span class="stringliteral">&#39;RUNOFF2&#39;</span>,runoff2,<span class="stringliteral">&#39;RUNOFF3&#39;</span>,runoff3, &amp;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>          <span class="stringliteral">&#39;RC&#39;</span>,rc, <span class="stringliteral">&#39;PC&#39;</span>,pc,<span class="stringliteral">&#39;RSMIN&#39;</span>,rsmin,<span class="stringliteral">&#39;XLAI&#39;</span>,xlai,<span class="stringliteral">&#39;RCS&#39;</span>,rcs,  &amp;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>          <span class="stringliteral">&#39;RCT&#39;</span>,rct,<span class="stringliteral">&#39;RCQ&#39;</span>,rcq,<span class="stringliteral">&#39;RCSOIL&#39;</span>,rcsoil,<span class="stringliteral">&#39;SOILW&#39;</span>,soilw,     &amp;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>          <span class="stringliteral">&#39;SOILM&#39;</span>,soilm,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;SMCWLT&#39;</span>,smcwlt,<span class="stringliteral">&#39;SMCDRY&#39;</span>,smcdry,&amp;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>          <span class="stringliteral">&#39;SMCREF&#39;</span>,smcref,<span class="stringliteral">&#39;SMCMAX&#39;</span>,smcmax,<span class="stringliteral">&#39;NROOT&#39;</span>,nroot</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span><span class="keywordflow">           endif</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span><span class="preprocessor"></span> </div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span><span class="comment">!***  UPDATE STATE VARIABLES</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>          canwat(i,j)=cmc*1000.</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>          snow(i,j)=sneqv*1000.</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span><span class="comment">!          SNOWH(I,J)=SNOWHK*1000.</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>          snowh(i,j)=snowhk                   <span class="comment">! SNOWHK in meters</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>          albedo(i,j)=albedok</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>          alb_rural(i,j)=albedok</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>          albbck(i,j)=albbrd</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>          z0(i,j)=z0brd</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>          emiss(i,j) = emissi</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>          emiss_rural(i,j) = emissi</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span><span class="comment">! Noah: activate time-varying roughness length (V3.3 Feb 2011)</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>          znt(i,j)=z0k</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span><span class="comment">!</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span><span class="comment">! FASDAS</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span><span class="comment">!</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span><span class="comment">! Update Skin Temperature</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>       <span class="keywordflow">IF</span>( fasdas == 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>           xsda_qfx= xsda_qfx*elwv*xqnorm</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        <span class="comment">!TWG2015 Bugfix to multiply Heat Capacity by Soil Depth for correct</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        <span class="comment">!units </span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span> </div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>           t1 = t1 + (xsda_hfx-xsda_qfx)*dt/(hcpct_fasdas*dzs(1))</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span> </div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span><span class="keywordflow">       END IF</span></div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span><span class="comment">!</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span><span class="comment">! END FASDAS</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span><span class="comment">!</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>          tsk(i,j)=t1</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>          tsk_rural(i,j)=t1</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>          <span class="keywordflow">if</span> (<span class="keyword">present</span>(tsk_rural_bep)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>             <span class="keywordflow">IF</span>(sf_urban_physics == 2 .or. sf_urban_physics == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>               tsk_rural_bep(i,j)=t1</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span><span class="keywordflow">             END IF</span></div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>          hfx(i,j)=sheat</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>          hfx_rural(i,j)=sheat</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span><span class="comment">! MEk Jul07 add potential evap accum</span></div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>        potevp(i,j)=potevp(i,j)+etp*fdtw</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>          qfx(i,j)=eta_kinematic</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>          qfx_rural(i,j)=eta_kinematic</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span> </div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span><span class="preprocessor">#ifdef WRF_HYDRO</span></div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span><span class="preprocessor"></span><span class="comment">!added by Wei Yu</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="comment">!         QFX(I,J) = QFX(I,J) + ETPND1</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span><span class="comment">!         ETA = ETA + ETPND1/2.501E6*dt</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="comment">!end added by Wei Yu</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span><span class="preprocessor"></span> </div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>          lh(i,j)=eta</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>          lh_rural(i,j)=eta</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>          grdflx(i,j)=ssoil</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>          grdflx_rural(i,j)=ssoil</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>          snowc(i,j)=sncovr</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>          chs2(i,j)=cqs2(i,j)</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>          snotime(i,j) = snotime1</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span><span class="comment">!      prevent diagnostic ground q (q1) from being greater than qsat(tsk)</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span><span class="comment">!      as happens over snow cover where the cqs2 value also becomes irrelevant</span></div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span><span class="comment">!      by setting cqs2=chs in this situation the 2m q should become just qv(k=1)</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span><span class="comment">! ww: comment out this change to avoid Q2 drop due to change of radiative flux</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span><span class="comment">!         IF (Q1 .GT. QSFC(I,J)) THEN</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span><span class="comment">!           CQS2(I,J) = CHS(I,J)</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span><span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span><span class="comment">!          QSFC(I,J)=Q1</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span><span class="comment">! Convert QSFC back to mixing ratio</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>           qsfc(i,j)= q1/(1.0-q1)</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span><span class="comment">!</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>           <span class="comment">! QSFC_RURAL(I,J)= Q1/(1.0-Q1)</span></div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span><span class="comment">! Calculate momentum flux from rural surface for use with multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span> </div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>          <span class="keywordflow">DO</span> 80 ns=1,nsoil</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>           smois(i,ns,j)=smc(ns)</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>           tslb(i,ns,j)=stc(ns)                                        <span class="comment">!  STEMP</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>           sh2o(i,ns,j)=swc(ns)</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>   80     <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span><span class="comment">!       ENDIF</span></div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span> </div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>        flx4_2d(i,j)  = flx4</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    fvb_2d(i,j)   = fvb</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>    fbur_2d(i,j)  = fbur</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    fgsn_2d(i,j)  = fgsn</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span> </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>     <span class="comment">!</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>     <span class="comment">! Residual of surface energy balance equation terms</span></div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>     <span class="comment">!</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span> </div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>     <span class="keywordflow">IF</span> ( ua_phys ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>         noahres(i,j) = ( solnet + lwdn ) - sheat + ssoil - eta &amp;</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>              - ( emissi * stbolt * (t1**4) ) - flx1 - flx2 - flx3 - flx4</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span> </div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>     <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>         noahres(i,j) = ( solnet + lwdn ) - sheat + ssoil - eta &amp;</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>              - ( emissi * stbolt * (t1**4) ) - flx1 - flx2 - flx3</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span><span class="keywordflow">     ENDIF</span></div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span> </div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>        <span class="keywordflow">IF</span> (sf_urban_physics == 1 ) <span class="keywordflow">THEN</span>                                              <span class="comment">! Beginning of UCM CALL if block</span></div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span><span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span><span class="comment">! URBAN CANOPY MODEL START - urban</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span><span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span><span class="comment">! Input variables lsm --&gt; urban</span></div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span> </div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span> </div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>          <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a6029894190d9a2de7f0bfe83f84821ed">low_density_residential</a> .or. &amp;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>              ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a162eaa508d912b165fd5d5b59f9c8276">high_density_residential</a> .or. ivgtyp(i,j) == <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a80bccc6a8e3641348467b3867a35ca00">high_intensity_industrial</a> ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span><span class="comment">! Call urban</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span> </div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span><span class="comment">!</span></div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>            utype_urb = utype_urb2d(i,j) <span class="comment">!urban type (low, high or industrial)</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span> </div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>            ta_urb    = sfctmp           <span class="comment">! [K]</span></div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>            qa_urb    = q2k              <span class="comment">! [kg/kg]</span></div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>            ua_urb    = sqrt(u_phy(i,1,j)**2.+v_phy(i,1,j)**2.)</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>            u1_urb    = u_phy(i,1,j)</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>            v1_urb    = v_phy(i,1,j)</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>            <span class="keywordflow">IF</span>(ua_urb &lt; 1.) ua_urb=1.    <span class="comment">! [m/s]</span></div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>            ssg_urb   = soldn            <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>            ssgd_urb  = 0.8*soldn        <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>            ssgq_urb  = ssg_urb-ssgd_urb <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>            llg_urb   = glw(i,j)         <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>            rain_urb  = rainbl(i,j)      <span class="comment">! [mm]</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>            rhoo_urb  = sfcprs / (287.04 * sfctmp * (1.0+ 0.61 * q2k)) <span class="comment">![kg/m/m/m]</span></div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>            za_urb    = zlvl             <span class="comment">! [m]</span></div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>            delt_urb  = dt               <span class="comment">! [sec]</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>            xlat_urb  = xlat_urb2d(i,j)  <span class="comment">! [deg]</span></div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>            cosz_urb  = cosz_urb2d(i,j)  <span class="comment">!</span></div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>            omg_urb   = omg_urb2d(i,j)   <span class="comment">!</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>            znt_urb   = znt(i,j)</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span> </div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>            lsolar_urb = .false.</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span> </div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>            tr_urb = tr_urb2d(i,j)</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>            tb_urb = tb_urb2d(i,j)</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>            tg_urb = tg_urb2d(i,j)</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>            tc_urb = tc_urb2d(i,j)</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>            qc_urb = qc_urb2d(i,j)</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>            uc_urb = uc_urb2d(i,j)</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span> </div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>            tgr_urb   = tgr_urb2d(i,j)</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>            cmcr_urb  = cmcr_urb2d(i,j)</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>            flxhumr_urb = flxhumr_urb2d(i,j)</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>            flxhumb_urb = flxhumb_urb2d(i,j)</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>            flxhumg_urb = flxhumg_urb2d(i,j)</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>            drelr_urb = drelr_urb2d(i,j)</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>            drelb_urb = drelb_urb2d(i,j)</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>            drelg_urb = drelg_urb2d(i,j)</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span> </div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>            <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>              trl_urb(k) = trl_urb3d(i,k,j)</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>              smr_urb(k) = smr_urb3d(i,k,j)</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>              tgrl_urb(k)= tgrl_urb3d(i,k,j)</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span><span class="keywordflow">            END DO</span></div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>            <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>              tbl_urb(k) = tbl_urb3d(i,k,j)</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span><span class="keywordflow">            END DO</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>            <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>              tgl_urb(k) = tgl_urb3d(i,k,j)</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span><span class="keywordflow">            END DO</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span> </div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>            xxxr_urb = xxxr_urb2d(i,j)</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>            xxxb_urb = xxxb_urb2d(i,j)</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>            xxxg_urb = xxxg_urb2d(i,j)</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>            xxxc_urb = xxxc_urb2d(i,j)</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span><span class="comment">!</span></div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span><span class="comment">!</span></div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span><span class="comment">!      Limits to avoid dividing by small number</span></div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>            <span class="keywordflow">if</span> (chs(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>               chs(i,j)  = 1.0e-02</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>            <span class="keywordflow">if</span> (chs2(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>               chs2(i,j)  = 1.0e-02</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>            <span class="keywordflow">if</span> (cqs2(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>               cqs2(i,j)  = 1.0e-02</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span><span class="comment">!</span></div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>            chs_urb  = chs(i,j)</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>            chs2_urb = chs2(i,j)</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>            <span class="keywordflow">IF</span> (<span class="keyword">PRESENT</span>(cmr_sfcdif)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>               cmr_urb = cmr_sfcdif(i,j)</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>               chr_urb = chr_sfcdif(i,j)</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>               cmgr_urb = cmgr_sfcdif(i,j)</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>               chgr_urb = chgr_sfcdif(i,j)</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>               cmc_urb = cmc_sfcdif(i,j)</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>               chc_urb = chc_sfcdif(i,j)</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span> </div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span><span class="comment">! NUDAPT for SLUCM</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>            mh_urb = mh_urb2d(i,j)</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>            stdh_urb = stdh_urb2d(i,j)</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>            lp_urb = lp_urb2d(i,j)</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>            hgt_urb = hgt_urb2d(i,j)</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>            lf_urb = 0.0</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>            <span class="keywordflow">DO</span> k = 1,4</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>              lf_urb(k)=lf_urb2d(i,k,j)</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span><span class="keywordflow">            ENDDO</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>            frc_urb = frc_urb2d(i,j)</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>            lb_urb = lb_urb2d(i,j)</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>            check = 0</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>            <span class="keywordflow">if</span> (i.eq.73.and.j.eq.125)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>               check = 1</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span><span class="keywordflow">            end if</span></div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span><span class="comment">!</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span><span class="comment">! Call urban</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>            <span class="keyword">CALL </span><a class="code hl_function" href="namespacempas__atmphys__date__time.html#a45e2fa1d81544b9b5cf50beb24054503">cal_mon_day</a>(julian,julyr,jmonth,jday)</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>            <span class="keyword">CALL </span><a class="code hl_function" href="namespacemodule__sf__urban.html#abe7b6fac55e8d899aaeef36db2430d27">urban</a>(lsolar_urb,                                      &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>                       num_roof_layers,num_wall_layers,num_road_layers, &amp; <span class="comment">! C</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>                       dzr,dzb,dzg,                                     &amp; <span class="comment">! C</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>                       utype_urb,ta_urb,qa_urb,ua_urb,u1_urb,v1_urb,ssg_urb, &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>                       ssgd_urb,ssgq_urb,llg_urb,rain_urb,rhoo_urb,     &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>                       za_urb,declin_urb,cosz_urb,omg_urb,              &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>                       xlat_urb,delt_urb,znt_urb,                       &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>                       chs_urb, chs2_urb,                               &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>                       tr_urb, tb_urb, tg_urb, tc_urb, qc_urb,uc_urb,   &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>                       trl_urb,tbl_urb,tgl_urb,                         &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>                       xxxr_urb, xxxb_urb, xxxg_urb, xxxc_urb,          &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>                       ts_urb,qs_urb,sh_urb,lh_urb,lh_kinematic_urb,    &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>                       sw_urb,alb_urb,lw_urb,g_urb,rn_urb,psim_urb,psih_urb, &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>                       gz1oz0_urb,                                      &amp; <span class="comment">!O</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>                       cmr_urb, chr_urb, cmc_urb, chc_urb,              &amp;</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>                       u10_urb, v10_urb, th2_urb, q2_urb,               &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>                       ust_urb,mh_urb, stdh_urb, lf_urb, lp_urb,        &amp; <span class="comment">! 0</span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>                       hgt_urb,frc_urb,lb_urb, check,cmcr_urb,tgr_urb,  &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>                       tgrl_urb,smr_urb,cmgr_urb,chgr_urb,jmonth,       &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>                       drelr_urb,drelb_urb,                             &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>                       drelg_urb,flxhumr_urb,flxhumb_urb,flxhumg_urb)                            </div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span> </div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span><span class="preprocessor"></span>          <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>       print*, <span class="stringliteral">&#39;AFTER CALL URBAN&#39;</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>       print*,<span class="stringliteral">&#39;num_roof_layers&#39;</span>,num_roof_layers, <span class="stringliteral">&#39;num_wall_layers&#39;</span>,  &amp;</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>        num_wall_layers,                                             &amp;</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>       <span class="stringliteral">&#39;DZR&#39;</span>,dzr,<span class="stringliteral">&#39;DZB&#39;</span>,dzb,<span class="stringliteral">&#39;DZG&#39;</span>,dzg,<span class="stringliteral">&#39;UTYPE_URB&#39;</span>,utype_urb,<span class="stringliteral">&#39;TA_URB&#39;</span>, &amp;</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>        ta_urb,                                                      &amp;</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>        <span class="stringliteral">&#39;QA_URB&#39;</span>,qa_urb,<span class="stringliteral">&#39;UA_URB&#39;</span>,ua_urb,<span class="stringliteral">&#39;U1_URB&#39;</span>,u1_urb,<span class="stringliteral">&#39;V1_URB&#39;</span>,    &amp;</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>         v1_urb,                                                     &amp;</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>         <span class="stringliteral">&#39;SSG_URB&#39;</span>,ssg_urb,<span class="stringliteral">&#39;SSGD_URB&#39;</span>,ssgd_urb,<span class="stringliteral">&#39;SSGQ_URB&#39;</span>,ssgq_urb,  &amp;</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>        <span class="stringliteral">&#39;LLG_URB&#39;</span>,llg_urb,<span class="stringliteral">&#39;RAIN_URB&#39;</span>,rain_urb,<span class="stringliteral">&#39;RHOO_URB&#39;</span>,rhoo_urb,   &amp;</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>        <span class="stringliteral">&#39;ZA_URB&#39;</span>,za_urb, <span class="stringliteral">&#39;DECLIN_URB&#39;</span>,declin_urb,<span class="stringliteral">&#39;COSZ_URB&#39;</span>,cosz_urb,&amp;</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>        <span class="stringliteral">&#39;OMG_URB&#39;</span>,omg_urb,<span class="stringliteral">&#39;XLAT_URB&#39;</span>,xlat_urb,<span class="stringliteral">&#39;DELT_URB&#39;</span>,delt_urb,   &amp;</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>         <span class="stringliteral">&#39;ZNT_URB&#39;</span>,znt_urb,<span class="stringliteral">&#39;TR_URB&#39;</span>,tr_urb, <span class="stringliteral">&#39;TB_URB&#39;</span>,tb_urb,<span class="stringliteral">&#39;TG_URB&#39;</span>,&amp;</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>         tg_urb,<span class="stringliteral">&#39;TC_URB&#39;</span>,tc_urb,<span class="stringliteral">&#39;QC_URB&#39;</span>,qc_urb,<span class="stringliteral">&#39;TRL_URB&#39;</span>,trl_urb,   &amp;</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>          <span class="stringliteral">&#39;TBL_URB&#39;</span>,tbl_urb,<span class="stringliteral">&#39;TGL_URB&#39;</span>,tgl_urb,<span class="stringliteral">&#39;XXXR_URB&#39;</span>,xxxr_urb,   &amp;</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>         <span class="stringliteral">&#39;XXXB_URB&#39;</span>,xxxb_urb,<span class="stringliteral">&#39;XXXG_URB&#39;</span>,xxxg_urb,<span class="stringliteral">&#39;XXXC_URB&#39;</span>,xxxc_urb,&amp;</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>         <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb,<span class="stringliteral">&#39;QS_URB&#39;</span>,qs_urb,<span class="stringliteral">&#39;SH_URB&#39;</span>,sh_urb,<span class="stringliteral">&#39;LH_URB&#39;</span>,   &amp;</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>         lh_urb, <span class="stringliteral">&#39;LH_KINEMATIC_URB&#39;</span>,lh_kinematic_urb,<span class="stringliteral">&#39;SW_URB&#39;</span>,sw_urb,&amp;</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>         <span class="stringliteral">&#39;ALB_URB&#39;</span>,alb_urb,<span class="stringliteral">&#39;LW_URB&#39;</span>,lw_urb,<span class="stringliteral">&#39;G_URB&#39;</span>,g_urb,<span class="stringliteral">&#39;RN_URB&#39;</span>,   &amp;</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>          rn_urb, <span class="stringliteral">&#39;PSIM_URB&#39;</span>,psim_urb,<span class="stringliteral">&#39;PSIH_URB&#39;</span>,psih_urb,          &amp;</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>         <span class="stringliteral">&#39;U10_URB&#39;</span>,u10_urb,<span class="stringliteral">&#39;V10_URB&#39;</span>,v10_urb,<span class="stringliteral">&#39;TH2_URB&#39;</span>,th2_urb,      &amp;</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>          <span class="stringliteral">&#39;Q2_URB&#39;</span>,q2_urb,<span class="stringliteral">&#39;CHS_URB&#39;</span>,chs_urb,<span class="stringliteral">&#39;CHS2_URB&#39;</span>,chs2_urb</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span><span class="keywordflow">           endif</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span><span class="preprocessor"></span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>            ts_urb2d(i,j) = ts_urb</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span> </div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>            albedo(i,j) = frc_urb2d(i,j)*alb_urb+(1-frc_urb2d(i,j))*albedok   <span class="comment">![-]</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>            hfx(i,j) = frc_urb2d(i,j)*sh_urb+(1-frc_urb2d(i,j))*sheat         <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>            qfx(i,j) = frc_urb2d(i,j)*lh_kinematic_urb &amp;</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>                     + (1-frc_urb2d(i,j))*eta_kinematic                <span class="comment">![kg/m/m/s]</span></div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>            lh(i,j) = frc_urb2d(i,j)*lh_urb+(1-frc_urb2d(i,j))*eta            <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>            grdflx(i,j) = frc_urb2d(i,j)*g_urb+(1-frc_urb2d(i,j))*ssoil       <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>            tsk(i,j) = frc_urb2d(i,j)*ts_urb+(1-frc_urb2d(i,j))*t1            <span class="comment">![K]</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>            q1 = frc_urb2d(i,j)*qs_urb+(1-frc_urb2d(i,j))*q1            <span class="comment">![-]</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span><span class="comment">! Convert QSFC back to mixing ratio</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>            qsfc(i,j)= q1/(1.0-q1)</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>            ust(i,j)= frc_urb2d(i,j)*ust_urb+(1-frc_urb2d(i,j))*ust(i,j)      <span class="comment">![m/s]</span></div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="preprocessor"></span>    <span class="keywordflow">IF</span>(iprint)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span> </div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>    print*, <span class="stringliteral">&#39; FRC_URB2D&#39;</span>, frc_urb2d,                        &amp;</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>    <span class="stringliteral">&#39;ALB_URB&#39;</span>,alb_urb, <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok, &amp;</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>    <span class="stringliteral">&#39;ALBEDO(I,J)&#39;</span>,  albedo(i,j),                  &amp;</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>    <span class="stringliteral">&#39;SH_URB&#39;</span>,sh_urb,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat, <span class="stringliteral">&#39;HFX(I,J)&#39;</span>,hfx(i,j),  &amp;</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>    <span class="stringliteral">&#39;LH_KINEMATIC_URB&#39;</span>,lh_kinematic_urb,<span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,  &amp;</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>     eta_kinematic, <span class="stringliteral">&#39;QFX(I,J)&#39;</span>,qfx(i,j),                  &amp;</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>    <span class="stringliteral">&#39;LH_URB&#39;</span>,lh_urb, <span class="stringliteral">&#39;ETA&#39;</span>,eta, <span class="stringliteral">&#39;LH(I,J)&#39;</span>,lh(i,j),        &amp;</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>    <span class="stringliteral">&#39;G_URB&#39;</span>,g_urb,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;GRDFLX(I,J)&#39;</span>, grdflx(i,j),&amp;</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>    <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb,<span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;TSK(I,J)&#39;</span>,tsk(i,j),          &amp;</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>    <span class="stringliteral">&#39;QS_URB&#39;</span>,qs_urb,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;QSFC(I,J)&#39;</span>,qsfc(i,j)</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span><span class="keywordflow">     endif</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span><span class="preprocessor"></span> </div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span> </div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span> </div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span><span class="comment">! Renew Urban State Varialbes</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span> </div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>            tr_urb2d(i,j) = tr_urb</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>            tb_urb2d(i,j) = tb_urb</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>            tg_urb2d(i,j) = tg_urb</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>            tc_urb2d(i,j) = tc_urb</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>            qc_urb2d(i,j) = qc_urb</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>            uc_urb2d(i,j) = uc_urb</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span> </div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>            tgr_urb2d(i,j) =tgr_urb </div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>            cmcr_urb2d(i,j)=cmcr_urb</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>            flxhumr_urb2d(i,j)=flxhumr_urb </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>            flxhumb_urb2d(i,j)=flxhumb_urb</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>            flxhumg_urb2d(i,j)=flxhumg_urb</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>            drelr_urb2d(i,j) = drelr_urb </div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>            drelb_urb2d(i,j) = drelb_urb </div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>            drelg_urb2d(i,j) = drelg_urb</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span> </div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>            <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>              trl_urb3d(i,k,j) = trl_urb(k)</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>              smr_urb3d(i,k,j) = smr_urb(k)</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>              tgrl_urb3d(i,k,j)= tgrl_urb(k)</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span><span class="keywordflow">            END DO</span></div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>            <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>              tbl_urb3d(i,k,j) = tbl_urb(k)</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span><span class="keywordflow">            END DO</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>            <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>              tgl_urb3d(i,k,j) = tgl_urb(k)</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span><span class="keywordflow">            END DO</span></div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>            xxxr_urb2d(i,j) = xxxr_urb</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>            xxxb_urb2d(i,j) = xxxb_urb</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>            xxxg_urb2d(i,j) = xxxg_urb</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>            xxxc_urb2d(i,j) = xxxc_urb</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span> </div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>            sh_urb2d(i,j)    = sh_urb</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>            lh_urb2d(i,j)    = lh_urb</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>            g_urb2d(i,j)     = g_urb</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>            rn_urb2d(i,j)    = rn_urb</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>            psim_urb2d(i,j)  = psim_urb</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>            psih_urb2d(i,j)  = psih_urb</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>            gz1oz0_urb2d(i,j)= gz1oz0_urb</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>            u10_urb2d(i,j)   = u10_urb</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>            v10_urb2d(i,j)   = v10_urb</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>            th2_urb2d(i,j)   = th2_urb</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>            q2_urb2d(i,j)    = q2_urb</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>            ust_urb2d(i,j)   = ust_urb</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>            akms_urb2d(i,j)  = karman * ust_urb2d(i,j)/(gz1oz0_urb2d(i,j)-psim_urb2d(i,j))</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>            <span class="keywordflow">IF</span> (<span class="keyword">PRESENT</span>(cmr_sfcdif)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>               cmr_sfcdif(i,j) = cmr_urb</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>               chr_sfcdif(i,j) = chr_urb</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>               cmgr_sfcdif(i,j) = cmgr_urb</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>               chgr_sfcdif(i,j) = chgr_urb</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>               cmc_sfcdif(i,j) = cmc_urb</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>               chc_sfcdif(i,j) = chc_urb</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span><span class="keywordflow">          END IF</span></div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span> </div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span><span class="keywordflow">         ENDIF</span>                                   <span class="comment">! end of UCM CALL if block</span></div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span><span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span><span class="comment">! Urban Part End - urban</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span><span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span><span class="comment">!***  DIAGNOSTICS</span></div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>          smstav(i,j)=soilw</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>          smstot(i,j)=soilm*1000.</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>          <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>          smcrel(i,ns,j)=smav(ns)</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span> </div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span><span class="comment">!         Convert the water unit into mm</span></div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>          sfcrunoff(i,j)=sfcrunoff(i,j)+runoff1*dt*1000.0</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>          udrunoff(i,j)=udrunoff(i,j)+runoff2*dt*1000.0</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span><span class="comment">! snow defined when fraction of frozen precip (FFROZP) &gt; 0.5,</span></div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>          <span class="keywordflow">IF</span>(ffrozp.GT.0.5)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>            acsnow(i,j)=acsnow(i,j)+prcp*dt</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>          <span class="keywordflow">IF</span>(snow(i,j).GT.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>            acsnom(i,j)=acsnom(i,j)+snomlt*1000.</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span><span class="comment">! accumulated snow-melt energy</span></div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>            snopcx(i,j)=snopcx(i,j)-snomlt/fdtliw</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span> </div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="keywordflow">        ENDIF</span>                                                           <span class="comment">! endif of land-sea test</span></div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span> </div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span><span class="keywordflow">      ENDDO</span> iloop                                                       <span class="comment">! of I loop</span></div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span><span class="keywordflow">   ENDDO</span> jloop                                                          <span class="comment">! of J loop</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>      <span class="keywordflow">IF</span> (sf_urban_physics == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span> </div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span> </div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>         <span class="keywordflow">do</span> j=jts,jte</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>         <span class="keywordflow">do</span> i=its,ite</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>            emiss_urb(i,j)=0.</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>            rl_up_urb(i,j)=0.</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>            rs_abs_urb(i,j)=0.</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>            grdflx_urb(i,j)=0.</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>            b_q_bep(i,kts:kte,j)=0.</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span><span class="keywordflow">         end do</span></div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span><span class="keywordflow">         end do</span></div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>       <span class="keyword">CALL </span><a class="code hl_function" href="namespacemodule__sf__bep.html#a4e43ca6e75172d2dc55705c6adc6ed0d">bep</a>(frc_urb2d,utype_urb2d,itimestep,dz8w,dt,u_phy,v_phy,   &amp;</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>                th_phy,rho,p_phy,swdown,glw,                           &amp;</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>                gmt,julday,xlong,xlat,declin_urb,cosz_urb2d,omg_urb2d, &amp;</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>                num_urban_layers,num_urban_hi,                         &amp;</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>                trb_urb4d,tw1_urb4d,tw2_urb4d,tgb_urb4d,               &amp;</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>                sfw1_urb3d,sfw2_urb3d,sfr_urb3d,sfg_urb3d,             &amp;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>                lp_urb2d,hi_urb2d,lb_urb2d,hgt_urb2d,                  &amp;</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>                a_u_bep,a_v_bep,a_t_bep,                               &amp;</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>                a_e_bep,b_u_bep,b_v_bep,                               &amp;</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>                b_t_bep,b_e_bep,b_q_bep,dlg_bep,                       &amp;</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>                dl_u_bep,sf_bep,vl_bep,                                &amp;</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>                rl_up_urb,rs_abs_urb,emiss_urb,grdflx_urb,             &amp;</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>                ids,ide, jds,jde, kds,kde,                             &amp;</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>                ims,ime, jms,jme, kms,kme,                             &amp;</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>                its,ite, jts,jte, kts,kte )</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span> </div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span><span class="keywordflow">       ENDIF</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span> </div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>       </div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>       <span class="keywordflow">IF</span> (sf_urban_physics == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span> </div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span> </div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>         <span class="keywordflow">do</span> j=jts,jte</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>         <span class="keywordflow">do</span> i=its,ite</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>            emiss_urb(i,j)=0.</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>            rl_up_urb(i,j)=0.</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>            rs_abs_urb(i,j)=0.</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>            grdflx_urb(i,j)=0.</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>            b_q_bep(i,kts:kte,j)=0.</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span><span class="keywordflow">         end do</span></div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span><span class="keywordflow">         end do</span></div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>        </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span> </div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>       <span class="keyword">CALL </span><a class="code hl_function" href="namespacemodule__sf__bep__bem.html#a601edbeeb722b0b6d0732b33d4884462">bep_bem</a>(frc_urb2d,utype_urb2d,itimestep,dz8w,dt,u_phy,v_phy, &amp;</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>                th_phy,rho,p_phy,swdown,glw,                           &amp;</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>                gmt,julday,xlong,xlat,declin_urb,cosz_urb2d,omg_urb2d, &amp;</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>                num_urban_layers,num_urban_hi,                         &amp;</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>                trb_urb4d,tw1_urb4d,tw2_urb4d,tgb_urb4d,               &amp;</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>                tlev_urb3d,qlev_urb3d,tw1lev_urb3d,tw2lev_urb3d,       &amp;</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>                tglev_urb3d,tflev_urb3d,sf_ac_urb3d,lf_ac_urb3d,       &amp;</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>                cm_ac_urb3d,sfvent_urb3d,lfvent_urb3d,                 &amp;</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>                sfwin1_urb3d,sfwin2_urb3d,                             &amp;</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>                sfw1_urb3d,sfw2_urb3d,sfr_urb3d,sfg_urb3d,             &amp;</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>                lp_urb2d,hi_urb2d,lb_urb2d,hgt_urb2d,                  &amp;</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>                a_u_bep,a_v_bep,a_t_bep,                               &amp;</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>                a_e_bep,b_u_bep,b_v_bep,                               &amp;</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>                b_t_bep,b_e_bep,b_q_bep,dlg_bep,                       &amp;</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>                dl_u_bep,sf_bep,vl_bep,                                &amp;</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>                rl_up_urb,rs_abs_urb,emiss_urb,grdflx_urb,qv3d,        &amp;</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>                ids,ide, jds,jde, kds,kde,                             &amp;</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>                ims,ime, jms,jme, kms,kme,                             &amp;</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>                its,ite, jts,jte, kts,kte )</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span> </div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span><span class="keywordflow">       ENDIF</span></div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span> </div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>    <span class="keywordflow">if</span>((sf_urban_physics.eq.2).OR.(sf_urban_physics.eq.3))<span class="keywordflow">then</span>         <span class="comment">!Bep begin</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>         <span class="keywordflow">do</span> j=jts,jte</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>         <span class="keywordflow">do</span> i=its,ite</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>            umom_urb(i,j)=0.</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>            vmom_urb(i,j)=0.</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>            hfx_urb(i,j)=0.</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>            qfx_urb(i,j)=0.</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>         <span class="keywordflow">do</span> k=kts,kte</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>            a_u_bep(i,k,j)=a_u_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>            a_v_bep(i,k,j)=a_v_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>            a_t_bep(i,k,j)=a_t_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>            a_q_bep(i,k,j)=0.        </div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>            a_e_bep(i,k,j)=0.</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>            b_u_bep(i,k,j)=b_u_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>            b_v_bep(i,k,j)=b_v_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>            b_t_bep(i,k,j)=b_t_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>            b_q_bep(i,k,j)=b_q_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>            b_e_bep(i,k,j)=b_e_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>            hfx_urb(i,j)=hfx_urb(i,j)+b_t_bep(i,k,j)*rho(i,k,j)*cp*                &amp;</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>                          dz8w(i,k,j)*vl_bep(i,k,j)</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>            qfx_urb(i,j)=qfx_urb(i,j)+b_q_bep(i,k,j)*               &amp;</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>                          dz8w(i,k,j)*vl_bep(i,k,j)</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>            umom_urb(i,j)=umom_urb(i,j)+ (a_u_bep(i,k,j)*u_phy(i,k,j)+             &amp;</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>                          b_u_bep(i,k,j))*dz8w(i,k,j)*vl_bep(i,k,j)</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>            vmom_urb(i,j)=vmom_urb(i,j)+ (a_v_bep(i,k,j)*v_phy(i,k,j)+             &amp;</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>                          b_v_bep(i,k,j))*dz8w(i,k,j)*vl_bep(i,k,j)</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>            vl_bep(i,k,j)=(1.-frc_urb2d(i,j))+vl_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>            sf_bep(i,k,j)=(1.-frc_urb2d(i,j))+sf_bep(i,k,j)*frc_urb2d(i,j)</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span><span class="keywordflow">         end do</span></div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>            a_u_bep(i,1,j)=(1.-frc_urb2d(i,j))*(-ust(i,j)*ust(i,j))/dz8w(i,1,j)/   &amp;</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>                           ((u_phy(i,1,j)**2+v_phy(i,1,j)**2.)**.5)+a_u_bep(i,1,j)</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>            a_v_bep(i,1,j)=(1.-frc_urb2d(i,j))*(-ust(i,j)*ust(i,j))/dz8w(i,1,j)/   &amp;</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>                           ((u_phy(i,1,j)**2+v_phy(i,1,j)**2.)**.5)+a_v_bep(i,1,j)</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>            b_t_bep(i,1,j)=(1.-frc_urb2d(i,j))*hfx_rural(i,j)/dz8w(i,1,j)/rho(i,1,j)/cp+ &amp;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>                            b_t_bep(i,1,j)</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>            b_q_bep(i,1,j)=(1.-frc_urb2d(i,j))*qfx_rural(i,j)/dz8w(i,1,j)/rho(i,1,j)+b_q_bep(i,1,j)</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>            umom=(1.-frc_urb2d(i,j))*ust(i,j)*ust(i,j)*u_phy(i,1,j)/               &amp;</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>                         ((u_phy(i,1,j)**2+v_phy(i,1,j)**2.)**.5)+umom_urb(i,j)</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>            vmom=(1.-frc_urb2d(i,j))*ust(i,j)*ust(i,j)*v_phy(i,1,j)/               &amp;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>                         ((u_phy(i,1,j)**2+v_phy(i,1,j)**2.)**.5)+vmom_urb(i,j)</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>            sf_bep(i,1,j)=1.</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>           </div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span><span class="comment">! compute upward longwave radiation from the rural part and total</span></div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span><span class="comment">!           rl_up_rural=-emiss_rural(i,j)*sigma_sb*(tsk_rural(i,j)**4.)-(1.-emiss_rural(i,j))*glw(i,j)</span></div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span><span class="comment">!           rl_up_tot=(1.-frc_urb2d(i,j))*rl_up_rural+frc_urb2d(i,j)*rl_up_urb(i,j)   </span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span><span class="comment">!           emiss(i,j)=(1.-frc_urb2d(i,j))*emiss_rural(i,j)+frc_urb2d(i,j)*emiss_urb(i,j)</span></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span><span class="comment">! using the emissivity and the total longwave upward radiation estimate the averaged skin temperature</span></div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>           <span class="keywordflow">IF</span> (frc_urb2d(i,j).GT.0.) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>              rl_up_rural=-emiss_rural(i,j)*sigma_sb*(tsk_rural(i,j)**4.)-(1.-emissi)*glw(i,j)</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>              rl_up_tot=(1.-frc_urb2d(i,j))*rl_up_rural+frc_urb2d(i,j)*rl_up_urb(i,j)   </div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>              emiss(i,j)=(1.-frc_urb2d(i,j))*emiss_rural(i,j)+frc_urb2d(i,j)*emiss_urb(i,j)</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>              ts_urb2d(i,j)=(max(0.,(-rl_up_urb(i,j)-(1.-emiss_urb(i,j))*glw(i,j))/emiss_urb(i,j)/sigma_sb))**0.25</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>              tsk(i,j)=(max(0., (-1.*rl_up_tot-(1.-emiss(i,j))*glw(i,j) )/emiss(i,j)/sigma_sb))**.25</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>           rs_abs_tot=(1.-frc_urb2d(i,j))*swdown(i,j)*(1.-albedo(i,j))+frc_urb2d(i,j)*rs_abs_urb(i,j)  </div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>          <span class="keywordflow">if</span>(swdown(i,j).gt.0.)<span class="keywordflow">then</span></div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>           albedo(i,j)=1.-rs_abs_tot/swdown(i,j)</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>           albedo(i,j)=alb_rural(i,j)</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span><span class="comment">! rename *_urb to sh_urb2d,lh_urb2d,g_urb2d,rn_urb2d</span></div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>         grdflx(i,j)= (1.-frc_urb2d(i,j))*grdflx_rural(i,j)+frc_urb2d(i,j)*grdflx_urb(i,j) </div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>         qfx(i,j)=(1.-frc_urb2d(i,j))*qfx_rural(i,j)+qfx_urb(i,j)</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span><span class="comment">!        lh(i,j)=(1.-frc_urb2d(i,j))*qfx_rural(i,j)*xlv</span></div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>         lh(i,j)=qfx(i,j)*xlv</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>         hfx(i,j) = hfx_urb(i,j)+(1-frc_urb2d(i,j))*hfx_rural(i,j)         <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>            sh_urb2d(i,j)    = hfx_urb(i,j)/frc_urb2d(i,j)</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>            lh_urb2d(i,j)    = qfx_urb(i,j)*xlv</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>            g_urb2d(i,j)     = grdflx_urb(i,j)</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>            rn_urb2d(i,j)    = rs_abs_urb(i,j)+emiss_urb(i,j)*glw(i,j)-rl_up_urb(i,j)</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>            ust(i,j)=(umom**2.+vmom**2.)**.25</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span><span class="comment">!          if(tsk(i,j).gt.350)write(*,*)&#39;tsk too big!&#39;,i,j,tsk(i,j)</span></div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span><span class="comment">!          if(tsk(i,j).lt.260)write(*,*)&#39;tsk too small!&#39;,i,j,tsk(i,j),rl_up_tot,rl_up_urb(i,j),rl_up_rural</span></div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span><span class="comment">!                    print*,&#39;ivgtyp,i,j,sigma_sb&#39;,ivgtyp(i,j),i,j,sigma_sb</span></div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span><span class="comment">!                    print*,&#39;hfx,lh,qfx,grdflx,ts_urb2d&#39;,hfx(i,j),lh(i,j),qfx(i,j),grdflx(i,j),ts_urb2d(i,j)</span></div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span><span class="comment">!                    print*,&#39;tsk,albedo,emiss&#39;,tsk(i,j),albedo(i,j),emiss(i,j)</span></div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span><span class="comment">!                if(i.eq.56.and.j.eq.29)then</span></div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span><span class="comment">!                    print*,&#39;ivgtyp, qfx, hfx&#39;,ivgtyp(i,j),hfx_rural(i,j),qfx_rural(i,j)</span></div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span><span class="comment">!                    print*,&#39;emiss_rural,emiss_urb&#39;,emiss_rural(i,j),emiss_urb(i,j)</span></div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span><span class="comment">!                    print*,&#39;rl_up_rural,rl_up_urb(i,j)&#39;,rl_up_rural,rl_up_urb(i,j)</span></div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span><span class="comment">!                    print*,&#39;tsk_rural,ts_urb2d(i,j),tsk&#39;,tsk_rural(i,j),ts_urb2d(i,j),tsk(i,j)</span></div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span><span class="comment">!                    print*,&#39;reconstruction fei&#39;,((emiss(i,j)*tsk(i,j)**4.-frc_urb2d(i,j)*emiss_urb(i,j)*ts_urb2d(i,j)**4.)/(emiss_rural(i,j)*(1.-frc_urb2d(i,j))))**.25</span></div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span><span class="comment">!                    print*,&#39;ivgtyp,hfx,hfx_urb,hfx_rural&#39;,hfx(i,j),hfx_urb(i,j),hfx_rural(i,j)</span></div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span><span class="comment">!                    print*,&#39;lh,lh_rural&#39;,lh(i,j),lh_rural(i,j)</span></div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span><span class="comment">!                    print*,&#39;qfx&#39;,qfx(i,j)</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span><span class="comment">!                    print*,&#39;ts_urb2d&#39;,ts_urb2d(i,j)</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span><span class="comment">!                    print*,&#39;ust&#39;,ust(i,j)</span></div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span><span class="comment">!                    print*,&#39;swdown,glw&#39;,swdown(i,j),glw(i,j)</span></div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span><span class="comment">!                endif</span></div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>              sh_urb2d(i,j)    = 0.</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>              lh_urb2d(i,j)    = 0.</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>              g_urb2d(i,j)     = 0.</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>              rn_urb2d(i,j)    = 0.</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span><span class="comment">!          IF( IVGTYP(I,J) == 1 .or. IVGTYP(I,J) == LOW_DENSITY_RESIDENTIAL .or. &amp;</span></div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span><span class="comment">!                  IVGTYP(I,J) == HIGH_DENSITY_RESIDENTIAL .or. IVGTYP(I,J) == HIGH_INTENSITY_INDUSTRIAL) THEN</span></div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span><span class="comment">!                    print*,&#39;ivgtyp, qfx, hfx&#39;,ivgtyp(i,j),hfx_rural(i,j),qfx_rural(i,j)</span></div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span><span class="comment">!                    print*,&#39;ivgtyp,hfx,hfx_urb,hfx_rural&#39;,hfx(i,j),hfx_urb(i,j),hfx_rural(i,j)</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span><span class="comment">!                    print*,&#39;lh,lh_rural&#39;,lh(i,j),lh_rural(i,j)</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span><span class="comment">!                    print*,&#39;qfx&#39;,qfx(i,j)</span></div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span><span class="comment">!                    print*,&#39;ts_urb2d&#39;,ts_urb2d(i,j)</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span><span class="comment">!                    print*,&#39;ust&#39;,ust(i,j)</span></div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span><span class="comment">!          endif</span></div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span> </div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span> </div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span><span class="keywordflow">       endif</span>                                                           <span class="comment">!Bep end</span></div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span> </div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span><span class="comment">!------------------------------------------------------</span></div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>   <span class="keyword">END SUBROUTINE </span><a class="code hl_function" href="namespacemodule__sf__noahdrv.html#a4c04acb56a9d85687443946a1d0a3cfe">lsm</a></div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span><span class="comment">!------------------------------------------------------</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span> </div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span><span class="comment">!For MPAS, the below section of the module is moved to module_physics_lsm_noahinit.F in</span></div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span><span class="comment">!./../core_physics to accomodate differences in the mpi calls between WRF and MPAS.I thought</span></div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span><span class="comment">!that it would be cleaner to do this instead of adding a lot of #ifdef statements throughout</span></div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span><span class="comment">!the initialization subroutine.</span></div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span> </div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span><span class="preprocessor">#if defined(wrfmodel)</span></div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"><a class="line" href="namespacemodule__sf__noahdrv.html#aa8a77a4699e9431687998d983cfb700f"> 1694</a></span><span class="preprocessor"></span>  <span class="keyword">SUBROUTINE </span>lsminit(VEGFRA,SNOW,SNOWC,SNOWH,CANWAT,SMSTAV,    &amp;</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>                     SMSTOT, SFCRUNOFF,UDRUNOFF,ACSNOW,        &amp;</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>                     ACSNOM,IVGTYP,ISLTYP,TSLB,SMOIS,SH2O,ZS,DZS, &amp;</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>                     MMINLU,                                   &amp;</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>                     SNOALB, FNDSOILW, FNDSNOWH, RDMAXALB,     &amp;</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>                     num_soil_layers, restart,                 &amp;</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>                     allowed_to_read ,                         &amp;</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>                     ids,ide, jds,jde, kds,kde,                &amp;</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>                     ims,ime, jms,jme, kms,kme,                &amp;</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>                     its,ite, jts,jte, kts,kte                 )</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span> </div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::     ids,ide, jds,jde, kds,kde,  &amp;</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>                                    ims,ime, jms,jme, kms,kme,  &amp;</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>                                    its,ite, jts,jte, kts,kte</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span> </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>       ::     num_soil_layers</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span> </div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>   <span class="keywordtype">LOGICAL</span> , <span class="keywordtype">INTENT(IN)</span> :: restart , allowed_to_read</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span> </div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( num_soil_layers)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: ZS, DZS</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span> </div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, num_soil_layers, jms:jme )</span>    , &amp;</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>            <span class="keywordtype">INTENT(INOUT)</span>    ::                          SMOIS, &amp;  <span class="comment">!Total soil moisture</span></div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>                                                         SH2O,  &amp;  <span class="comment">!liquid soil moisture</span></div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>                                                         TSLB      <span class="comment">!STEMP</span></div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span> </div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>            <span class="keywordtype">INTENT(INOUT)</span>    ::                           SNOW, &amp;</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>                                                         SNOWH, &amp;</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>                                                         SNOWC, &amp;</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>                                                        SNOALB, &amp;</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>                                                        CANWAT, &amp;</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>                                                        SMSTAV, &amp;</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>                                                        SMSTOT, &amp;</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>                                                     SFCRUNOFF, &amp;</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>                                                      UDRUNOFF, &amp;</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>                                                        ACSNOW, &amp;</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>                                                        VEGFRA, &amp;</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>                                                        ACSNOM</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span> </div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>            <span class="keywordtype">INTENT(IN)</span>       ::                         IVGTYP, &amp;</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>                                                        ISLTYP</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>   <span class="keywordtype">CHARACTER(LEN=*)</span>,  <span class="keywordtype">INTENT(IN)</span>      ::                MMINLU</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span> </div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>   <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(IN)</span>       ::                      FNDSOILW , &amp;</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>                                                     FNDSNOWH</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>   <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(IN)</span>       ::                      RDMAXALB</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span> </div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span> </div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>   <span class="keywordtype">INTEGER</span>                   :: L</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span><span class="keywordtype">   REAL</span>                      :: BX, SMCMAX, PSISAT, FREE</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">PARAMETER</span>           :: BLIM = 5.5, hlice = 3.335e5,    &amp;</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>                                grav = 9.81, t0 = 273.15</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>   <span class="keywordtype">INTEGER</span>                   :: errflag</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>   <span class="keywordtype">CHARACTER(LEN=80)</span>         :: err_message</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span> </div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>   <span class="keywordtype">character*256</span> :: MMINSL</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>        mminsl=<span class="stringliteral">&#39;STAS&#39;</span></div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span><span class="comment">!</span></div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span> </div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span><span class="comment">! initialize three Noah LSM related tables</span></div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>   <span class="keywordflow">IF</span> ( allowed_to_read ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>     <span class="keyword">CALL </span>wrf_message( <span class="stringliteral">&#39;INITIALIZE THREE Noah LSM RELATED TABLES&#39;</span> )</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>     <span class="keyword">CALL  </span>soil_veg_gen_parm( mminlu, mminsl )</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span><span class="keywordflow">   ENDIF</span></div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span> </div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span><span class="comment">! GAC--&gt;</span></div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span><span class="comment">! 20130219 - No longer need these - see module_data_gocart_dust</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span><span class="comment">!#if ( WRF_CHEM == 1 )</span></div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span><span class="comment">!!</span></div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span><span class="comment">!! need this parameter for dust parameterization in wrf/chem</span></div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span><span class="comment">!!</span></div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span><span class="comment">!   do I=1,NSLTYPE</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span><span class="comment">!      porosity(i)=maxsmc(i)</span></div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span><span class="comment">!      drypoint(i)=drysmc(i)</span></div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span><span class="comment">!   enddo</span></div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span><span class="comment">!#endif</span></div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span><span class="comment">! &lt;--GAC</span></div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span> </div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>   <span class="keywordflow">IF</span>(.not.restart)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span> </div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>   itf=min0(ite,ide-1)</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>   jtf=min0(jte,jde-1)</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span> </div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>   errflag = 0</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>   <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>     <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>       <span class="keywordflow">IF</span> ( isltyp( i,j ) .LT. 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>         errflag = 1</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>         <span class="keyword">WRITE</span>(err_message,*)<span class="stringliteral">&quot;module_sf_noahdrv.F: lsminit: out of range ISLTYP &quot;</span>,i,j,isltyp( i,j )</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>         <span class="keyword">CALL </span>wrf_message(err_message)</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span><span class="keywordflow">       ENDIF</span></div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>       <span class="keywordflow">IF</span>(.not.rdmaxalb) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>          snoalb(i,j)=<a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#aaf2ec4ae19423d4c1b907274266e1f75">maxalb</a>(ivgtyp(i,j))*0.01</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span><span class="keywordflow">       ENDIF</span></div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span><span class="keywordflow">     ENDDO</span></div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span><span class="keywordflow">   ENDDO</span></div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>   <span class="keywordflow">IF</span> ( errflag .EQ. 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span><span class="preprocessor">#if ( HWRF == 1 ) </span></div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span><span class="preprocessor"></span>      <span class="keyword">CALL </span>wrf_message( <span class="stringliteral">&quot;WARNING: message only; was fatal. module_sf_noahdrv.F: lsminit: out of range value &quot;</span>// &amp;</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>                            <span class="stringliteral">&quot;of ISLTYP. Is this field in the input?&quot;</span> )</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span><span class="preprocessor"></span>      <span class="keyword">CALL </span>wrf_error_fatal( <span class="stringliteral">&quot;module_sf_noahdrv.F: lsminit: out of range value &quot;</span>// &amp;</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>                            <span class="stringliteral">&quot;of ISLTYP. Is this field in the input?&quot;</span> )</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span><span class="preprocessor"></span><span class="keywordflow">   ENDIF</span></div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span> </div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span><span class="comment">! initialize soil liquid water content SH2O</span></div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span> </div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span><span class="comment">!  IF(.NOT.FNDSOILW) THEN</span></div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span> </div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span><span class="comment">! If no SWC, do the following</span></div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span><span class="comment">!         PRINT *,&#39;SOIL WATER NOT FOUND - VALUE SET IN LSMINIT&#39;</span></div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>        <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>        <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>          bx = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a421c11109bef5a1c768d721cb746c495">bb</a>(isltyp(i,j))</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>          smcmax = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae7e9abc3699009623585d342ed700ea8">maxsmc</a>(isltyp(i,j))</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>          psisat = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a2d3913e03c9d3f6dc2f1817689a70aa7">satpsi</a>(isltyp(i,j))</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>         <span class="keywordflow">if</span> ((bx &gt; 0.0).and.(smcmax &gt; 0.0).and.(psisat &gt; 0.0)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>          <span class="keywordflow">DO</span> ns=1, num_soil_layers</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span><span class="comment">!SH2O  &lt;= SMOIS for T &lt; 273.149K (-0.001C)</span></div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>             <span class="keywordflow">IF</span> (tslb(i,ns,j) &lt; 273.149) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span><span class="comment">! first guess following explicit solution for Flerchinger Eqn from Koren</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span><span class="comment">! et al, JGR, 1999, Eqn 17 (KCOUNT=0 in FUNCTION FRH2O).</span></div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span><span class="comment">! ISLTPK is soil type</span></div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>              bx = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a421c11109bef5a1c768d721cb746c495">bb</a>(isltyp(i,j))</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>              smcmax = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#ae7e9abc3699009623585d342ed700ea8">maxsmc</a>(isltyp(i,j))</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>              psisat = <a class="code hl_variable" href="namespacemodule__sf__noahlsm.html#a2d3913e03c9d3f6dc2f1817689a70aa7">satpsi</a>(isltyp(i,j))</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>              <span class="keywordflow">IF</span> ( bx &gt;  blim ) bx = blim</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>              fk=(( (hlice/(grav*(-psisat))) *                              &amp;</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>                 ((tslb(i,ns,j)-t0)/tslb(i,ns,j)) )**(-1/bx) )*smcmax</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>              <span class="keywordflow">IF</span> (fk &lt; 0.02) fk = 0.02</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>              sh2o(i,ns,j) = min( fk, smois(i,ns,j) )</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span><span class="comment">! now use iterative solution for liquid soil water content using</span></div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span><span class="comment">! FUNCTION FRH2O with the initial guess for SH2O from above explicit</span></div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span><span class="comment">! first guess.</span></div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>              <span class="keyword">CALL </span><a class="code hl_function" href="namespacemodule__sf__noahlsm.html#a5beb42f74e1a357ccfc0e904f356b33a">frh2o</a> (free,tslb(i,ns,j),smois(i,ns,j),sh2o(i,ns,j),    &amp;</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>                 smcmax,bx,psisat)</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>              sh2o(i,ns,j) = free</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>             <span class="keywordflow">ELSE</span>             <span class="comment">! of IF (TSLB(I,NS,J)</span></div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span><span class="comment">! SH2O = SMOIS ( for T =&gt; 273.149K (-0.001C)</span></div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>              sh2o(i,ns,j)=smois(i,ns,j)</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span><span class="keywordflow">             ENDIF</span>            <span class="comment">! of IF (TSLB(I,NS,J)</span></div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span><span class="keywordflow">          END DO</span>              <span class="comment">! of DO NS=1, num_soil_layers</span></div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>         <span class="keywordflow">else</span>                 <span class="comment">! of if ((bx &gt; 0.0)</span></div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>          <span class="keywordflow">DO</span> ns=1, num_soil_layers</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>           sh2o(i,ns,j)=smois(i,ns,j)</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span><span class="keywordflow">          END DO</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span><span class="keywordflow">         endif</span>                <span class="comment">! of if ((bx &gt; 0.0)</span></div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span><span class="keywordflow">        ENDDO</span>                 <span class="comment">! DO I = its,itf</span></div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span><span class="keywordflow">        ENDDO</span>                 <span class="comment">! DO J = jts,jtf</span></div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span><span class="comment">!  ENDIF                       ! of IF(.NOT.FNDSOILW)THEN</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span> </div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span><span class="comment">! initialize physical snow height SNOWH</span></div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span> </div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>        <span class="keywordflow">IF</span>(.NOT.fndsnowh)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span><span class="comment">! If no SNOWH do the following</span></div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>          <span class="keyword">CALL </span>wrf_message( <span class="stringliteral">&#39;SNOW HEIGHT NOT FOUND - VALUE DEFINED IN LSMINIT&#39;</span> )</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>          <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>          <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>            snowh(i,j)=snow(i,j)*0.005               <span class="comment">! SNOW in mm and SNOWH in m</span></div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span> </div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span><span class="comment">! initialize canopy water to ZERO</span></div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span> </div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span><span class="comment">!          GO TO 110</span></div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span><span class="comment">!         print*,&#39;Note that canopy water content (CANWAT) is set to ZERO in LSMINIT&#39;</span></div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>          <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>          <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>            canwat(i,j)=0.0</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span> 110      <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span> </div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span><span class="keywordflow">   ENDIF</span></div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span><span class="comment">!------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span>  <span class="keyword">END SUBROUTINE </span>lsminit</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span><span class="comment">!------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span> </div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span> </div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span> </div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span><span class="comment">!-----------------------------------------------------------------</span></div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"><a class="line" href="namespacemodule__sf__noahdrv.html#aeb286b1a6b9c0691f65581432dbf283f"> 1884</a></span>        <span class="keyword">SUBROUTINE </span>soil_veg_gen_parm( MMINLU, MMINSL)</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span><span class="comment">!-----------------------------------------------------------------</span></div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span> </div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>        <span class="keywordtype">USE </span>module_wrf_error</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>        <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span> </div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>        <span class="keywordtype">CHARACTER(LEN=*)</span>, <span class="keywordtype">INTENT(IN)</span> :: MMINLU, MMINSL</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>        <span class="keywordtype">integer</span> :: LUMATCH, IINDEX, LC, NUM_SLOPE</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>        <span class="keywordtype">integer</span> :: ierr</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>        <span class="keywordtype">INTEGER</span> , <span class="keywordtype">PARAMETER</span> :: OPEN_OK = 0</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span> </div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span>        <span class="keywordtype">character*128</span> :: mess , message</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>        <span class="keywordtype">character*256</span> :: a_string</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>        <span class="keywordtype">logical</span>, <span class="keywordtype">external</span> :: wrf_dm_on_monitor</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">parameter</span> :: loop_max   = 10</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>        <span class="keywordtype">integer</span>             :: loop_count</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span> </div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span> </div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span><span class="comment">!-----SPECIFY VEGETATION RELATED CHARACTERISTICS :</span></div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span><span class="comment">!             ALBBCK: SFC albedo (in percentage)</span></div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span><span class="comment">!                 Z0: Roughness length (m)</span></div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span><span class="comment">!             SHDFAC: Green vegetation fraction (in percentage)</span></div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span><span class="comment">!  Note: The ALBEDO, Z0, and SHDFAC values read from the following table</span></div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span><span class="comment">!          ALBEDO, amd Z0 are specified in LAND-USE TABLE; and SHDFAC is</span></div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span><span class="comment">!          the monthly green vegetation data</span></div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span><span class="comment">!             CMXTBL: MAX CNPY Capacity (m)</span></div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span><span class="comment">!             NROTBL: Rooting depth (layer)</span></div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span><span class="comment">!              RSMIN: Mimimum stomatal resistance (s m-1)</span></div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span><span class="comment">!              RSMAX: Max. stomatal resistance (s m-1)</span></div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span><span class="comment">!                RGL: Parameters used in radiation stress function</span></div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span><span class="comment">!                 HS: Parameter used in vapor pressure deficit functio</span></div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span><span class="comment">!               TOPT: Optimum transpiration air temperature. (K)</span></div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span><span class="comment">!             CMCMAX: Maximum canopy water capacity</span></div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span><span class="comment">!             CFACTR: Parameter used in the canopy inteception calculati</span></div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span><span class="comment">!               SNUP: Threshold snow depth (in water equivalent m) that</span></div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span><span class="comment">!                     implies 100% snow cover</span></div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span><span class="comment">!                LAI: Leaf area index (dimensionless)</span></div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span><span class="comment">!             MAXALB: Upper bound on maximum albedo over deep snow</span></div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span><span class="comment">!</span></div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span><span class="comment">!-----READ IN VEGETAION PROPERTIES FROM VEGPARM.TBL</span></div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span><span class="comment">!</span></div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span> </div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>       <span class="keywordflow">IF</span> ( wrf_dm_on_monitor() ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span> </div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>        <span class="keyword">OPEN</span>(19, file=<span class="stringliteral">&#39;VEGPARM.TBL&#39;</span>,form=<span class="stringliteral">&#39;FORMATTED&#39;</span>,status=<span class="stringliteral">&#39;OLD&#39;</span>,iostat=ierr)</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>        <span class="keywordflow">IF</span>(ierr .NE. open_ok ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>          <span class="keyword">WRITE</span>(message,fmt=<span class="stringliteral">&#39;(A)&#39;</span>) &amp;</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>          <span class="stringliteral">&#39;module_sf_noahlsm.F: soil_veg_gen_parm: failure opening VEGPARM.TBL&#39;</span></div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>          <span class="keyword">CALL </span>wrf_error_fatal ( message )</div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span><span class="keywordflow">        END IF</span></div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span> </div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span> </div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>        lumatch=0</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span> </div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>        loop_count = 0</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>        <span class="keyword">READ</span> (19,fmt=<span class="stringliteral">&#39;(A)&#39;</span>,<span class="keyword">END</span>=2002) a_string</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span>        find_lutype : <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span> (lumatch == 0)</div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>           <span class="keyword">READ</span> (19,*,<span class="keyword">END</span>=2002)lutype</div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>           <span class="keyword">READ</span> (19,*)lucats,iindex</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span> </div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span>           <span class="keywordflow">IF</span>(lutype.EQ.mminlu)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>              <span class="keyword">WRITE</span>( mess , * ) <span class="stringliteral">&#39;LANDUSE TYPE = &#39;</span> // trim( lutype ) // <span class="stringliteral">&#39; FOUND&#39;</span>, lucats,<span class="stringliteral">&#39; CATEGORIES&#39;</span></div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>              <span class="keyword">CALL </span>wrf_message( mess )</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>              lumatch=1</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>           <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>              loop_count = loop_count+1</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>              <span class="keyword">call </span>wrf_message ( <span class="stringliteral">&quot;Skipping over LUTYPE = &quot;</span> // trim( lutype ) )</div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>              find_vegetation_parameter_flag : <span class="keywordflow">DO</span></div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span>                 <span class="keyword">READ</span> (19,fmt=<span class="stringliteral">&#39;(A)&#39;</span>, <span class="keyword">END</span>=2002) a_string</div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>                 <span class="keywordflow">IF</span> ( a_string(1:21) .EQ. <span class="stringliteral">&#39;Vegetation Parameters&#39;</span> ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>                    <span class="keywordflow">EXIT</span> find_vegetation_parameter_flag</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>                 <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> ( loop_count .GE. loop_max ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>                    <span class="keyword">CALL </span>wrf_error_fatal ( <span class="stringliteral">&#39;Too many loops in VEGPARM.TBL&#39;</span>)</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span><span class="keywordflow">                 ENDIF</span></div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span><span class="keywordflow">              ENDDO</span> find_vegetation_parameter_flag</div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span><span class="keywordflow">        ENDDO</span> find_lutype</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span><span class="comment">! prevent possible array overwrite, Bill Bovermann, IBM, May 6, 2008</span></div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>        <span class="keywordflow">IF</span> ( <span class="keyword">SIZE</span>(shdtbl)       &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>             <span class="keyword">SIZE</span>(nrotbl)       &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>             <span class="keyword">SIZE</span>(rstbl)        &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>             <span class="keyword">SIZE</span>(rgltbl)       &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>             <span class="keyword">SIZE</span>(hstbl)        &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span>             <span class="keyword">SIZE</span>(snuptbl)      &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span>             <span class="keyword">SIZE</span>(maxalb)       &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>             <span class="keyword">SIZE</span>(laimintbl)    &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>             <span class="keyword">SIZE</span>(laimaxtbl)    &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>             <span class="keyword">SIZE</span>(z0mintbl)     &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>             <span class="keyword">SIZE</span>(z0maxtbl)     &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>             <span class="keyword">SIZE</span>(albedomintbl) &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>             <span class="keyword">SIZE</span>(albedomaxtbl) &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>             <span class="keyword">SIZE</span>(ztopvtbl) &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>             <span class="keyword">SIZE</span>(zbotvtbl) &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>             <span class="keyword">SIZE</span>(emissmintbl ) &lt; lucats .OR. &amp;</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>             <span class="keyword">SIZE</span>(emissmaxtbl ) &lt; lucats ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>           <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;Table sizes too small for value of LUCATS in module_sf_noahdrv.F&#39;</span>)</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span> </div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>        <span class="keywordflow">IF</span>(lutype.EQ.mminlu)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>          <span class="keywordflow">DO</span> lc=1,lucats</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>              <span class="keyword">READ</span> (19,*)iindex,shdtbl(lc),                        &amp;</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>                        nrotbl(lc),rstbl(lc),rgltbl(lc),hstbl(lc), &amp;</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>                        snuptbl(lc),maxalb(lc), laimintbl(lc),     &amp;</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>                        laimaxtbl(lc),emissmintbl(lc),             &amp;</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>                        emissmaxtbl(lc), albedomintbl(lc),         &amp;</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>                        albedomaxtbl(lc), z0mintbl(lc), z0maxtbl(lc),&amp;</div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>            ztopvtbl(lc), zbotvtbl(lc)</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><span class="comment">!</span></div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>          <span class="keyword">READ</span> (19,*)topt_data</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>          <span class="keyword">READ</span> (19,*)cmcmax_data</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>          <span class="keyword">READ</span> (19,*)cfactr_data</div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>          <span class="keyword">READ</span> (19,*)rsmax_data</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>          <span class="keyword">READ</span> (19,*)bare</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>          <span class="keyword">READ</span> (19,*)natural</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span>          <span class="keyword">READ</span> (19,fmt=<span class="stringliteral">&#39;(A)&#39;</span>) a_string</div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>          <span class="keywordflow">IF</span> ( a_string(1:21) .EQ. <span class="stringliteral">&#39;Vegetation Parameters&#39;</span> ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>             <span class="keyword">CALL </span>wrf_message     (<span class="stringliteral">&quot;Expected low and high density residential, and high density industrial information in VEGPARM.TBL&quot;</span>)</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>             <span class="keyword">CALL </span>wrf_error_fatal (<span class="stringliteral">&quot;This could be caused by using an older VEGPARM.TBL file with a newer WRF source code.&quot;</span>)</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>          <span class="keyword">READ</span> (19,*)low_density_residential</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>          <span class="keyword">READ</span> (19,*)high_density_residential</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>          <span class="keyword">READ</span> (19,*)high_intensity_industrial</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span><span class="comment">!</span></div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span> 2002   <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span> </div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>        <span class="keyword">CLOSE</span> (19)</div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>        <span class="keywordflow">IF</span> (lumatch == 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>           <span class="keyword">CALL </span>wrf_error_fatal (<span class="stringliteral">&quot;Land Use Dataset &#39;&quot;</span>//mminlu//<span class="stringliteral">&quot;&#39; not found in VEGPARM.TBL.&quot;</span>)</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span> </div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>      <span class="keyword">CALL </span>wrf_dm_bcast_string  ( lutype  , 4 )</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( lucats  , 1 )</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( iindex  , 1 )</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( lumatch , 1 )</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( shdtbl  , nlus )</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( nrotbl  , nlus )</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( rstbl   , nlus )</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( rgltbl  , nlus )</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( hstbl   , nlus )</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( snuptbl , nlus )</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( laimintbl    , nlus )</div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( laimaxtbl    , nlus )</div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( z0mintbl     , nlus )</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( z0maxtbl     , nlus )</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( emissmintbl  , nlus )</div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( emissmaxtbl  , nlus )</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( albedomintbl , nlus )</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( albedomaxtbl , nlus )</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( ztopvtbl , nlus )</div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( zbotvtbl , nlus )</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( maxalb  , nlus )</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( topt_data    , 1 )</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( cmcmax_data  , 1 )</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( cfactr_data  , 1 )</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( rsmax_data  , 1 )</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( bare    , 1 )</div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( natural , 1 )</div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( low_density_residential , 1 )</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( high_density_residential , 1 )</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( high_intensity_industrial , 1 )</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span> </div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span><span class="comment">!</span></div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span><span class="comment">!-----READ IN SOIL PROPERTIES FROM SOILPARM.TBL</span></div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span><span class="comment">!</span></div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>      <span class="keywordflow">IF</span> ( wrf_dm_on_monitor() ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>        <span class="keyword">OPEN</span>(19, file=<span class="stringliteral">&#39;SOILPARM.TBL&#39;</span>,form=<span class="stringliteral">&#39;FORMATTED&#39;</span>,status=<span class="stringliteral">&#39;OLD&#39;</span>,iostat=ierr)</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>        <span class="keywordflow">IF</span>(ierr .NE. open_ok ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>          <span class="keyword">WRITE</span>(message,fmt=<span class="stringliteral">&#39;(A)&#39;</span>) &amp;</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>          <span class="stringliteral">&#39;module_sf_noahlsm.F: soil_veg_gen_parm: failure opening SOILPARM.TBL&#39;</span></div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>          <span class="keyword">CALL </span>wrf_error_fatal ( message )</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span><span class="keywordflow">        END IF</span></div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span> </div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>        <span class="keyword">WRITE</span>(mess,*) <span class="stringliteral">&#39;INPUT SOIL TEXTURE CLASSIFICATION = &#39;</span>, trim( mminsl )</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>        <span class="keyword">CALL </span>wrf_message( mess )</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span> </div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>        lumatch=0</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span> </div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>        <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>        <span class="keyword">READ</span> (19,2000,<span class="keyword">END</span>=2003)sltype</div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span> 2000   <span class="keyword">FORMAT</span> (a4)</div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>        <span class="keyword">READ</span> (19,*)slcats,iindex</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>        <span class="keywordflow">IF</span>(sltype.EQ.mminsl)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>            <span class="keyword">WRITE</span>( mess , * ) <span class="stringliteral">&#39;SOIL TEXTURE CLASSIFICATION = &#39;</span>, trim( sltype ) , <span class="stringliteral">&#39; FOUND&#39;</span>, &amp;</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>                  slcats,<span class="stringliteral">&#39; CATEGORIES&#39;</span></div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>            <span class="keyword">CALL </span>wrf_message ( mess )</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>          lumatch=1</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span><span class="comment">! prevent possible array overwrite, Bill Bovermann, IBM, May 6, 2008</span></div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>        <span class="keywordflow">IF</span> ( <span class="keyword">SIZE</span>(bb    ) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>             <span class="keyword">SIZE</span>(drysmc) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>             <span class="keyword">SIZE</span>(f11   ) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>             <span class="keyword">SIZE</span>(maxsmc) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span>             <span class="keyword">SIZE</span>(refsmc) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>             <span class="keyword">SIZE</span>(satpsi) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>             <span class="keyword">SIZE</span>(satdk ) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>             <span class="keyword">SIZE</span>(satdw ) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>             <span class="keyword">SIZE</span>(wltsmc) &lt; slcats .OR. &amp;</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>             <span class="keyword">SIZE</span>(qtz   ) &lt; slcats  ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span>           <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;Table sizes too small for value of SLCATS in module_sf_noahdrv.F&#39;</span>)</div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>        <span class="keywordflow">IF</span>(sltype.EQ.mminsl)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>          <span class="keywordflow">DO</span> lc=1,slcats</div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>              <span class="keyword">READ</span> (19,*) iindex,bb(lc),drysmc(lc),f11(lc),maxsmc(lc),&amp;</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>                        refsmc(lc),satpsi(lc),satdk(lc), satdw(lc),   &amp;</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>                        wltsmc(lc), qtz(lc)</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span> </div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span> 2003   <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span> </div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>        <span class="keyword">CLOSE</span> (19)</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span> </div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( lumatch , 1 )</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>      <span class="keyword">CALL </span>wrf_dm_bcast_string  ( sltype  , 4 )</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>      <span class="keyword">CALL </span>wrf_dm_bcast_string  ( mminsl  , 4 )  <span class="comment">! since this is reset above, see oct2 ^</span></div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( slcats  , 1 )</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( iindex  , 1 )</div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( bb      , nsltype )</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( drysmc  , nsltype )</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( f11     , nsltype )</div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( maxsmc  , nsltype )</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( refsmc  , nsltype )</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( satpsi  , nsltype )</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( satdk   , nsltype )</div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( satdw   , nsltype )</div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( wltsmc  , nsltype )</div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( qtz     , nsltype )</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span> </div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>      <span class="keywordflow">IF</span>(lumatch.EQ.0)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span>          <span class="keyword">CALL </span>wrf_message( <span class="stringliteral">&#39;SOIl TEXTURE IN INPUT FILE DOES NOT &#39;</span> )</div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>          <span class="keyword">CALL </span>wrf_message( <span class="stringliteral">&#39;MATCH SOILPARM TABLE&#39;</span>                 )</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>          <span class="keyword">CALL </span>wrf_error_fatal ( <span class="stringliteral">&#39;INCONSISTENT OR MISSING SOILPARM FILE&#39;</span> )</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span> </div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span><span class="comment">!</span></div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span><span class="comment">!-----READ IN GENERAL PARAMETERS FROM GENPARM.TBL</span></div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span><span class="comment">!</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span>      <span class="keywordflow">IF</span> ( wrf_dm_on_monitor() ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>        <span class="keyword">OPEN</span>(19, file=<span class="stringliteral">&#39;GENPARM.TBL&#39;</span>,form=<span class="stringliteral">&#39;FORMATTED&#39;</span>,status=<span class="stringliteral">&#39;OLD&#39;</span>,iostat=ierr)</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>        <span class="keywordflow">IF</span>(ierr .NE. open_ok ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>          <span class="keyword">WRITE</span>(message,fmt=<span class="stringliteral">&#39;(A)&#39;</span>) &amp;</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span>          <span class="stringliteral">&#39;module_sf_noahlsm.F: soil_veg_gen_parm: failure opening GENPARM.TBL&#39;</span></div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span>          <span class="keyword">CALL </span>wrf_error_fatal ( message )</div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span><span class="keywordflow">        END IF</span></div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span> </div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>        <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>        <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>        <span class="keyword">READ</span> (19,*) num_slope</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span> </div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>          slpcats=num_slope</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span><span class="comment">! prevent possible array overwrite, Bill Bovermann, IBM, May 6, 2008</span></div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>          <span class="keywordflow">IF</span> ( <span class="keyword">SIZE</span>(slope_data) &lt; num_slope ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>            <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;NUM_SLOPE too large for slope_data array in module_sf_noahdrv&#39;</span>)</div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span> </div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>          <span class="keywordflow">DO</span> lc=1,slpcats</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>              <span class="keyword">READ</span> (19,*)slope_data(lc)</div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span> </div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>          <span class="keyword">READ</span> (19,*)sbeta_data</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>          <span class="keyword">READ</span> (19,*)fxexp_data</div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>          <span class="keyword">READ</span> (19,*)csoil_data</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span>          <span class="keyword">READ</span> (19,*)salp_data</div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span>          <span class="keyword">READ</span> (19,*)refdk_data</div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>          <span class="keyword">READ</span> (19,*)refkdt_data</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span>          <span class="keyword">READ</span> (19,*)frzk_data</div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span>          <span class="keyword">READ</span> (19,*)zbot_data</div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span>          <span class="keyword">READ</span> (19,*)czil_data</div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>          <span class="keyword">READ</span> (19,*)smlow_data</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span>          <span class="keyword">READ</span> (19,*)smhigh_data</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>          <span class="keyword">READ</span> (19,*)</div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span>          <span class="keyword">READ</span> (19,*)lvcoef_data</div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>        <span class="keyword">CLOSE</span> (19)</div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span> </div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( num_slope    ,  1 )</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>      <span class="keyword">CALL </span>wrf_dm_bcast_integer ( slpcats      ,  1 )</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( slope_data   ,  nslope )</div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( sbeta_data   ,  1 )</div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( fxexp_data   ,  1 )</div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( csoil_data   ,  1 )</div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( salp_data    ,  1 )</div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( refdk_data   ,  1 )</div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( refkdt_data  ,  1 )</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( frzk_data    ,  1 )</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( zbot_data    ,  1 )</div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( czil_data    ,  1 )</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( smlow_data   ,  1 )</div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( smhigh_data  ,  1 )</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span>      <span class="keyword">CALL </span>wrf_dm_bcast_real    ( lvcoef_data  ,  1 )</div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span> </div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span> </div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span><span class="comment">!-----------------------------------------------------------------</span></div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>      <span class="keyword">END SUBROUTINE </span>soil_veg_gen_parm</div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span><span class="comment">!-----------------------------------------------------------------</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span> </div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span><span class="comment">!===========================================================================</span></div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span><span class="comment">!</span></div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span><span class="comment">! subroutine lsm_mosaic: a tiling approach for Noah LSM</span></div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span><span class="comment">!</span></div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span><span class="comment">!=========================================================================== </span></div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span> </div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"><a class="line" href="namespacemodule__sf__noahdrv.html#abb5d9a7134268d50cc5cca58ecd9b0ea"> 2211</a></span><span class="keyword">SUBROUTINE </span><a class="code hl_function" href="namespacemodule__sf__noahdrv.html#abb5d9a7134268d50cc5cca58ecd9b0ea">lsm_mosaic</a>(DZ8W,QV3D,P8W3D,T3D,TSK,                      &amp;</div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>                  HFX,QFX,LH,GRDFLX, QGH,GSW,SWDOWN,GLW,SMSTAV,SMSTOT, &amp;</div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>                  SFCRUNOFF, UDRUNOFF,IVGTYP,ISLTYP,ISURBAN,ISICE,VEGFRA,    &amp;</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>                  ALBEDO,ALBBCK,ZNT,Z0,TMN,XLAND,XICE,EMISS,EMBCK,   &amp;</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>                  SNOWC,QSFC,RAINBL,MMINLU,                     &amp;</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>                  num_soil_layers,DT,DZS,ITIMESTEP,             &amp;</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>                  SMOIS,TSLB,SNOW,CANWAT,                       &amp;</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>                  CHS,CHS2,CQS2,CPM,ROVCP,SR,chklowq,lai,qz0,   &amp; !H</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span>                  myj,frpcpn,                                   &amp;</div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span>                  SH2O,SNOWH,                                   &amp; !H</div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>                  U_PHY,V_PHY,                                  &amp; !I</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>                  SNOALB,SHDMIN,SHDMAX,                         &amp; !I</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>                  SNOTIME,                                      &amp; !?</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span>                  ACSNOM,ACSNOW,                                &amp; !O</div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span>                  SNOPCX,                                       &amp; !O</div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>                  POTEVP,                                       &amp; !O</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>                  SMCREL,                                       &amp; !O</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>                  XICE_THRESHOLD,                               &amp;</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>                  RDLAI2D,USEMONALB,                            &amp;</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span>                  RIB,                                          &amp; !?</div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>                  NOAHRES,OPT_THCND,                            &amp;</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span>                 NLCAT,landusef,landusef2,                       &amp; ! danli mosaic</div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>                 sf_surface_mosaic,mosaic_cat,mosaic_cat_index,  &amp; ! danli mosaic </div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>                 TSK_mosaic,QSFC_mosaic,                         &amp; ! danli mosaic </div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>                 TSLB_mosaic,SMOIS_mosaic,SH2O_mosaic,           &amp; ! danli mosaic </div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>                 CANWAT_mosaic,SNOW_mosaic,                      &amp; ! danli mosaic</div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>                 SNOWH_mosaic,SNOWC_mosaic,                      &amp; ! danli mosaic </div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>                 ALBEDO_mosaic,ALBBCK_mosaic,                    &amp; ! danli mosaic</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>                 EMISS_mosaic, EMBCK_mosaic,                     &amp; ! danli mosaic</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>                 ZNT_mosaic, Z0_mosaic,                          &amp; ! danli mosaic </div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>                 HFX_mosaic,QFX_mosaic,                          &amp; ! danli mosaic</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span>                 LH_mosaic, GRDFLX_mosaic, SNOTIME_mosaic,       &amp; ! danli mosaic                   </div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span>                 RC_mosaic, LAI_mosaic,                          &amp;</div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>! Noah UA changes</div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span>                  ua_phys,flx4_2d,fvb_2d,fbur_2d,fgsn_2d,       &amp;</div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>                  ids,ide, jds,jde, kds,kde,                    &amp;</div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>                  ims,ime, jms,jme, kms,kme,                    &amp;</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>                  its,ite, jts,jte, kts,kte,                    &amp;</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>                  sf_urban_physics,                             &amp;</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>                  CMR_SFCDIF,CHR_SFCDIF,CMC_SFCDIF,CHC_SFCDIF,  &amp;</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>                  CMGR_SFCDIF,CHGR_SFCDIF,                      &amp;</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>!Optional Urban</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>                  TR_URB2D,TB_URB2D,TG_URB2D,TC_URB2D,QC_URB2D, &amp; !H urban</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>                  UC_URB2D,                                     &amp; !H urban</div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>                  XXXR_URB2D,XXXB_URB2D,XXXG_URB2D,XXXC_URB2D,  &amp; !H urban</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>                  TRL_URB3D,TBL_URB3D,TGL_URB3D,                &amp; !H urban</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>                  SH_URB2D,LH_URB2D,G_URB2D,RN_URB2D,TS_URB2D,  &amp; !H urban</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>                  TR_URB2D_mosaic,TB_URB2D_mosaic,              &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>                  TG_URB2D_mosaic,TC_URB2D_mosaic,              &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span>                  QC_URB2D_mosaic,UC_URB2D_mosaic,              &amp; !H urban  danli mosaic                  </div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span>                  TRL_URB3D_mosaic,TBL_URB3D_mosaic,            &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span>                  TGL_URB3D_mosaic,                             &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span>                  SH_URB2D_mosaic,LH_URB2D_mosaic,              &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>                  G_URB2D_mosaic,RN_URB2D_mosaic,               &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>                  TS_URB2D_mosaic,                              &amp; !H urban  danli mosaic</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>                  TS_RUL2D_mosaic,                              &amp; !H urban  danli mosaic                  </div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>                  PSIM_URB2D,PSIH_URB2D,U10_URB2D,V10_URB2D,    &amp; !O urban</div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>                  GZ1OZ0_URB2D,  AKMS_URB2D,                    &amp; !O urban</div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>                  TH2_URB2D,Q2_URB2D, UST_URB2D,                &amp; !O urban</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>                  DECLIN_URB,COSZ_URB2D,OMG_URB2D,              &amp; !I urban</div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>                  XLAT_URB2D,                                   &amp; !I urban</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>                  num_roof_layers, num_wall_layers,             &amp; !I urban</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>                  num_road_layers, DZR, DZB, DZG,               &amp; !I urban</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>                  CMCR_URB2D,TGR_URB2D,TGRL_URB3D,SMR_URB3D,    &amp; !H urban</div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span>                  julian,julyr,                                 &amp; !H urban</div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span>                  DRELR_URB2D,DRELB_URB2D,DRELG_URB2D,          &amp; !H urban</div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>                  FLXHUMR_URB2D,FLXHUMB_URB2D,FLXHUMG_URB2D,    &amp; !H urban</div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>                  FRC_URB2D,UTYPE_URB2D,                        &amp; !O</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span>                  num_urban_layers,                             &amp; !I multi-layer urban</div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>                  num_urban_hi,                                 &amp; !I multi-layer urban</div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>                  tsk_rural_bep,                                &amp; !H multi-layer urban</div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>                  trb_urb4d,tw1_urb4d,tw2_urb4d,tgb_urb4d,      &amp; !H multi-layer urban</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span>                  tlev_urb3d,qlev_urb3d,                        &amp; !H multi-layer urban</div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span>                  tw1lev_urb3d,tw2lev_urb3d,                    &amp; !H multi-layer urban</div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>                  tglev_urb3d,tflev_urb3d,                      &amp; !H multi-layer urban</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span>                  sf_ac_urb3d,lf_ac_urb3d,cm_ac_urb3d,          &amp; !H multi-layer urban</div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span>                  sfvent_urb3d,lfvent_urb3d,                    &amp; !H multi-layer urban</div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span>                  sfwin1_urb3d,sfwin2_urb3d,                    &amp; !H multi-layer urban</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>                  sfw1_urb3d,sfw2_urb3d,sfr_urb3d,sfg_urb3d,    &amp; !H multi-layer urban</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>                  lp_urb2d,hi_urb2d,lb_urb2d,hgt_urb2d,         &amp; !H multi-layer urban</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span>                  mh_urb2d,stdh_urb2d,lf_urb2d,                 &amp; !SLUCM</div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>                  th_phy,rho,p_phy,ust,                         &amp; !I multi-layer urban</div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>                  gmt,julday,xlong,xlat,                        &amp; !I multi-layer urban</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span>                  a_u_bep,a_v_bep,a_t_bep,a_q_bep,              &amp; !O multi-layer urban</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>                  a_e_bep,b_u_bep,b_v_bep,                      &amp; !O multi-layer urban</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>                  b_t_bep,b_q_bep,b_e_bep,dlg_bep,              &amp; !O multi-layer urban</div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>                  dl_u_bep,sf_bep,vl_bep                        &amp; !O multi-layer urban</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>                 ,sfcheadrt,INFXSRT, soldrain                   &amp; !hydro</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span>                 ,SDA_HFX, SDA_QFX, HFX_BOTH, QFX_BOTH, QNORM, fasdas     &amp;   !fasdas</div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>                 ,RC2,XLAI2                                     &amp; !O</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>                  )</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span> </div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span><span class="comment">! --- atmospheric (WRF generic) variables</span></div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span><span class="comment">!-- DT          time step (seconds)</span></div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span><span class="comment">!-- DZ8W        thickness of layers (m)</span></div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span><span class="comment">!-- T3D         temperature (K)</span></div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span><span class="comment">!-- QV3D        3D water vapor mixing ratio (Kg/Kg)</span></div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span><span class="comment">!-- P3D         3D pressure (Pa)</span></div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span><span class="comment">!-- FLHC        exchange coefficient for heat (m/s)</span></div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span><span class="comment">!-- FLQC        exchange coefficient for moisture (m/s)</span></div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span><span class="comment">!-- PSFC        surface pressure (Pa)</span></div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span><span class="comment">!-- XLAND       land mask (1 for land, 2 for water)</span></div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span><span class="comment">!-- QGH         saturated mixing ratio at 2 meter</span></div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span><span class="comment">!-- GSW         downward short wave flux at ground surface (W/m^2)</span></div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span><span class="comment">!-- GLW         downward long wave flux at ground surface (W/m^2)</span></div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span><span class="comment">!-- History variables</span></div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span><span class="comment">!-- CANWAT      canopy moisture content (mm)</span></div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span><span class="comment">!-- TSK         surface temperature (K)</span></div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span><span class="comment">!-- TSLB        soil temp (k)</span></div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span><span class="comment">!-- SMOIS       total soil moisture content (volumetric fraction)</span></div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span><span class="comment">!-- SH2O        unfrozen soil moisture content (volumetric fraction)</span></div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span><span class="comment">!                note: frozen soil moisture (i.e., soil ice) = SMOIS - SH2O</span></div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span><span class="comment">!-- SNOWH       actual snow depth (m)</span></div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span><span class="comment">!-- SNOW        liquid water-equivalent snow depth (m)</span></div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span><span class="comment">!-- ALBEDO      time-varying surface albedo including snow effect (unitless fraction)</span></div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span><span class="comment">!-- ALBBCK      background surface albedo (unitless fraction)</span></div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span><span class="comment">!-- CHS          surface exchange coefficient for heat and moisture (m s-1);</span></div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span><span class="comment">!-- CHS2        2m surface exchange coefficient for heat  (m s-1);</span></div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span><span class="comment">!-- CQS2        2m surface exchange coefficient for moisture (m s-1);</span></div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span><span class="comment">! --- soil variables</span></div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span><span class="comment">!-- num_soil_layers   the number of soil layers</span></div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span><span class="comment">!-- ZS          depths of centers of soil layers   (m)</span></div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span><span class="comment">!-- DZS         thicknesses of soil layers (m)</span></div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span><span class="comment">!-- SLDPTH      thickness of each soil layer (m, same as DZS)</span></div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span><span class="comment">!-- TMN         soil temperature at lower boundary (K)</span></div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span><span class="comment">!-- SMCWLT      wilting point (volumetric)</span></div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span><span class="comment">!-- SMCDRY      dry soil moisture threshold where direct evap from</span></div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span><span class="comment">!               top soil layer ends (volumetric)</span></div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span><span class="comment">!-- SMCREF      soil moisture threshold below which transpiration begins to</span></div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span><span class="comment">!                   stress (volumetric)</span></div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span><span class="comment">!-- SMCMAX      porosity, i.e. saturated value of soil moisture (volumetric)</span></div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span><span class="comment">!-- NROOT       number of root layers, a function of veg type, determined</span></div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span><span class="comment">!               in subroutine redprm.</span></div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span><span class="comment">!-- SMSTAV      Soil moisture availability for evapotranspiration (</span></div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span><span class="comment">!                   fraction between SMCWLT and SMCMXA)</span></div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span><span class="comment">!-- SMSTOT      Total soil moisture content frozen+unfrozen) in the soil column (mm)</span></div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span><span class="comment">! --- snow variables</span></div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span><span class="comment">!-- SNOWC       fraction snow coverage (0-1.0)</span></div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span><span class="comment">! --- vegetation variables</span></div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span><span class="comment">!-- SNOALB      upper bound on maximum albedo over deep snow</span></div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span><span class="comment">!-- SHDMIN      minimum areal fractional coverage of annual green vegetation</span></div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span><span class="comment">!-- SHDMAX      maximum areal fractional coverage of annual green vegetation</span></div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span><span class="comment">!-- XLAI        leaf area index (dimensionless)</span></div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span><span class="comment">!-- Z0BRD       Background fixed roughness length (M)</span></div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span><span class="comment">!-- Z0          Background vroughness length (M) as function</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span><span class="comment">!-- ZNT         Time varying roughness length (M) as function</span></div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span><span class="comment">!-- ALBD(IVGTPK,ISN) background albedo reading from a table</span></div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span><span class="comment">! --- LSM output</span></div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span><span class="comment">!-- HFX         upward heat flux at the surface (W/m^2)</span></div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span><span class="comment">!-- QFX         upward moisture flux at the surface (kg/m^2/s)</span></div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span><span class="comment">!-- LH          upward moisture flux at the surface (W m-2)</span></div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span><span class="comment">!-- GRDFLX(I,J) ground heat flux (W m-2)</span></div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span><span class="comment">!-- FDOWN       radiation forcing at the surface (W m-2) = SOLDN*(1-alb)+LWDN</span></div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span><span class="comment">!----------------------------------------------------------------------------</span></div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span><span class="comment">!-- EC          canopy water evaporation ((W m-2)</span></div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span><span class="comment">!-- EDIR        direct soil evaporation (W m-2)</span></div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span><span class="comment">!-- ET          plant transpiration from a particular root layer (W m-2)</span></div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span><span class="comment">!-- ETT         total plant transpiration (W m-2)</span></div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span><span class="comment">!-- ESNOW       sublimation from (or deposition to if &lt;0) snowpack (W m-2)</span></div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span><span class="comment">!-- DRIP        through-fall of precip and/or dew in excess of canopy</span></div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span><span class="comment">!                 water-holding capacity (m)</span></div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span><span class="comment">!-- DEW         dewfall (or frostfall for t&lt;273.15) (M)</span></div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span><span class="comment">!-- SMAV        Soil Moisture Availability for each layer, as a fraction</span></div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span><span class="comment">!                 between SMCWLT and SMCMAX (dimensionless fraction)</span></div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span><span class="comment">!-- BETA        ratio of actual/potential evap (dimensionless)</span></div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span><span class="comment">!-- ETP         potential evaporation (W m-2)</span></div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span><span class="comment">!-- FLX1        precip-snow sfc (W m-2)</span></div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span><span class="comment">!-- FLX2        freezing rain latent heat flux (W m-2)</span></div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span><span class="comment">!-- FLX3        phase-change heat flux from snowmelt (W m-2)</span></div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span><span class="comment">!-- ACSNOM      snow melt (mm) (water equivalent)</span></div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span><span class="comment">!-- ACSNOW      accumulated snow fall (mm) (water equivalent)</span></div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span><span class="comment">!-- SNOPCX      snow phase change heat flux (W/m^2)</span></div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span><span class="comment">!-- POTEVP      accumulated potential evaporation (m)</span></div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span><span class="comment">!-- RIB         Documentation needed!!!</span></div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span><span class="comment">!-- RUNOFF1     surface runoff (m s-1), not infiltrating the surface</span></div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span><span class="comment">!-- RUNOFF2     subsurface runoff (m s-1), drainage out bottom of last</span></div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span><span class="comment">!                  soil layer (baseflow)</span></div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span><span class="comment">!  important note: here RUNOFF2 is actually the sum of RUNOFF2 and RUNOFF3</span></div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span><span class="comment">!-- RUNOFF3     numerical trunctation in excess of porosity (smcmax)</span></div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span><span class="comment">!                  for a given soil layer at the end of a time step (m s-1).</span></div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span><span class="comment">!SFCRUNOFF     Surface Runoff (mm)</span></div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span><span class="comment">!UDRUNOFF      Total Underground Runoff (mm), which is the sum of RUNOFF2 and RUNOFF3</span></div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span><span class="comment">!-- RC          canopy resistance (s m-1)</span></div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span><span class="comment">!-- PC          plant coefficient (unitless fraction, 0-1) where PC*ETP = actual transp</span></div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span><span class="comment">!-- RSMIN       minimum canopy resistance (s m-1)</span></div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span><span class="comment">!-- RCS         incoming solar rc factor (dimensionless)</span></div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span><span class="comment">!-- RCT         air temperature rc factor (dimensionless)</span></div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span><span class="comment">!-- RCQ         atmos vapor pressure deficit rc factor (dimensionless)</span></div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span><span class="comment">!-- RCSOIL      soil moisture rc factor (dimensionless)</span></div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span> </div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span><span class="comment">!-- EMISS       surface emissivity (between 0 and 1)</span></div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span><span class="comment">!-- EMBCK       Background surface emissivity (between 0 and 1)</span></div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span> </div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span><span class="comment">!-- ROVCP       R/CP</span></div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span><span class="comment">!               (R_d/R_v) (dimensionless)</span></div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span><span class="comment">!-- ids         start index for i in domain</span></div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span><span class="comment">!-- ide         end index for i in domain</span></div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span><span class="comment">!-- jds         start index for j in domain</span></div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span><span class="comment">!-- jde         end index for j in domain</span></div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span><span class="comment">!-- kds         start index for k in domain</span></div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span><span class="comment">!-- kde         end index for k in domain</span></div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span><span class="comment">!-- ims         start index for i in memory</span></div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span><span class="comment">!-- ime         end index for i in memory</span></div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span><span class="comment">!-- jms         start index for j in memory</span></div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span><span class="comment">!-- jme         end index for j in memory</span></div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span><span class="comment">!-- kms         start index for k in memory</span></div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span><span class="comment">!-- kme         end index for k in memory</span></div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span><span class="comment">!-- its         start index for i in tile</span></div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span><span class="comment">!-- ite         end index for i in tile</span></div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span><span class="comment">!-- jts         start index for j in tile</span></div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span><span class="comment">!-- jte         end index for j in tile</span></div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span><span class="comment">!-- kts         start index for k in tile</span></div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span><span class="comment">!-- kte         end index for k in tile</span></div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span><span class="comment">!</span></div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span><span class="comment">!-- SR          fraction of frozen precip (0.0 to 1.0)</span></div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span> </div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span><span class="comment">! IN only</span></div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span> </div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::     ids,ide, jds,jde, kds,kde,  &amp;</div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span>                                    ims,ime, jms,jme, kms,kme,  &amp;</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span>                                    its,ite, jts,jte, kts,kte</div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span> </div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  sf_urban_physics               <span class="comment">!urban</span></div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  isurban</div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  isice</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>   <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN   )</span>   ::  julian,julyr</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span> </div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span><span class="comment">!added by Wei Yu  for routing</span></div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span><span class="keywordtype">    REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>             <span class="keywordtype">INTENT(INOUT)</span>  :: sfcheadrt,INFXSRT,soldrain </div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span><span class="keywordtype">    real</span> :: etpnd1</div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span><span class="comment">!end added</span></div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span> </div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>            <span class="keywordtype">INTENT(IN   )</span>    ::                            TMN, &amp;</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span>                                                         XLAND, &amp;</div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span>                                                          XICE, &amp;</div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span>                                                        VEGFRA, &amp;</div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>                                                        SHDMIN, &amp;</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>                                                        SHDMAX, &amp;</div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span>                                                        SNOALB, &amp;</div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>                                                           GSW, &amp;</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>                                                        SWDOWN, &amp; <span class="comment">!added 10 jan 2007</span></div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span>                                                           GLW, &amp;</div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span>                                                        RAINBL, &amp;</div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span>                                                        SR</div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span> </div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>            <span class="keywordtype">INTENT(INOUT)</span>    ::                         ALBBCK, &amp;</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span>                                                            Z0, &amp;</div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span>                                                         EMBCK                  <span class="comment">! danli mosaic</span></div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span>                                                         </div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span>   <span class="keywordtype">CHARACTER(LEN=*)</span>, <span class="keywordtype">INTENT(IN   )</span>    ::                 MMINLU</div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span> </div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>            , &amp;</div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span>            <span class="keywordtype">INTENT(IN   )</span>    ::                           QV3D, &amp;</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span>                                                         p8w3D, &amp;</div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>                                                          DZ8W, &amp;</div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span>                                                          T3D</div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                    , &amp;</div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>             <span class="keywordtype">INTENT(IN   )</span>               ::               QGH,  &amp;</div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>                                                          CPM</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span> </div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>            <span class="keywordtype">INTENT(IN   )</span>    ::                          ISLTYP</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span>                                                        </div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span>            <span class="keywordtype">INTENT(INOUT   )</span>    ::                         IVGTYP                   <span class="comment">! for mosaic danli</span></div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span> </div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>       ::     num_soil_layers,ITIMESTEP</div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span> </div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">INTENT(IN   )</span>   ::     DT,ROVCP</div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span> </div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION(1:num_soil_layers)</span>, <span class="keywordtype">INTENT(IN)</span>::DZS</div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span> </div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span><span class="comment">! IN and OUT</span></div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span> </div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION( ims:ime , 1:num_soil_layers, jms:jme )</span>, &amp;</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>             <span class="keywordtype">INTENT(INOUT)</span>   ::                          SMOIS, &amp; <span class="comment">! total soil moisture</span></div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span>                                                         SH2O,  &amp; <span class="comment">! new soil liquid</span></div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>                                                         TSLB     <span class="comment">! TSLB     STEMP</span></div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span> </div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span><span class="keywordtype">   REAL</span>,     <span class="keywordtype">DIMENSION( ims:ime , 1:num_soil_layers, jms:jme )</span>, &amp;</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>             <span class="keywordtype">INTENT(OUT)</span>     ::                         SMCREL</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span> </div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>            <span class="keywordtype">INTENT(INOUT)</span>    ::                            TSK, &amp; <span class="comment">!was TGB (temperature)</span></div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>                                                           HFX, &amp;</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>                                                           QFX, &amp;</div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span>                                                            LH, &amp;</div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span>                                                        GRDFLX, &amp;</div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span>                                                          QSFC,&amp;</div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>                                                          CQS2,&amp;</div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span>                                                          CHS,   &amp;</div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>                                                          CHS2,&amp;</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>                                                          SNOW, &amp;</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span>                                                         SNOWC, &amp;</div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span>                                                         SNOWH, &amp; <span class="comment">!new</span></div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span>                                                        CANWAT, &amp;</div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span>                                                        SMSTAV, &amp;</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span>                                                        SMSTOT, &amp;</div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>                                                     SFCRUNOFF, &amp;</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span>                                                      UDRUNOFF, &amp;</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>                                                        ACSNOM, &amp;</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>                                                        ACSNOW, &amp;</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span>                                                       SNOTIME, &amp;</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span>                                                        SNOPCX, &amp;</div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span>                                                        EMISS,  &amp;</div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span>                                                          RIB,  &amp;</div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span>                                                        POTEVP, &amp;</div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>                                                        ALBEDO, &amp;</div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span>                                                           ZNT</div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"> 2533</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span>            <span class="keywordtype">INTENT(OUT)</span>      ::                         NOAHRES</div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>   <span class="keywordtype">INTEGER</span>,                                <span class="keywordtype">INTENT(IN)</span>  :: OPT_THCND</div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span> </div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span><span class="comment">! Noah UA changes</span></div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>   <span class="keywordtype">LOGICAL</span>,                                <span class="keywordtype">INTENT(IN)</span>  :: UA_PHYS</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: FLX4_2D,FVB_2D,FBUR_2D,FGSN_2D</div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span><span class="keywordtype">   REAL</span>                                                :: FLX4,FVB,FBUR,FGSN</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span> </div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>               <span class="keywordtype">INTENT(OUT)</span>    ::                        CHKLOWQ</div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: LAI</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span><span class="keywordtype">   REAL</span>,<span class="keywordtype">DIMENSION(IMS:IME,JMS:JME)</span>,<span class="keywordtype">INTENT(IN)</span> ::        QZ0</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span>   :: RC2, XLAI2</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span> </div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMR_SFCDIF</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CHR_SFCDIF</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMGR_SFCDIF</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CHGR_SFCDIF</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMC_SFCDIF</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CHC_SFCDIF</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span><span class="comment">! Local variables (moved here from driver to make routine thread safe, 20031007 jm)</span></div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span> </div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span> ::  ET</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span> </div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span> ::  SMAV</div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span> </div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span><span class="keywordtype">      REAL</span>  ::  BETA, ETP, SSOIL,EC, EDIR, ESNOW, ETT,        &amp;</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span>                FLX1,FLX2,FLX3, DRIP,DEW,FDOWN,RC,PC,RSMIN,XLAI,  &amp;</div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span><span class="comment">!                RCS,RCT,RCQ,RCSOIL</span></div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>                rcs,rct,rcq,rcsoil,ffrozp</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span> </div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span>    <span class="keywordtype">LOGICAL</span>,    <span class="keywordtype">INTENT(IN   )</span>    ::     myj,frpcpn</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span> </div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span><span class="comment">! DECLARATIONS - LOGICAL</span></div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span>      <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">PARAMETER</span> :: LOCAL=.false.</div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span>      <span class="keywordtype">LOGICAL</span> :: FRZGRA, SNOWNG</div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span> </div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span>      <span class="keywordtype">LOGICAL</span> :: IPRINT</div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span> </div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span><span class="comment">! DECLARATIONS - INTEGER</span></div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>      <span class="keywordtype">INTEGER</span> :: I,J, ICE,NSOIL,SLOPETYP,SOILTYP,VEGTYP</div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>      <span class="keywordtype">INTEGER</span> :: NROOT</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span>      <span class="keywordtype">INTEGER</span> :: KZ ,K</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span>      <span class="keywordtype">INTEGER</span> :: NS</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span><span class="comment">! DECLARATIONS - REAL</span></div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span> </div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span><span class="keywordtype">      REAL</span>  :: SHMIN,SHMAX,DQSDT2,LWDN,PRCP,PRCPRAIN,                    &amp;</div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>               Q2SAT,Q2SATI,SFCPRS,SFCSPD,SFCTMP,SHDFAC,SNOALB1,         &amp;</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>               SOLDN,TBOT,ZLVL, Q2K,ALBBRD, ALBEDOK, ETA, ETA_KINEMATIC, &amp;</div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>               EMBRD,                                                    &amp;</div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>               Z0K,RUNOFF1,RUNOFF2,RUNOFF3,SHEAT,SOLNET,E2SAT,SFCTSNO,   &amp;</div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span><span class="comment">! mek, WRF testing, expanded diagnostics</span></div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>               solup,lwup,rnet,res,q1sfc,tairv,satflg</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span><span class="comment">! MEK MAY 2007</span></div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span><span class="keywordtype">      REAL</span> ::  FDTLIW</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span><span class="comment">! MEK JUL2007 for pot. evap.</span></div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span><span class="keywordtype">      REAL</span> :: RIBB</div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span><span class="keywordtype">      REAL</span> ::  FDTW</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span> </div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span><span class="keywordtype">      REAL</span>  :: EMISSI</div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span> </div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span><span class="keywordtype">      REAL</span>  :: SNCOVR,SNEQV,SNOWHK,CMC, CHK,TH2</div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span> </div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span><span class="keywordtype">      REAL</span>  :: SMCDRY,SMCMAX,SMCREF,SMCWLT,SNOMLT,SOILM,SOILW,Q1,T1</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span><span class="keywordtype">      REAL</span>  :: SNOTIME1    <span class="comment">! LSTSNW1 INITIAL NUMBER OF TIMESTEPS SINCE LAST SNOWFALL</span></div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span> </div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span><span class="keywordtype">      REAL</span>  :: DUMMY,Z0BRD</div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span><span class="comment">!</span></div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span><span class="keywordtype">      REAL</span>  :: COSZ, SOLARDIRECT</div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span><span class="comment">!</span></div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span>::  SLDPTH, STC,SMC,SWC</div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span><span class="comment">!</span></div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">DIMENSION(1:num_soil_layers)</span> ::     ZSOIL, RTDIS</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">PARAMETER</span>  :: TRESH=.95e0, a2=17.67,a3=273.15,a4=29.65,   &amp;</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span>                          t0=273.16e0, elwv=2.50e6,  a23m4=a2*(a3-a4)</div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span><span class="comment">! MEK MAY 2007</span></div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span><span class="keywordtype">      REAL</span>, <span class="keywordtype">PARAMETER</span>  :: ROW=1.e3,eliw=xlf,rowliw=row*eliw</div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span> </div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span><span class="comment">! DECLARATIONS START - urban</span></div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span> </div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span><span class="comment">! input variables surface_driver --&gt; lsm</span></div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: num_roof_layers</div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: num_wall_layers</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: num_road_layers</div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span>, <span class="keywordtype">INTENT(IN)</span> :: DZR</div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION(1:num_wall_layers)</span>, <span class="keywordtype">INTENT(IN)</span> :: DZB</div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION(1:num_road_layers)</span>, <span class="keywordtype">INTENT(IN)</span> :: DZG</div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(IN)</span> :: DECLIN_URB</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: COSZ_URB2D</div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: OMG_URB2D</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: XLAT_URB2D</div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: U_PHY</div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: V_PHY</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: TH_PHY</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: P_PHY</div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: RHO</div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: UST</div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span> </div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>     <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">intent(in)</span> :: rdlai2d</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>     <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">intent(in)</span> :: USEMONALB</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span> </div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span><span class="comment">! input variables lsm --&gt; urban</span></div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>     <span class="keywordtype">INTEGER</span> :: UTYPE_URB <span class="comment">! urban type [urban=1, suburban=2, rural=3]</span></div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span><span class="keywordtype">     REAL</span> :: TA_URB       <span class="comment">! potential temp at 1st atmospheric level [K]</span></div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span><span class="keywordtype">     REAL</span> :: QA_URB       <span class="comment">! mixing ratio at 1st atmospheric level  [kg/kg]</span></div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span><span class="keywordtype">     REAL</span> :: UA_URB       <span class="comment">! wind speed at 1st atmospheric level    [m/s]</span></div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span><span class="keywordtype">     REAL</span> :: U1_URB       <span class="comment">! u at 1st atmospheric level             [m/s]</span></div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span><span class="keywordtype">     REAL</span> :: V1_URB       <span class="comment">! v at 1st atmospheric level             [m/s]</span></div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span><span class="keywordtype">     REAL</span> :: SSG_URB      <span class="comment">! downward total short wave radiation    [W/m/m]</span></div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span><span class="keywordtype">     REAL</span> :: LLG_URB      <span class="comment">! downward long wave radiation           [W/m/m]</span></div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span><span class="keywordtype">     REAL</span> :: RAIN_URB     <span class="comment">! precipitation                          [mm/h]</span></div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span><span class="keywordtype">     REAL</span> :: RHOO_URB     <span class="comment">! air density                            [kg/m^3]</span></div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span><span class="keywordtype">     REAL</span> :: ZA_URB       <span class="comment">! first atmospheric level                [m]</span></div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span><span class="keywordtype">     REAL</span> :: DELT_URB     <span class="comment">! time step                              [s]</span></div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span><span class="keywordtype">     REAL</span> :: SSGD_URB     <span class="comment">! downward direct short wave radiation   [W/m/m]</span></div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span><span class="keywordtype">     REAL</span> :: SSGQ_URB     <span class="comment">! downward diffuse short wave radiation  [W/m/m]</span></div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span><span class="keywordtype">     REAL</span> :: XLAT_URB     <span class="comment">! latitude                               [deg]</span></div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span><span class="keywordtype">     REAL</span> :: COSZ_URB     <span class="comment">! cosz</span></div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span><span class="keywordtype">     REAL</span> :: OMG_URB      <span class="comment">! hour angle</span></div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span><span class="keywordtype">     REAL</span> :: ZNT_URB      <span class="comment">! roughness length                       [m]</span></div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span><span class="keywordtype">     REAL</span> :: TR_URB</div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span><span class="keywordtype">     REAL</span> :: TB_URB</div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span><span class="keywordtype">     REAL</span> :: TG_URB</div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span><span class="keywordtype">     REAL</span> :: TC_URB</div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span><span class="keywordtype">     REAL</span> :: QC_URB</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span><span class="keywordtype">     REAL</span> :: UC_URB</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span><span class="keywordtype">     REAL</span> :: XXXR_URB</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span><span class="keywordtype">     REAL</span> :: XXXB_URB</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span><span class="keywordtype">     REAL</span> :: XXXG_URB</div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span><span class="keywordtype">     REAL</span> :: XXXC_URB</div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span> :: TRL_URB  <span class="comment">! roof layer temp [K]</span></div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_wall_layers)</span> :: TBL_URB  <span class="comment">! wall layer temp [K]</span></div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_road_layers)</span> :: TGL_URB  <span class="comment">! road layer temp [K]</span></div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span>     <span class="keywordtype">LOGICAL</span>  :: LSOLAR_URB</div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span> </div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span><span class="comment">!===Yang,2014/10/08,hydrological variable for single layer UCM===</span></div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span>     <span class="keywordtype">INTEGER</span> :: jmonth, jday, tloc</div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>     <span class="keywordtype">INTEGER</span> :: IRIOPTION, USOIL, DSOIL</div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span><span class="keywordtype">     REAL</span> :: AOASIS, OMG</div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span><span class="keywordtype">     REAL</span> :: DRELR_URB</div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span><span class="keywordtype">     REAL</span> :: DRELB_URB</div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span><span class="keywordtype">     REAL</span> :: DRELG_URB</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span><span class="keywordtype">     REAL</span> :: FLXHUMR_URB</div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span><span class="keywordtype">     REAL</span> :: FLXHUMB_URB</div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span><span class="keywordtype">     REAL</span> :: FLXHUMG_URB</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span><span class="keywordtype">     REAL</span> :: CMCR_URB</div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span><span class="keywordtype">     REAL</span> :: TGR_URB</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span> :: SMR_URB  <span class="comment">! green roof layer moisture</span></div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(1:num_roof_layers)</span> :: TGRL_URB <span class="comment">! green roof layer temp [K]</span></div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span> </div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: DRELR_URB2D</div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: DRELB_URB2D</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: DRELG_URB2D</div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FLXHUMR_URB2D</div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FLXHUMB_URB2D</div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FLXHUMG_URB2D</div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: CMCR_URB2D</div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGR_URB2D</div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGRL_URB3D</div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: SMR_URB3D</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span> </div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span><span class="comment">! state variable surface_driver &lt;--&gt; lsm &lt;--&gt; urban</span></div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TR_URB2D</div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TB_URB2D</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TG_URB2D</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TC_URB2D</div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: QC_URB2D</div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: UC_URB2D</div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXR_URB2D</div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXB_URB2D</div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXG_URB2D</div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: XXXC_URB2D</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: SH_URB2D</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: LH_URB2D</div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: G_URB2D</div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: RN_URB2D</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span><span class="comment">!</span></div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TS_URB2D</div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span> </div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TRL_URB3D</div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_wall_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TBL_URB3D</div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_road_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGL_URB3D</div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span> </div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span><span class="comment">! output variable lsm --&gt; surface_driver</span></div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: PSIM_URB2D</div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: PSIH_URB2D</div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: GZ1OZ0_URB2D</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: U10_URB2D</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: V10_URB2D</div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: TH2_URB2D</div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: Q2_URB2D</div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span><span class="comment">!</span></div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: AKMS_URB2D</div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span><span class="comment">!</span></div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(OUT)</span> :: UST_URB2D</div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: FRC_URB2D                <span class="comment">! change this to inout, danli mosaic</span></div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span>     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: UTYPE_URB2D</div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span> </div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span><span class="comment">! output variables urban --&gt; lsm</span></div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span><span class="keywordtype">     REAL</span> :: TS_URB     <span class="comment">! surface radiative temperature    [K]</span></div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span><span class="keywordtype">     REAL</span> :: QS_URB     <span class="comment">! surface humidity                 [-]</span></div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span><span class="keywordtype">     REAL</span> :: SH_URB     <span class="comment">! sensible heat flux               [W/m/m]</span></div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span><span class="keywordtype">     REAL</span> :: LH_URB     <span class="comment">! latent heat flux                 [W/m/m]</span></div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span><span class="keywordtype">     REAL</span> :: LH_KINEMATIC_URB <span class="comment">! latent heat flux, kinetic  [kg/m/m/s]</span></div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span><span class="keywordtype">     REAL</span> :: SW_URB     <span class="comment">! upward short wave radiation flux [W/m/m]</span></div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span><span class="keywordtype">     REAL</span> :: ALB_URB    <span class="comment">! time-varying albedo            [fraction]</span></div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span><span class="keywordtype">     REAL</span> :: LW_URB     <span class="comment">! upward long wave radiation flux  [W/m/m]</span></div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span><span class="keywordtype">     REAL</span> :: G_URB      <span class="comment">! heat flux into the ground        [W/m/m]</span></div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span><span class="keywordtype">     REAL</span> :: RN_URB     <span class="comment">! net radiation                    [W/m/m]</span></div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span><span class="keywordtype">     REAL</span> :: PSIM_URB   <span class="comment">! shear f for momentum             [-]</span></div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span><span class="keywordtype">     REAL</span> :: PSIH_URB   <span class="comment">! shear f for heat                 [-]</span></div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span><span class="keywordtype">     REAL</span> :: GZ1OZ0_URB   <span class="comment">! shear f for heat                 [-]</span></div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span><span class="keywordtype">     REAL</span> :: U10_URB    <span class="comment">! wind u component at 10 m         [m/s]</span></div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span><span class="keywordtype">     REAL</span> :: V10_URB    <span class="comment">! wind v component at 10 m         [m/s]</span></div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span><span class="keywordtype">     REAL</span> :: TH2_URB    <span class="comment">! potential temperature at 2 m     [K]</span></div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span><span class="keywordtype">     REAL</span> :: Q2_URB     <span class="comment">! humidity at 2 m                  [-]</span></div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span><span class="keywordtype">     REAL</span> :: CHS_URB</div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span><span class="keywordtype">     REAL</span> :: CHS2_URB</div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span><span class="keywordtype">     REAL</span> :: UST_URB</div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span><span class="comment">! NUDAPT Parameters urban --&gt; lam</span></div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span><span class="keywordtype">     REAL</span> :: mh_urb</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span><span class="keywordtype">     REAL</span> :: stdh_urb</div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span><span class="keywordtype">     REAL</span> :: lp_urb</div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span><span class="keywordtype">     REAL</span> :: hgt_urb</div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span><span class="keywordtype">     REAL</span>, <span class="keywordtype">DIMENSION(4)</span> :: lf_urb</div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span><span class="comment">! Variables for multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(IN  )</span>   ::                                   GMT </div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(IN  )</span> ::                               JULDAY</div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN   )</span>        ::XLAT, XLONG</div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN  )</span> ::                               NUM_URBAN_LAYERS</div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN  )</span> ::                               NUM_URBAN_HI</div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime,                     jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tsk_rural_bep</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: trb_urb4d</div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw1_urb4d</div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw2_urb4d</div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tgb_urb4d</div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tlev_urb3d</div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: qlev_urb3d</div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw1lev_urb3d</div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tw2lev_urb3d</div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tglev_urb3d</div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: tflev_urb3d</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: lf_ac_urb3d</div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sf_ac_urb3d</div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: cm_ac_urb3d</div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfvent_urb3d</div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: lfvent_urb3d</div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfwin1_urb3d</div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfwin2_urb3d</div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfw1_urb3d</div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfw2_urb3d</div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfr_urb3d</div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_layers, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: sfg_urb3d</div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_urban_hi, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: hi_urb2d</div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: lp_urb2d</div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: lb_urb2d</div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: hgt_urb2d</div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: mh_urb2d</div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: stdh_urb2d</div>
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"> 2800</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 4, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: lf_urb2d</div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_u_bep   <span class="comment">!Implicit momemtum component X-direction</span></div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_v_bep   <span class="comment">!Implicit momemtum component Y-direction</span></div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_t_bep   <span class="comment">!Implicit component pot. temperature</span></div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_q_bep   <span class="comment">!Implicit momemtum component X-direction</span></div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::a_e_bep   <span class="comment">!Implicit component TKE</span></div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_u_bep   <span class="comment">!Explicit momentum component X-direction</span></div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_v_bep   <span class="comment">!Explicit momentum component Y-direction</span></div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_t_bep   <span class="comment">!Explicit component pot. temperature</span></div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_q_bep   <span class="comment">!Implicit momemtum component Y-direction</span></div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::b_e_bep   <span class="comment">!Explicit component TKE</span></div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::vl_bep    <span class="comment">!Fraction air volume in grid cell</span></div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::dlg_bep   <span class="comment">!Height above ground</span></div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::sf_bep  <span class="comment">!Fraction air at the face of grid cell</span></div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, kms:kme, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::dl_u_bep  <span class="comment">!Length scale</span></div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span> </div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span><span class="comment">! Local variables for multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: HFX_RURAL,LH_RURAL,GRDFLX_RURAL <span class="comment">! ,RN_RURAL</span></div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: QFX_RURAL <span class="comment">! ,QSFC_RURAL,UMOM_RURAL,VMOM_RURAL</span></div>
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"> 2819</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: ALB_RURAL,EMISS_RURAL,TSK_RURAL <span class="comment">! ,UST_RURAL</span></div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span><span class="comment">!   REAL,    DIMENSION( ims:ime, jms:jme ) :: QSFC_URB</span></div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: HFX_URB,UMOM_URB,VMOM_URB</div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( its:ite, jts:jte )</span> :: QFX_URB</div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span><span class="comment">!   REAL,    DIMENSION( ims:ime, jms:jme ) :: ALBEDO_URB,EMISS_URB,UMOM,VMOM,UST</span></div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> ::EMISS_URB</div>
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"> 2825</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> :: RL_UP_URB</div>
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"> 2826</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> ::RS_ABS_URB</div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">DIMENSION(its:ite,jts:jte)</span> ::GRDFLX_URB</div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span><span class="keywordtype">   REAL</span> :: SIGMA_SB,RL_UP_RURAL,RL_UP_TOT,RS_ABS_TOT,UMOM,VMOM</div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span><span class="keywordtype">   REAL</span> :: CMR_URB, CHR_URB, CMC_URB, CHC_URB, CMGR_URB, CHGR_URB</div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span><span class="keywordtype">   REAL</span> :: frc_urb,lb_urb</div>
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"> 2831</span><span class="keywordtype">   REAL</span> :: check </div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span><span class="comment">! DECLARATIONS END - urban</span></div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span><span class="comment">! ----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span><span class="comment">!-------------------------------------------------</span></div>
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"> 2836</span><span class="comment">! Noah-mosaic related variables are added to declaration  (danli)</span></div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span><span class="comment">!-------------------------------------------------</span></div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"> 2838</span>  </div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: sf_surface_mosaic    </div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: mosaic_cat, NLCAT</div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, NLCAT, jms:jme )</span>, <span class="keywordtype">INTENT(IN)</span> :: landusef </div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, NLCAT, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> ::landusef2 </div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, NLCAT, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: mosaic_cat_index </div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span> </div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span> , <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"> 2846</span>        TSK_mosaic, QSFC_mosaic, CANWAT_mosaic, SNOW_mosaic,SNOWH_mosaic, SNOWC_mosaic </div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span> , <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span>        ALBEDO_mosaic,ALBBCK_mosaic, EMISS_mosaic, EMBCK_mosaic, ZNT_mosaic, Z0_mosaic,   &amp;</div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"> 2849</span>        HFX_mosaic,QFX_mosaic, LH_mosaic, GRDFLX_mosaic,SNOTIME_mosaic    </div>
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"> 2850</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_soil_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"> 2851</span>        TSLB_mosaic,SMOIS_mosaic,SH2O_mosaic</div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>:: LAI_mosaic, RC_mosaic</div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span> </div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span> :: TSK_mosaic_avg, QSFC_mosaic_avg, CANWAT_mosaic_avg,SNOW_mosaic_avg,SNOWH_mosaic_avg, &amp;</div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span>                                         SNOWC_mosaic_avg, HFX_mosaic_avg, QFX_mosaic_avg, LH_mosaic_avg, GRDFLX_mosaic_avg,  &amp;</div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span>                                         ALBEDO_mosaic_avg, ALBBCK_mosaic_avg, EMISS_mosaic_avg, EMBCK_mosaic_avg,            &amp;</div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span>                                         ZNT_mosaic_avg, Z0_mosaic_avg, LAI_mosaic_avg, RC_mosaic_avg, SNOTIME_mosaic_avg,    &amp;</div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span>                                         FAREA_mosaic_avg</div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_soil_layers, jms:jme )</span>                     ::   &amp;</div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span>        TSLB_mosaic_avg,SMOIS_mosaic_avg,SH2O_mosaic_avg</div>
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"> 2861</span>  </div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"> 2862</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span> , <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span>        TR_URB2D_mosaic, TB_URB2D_mosaic, TG_URB2D_mosaic, TC_URB2D_mosaic,QC_URB2D_mosaic, UC_URB2D_mosaic, &amp;</div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span>        SH_URB2D_mosaic,LH_URB2D_mosaic,G_URB2D_mosaic,RN_URB2D_mosaic,TS_URB2D_mosaic, TS_RUL2D_mosaic  </div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span>                  </div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_roof_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TRL_URB3D_mosaic</div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_wall_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TBL_URB3D_mosaic</div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span><span class="keywordtype">   REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_road_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGL_URB3D_mosaic</div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span> </div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span> ::    IVGTYP_dominant</div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span>  <span class="keywordtype">INTEGER</span> ::  mosaic_i, URBAN_METHOD, zo_avg_option</div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span><span class="keywordtype">  REAL</span> :: FAREA</div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"> 2873</span>  <span class="keywordtype">LOGICAL</span> :: IPRINT_mosaic, Noah_call</div>
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"> 2874</span><span class="comment">!-------------------------------------------------</span></div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span><span class="comment">! Noah-mosaic related variables declaration end (danli)</span></div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span><span class="comment">!-------------------------------------------------</span></div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span> </div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">PARAMETER</span>  :: CAPA=r_d/cp</div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span><span class="keywordtype">  REAL</span> :: APELM,APES,SFCTH2,PSFC</div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span><span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span> :: xice_threshold</div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span>  <span class="keywordtype">character(len=80)</span> :: message_text</div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span><span class="comment">!</span></div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span><span class="comment">!  FASDAS: it doesn&#39;t work for mosaic, but we need the variables to call sflx</span></div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span><span class="comment">!</span></div>
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"> 2885</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span>            <span class="keywordtype">INTENT(INOUT)</span>  ::   SDA_HFX, SDA_QFX, HFX_BOTH, QFX_BOTH, QNORM</div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN   )</span>  ::  fasdas</div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span><span class="keywordtype">   REAL</span>                    ::  XSDA_HFX, XSDA_QFX, XQNORM</div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span><span class="keywordtype">   REAL</span>                    ::  HFX_PHY, QFX_PHY</div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span><span class="keywordtype">   REAL</span>                    ::  DZQ</div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"> 2891</span><span class="keywordtype">   REAL</span>                    ::  HCPCT_FASDAS</div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span> </div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span>   hfx_phy = 0.0   <span class="comment">! initialize</span></div>
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"> 2894</span>   qfx_phy = 0.0</div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span>   xqnorm  = 0.0</div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span>   xsda_hfx = 0.0</div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span>   xsda_qfx = 0.0</div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span><span class="comment">!</span></div>
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"> 2899</span><span class="comment">!  END FASDAS</span></div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"> 2900</span><span class="comment">!</span></div>
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"> 2901</span><span class="comment">! MEK MAY 2007</span></div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span>      fdtliw=dt/rowliw</div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"> 2903</span><span class="comment">! MEK JUL2007</span></div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span>      fdtw=dt/(xlv*rhowater)</div>
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"> 2905</span><span class="comment">! debug printout</span></div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span>      iprint=.false.</div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span>      iprint_mosaic=.false.</div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span> </div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span><span class="comment">!      SLOPETYP=2</span></div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span>      slopetyp=1</div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span><span class="comment">!      SHDMIN=0.00</span></div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span> </div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span>      nsoil=num_soil_layers</div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"> 2914</span> </div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"> 2915</span>     <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"> 2916</span>     sldpth(ns)=dzs(ns)</div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span><span class="keywordflow">     ENDDO</span></div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span> </div>
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"> 2919</span>     jloop : <span class="keywordflow">DO</span> j=jts,jte</div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span> </div>
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"> 2921</span>      <span class="keywordflow">IF</span>(itimestep.EQ.1)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span>        <span class="keywordflow">DO</span> 50 i=its,ite</div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span><span class="comment">!*** initialize soil conditions for IHOP 31 May case</span></div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span><span class="comment">!         IF((XLAND(I,J)-1.5) &lt; 0.)THEN</span></div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span><span class="comment">!            if (I==108.and.j==85) then</span></div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"> 2926</span><span class="comment">!                  DO NS=1,NSOIL</span></div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span><span class="comment">!                      SMOIS(I,NS,J)=0.10</span></div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span><span class="comment">!                      SH2O(I,NS,J)=0.10</span></div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span><span class="comment">!                  enddo</span></div>
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"> 2930</span><span class="comment">!             endif</span></div>
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"> 2931</span><span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span> </div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span><span class="comment">!*** SET ZERO-VALUE FOR SOME OUTPUT DIAGNOSTIC ARRAYS</span></div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span>          <span class="keywordflow">IF</span>((xland(i,j)-1.5).GE.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"> 2935</span><span class="comment">! check sea-ice point</span></div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span><span class="preprocessor"></span>            <span class="keywordflow">IF</span>( xice(i,j).GE. xice_threshold .and. iprint ) print*, <span class="stringliteral">&#39; sea-ice at water point, I=&#39;</span>,i,<span class="stringliteral">&#39;J=&#39;</span>,j</div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span><span class="preprocessor"></span><span class="comment">!***   Open Water Case</span></div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span>            smstav(i,j)=1.0</div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span>            smstot(i,j)=1.0</div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span>            <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span>              smois(i,ns,j)=1.0</div>
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"> 2944</span>              tslb(i,ns,j)=273.16                                          <span class="comment">!STEMP</span></div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span>              smcrel(i,ns,j)=1.0</div>
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"> 2946</span><span class="keywordflow">            ENDDO</span></div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span>            <span class="keywordflow">IF</span> ( xice(i,j) .GE. xice_threshold ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span><span class="comment">!***        SEA-ICE CASE</span></div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>              smstav(i,j)=1.0</div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"> 2951</span>              smstot(i,j)=1.0</div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"> 2952</span>              <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span>                smois(i,ns,j)=1.0</div>
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"> 2954</span>                smcrel(i,ns,j)=1.0</div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span><span class="keywordflow">              ENDDO</span></div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span><span class="comment">!</span></div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span>   50   <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"> 2960</span><span class="keywordflow">      ENDIF</span>                                                               <span class="comment">! end of initialization over ocean</span></div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span> </div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span><span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span>      iloop : <span class="keywordflow">DO</span> i=its,ite</div>
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"> 2964</span>      </div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"> 2965</span><span class="comment">! initializing local variables</span></div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>         soilw = 0.</div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span>         flx4  = 0.</div>
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"> 2968</span>         fvb   = 0.</div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span>         fbur  = 0.</div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"> 2970</span>         fgsn  = 0.</div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span> </div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span>         <span class="keywordflow">IF</span> (((xland(i,j)-1.5).LT.0.) .AND. (xice(i,j) &lt; xice_threshold) ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>               </div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span>               ivgtyp_dominant(i,j)=ivgtyp(i,j)                                   <span class="comment">! save this</span></div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span>      </div>
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"> 2976</span>            <span class="comment">! INITIALIZE THE AREA-AVERAGED FLUXES </span></div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span>               </div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span>                 tsk_mosaic_avg(i,j)= 0.0                              <span class="comment">! from 3D to 2D</span></div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span>                 qsfc_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"> 2980</span>                 canwat_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span>                 snow_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"> 2982</span>                 snowh_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span>                 snowc_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span>            </div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>                          <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span>            </div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span>                     tslb_mosaic_avg(i,ns,j)=0.0</div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span>                     smois_mosaic_avg(i,ns,j)=0.0</div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span>                     sh2o_mosaic_avg(i,ns,j)=0.0</div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span>            </div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span><span class="keywordflow">                         ENDDO</span></div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span>            </div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span>                 hfx_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span>                 qfx_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span>                 lh_mosaic_avg(i,j)=  0.0</div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>                 grdflx_mosaic_avg(i,j)= 0.0</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span>                 albedo_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"> 2998</span>                 albbck_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span>                 emiss_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span>                 embck_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span>                 znt_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span>                 z0_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span>                 lai_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span>                 rc_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"> 3005</span>                 farea_mosaic_avg(i,j)=0.0</div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>            </div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span>            <span class="comment">! add a new loop for the mosaic_cat</span></div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span>            </div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span>               <span class="keywordflow">DO</span> mosaic_i = mosaic_cat, 1, -1</div>
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"> 3010</span>               </div>
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"> 3011</span>            <span class="comment">!   if (mosaic_cat_index(I,mosaic_i,J) .EQ. 16 ) then</span></div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span>            <span class="comment">!   PRINT*, &#39;you still have water tiles at&#39;,&#39;i=&#39;,i,&#39;j=&#39;,j, &#39;mosaic_i&#39;,mosaic_i</span></div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span>            <span class="comment">!   PRINT*, &#39;xland&#39;,xland(i,j),&#39;xice&#39;,xice(i,j)</span></div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span>            <span class="comment">!   endif</span></div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span>               </div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span>               ivgtyp(i,j)=mosaic_cat_index(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"> 3017</span>               tsk(i,j)=tsk_mosaic(i,mosaic_i,j)                                  <span class="comment">! from 3D to 2D</span></div>
<div class="line"><a id="l03018" name="l03018"></a><span class="lineno"> 3018</span>               qsfc(i,j)=qsfc_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span>               canwat(i,j)=canwat_mosaic(i,mosaic_i,j) </div>
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"> 3020</span>               snow(i,j)=snow_mosaic(i,mosaic_i,j) </div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span>               snowh(i,j)=snowh_mosaic(i,mosaic_i,j)  </div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span>               snowc(i,j)=snowc_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"> 3023</span>            </div>
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"> 3024</span>                albedo(i,j) = albedo_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span>                albbck(i,j)= albbck_mosaic(i,mosaic_i,j) </div>
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"> 3026</span>                emiss(i,j)= emiss_mosaic(i,mosaic_i,j) </div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>                embck(i,j)= embck_mosaic(i,mosaic_i,j) </div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>                znt(i,j)= znt_mosaic(i,mosaic_i,j) </div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span>                z0(i,j)= z0_mosaic(i,mosaic_i,j)    </div>
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"> 3030</span>            </div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span>                 snotime(i,j)= snotime_mosaic(i,mosaic_i,j)          </div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>              </div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>                          <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span>            </div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span>                     tslb(i,ns,j)=tslb_mosaic(i,nsoil*(mosaic_i-1)+ns,j)</div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span>                     smois(i,ns,j)=smois_mosaic(i,nsoil*(mosaic_i-1)+ns,j)</div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span>                     sh2o(i,ns,j)=sh2o_mosaic(i,nsoil*(mosaic_i-1)+ns,j)</div>
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"> 3038</span>            </div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span><span class="keywordflow">                          ENDDO</span></div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span>            </div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"> 3041</span>                       <span class="keywordflow">IF</span>(iprint_mosaic) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span>            </div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span>                   print*, <span class="stringliteral">&#39;BEFORE SFLX, in Noahdrv.F&#39;</span></div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span>                   print*, <span class="stringliteral">&#39;mosaic_cat&#39;</span>, mosaic_cat, <span class="stringliteral">&#39;IVGTYP&#39;</span>,ivgtyp(i,j), <span class="stringliteral">&#39;TSK&#39;</span>,tsk(i,j),<span class="stringliteral">&#39;HFX&#39;</span>,hfx(i,j), <span class="stringliteral">&#39;QSFC&#39;</span>, qsfc(i,j),   &amp;</div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span>                   <span class="stringliteral">&#39;CANWAT&#39;</span>, canwat(i,j), <span class="stringliteral">&#39;SNOW&#39;</span>,snow(i,j), <span class="stringliteral">&#39;ALBEDO&#39;</span>,albedo(i,j), <span class="stringliteral">&#39;TSLB&#39;</span>,tslb(i,1,j),<span class="stringliteral">&#39;CHS&#39;</span>,chs(i,j),<span class="stringliteral">&#39;ZNT&#39;</span>,znt(i,j)</div>
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"> 3046</span>            </div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span><span class="keywordflow">                       ENDIF</span></div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"> 3048</span>            </div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span>            <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span>            <span class="comment">! insert the NOAH model here for the non-urban one and the urban one  DANLI</span></div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>            <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span>            </div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span>      <span class="comment">! surface pressure</span></div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span>              psfc=p8w3d(i,1,j)</div>
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"> 3055</span>      <span class="comment">! pressure in middle of lowest layer</span></div>
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"> 3056</span>              sfcprs=(p8w3d(i,kts+1,j)+p8w3d(i,kts,j))*0.5</div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>      <span class="comment">! convert from mixing ratio to specific humidity</span></div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span>               q2k=qv3d(i,1,j)/(1.0+qv3d(i,1,j))</div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span>      <span class="comment">!         Q2SAT=QGH(I,j)</span></div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span>               q2sat=qgh(i,j)/(1.0+qgh(i,j))        <span class="comment">! Q2SAT is sp humidity</span></div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span>      <span class="comment">! add check on myj=.true.</span></div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>      <span class="comment">!        IF((Q2K.GE.Q2SAT*TRESH).AND.Q2K.LT.QZ0(I,J))THEN</span></div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span>              <span class="keywordflow">IF</span>((myj).AND.(q2k.GE.q2sat*tresh).AND.q2k.LT.qz0(i,j))<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span>                satflg=0.</div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"> 3066</span>                chklowq(i,j)=0.</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>              <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span>                satflg=1.0</div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span>                chklowq(i,j)=1.</div>
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"> 3070</span><span class="keywordflow">              ENDIF</span></div>
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"> 3071</span>      </div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span>              sfctmp=t3d(i,1,j)</div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span>              zlvl=0.5*dz8w(i,1,j)</div>
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"> 3074</span>      </div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span>      <span class="comment">!        TH2=SFCTMP+(0.0097545*ZLVL)</span></div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span>      <span class="comment">! calculate SFCTH2 via Exner function vs lapse-rate (above)</span></div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span>               apes=(1.e5/psfc)**capa</div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span>               apelm=(1.e5/sfcprs)**capa</div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span>               sfcth2=sfctmp*apelm</div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"> 3080</span>               th2=sfcth2/apes</div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"> 3081</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span>               emissi = emiss(i,j)</div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span>               lwdn=glw(i,j)*emissi</div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span>      <span class="comment">! SOLDN is total incoming solar</span></div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span>              soldn=swdown(i,j)</div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"> 3086</span>      <span class="comment">! GSW is net downward solar</span></div>
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"> 3087</span>      <span class="comment">!        SOLNET=GSW(I,J)</span></div>
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"> 3088</span>      <span class="comment">! use mid-day albedo to determine net downward solar (no solar zenith angle correction)</span></div>
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"> 3089</span>              solnet=soldn*(1.-albedo(i,j))</div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span>              prcp=rainbl(i,j)/dt</div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span>              vegtyp=ivgtyp(i,j)</div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span>              soiltyp=isltyp(i,j)</div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>              shdfac=vegfra(i,j)/100.</div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span>              t1=tsk(i,j)</div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>              chk=chs(i,j)</div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>              shmin=shdmin(i,j)/100. <span class="comment">!NEW</span></div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span>              shmax=shdmax(i,j)/100. <span class="comment">!NEW</span></div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span>      <span class="comment">! convert snow water equivalent from mm to meter</span></div>
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"> 3099</span>              sneqv=snow(i,j)*0.001</div>
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"> 3100</span>      <span class="comment">! snow depth in meters</span></div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"> 3101</span>              snowhk=snowh(i,j)</div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span>              sncovr=snowc(i,j)</div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span>      </div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span>      <span class="comment">! if &quot;SR&quot; present, set frac of frozen precip (&quot;FFROZP&quot;) = snow-ratio (&quot;SR&quot;, range:0-1)</span></div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>      <span class="comment">! SR from e.g. Ferrier microphysics</span></div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>      <span class="comment">! otherwise define from 1st atmos level temperature</span></div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span>             <span class="keywordflow">IF</span>(frpcpn) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>                ffrozp=sr(i,j)</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span>              <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span>                <span class="keywordflow">IF</span> (sfctmp &lt;=  273.15) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>                  ffrozp = 1.0</div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span>            ffrozp = 0.0</div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"> 3115</span><span class="keywordflow">              ENDIF</span></div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span>      <span class="comment">!***</span></div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>              <span class="keywordflow">IF</span>((xland(i,j)-1.5).GE.0.)<span class="keywordflow">THEN</span>                                  <span class="comment">! begining of land/sea if block</span></div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span>      <span class="comment">! Open water points</span></div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>                tsk_rural(i,j)=tsk(i,j)</div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>                hfx_rural(i,j)=hfx(i,j)</div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span>                qfx_rural(i,j)=qfx(i,j)</div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span>                lh_rural(i,j)=lh(i,j)</div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span>                emiss_rural(i,j)=emiss(i,j)</div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span>                grdflx_rural(i,j)=grdflx(i,j)</div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span>              <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span>      <span class="comment">! Land or sea-ice case</span></div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span>      </div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span>                <span class="keywordflow">IF</span> (xice(i,j) &gt;= xice_threshold) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span>                   <span class="comment">! Sea-ice point</span></div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span>                   ice = 1</div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"> 3131</span>                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> ( vegtyp == isice ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span>                   <span class="comment">! Land-ice point</span></div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span>                   ice = -1</div>
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"> 3134</span>                <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span>                   <span class="comment">! Neither sea ice or land ice.</span></div>
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"> 3136</span>                   ice=0</div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>                dqsdt2=q2sat*a23m4/(sfctmp-a4)**2</div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span>      </div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span>                <span class="keywordflow">IF</span>(snow(i,j).GT.0.0)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span>      <span class="comment">! snow on surface (use ice saturation properties)</span></div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span>                  sfctsno=sfctmp</div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span>                  e2sat=611.2*exp(6174.*(1./273.15 - 1./sfctsno))</div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span>                  q2sati=0.622*e2sat/(sfcprs-e2sat)</div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span>                  q2sati=q2sati/(1.0+q2sati)    <span class="comment">! spec. hum.</span></div>
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"> 3146</span>                  <span class="keywordflow">IF</span> (t1 .GT. 273.14) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span>      <span class="comment">! warm ground temps, weight the saturation between ice and water according to SNOWC</span></div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span>                    q2sat=q2sat*(1.-snowc(i,j)) + q2sati*snowc(i,j)</div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>                    dqsdt2=dqsdt2*(1.-snowc(i,j)) + q2sati*6174./(sfctsno**2)*snowc(i,j)</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span>                  <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span>      <span class="comment">! cold ground temps, use ice saturation only</span></div>
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"> 3152</span>                    q2sat=q2sati</div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span>                    dqsdt2=q2sati*6174./(sfctsno**2)</div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>      <span class="comment">! for snow cover fraction at 0 C, ground temp will not change, so DQSDT2 effectively zero</span></div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span>                  <span class="keywordflow">IF</span>(t1 .GT. 273. .AND. snowc(i,j) .GT. 0.)dqsdt2=dqsdt2*(1.-snowc(i,j))</div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>      </div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span>                <span class="comment">! Land-ice or land points use the usual deep-soil temperature.</span></div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span>                tbot=tmn(i,j)</div>
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"> 3161</span>      </div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"> 3162</span>                <span class="keywordflow">IF</span>(vegtyp.EQ.25) shdfac=0.0000</div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"> 3163</span>                <span class="keywordflow">IF</span>(vegtyp.EQ.26) shdfac=0.0000</div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"> 3164</span>                <span class="keywordflow">IF</span>(vegtyp.EQ.27) shdfac=0.0000</div>
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"> 3165</span>                <span class="keywordflow">IF</span>(soiltyp.EQ.14.AND.xice(i,j).EQ.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span><span class="preprocessor"></span>               <span class="keywordflow">IF</span>(iprint)print*,<span class="stringliteral">&#39; SOIL TYPE FOUND TO BE WATER AT A LAND-POINT&#39;</span></div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span>               <span class="keywordflow">IF</span>(iprint)print*,i,j,<span class="stringliteral">&#39;RESET SOIL in surfce.F&#39;</span></div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"> 3170</span><span class="preprocessor"></span>                  soiltyp=7</div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"> 3172</span>                snoalb1 = snoalb(i,j)</div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span><span class="comment">! converts canwat in mm to CMC in meters</span></div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span>                cmc=canwat(i,j)/1000.</div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span>      </div>
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"> 3176</span>      <span class="comment">!-------------------------------------------</span></div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span>      <span class="comment">!*** convert snow depth from mm to meter</span></div>
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"> 3178</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"> 3179</span>      <span class="comment">!          IF(RDMAXALB) THEN</span></div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span>      <span class="comment">!           SNOALB=ALBMAX(I,J)*0.01</span></div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>      <span class="comment">!         ELSE</span></div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>      <span class="comment">!           SNOALB=MAXALB(IVGTPK)*0.01</span></div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span>      <span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span>      </div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"> 3185</span>      <span class="comment">!        SNOALB1=0.80</span></div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span>      <span class="comment">!        SHMIN=0.00</span></div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span>              albbrd=albbck(i,j)</div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span>              z0brd=z0(i,j)</div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span>              embrd=embck(i,j)</div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span>              snotime1 = snotime(i,j)</div>
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"> 3191</span>              ribb=rib(i,j)</div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span>      <span class="comment">!FEI: temporaray arrays above need to be changed later by using SI</span></div>
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"> 3193</span>      </div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span>                <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>                  smc(ns)=smois(i,ns,j)</div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>                  stc(ns)=tslb(i,ns,j)                                          <span class="comment">!STEMP</span></div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span>                  swc(ns)=sh2o(i,ns,j)</div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span><span class="keywordflow">                ENDDO</span></div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"> 3200</span>                <span class="keywordflow">if</span> ( (sneqv.ne.0..AND.snowhk.eq.0.).or.(snowhk.le.sneqv) )<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span>                  snowhk= 5.*sneqv</div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span><span class="keywordflow">                endif</span></div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>      </div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>      <span class="comment">!Fei: urban. for urban surface, if calling UCM, redefine the natural surface in cities as</span></div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span>      <span class="comment">! the &quot;NATURAL&quot; category in the VEGPARM.TBL</span></div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span>        </div>
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"> 3208</span>        <span class="comment">!   IF(SF_URBAN_PHYSICS == 1.OR. SF_URBAN_PHYSICS==2.OR.SF_URBAN_PHYSICS==3 ) THEN</span></div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span>                       </div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span>      </div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span>           <span class="comment">!           IF( IVGTYP(I,J) == ISURBAN .or. IVGTYP(I,J) == LOW_DENSITY_RESIDENTIAL .or. &amp;</span></div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span>           <span class="comment">!            IVGTYP(I,J) == HIGH_DENSITY_RESIDENTIAL .or. IVGTYP(I,J) == HIGH_INTENSITY_INDUSTRIAL) THEN</span></div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span>           <span class="comment">!     VEGTYP = NATURAL</span></div>
<div class="line"><a id="l03214" name="l03214"></a><span class="lineno"> 3214</span>           <span class="comment">!            SHDFAC = SHDTBL(NATURAL)</span></div>
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"> 3215</span>           <span class="comment">!            ALBEDOK =0.2         !  0.2</span></div>
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"> 3216</span>           <span class="comment">!            ALBBRD  =0.2         !0.2</span></div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span>           <span class="comment">!            EMISSI = 0.98                                 !for VEGTYP=5</span></div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span>           <span class="comment">!     IF ( FRC_URB2D(I,J) &lt; 0.99 ) THEN</span></div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span>          <span class="comment">!               if(sf_urban_physics.eq.1)then</span></div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span>          <span class="comment">!       T1= ( TSK(I,J) -FRC_URB2D(I,J) * TS_URB2D (I,J) )/ (1-FRC_URB2D(I,J))</span></div>
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"> 3221</span>          <span class="comment">!               elseif((sf_urban_physics.eq.2).OR.(sf_urban_physics.eq.3))then</span></div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span>          <span class="comment">!            r1= (tsk(i,j)**4.)</span></div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span>          <span class="comment">!            r2= frc_urb2d(i,j)*(ts_urb2d(i,j)**4.)</span></div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"> 3224</span>          <span class="comment">!            r3= (1.-frc_urb2d(i,j))</span></div>
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"> 3225</span>         <span class="comment">!             t1= ((r1-r2)/r3)**.25</span></div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span>         <span class="comment">!                endif</span></div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span>         <span class="comment">!           ELSE</span></div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span>         <span class="comment">!       T1 = TSK(I,J)</span></div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>         <span class="comment">!              ENDIF</span></div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span>         <span class="comment">!             ENDIF</span></div>
<div class="line"><a id="l03231" name="l03231"></a><span class="lineno"> 3231</span>          <span class="comment">!       ELSE</span></div>
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"> 3232</span>           <span class="comment">!            IF( IVGTYP(I,J) == ISURBAN .or. IVGTYP(I,J) == LOW_DENSITY_RESIDENTIAL .or. &amp;</span></div>
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"> 3233</span>          <span class="comment">!              IVGTYP(I,J) == HIGH_DENSITY_RESIDENTIAL .or. IVGTYP(I,J) == HIGH_INTENSITY_INDUSTRIAL) THEN</span></div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span>           <span class="comment">!             VEGTYP = ISURBAN</span></div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span>           <span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span>           <span class="comment">!      ENDIF</span></div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span>      </div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span>            noah_call=.true.</div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span>      </div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span>            <span class="keywordflow">If</span> ( sf_urban_physics == 0 ) <span class="keywordflow">THEN</span>   <span class="comment">! ONLY NOAH</span></div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span>      </div>
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"> 3242</span>                 <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span>                       ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"> 3244</span>                       noah_call = .true.                 </div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>                       vegtyp = isurban</div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span><span class="keywordflow">                 ENDIF</span></div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>      </div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span>            </div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span>            <span class="keywordflow">IF</span>(sf_urban_physics == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"> 3251</span>      </div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span>                 <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span>                       ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial) <span class="keywordflow">THEN</span>   </div>
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"> 3254</span>                </div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span>                       noah_call = .true.                       </div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span>                       vegtyp = natural                                              </div>
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"> 3257</span>                       shdfac = shdtbl(natural)</div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span>                       albedok =0.2         <span class="comment">!  0.2</span></div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span>                       albbrd  =0.2         <span class="comment">!  0.2</span></div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>                       emissi = 0.98        <span class="comment">!  for VEGTYP=5       </span></div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span>                       </div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span>                  t1= ts_rul2d_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"> 3263</span>                       </div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span><span class="keywordflow">                 ENDIF</span></div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span>      </div>
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"> 3266</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span> </div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span><span class="comment">!===Yang, 2014/10/08, hydrological processes for urban vegetation in single layer UCM===</span></div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span>           aoasis = 1.0</div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span>           usoil = 1</div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span>           dsoil = 2</div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span>           irioption=iri_scheme</div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span>           omg= omg_urb2d(i,j)   </div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span>           tloc=mod(int(omg/3.14159*180./15.+12.+0.5 ),24)</div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span>           <span class="keywordflow">if</span> (tloc.lt.0) tloc=tloc+24</div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"> 3276</span>           <span class="keywordflow">if</span> (tloc==0) tloc=24</div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span>           <span class="keyword">CALL </span>cal_mon_day(julian,julyr,jmonth,jday) </div>
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"> 3278</span>      <span class="keywordflow">IF</span>(sf_urban_physics == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span>           <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span>                ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span>            aoasis = oasis  <span class="comment">! urban oasis effect</span></div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>                   <span class="keywordflow">IF</span> (irioption ==1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>                   <span class="keywordflow">IF</span> (tloc==21 .or. tloc==22) <span class="keywordflow">THEN</span>  <span class="comment">!irrigation on vegetaion in urban area, MAY-SEP, 9-10pm</span></div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span>                   <span class="keywordflow">IF</span> (jmonth==5 .or. jmonth==6 .or. jmonth==7 .or. jmonth==8 .or. jmonth==9) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span>                      <span class="keywordflow">IF</span> (smc(usoil) .LT. smcref) smc(usoil)= refsmc(isltyp(i,j))</div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span>                      <span class="keywordflow">IF</span> (smc(dsoil) .LT. smcref) smc(dsoil)= refsmc(isltyp(i,j))</div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"> 3291</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span> </div>
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"> 3293</span>      <span class="keywordflow">IF</span>(sf_urban_physics == 2 .or. sf_urban_physics == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span>          <span class="keywordflow">IF</span>(aoasis &gt; 1.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span>          <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;Urban oasis option is for SF_URBAN_PHYSICS == 1 only&#39;</span>)</div>
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"> 3296</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span>          <span class="keywordflow">IF</span>(irioption == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"> 3298</span>          <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;Urban irrigation option is for SF_URBAN_PHYSICS == 1 only&#39;</span>)</div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span>            </div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span>            <span class="keywordflow">IF</span>( sf_urban_physics==2.OR.sf_urban_physics==3 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span><span class="comment">!             print*, &#39;MOSAIC is not designed to work with SF_URBAN_PHYSICS=2 or SF_URBAN_PHYSICS=3&#39;</span></div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"> 3304</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>      </div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span>         <span class="keywordflow">IF</span> (noah_call) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span><span class="preprocessor"></span>                <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"> 3310</span>             print*, <span class="stringliteral">&#39;BEFORE SFLX, in Noahlsm_driver&#39;</span></div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"> 3311</span>             print*, <span class="stringliteral">&#39;ICE&#39;</span>, ice, <span class="stringliteral">&#39;DT&#39;</span>,dt, <span class="stringliteral">&#39;ZLVL&#39;</span>,zlvl, <span class="stringliteral">&#39;NSOIL&#39;</span>, nsoil,   &amp;</div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>             <span class="stringliteral">&#39;SLDPTH&#39;</span>, sldpth, <span class="stringliteral">&#39;LOCAL&#39;</span>,local, <span class="stringliteral">&#39;LUTYPE&#39;</span>,&amp;</div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span>              lutype, <span class="stringliteral">&#39;SLTYPE&#39;</span>,sltype, <span class="stringliteral">&#39;LWDN&#39;</span>,lwdn, <span class="stringliteral">&#39;SOLDN&#39;</span>,soldn,      &amp;</div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span>              <span class="stringliteral">&#39;SFCPRS&#39;</span>,sfcprs, <span class="stringliteral">&#39;PRCP&#39;</span>,prcp,<span class="stringliteral">&#39;SFCTMP&#39;</span>,sfctmp,<span class="stringliteral">&#39;Q2K&#39;</span>,q2k,   &amp;</div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>               <span class="stringliteral">&#39;TH2&#39;</span>,th2,<span class="stringliteral">&#39;Q2SAT&#39;</span>,q2sat,<span class="stringliteral">&#39;DQSDT2&#39;</span>,dqsdt2,<span class="stringliteral">&#39;VEGTYP&#39;</span>, vegtyp,&amp;</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>               <span class="stringliteral">&#39;SOILTYP&#39;</span>,soiltyp, <span class="stringliteral">&#39;SLOPETYP&#39;</span>,slopetyp, <span class="stringliteral">&#39;SHDFAC&#39;</span>,shdfac,&amp;</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span>               <span class="stringliteral">&#39;SHMIN&#39;</span>,shmin, <span class="stringliteral">&#39;ALBBRD&#39;</span>,albbrd,<span class="stringliteral">&#39;SNOALB1&#39;</span>,snoalb1,<span class="stringliteral">&#39;TBOT&#39;</span>,&amp;</div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span>                tbot, <span class="stringliteral">&#39;Z0BRD&#39;</span>,z0brd, <span class="stringliteral">&#39;Z0K&#39;</span>,z0k, <span class="stringliteral">&#39;CMC&#39;</span>,cmc, <span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;STC&#39;</span>,&amp;</div>
<div class="line"><a id="l03319" name="l03319"></a><span class="lineno"> 3319</span>                stc, <span class="stringliteral">&#39;SMC&#39;</span>,smc, <span class="stringliteral">&#39;SWC&#39;</span>,swc,<span class="stringliteral">&#39;SNOWHK&#39;</span>,snowhk,<span class="stringliteral">&#39;SNEQV&#39;</span>,sneqv,&amp;</div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span>                <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok,<span class="stringliteral">&#39;CHK&#39;</span>,chk,<span class="stringliteral">&#39;ETA&#39;</span>,eta,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat,      &amp;</div>
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"> 3321</span>                <span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,eta_kinematic, <span class="stringliteral">&#39;FDOWN&#39;</span>,fdown,<span class="stringliteral">&#39;EC&#39;</span>,ec,   &amp;</div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span>                <span class="stringliteral">&#39;EDIR&#39;</span>,edir,<span class="stringliteral">&#39;ET&#39;</span>,et,<span class="stringliteral">&#39;ETT&#39;</span>,ett,<span class="stringliteral">&#39;ESNOW&#39;</span>,esnow,<span class="stringliteral">&#39;DRIP&#39;</span>,drip,&amp;</div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span>                <span class="stringliteral">&#39;DEW&#39;</span>,dew,<span class="stringliteral">&#39;BETA&#39;</span>,beta,<span class="stringliteral">&#39;ETP&#39;</span>,etp,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;FLX1&#39;</span>,flx1,&amp;</div>
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"> 3324</span>                <span class="stringliteral">&#39;FLX2&#39;</span>,flx2,<span class="stringliteral">&#39;FLX3&#39;</span>,flx3,<span class="stringliteral">&#39;SNOMLT&#39;</span>,snomlt,<span class="stringliteral">&#39;SNCOVR&#39;</span>,sncovr,&amp;</div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"> 3325</span>                <span class="stringliteral">&#39;RUNOFF1&#39;</span>,runoff1,<span class="stringliteral">&#39;RUNOFF2&#39;</span>,runoff2,<span class="stringliteral">&#39;RUNOFF3&#39;</span>,runoff3, &amp;</div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span>                <span class="stringliteral">&#39;RC&#39;</span>,rc, <span class="stringliteral">&#39;PC&#39;</span>,pc,<span class="stringliteral">&#39;RSMIN&#39;</span>,rsmin,<span class="stringliteral">&#39;XLAI&#39;</span>,xlai,<span class="stringliteral">&#39;RCS&#39;</span>,rcs,  &amp;</div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span>                <span class="stringliteral">&#39;RCT&#39;</span>,rct,<span class="stringliteral">&#39;RCQ&#39;</span>,rcq,<span class="stringliteral">&#39;RCSOIL&#39;</span>,rcsoil,<span class="stringliteral">&#39;SOILW&#39;</span>,soilw,     &amp;</div>
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"> 3328</span>                <span class="stringliteral">&#39;SOILM&#39;</span>,soilm,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;SMCWLT&#39;</span>,smcwlt,<span class="stringliteral">&#39;SMCDRY&#39;</span>,smcdry,&amp;</div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span>                <span class="stringliteral">&#39;SMCREF&#39;</span>,smcref,<span class="stringliteral">&#39;SMCMAX&#39;</span>,smcmax,<span class="stringliteral">&#39;NROOT&#39;</span>,nroot</div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span><span class="keywordflow">                 endif</span></div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span>                <span class="keywordflow">IF</span> (rdlai2d) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span>                   <span class="keywordflow">IF</span> (shdfac &gt; 0.0 .AND. lai(i,j) &lt;= 0.0) lai(i,j) = 0.01</div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span>                   xlai = lai(i,j)</div>
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"> 3336</span><span class="keywordflow">                endif</span></div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span>      </div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span>          <span class="keywordflow">IF</span> ( ice == 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span>      </div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span>             <span class="comment">! Sea-ice case</span></div>
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"> 3341</span>      </div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span>             <span class="keywordflow">DO</span> ns = 1, nsoil</div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span>                sh2o(i,ns,j) = 1.0</div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span><span class="keywordflow">             ENDDO</span></div>
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"> 3345</span>             lai(i,j) = 0.01</div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span>      </div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span>             cycle iloop</div>
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"> 3348</span>      </div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span>          <span class="keywordflow">ELSEIF</span> (ice == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span>      </div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span>             <span class="comment">! Non-glacial land</span></div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span>      </div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span>             <span class="keyword">CALL </span>sflx (i,j,ffrozp, isurban, dt,zlvl,nsoil,sldpth,       &amp;    <span class="comment">!C</span></div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>                       local,                                            &amp;    <span class="comment">!L</span></div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span>                       lutype, sltype,                                   &amp;    <span class="comment">!CL</span></div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span>                       lwdn,soldn,solnet,sfcprs,prcp,sfctmp,q2k,dummy,   &amp;    <span class="comment">!F</span></div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span>                       dummy,dummy, dummy,                               &amp;    <span class="comment">!F PRCPRAIN not used</span></div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span>                       th2,q2sat,dqsdt2,                                 &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"> 3359</span>                       vegtyp,soiltyp,slopetyp,shdfac,shmin,shmax,       &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span>                       albbrd, snoalb1,tbot, z0brd, z0k, emissi, embrd,  &amp;    <span class="comment">!S</span></div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span>                       cmc,t1,stc,smc,swc,snowhk,sneqv,albedok,chk,dummy,&amp;    <span class="comment">!H</span></div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span>                       eta,sheat, eta_kinematic,fdown,                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"> 3363</span>                       ec,edir,et,ett,esnow,drip,dew,                    &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span>                       beta,etp,ssoil,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span>                       flx1,flx2,flx3,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span>             flx4,fvb,fbur,fgsn,ua_phys,                             &amp;    <span class="comment">!UA </span></div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span>                       snomlt,sncovr,                                    &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"> 3368</span>                       runoff1,runoff2,runoff3,                          &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"> 3369</span>                       rc,pc,rsmin,xlai,rcs,rct,rcq,rcsoil,              &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span>                       soilw,soilm,q1,smav,                              &amp;    <span class="comment">!D</span></div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>                       rdlai2d,usemonalb,                                &amp;</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span>                       snotime1,                                         &amp;</div>
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"> 3373</span>                       ribb,                                             &amp;</div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span>                       smcwlt,smcdry,smcref,smcmax,nroot,                &amp;</div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span>                       sfcheadrt(i,j),                                   &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span>                       infxsrt(i,j),etpnd1,opt_thcnd,aoasis              &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"> 3377</span>                ,xsda_qfx, hfx_phy, qfx_phy, xqnorm, fasdas, hcpct_fasdas    &amp; <span class="comment">! fasdas vars</span></div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span>                       )</div>
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"> 3379</span>      </div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span><span class="preprocessor">#ifdef WRF_HYDRO</span></div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span><span class="preprocessor"></span>                       soldrain(i,j) = runoff2*dt*1000.0</div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span><span class="preprocessor"></span>          <span class="keywordflow">ELSEIF</span> (ice == -1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span>      </div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span>             <span class="comment">!</span></div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span>             <span class="comment">! Set values that the LSM is expected to update,</span></div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span>             <span class="comment">! but don&#39;t get updated for glacial points.</span></div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span>             <span class="comment">!</span></div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span>             soilm = 0.0 <span class="comment">!BSINGH(PNNL)- SOILM is undefined for this case, it is used for diagnostics so setting it to zero</span></div>
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"> 3390</span>             xlai = 0.01 <span class="comment">! KWM Should this be Zero over land ice?  Does this value matter?</span></div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span>             runoff2 = 0.0</div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span>             runoff3 = 0.0</div>
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"> 3393</span>             <span class="keywordflow">DO</span> ns = 1, nsoil</div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span>                swc(ns) = 1.0</div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span>                smc(ns) = 1.0</div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span>                smav(ns) = 1.0</div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span><span class="keywordflow">             ENDDO</span></div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span>             <span class="keyword">CALL </span>sflx_glacial(i,j,isice,ffrozp,dt,zlvl,nsoil,sldpth,   &amp;    <span class="comment">!C</span></div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span>                  &amp;    lwdn,solnet,sfcprs,prcp,sfctmp,q2k,              &amp;    <span class="comment">!F</span></div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span>                  &amp;    th2,q2sat,dqsdt2,                                &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span>                  &amp;    albbrd, snoalb1,tbot, z0brd, z0k, emissi, embrd, &amp;    <span class="comment">!S</span></div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span>                  &amp;    t1,stc(1:nsoil),snowhk,sneqv,albedok,chk,        &amp;    <span class="comment">!H</span></div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span>                  &amp;    eta,sheat,eta_kinematic,fdown,                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span>                  &amp;    esnow,dew,                                       &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span>                  &amp;    etp,ssoil,                                       &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span>                  &amp;    flx1,flx2,flx3,                                  &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span>                  &amp;    snomlt,sncovr,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span>                  &amp;    runoff1,                                         &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span>                  &amp;    q1,                                              &amp;    <span class="comment">!D</span></div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span>                  &amp;    snotime1,                                        &amp;</div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span>                  &amp;    ribb)</div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span>      </div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span>             lai(i,j) = xlai</div>
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"> 3415</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span><span class="preprocessor"></span>                <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"> 3417</span>      </div>
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"> 3418</span>             print*, <span class="stringliteral">&#39;AFTER SFLX, in Noahlsm_driver&#39;</span></div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span>             print*, <span class="stringliteral">&#39;ICE&#39;</span>, ice, <span class="stringliteral">&#39;DT&#39;</span>,dt, <span class="stringliteral">&#39;ZLVL&#39;</span>,zlvl, <span class="stringliteral">&#39;NSOIL&#39;</span>, nsoil,   &amp;</div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span>             <span class="stringliteral">&#39;SLDPTH&#39;</span>, sldpth, <span class="stringliteral">&#39;LOCAL&#39;</span>,local, <span class="stringliteral">&#39;LUTYPE&#39;</span>,&amp;</div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span>              lutype, <span class="stringliteral">&#39;SLTYPE&#39;</span>,sltype, <span class="stringliteral">&#39;LWDN&#39;</span>,lwdn, <span class="stringliteral">&#39;SOLDN&#39;</span>,soldn,      &amp;</div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"> 3422</span>              <span class="stringliteral">&#39;SFCPRS&#39;</span>,sfcprs, <span class="stringliteral">&#39;PRCP&#39;</span>,prcp,<span class="stringliteral">&#39;SFCTMP&#39;</span>,sfctmp,<span class="stringliteral">&#39;Q2K&#39;</span>,q2k,   &amp;</div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span>               <span class="stringliteral">&#39;TH2&#39;</span>,th2,<span class="stringliteral">&#39;Q2SAT&#39;</span>,q2sat,<span class="stringliteral">&#39;DQSDT2&#39;</span>,dqsdt2,<span class="stringliteral">&#39;VEGTYP&#39;</span>, vegtyp,&amp;</div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span>                <span class="stringliteral">&#39;SOILTYP&#39;</span>,soiltyp, <span class="stringliteral">&#39;SLOPETYP&#39;</span>,slopetyp, <span class="stringliteral">&#39;SHDFAC&#39;</span>,shdfac,&amp;</div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span>               <span class="stringliteral">&#39;SHDMIN&#39;</span>,shmin, <span class="stringliteral">&#39;ALBBRD&#39;</span>,albbrd,<span class="stringliteral">&#39;SNOALB&#39;</span>,snoalb1,<span class="stringliteral">&#39;TBOT&#39;</span>,&amp;</div>
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"> 3426</span>                tbot, <span class="stringliteral">&#39;Z0BRD&#39;</span>,z0brd, <span class="stringliteral">&#39;Z0K&#39;</span>,z0k, <span class="stringliteral">&#39;CMC&#39;</span>,cmc, <span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;STC&#39;</span>,&amp;</div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span>                stc, <span class="stringliteral">&#39;SMC&#39;</span>,smc, <span class="stringliteral">&#39;SWc&#39;</span>,swc,<span class="stringliteral">&#39;SNOWHK&#39;</span>,snowhk,<span class="stringliteral">&#39;SNEQV&#39;</span>,sneqv,&amp;</div>
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"> 3428</span>                <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok,<span class="stringliteral">&#39;CHK&#39;</span>,chk,<span class="stringliteral">&#39;ETA&#39;</span>,eta,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat,      &amp;</div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span>                <span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,eta_kinematic, <span class="stringliteral">&#39;FDOWN&#39;</span>,fdown,<span class="stringliteral">&#39;EC&#39;</span>,ec,   &amp;</div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span>                <span class="stringliteral">&#39;EDIR&#39;</span>,edir,<span class="stringliteral">&#39;ET&#39;</span>,et,<span class="stringliteral">&#39;ETT&#39;</span>,ett,<span class="stringliteral">&#39;ESNOW&#39;</span>,esnow,<span class="stringliteral">&#39;DRIP&#39;</span>,drip,&amp;</div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span>                <span class="stringliteral">&#39;DEW&#39;</span>,dew,<span class="stringliteral">&#39;BETA&#39;</span>,beta,<span class="stringliteral">&#39;ETP&#39;</span>,etp,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;FLX1&#39;</span>,flx1,&amp;</div>
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"> 3432</span>                <span class="stringliteral">&#39;FLX2&#39;</span>,flx2,<span class="stringliteral">&#39;FLX3&#39;</span>,flx3,<span class="stringliteral">&#39;SNOMLT&#39;</span>,snomlt,<span class="stringliteral">&#39;SNCOVR&#39;</span>,sncovr,&amp;</div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span>                <span class="stringliteral">&#39;RUNOFF1&#39;</span>,runoff1,<span class="stringliteral">&#39;RUNOFF2&#39;</span>,runoff2,<span class="stringliteral">&#39;RUNOFF3&#39;</span>,runoff3, &amp;</div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span>                <span class="stringliteral">&#39;RC&#39;</span>,rc, <span class="stringliteral">&#39;PC&#39;</span>,pc,<span class="stringliteral">&#39;RSMIN&#39;</span>,rsmin,<span class="stringliteral">&#39;XLAI&#39;</span>,xlai,<span class="stringliteral">&#39;RCS&#39;</span>,rcs,  &amp;</div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span>                <span class="stringliteral">&#39;RCT&#39;</span>,rct,<span class="stringliteral">&#39;RCQ&#39;</span>,rcq,<span class="stringliteral">&#39;RCSOIL&#39;</span>,rcsoil,<span class="stringliteral">&#39;SOILW&#39;</span>,soilw,     &amp;</div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span>                <span class="stringliteral">&#39;SOILM&#39;</span>,soilm,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;SMCWLT&#39;</span>,smcwlt,<span class="stringliteral">&#39;SMCDRY&#39;</span>,smcdry,&amp;</div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span>                <span class="stringliteral">&#39;SMCREF&#39;</span>,smcref,<span class="stringliteral">&#39;SMCMAX&#39;</span>,smcmax,<span class="stringliteral">&#39;NROOT&#39;</span>,nroot</div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span><span class="keywordflow">                 endif</span></div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span>      <span class="comment">!***  UPDATE STATE VARIABLES</span></div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span>                canwat(i,j)=cmc*1000.</div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span>                snow(i,j)=sneqv*1000.</div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span>      <span class="comment">!          SNOWH(I,J)=SNOWHK*1000.</span></div>
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"> 3445</span>                snowh(i,j)=snowhk                   <span class="comment">! SNOWHK in meters</span></div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span>                albedo(i,j)=albedok</div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span>                alb_rural(i,j)=albedok</div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span>                albbck(i,j)=albbrd</div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span>                z0(i,j)=z0brd</div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span>                emiss(i,j) = emissi</div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span>                emiss_rural(i,j) = emissi</div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span>      <span class="comment">! Noah: activate time-varying roughness length (V3.3 Feb 2011)</span></div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span>                znt(i,j)=z0k</div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span>                tsk(i,j)=t1</div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span>                tsk_rural(i,j)=t1</div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span>                hfx(i,j)=sheat</div>
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"> 3457</span>                hfx_rural(i,j)=sheat</div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span>      <span class="comment">! MEk Jul07 add potential evap accum</span></div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"> 3459</span>              potevp(i,j)=potevp(i,j)+etp*fdtw</div>
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"> 3460</span>                qfx(i,j)=eta_kinematic</div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span>                qfx_rural(i,j)=eta_kinematic</div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span>      </div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span><span class="preprocessor">#ifdef WRF_HYDRO</span></div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span><span class="preprocessor"></span>      <span class="comment">!added by Wei Yu</span></div>
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"> 3465</span>      <span class="comment">!         QFX(I,J) = QFX(I,J) + ETPND1</span></div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span>      <span class="comment">!         ETA = ETA + ETPND1/2.501E6*dt</span></div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span>      <span class="comment">!end added by Wei Yu</span></div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span>                lh(i,j)=eta</div>
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"> 3471</span>                lh_rural(i,j)=eta</div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span>                grdflx(i,j)=ssoil</div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span>                grdflx_rural(i,j)=ssoil</div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span>                snowc(i,j)=sncovr</div>
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"> 3475</span>                chs2(i,j)=cqs2(i,j)</div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span>                snotime(i,j) = snotime1</div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span>      <span class="comment">!      prevent diagnostic ground q (q1) from being greater than qsat(tsk)</span></div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span>      <span class="comment">!      as happens over snow cover where the cqs2 value also becomes irrelevant</span></div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span>      <span class="comment">!      by setting cqs2=chs in this situation the 2m q should become just qv(k=1)</span></div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span>                <span class="keywordflow">IF</span> (q1 .GT. qsfc(i,j)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span>                  cqs2(i,j) = chs(i,j)</div>
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"> 3482</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"> 3483</span>      <span class="comment">!          QSFC(I,J)=Q1</span></div>
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"> 3484</span>      <span class="comment">! Convert QSFC back to mixing ratio</span></div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span>                 qsfc(i,j)= q1/(1.0-q1)</div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"> 3487</span>                 <span class="comment">! QSFC_RURAL(I,J)= Q1/(1.0-Q1)</span></div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span>      <span class="comment">! Calculate momentum flux from rural surface for use with multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span>      </div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span>                <span class="keywordflow">DO</span> 81 ns=1,nsoil</div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span>                 smois(i,ns,j)=smc(ns)</div>
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"> 3492</span>                 tslb(i,ns,j)=stc(ns)                                        <span class="comment">!  STEMP</span></div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span>                 sh2o(i,ns,j)=swc(ns)</div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span>         81     <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span>      <span class="comment">!       ENDIF</span></div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span>      </div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span>              flx4_2d(i,j)  = flx4</div>
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"> 3498</span>        fvb_2d(i,j)   = fvb</div>
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"> 3499</span>        fbur_2d(i,j)  = fbur</div>
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"> 3500</span>        fgsn_2d(i,j)  = fgsn</div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span>      </div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span>           <span class="comment">!</span></div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span>           <span class="comment">! Residual of surface energy balance equation terms</span></div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span>           <span class="comment">!</span></div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span>      </div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span>           <span class="keywordflow">IF</span> ( ua_phys ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"> 3507</span>               noahres(i,j) = ( solnet + lwdn ) - sheat + ssoil - eta &amp;</div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span>                    - ( emissi * stbolt * (t1**4) ) - flx1 - flx2 - flx3 - flx4</div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span>      </div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span>           <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span>               noahres(i,j) = ( solnet + lwdn ) - sheat + ssoil - eta &amp;</div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span>                    - ( emissi * stbolt * (t1**4) ) - flx1 - flx2 - flx3</div>
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"> 3513</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"> 3514</span>      </div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span><span class="keywordflow">               ENDIF</span>   <span class="comment">!ENDIF FOR Noah_call</span></div>
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"> 3516</span>               </div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span>              <span class="keywordflow">IF</span> (sf_urban_physics == 1 ) <span class="keywordflow">THEN</span>                                              <span class="comment">! Beginning of UCM CALL if block</span></div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span>      <span class="comment">! URBAN CANOPY MODEL START - urban</span></div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span>      <span class="comment">! Input variables lsm --&gt; urban</span></div>
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"> 3522</span>      </div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span>                <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>                    ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial ) <span class="keywordflow">THEN</span>            </div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span>      </div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span>                <span class="comment">!  UTYPE_URB = UTYPE_URB2D(I,J) !urban type (low, high or industrial)</span></div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span>                <span class="comment">!  this need to be changed in the mosaic danli</span></div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span>      </div>
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"> 3529</span>                <span class="keywordflow">IF</span>(ivgtyp(i,j)==isurban) utype_urb=2</div>
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"> 3530</span>                <span class="keywordflow">IF</span>(ivgtyp(i,j)==low_density_residential) utype_urb=1</div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span>                <span class="keywordflow">IF</span>(ivgtyp(i,j)==high_density_residential) utype_urb=2</div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>                <span class="keywordflow">IF</span>(ivgtyp(i,j)==high_intensity_industrial) utype_urb=3</div>
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"> 3533</span>                        </div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span>                <span class="keywordflow">IF</span>(utype_urb==1) frc_urb2d(i,j)=0.5</div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>                <span class="keywordflow">IF</span>(utype_urb==2) frc_urb2d(i,j)=0.9</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span>                <span class="keywordflow">IF</span>(utype_urb==3) frc_urb2d(i,j)=0.95</div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span>      </div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span>                  ta_urb    = sfctmp           <span class="comment">! [K]</span></div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span>                  qa_urb    = q2k              <span class="comment">! [kg/kg]</span></div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span>                  ua_urb    = sqrt(u_phy(i,1,j)**2.+v_phy(i,1,j)**2.)</div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span>                  u1_urb    = u_phy(i,1,j)</div>
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"> 3542</span>                  v1_urb    = v_phy(i,1,j)</div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span>                  <span class="keywordflow">IF</span>(ua_urb &lt; 1.) ua_urb=1.    <span class="comment">! [m/s]</span></div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span>                  ssg_urb   = soldn            <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span>                  ssgd_urb  = 0.8*soldn        <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span>                  ssgq_urb  = ssg_urb-ssgd_urb <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span>                  llg_urb   = glw(i,j)         <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span>                  rain_urb  = rainbl(i,j)      <span class="comment">! [mm]</span></div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span>                  rhoo_urb  = sfcprs / (287.04 * sfctmp * (1.0+ 0.61 * q2k)) <span class="comment">![kg/m/m/m]</span></div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span>                  za_urb    = zlvl             <span class="comment">! [m]</span></div>
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"> 3551</span>                  delt_urb  = dt               <span class="comment">! [sec]</span></div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span>                  xlat_urb  = xlat_urb2d(i,j)  <span class="comment">! [deg]</span></div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span>                  cosz_urb  = cosz_urb2d(i,j)  <span class="comment">!</span></div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span>                  omg_urb   = omg_urb2d(i,j)   <span class="comment">!</span></div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span>                  znt_urb   = znt(i,j)</div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span>      </div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span>                  lsolar_urb = .false.</div>
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"> 3558</span>                  </div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>      <span class="comment">! mosaic 3D to 2D</span></div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span>      </div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"> 3561</span>         tr_urb2d(i,j)=tr_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span>         tb_urb2d(i,j)=tb_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span>         tg_urb2d(i,j)=tg_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span>         tc_urb2d(i,j)=tc_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span>         qc_urb2d(i,j)=qc_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03566" name="l03566"></a><span class="lineno"> 3566</span>         uc_urb2d(i,j)=uc_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03567" name="l03567"></a><span class="lineno"> 3567</span>         ts_urb2d(i,j)=ts_urb2d_mosaic(i,mosaic_i,j)                         <span class="comment">! replace it with the mosaic one          </span></div>
<div class="line"><a id="l03568" name="l03568"></a><span class="lineno"> 3568</span>      </div>
<div class="line"><a id="l03569" name="l03569"></a><span class="lineno"> 3569</span>                  <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l03570" name="l03570"></a><span class="lineno"> 3570</span>                    trl_urb3d(i,k,j) = trl_urb3d_mosaic(i,k+(mosaic_i-1)*num_roof_layers,j)</div>
<div class="line"><a id="l03571" name="l03571"></a><span class="lineno"> 3571</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03572" name="l03572"></a><span class="lineno"> 3572</span>                  <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l03573" name="l03573"></a><span class="lineno"> 3573</span>                    tbl_urb3d(i,k,j) = tbl_urb3d_mosaic(i,k+(mosaic_i-1)*num_roof_layers,j)</div>
<div class="line"><a id="l03574" name="l03574"></a><span class="lineno"> 3574</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03575" name="l03575"></a><span class="lineno"> 3575</span>                  <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l03576" name="l03576"></a><span class="lineno"> 3576</span>                    tgl_urb3d(i,k,j) = tgl_urb3d_mosaic(i,k+(mosaic_i-1)*num_roof_layers,j)</div>
<div class="line"><a id="l03577" name="l03577"></a><span class="lineno"> 3577</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03578" name="l03578"></a><span class="lineno"> 3578</span>      </div>
<div class="line"><a id="l03579" name="l03579"></a><span class="lineno"> 3579</span>      <span class="comment">! mosaic 2D to 1D            </span></div>
<div class="line"><a id="l03580" name="l03580"></a><span class="lineno"> 3580</span>      </div>
<div class="line"><a id="l03581" name="l03581"></a><span class="lineno"> 3581</span>                  tr_urb = tr_urb2d(i,j)</div>
<div class="line"><a id="l03582" name="l03582"></a><span class="lineno"> 3582</span>                  tb_urb = tb_urb2d(i,j)</div>
<div class="line"><a id="l03583" name="l03583"></a><span class="lineno"> 3583</span>                  tg_urb = tg_urb2d(i,j)</div>
<div class="line"><a id="l03584" name="l03584"></a><span class="lineno"> 3584</span>                  tc_urb = tc_urb2d(i,j)</div>
<div class="line"><a id="l03585" name="l03585"></a><span class="lineno"> 3585</span>                  qc_urb = qc_urb2d(i,j)</div>
<div class="line"><a id="l03586" name="l03586"></a><span class="lineno"> 3586</span>                  uc_urb = uc_urb2d(i,j)</div>
<div class="line"><a id="l03587" name="l03587"></a><span class="lineno"> 3587</span>      </div>
<div class="line"><a id="l03588" name="l03588"></a><span class="lineno"> 3588</span>                  <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l03589" name="l03589"></a><span class="lineno"> 3589</span>                    trl_urb(k) = trl_urb3d(i,k,j)</div>
<div class="line"><a id="l03590" name="l03590"></a><span class="lineno"> 3590</span>                    smr_urb(k) = smr_urb3d(i,k,j)</div>
<div class="line"><a id="l03591" name="l03591"></a><span class="lineno"> 3591</span>                    tgrl_urb(k)= tgrl_urb3d(i,k,j)</div>
<div class="line"><a id="l03592" name="l03592"></a><span class="lineno"> 3592</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03593" name="l03593"></a><span class="lineno"> 3593</span>                  <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l03594" name="l03594"></a><span class="lineno"> 3594</span>                    tbl_urb(k) = tbl_urb3d(i,k,j)</div>
<div class="line"><a id="l03595" name="l03595"></a><span class="lineno"> 3595</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03596" name="l03596"></a><span class="lineno"> 3596</span>                  <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l03597" name="l03597"></a><span class="lineno"> 3597</span>                    tgl_urb(k) = tgl_urb3d(i,k,j)</div>
<div class="line"><a id="l03598" name="l03598"></a><span class="lineno"> 3598</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03599" name="l03599"></a><span class="lineno"> 3599</span>                  </div>
<div class="line"><a id="l03600" name="l03600"></a><span class="lineno"> 3600</span>                  tgr_urb   = tgr_urb2d(i,j)</div>
<div class="line"><a id="l03601" name="l03601"></a><span class="lineno"> 3601</span>                  cmcr_urb  = cmcr_urb2d(i,j)</div>
<div class="line"><a id="l03602" name="l03602"></a><span class="lineno"> 3602</span>                  flxhumr_urb = flxhumr_urb2d(i,j)</div>
<div class="line"><a id="l03603" name="l03603"></a><span class="lineno"> 3603</span>                  flxhumb_urb = flxhumb_urb2d(i,j)</div>
<div class="line"><a id="l03604" name="l03604"></a><span class="lineno"> 3604</span>                  flxhumg_urb = flxhumg_urb2d(i,j)</div>
<div class="line"><a id="l03605" name="l03605"></a><span class="lineno"> 3605</span>                  drelr_urb = drelr_urb2d(i,j)</div>
<div class="line"><a id="l03606" name="l03606"></a><span class="lineno"> 3606</span>                  drelb_urb = drelb_urb2d(i,j)</div>
<div class="line"><a id="l03607" name="l03607"></a><span class="lineno"> 3607</span>                  drelg_urb = drelg_urb2d(i,j)</div>
<div class="line"><a id="l03608" name="l03608"></a><span class="lineno"> 3608</span>      </div>
<div class="line"><a id="l03609" name="l03609"></a><span class="lineno"> 3609</span>                  xxxr_urb = xxxr_urb2d(i,j)</div>
<div class="line"><a id="l03610" name="l03610"></a><span class="lineno"> 3610</span>                  xxxb_urb = xxxb_urb2d(i,j)</div>
<div class="line"><a id="l03611" name="l03611"></a><span class="lineno"> 3611</span>                  xxxg_urb = xxxg_urb2d(i,j)</div>
<div class="line"><a id="l03612" name="l03612"></a><span class="lineno"> 3612</span>                  xxxc_urb = xxxc_urb2d(i,j)</div>
<div class="line"><a id="l03613" name="l03613"></a><span class="lineno"> 3613</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03614" name="l03614"></a><span class="lineno"> 3614</span>      <span class="comment">!      Limits to avoid dividing by small number</span></div>
<div class="line"><a id="l03615" name="l03615"></a><span class="lineno"> 3615</span>                  <span class="keywordflow">if</span> (chs(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03616" name="l03616"></a><span class="lineno"> 3616</span>                     chs(i,j)  = 1.0e-02</div>
<div class="line"><a id="l03617" name="l03617"></a><span class="lineno"> 3617</span><span class="keywordflow">                  endif</span></div>
<div class="line"><a id="l03618" name="l03618"></a><span class="lineno"> 3618</span>                  <span class="keywordflow">if</span> (chs2(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03619" name="l03619"></a><span class="lineno"> 3619</span>                     chs2(i,j)  = 1.0e-02</div>
<div class="line"><a id="l03620" name="l03620"></a><span class="lineno"> 3620</span><span class="keywordflow">                  endif</span></div>
<div class="line"><a id="l03621" name="l03621"></a><span class="lineno"> 3621</span>                  <span class="keywordflow">if</span> (cqs2(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03622" name="l03622"></a><span class="lineno"> 3622</span>                     cqs2(i,j)  = 1.0e-02</div>
<div class="line"><a id="l03623" name="l03623"></a><span class="lineno"> 3623</span><span class="keywordflow">                  endif</span></div>
<div class="line"><a id="l03624" name="l03624"></a><span class="lineno"> 3624</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03625" name="l03625"></a><span class="lineno"> 3625</span>                  chs_urb  = chs(i,j)</div>
<div class="line"><a id="l03626" name="l03626"></a><span class="lineno"> 3626</span>                  chs2_urb = chs2(i,j)</div>
<div class="line"><a id="l03627" name="l03627"></a><span class="lineno"> 3627</span>                  <span class="keywordflow">IF</span> (<span class="keyword">PRESENT</span>(cmr_sfcdif)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03628" name="l03628"></a><span class="lineno"> 3628</span>                     cmr_urb = cmr_sfcdif(i,j)</div>
<div class="line"><a id="l03629" name="l03629"></a><span class="lineno"> 3629</span>                     chr_urb = chr_sfcdif(i,j)</div>
<div class="line"><a id="l03630" name="l03630"></a><span class="lineno"> 3630</span>                     cmgr_urb = cmgr_sfcdif(i,j)</div>
<div class="line"><a id="l03631" name="l03631"></a><span class="lineno"> 3631</span>                     chgr_urb = chgr_sfcdif(i,j)</div>
<div class="line"><a id="l03632" name="l03632"></a><span class="lineno"> 3632</span>                     cmc_urb = cmc_sfcdif(i,j)</div>
<div class="line"><a id="l03633" name="l03633"></a><span class="lineno"> 3633</span>                     chc_urb = chc_sfcdif(i,j)</div>
<div class="line"><a id="l03634" name="l03634"></a><span class="lineno"> 3634</span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a id="l03635" name="l03635"></a><span class="lineno"> 3635</span>      </div>
<div class="line"><a id="l03636" name="l03636"></a><span class="lineno"> 3636</span>      <span class="comment">! NUDAPT for SLUCM</span></div>
<div class="line"><a id="l03637" name="l03637"></a><span class="lineno"> 3637</span>                  mh_urb = mh_urb2d(i,j)</div>
<div class="line"><a id="l03638" name="l03638"></a><span class="lineno"> 3638</span>                  stdh_urb = stdh_urb2d(i,j)</div>
<div class="line"><a id="l03639" name="l03639"></a><span class="lineno"> 3639</span>                  lp_urb = lp_urb2d(i,j)</div>
<div class="line"><a id="l03640" name="l03640"></a><span class="lineno"> 3640</span>                  hgt_urb = hgt_urb2d(i,j)</div>
<div class="line"><a id="l03641" name="l03641"></a><span class="lineno"> 3641</span>                  lf_urb = 0.0</div>
<div class="line"><a id="l03642" name="l03642"></a><span class="lineno"> 3642</span>                  <span class="keywordflow">DO</span> k = 1,4</div>
<div class="line"><a id="l03643" name="l03643"></a><span class="lineno"> 3643</span>                    lf_urb(k)=lf_urb2d(i,k,j)</div>
<div class="line"><a id="l03644" name="l03644"></a><span class="lineno"> 3644</span><span class="keywordflow">                  ENDDO</span></div>
<div class="line"><a id="l03645" name="l03645"></a><span class="lineno"> 3645</span>                  frc_urb = frc_urb2d(i,j)</div>
<div class="line"><a id="l03646" name="l03646"></a><span class="lineno"> 3646</span>                  lb_urb = lb_urb2d(i,j)</div>
<div class="line"><a id="l03647" name="l03647"></a><span class="lineno"> 3647</span>                  check = 0</div>
<div class="line"><a id="l03648" name="l03648"></a><span class="lineno"> 3648</span>                  <span class="keywordflow">if</span> (i.eq.73.and.j.eq.125)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03649" name="l03649"></a><span class="lineno"> 3649</span>                     check = 1</div>
<div class="line"><a id="l03650" name="l03650"></a><span class="lineno"> 3650</span><span class="keywordflow">                  end if</span></div>
<div class="line"><a id="l03651" name="l03651"></a><span class="lineno"> 3651</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03652" name="l03652"></a><span class="lineno"> 3652</span>      <span class="comment">! Call urban</span></div>
<div class="line"><a id="l03653" name="l03653"></a><span class="lineno"> 3653</span>                  <span class="keyword">CALL </span>cal_mon_day(julian,julyr,jmonth,jday)      </div>
<div class="line"><a id="l03654" name="l03654"></a><span class="lineno"> 3654</span>                  <span class="keyword">CALL </span>urban(lsolar_urb,                                      &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l03655" name="l03655"></a><span class="lineno"> 3655</span>                             num_roof_layers,num_wall_layers,num_road_layers, &amp; <span class="comment">! C</span></div>
<div class="line"><a id="l03656" name="l03656"></a><span class="lineno"> 3656</span>                             dzr,dzb,dzg,                                     &amp; <span class="comment">! C</span></div>
<div class="line"><a id="l03657" name="l03657"></a><span class="lineno"> 3657</span>                             utype_urb,ta_urb,qa_urb,ua_urb,u1_urb,v1_urb,ssg_urb, &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l03658" name="l03658"></a><span class="lineno"> 3658</span>                             ssgd_urb,ssgq_urb,llg_urb,rain_urb,rhoo_urb,     &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l03659" name="l03659"></a><span class="lineno"> 3659</span>                             za_urb,declin_urb,cosz_urb,omg_urb,              &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l03660" name="l03660"></a><span class="lineno"> 3660</span>                             xlat_urb,delt_urb,znt_urb,                       &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span>                             chs_urb, chs2_urb,                               &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>                             tr_urb, tb_urb, tg_urb, tc_urb, qc_urb,uc_urb,   &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span>                             trl_urb,tbl_urb,tgl_urb,                         &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span>                             xxxr_urb, xxxb_urb, xxxg_urb, xxxc_urb,          &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span>                             ts_urb,qs_urb,sh_urb,lh_urb,lh_kinematic_urb,    &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>                             sw_urb,alb_urb,lw_urb,g_urb,rn_urb,psim_urb,psih_urb, &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>                             gz1oz0_urb,                                      &amp; <span class="comment">!O</span></div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span>                             cmr_urb, chr_urb, cmc_urb, chc_urb,              &amp;</div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span>                             u10_urb, v10_urb, th2_urb, q2_urb,               &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span>                             ust_urb,mh_urb, stdh_urb, lf_urb, lp_urb,        &amp; <span class="comment">! 0</span></div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span>                             hgt_urb,frc_urb,lb_urb, check,cmcr_urb,tgr_urb,  &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span>                             tgrl_urb,smr_urb,cmgr_urb,chgr_urb,jmonth,       &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span>                             drelr_urb,drelb_urb,                             &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span>                             drelg_urb,flxhumr_urb,flxhumb_urb,flxhumg_urb)     </div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span>      </div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span><span class="preprocessor"></span>                <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"> 3678</span>      </div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span>             print*, <span class="stringliteral">&#39;AFTER CALL URBAN&#39;</span></div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>             print*,<span class="stringliteral">&#39;num_roof_layers&#39;</span>,num_roof_layers, <span class="stringliteral">&#39;num_wall_layers&#39;</span>,  &amp;</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span>              num_wall_layers,                                             &amp;</div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span>             <span class="stringliteral">&#39;DZR&#39;</span>,dzr,<span class="stringliteral">&#39;DZB&#39;</span>,dzb,<span class="stringliteral">&#39;DZG&#39;</span>,dzg,<span class="stringliteral">&#39;UTYPE_URB&#39;</span>,utype_urb,<span class="stringliteral">&#39;TA_URB&#39;</span>, &amp;</div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span>              ta_urb,                                                      &amp;</div>
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"> 3684</span>              <span class="stringliteral">&#39;QA_URB&#39;</span>,qa_urb,<span class="stringliteral">&#39;UA_URB&#39;</span>,ua_urb,<span class="stringliteral">&#39;U1_URB&#39;</span>,u1_urb,<span class="stringliteral">&#39;V1_URB&#39;</span>,    &amp;</div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span>               v1_urb,                                                     &amp;</div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span>               <span class="stringliteral">&#39;SSG_URB&#39;</span>,ssg_urb,<span class="stringliteral">&#39;SSGD_URB&#39;</span>,ssgd_urb,<span class="stringliteral">&#39;SSGQ_URB&#39;</span>,ssgq_urb,  &amp;</div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span>              <span class="stringliteral">&#39;LLG_URB&#39;</span>,llg_urb,<span class="stringliteral">&#39;RAIN_URB&#39;</span>,rain_urb,<span class="stringliteral">&#39;RHOO_URB&#39;</span>,rhoo_urb,   &amp;</div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span>              <span class="stringliteral">&#39;ZA_URB&#39;</span>,za_urb, <span class="stringliteral">&#39;DECLIN_URB&#39;</span>,declin_urb,<span class="stringliteral">&#39;COSZ_URB&#39;</span>,cosz_urb,&amp;</div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span>              <span class="stringliteral">&#39;OMG_URB&#39;</span>,omg_urb,<span class="stringliteral">&#39;XLAT_URB&#39;</span>,xlat_urb,<span class="stringliteral">&#39;DELT_URB&#39;</span>,delt_urb,   &amp;</div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span>               <span class="stringliteral">&#39;ZNT_URB&#39;</span>,znt_urb,<span class="stringliteral">&#39;TR_URB&#39;</span>,tr_urb, <span class="stringliteral">&#39;TB_URB&#39;</span>,tb_urb,<span class="stringliteral">&#39;TG_URB&#39;</span>,&amp;</div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span>               tg_urb,<span class="stringliteral">&#39;TC_URB&#39;</span>,tc_urb,<span class="stringliteral">&#39;QC_URB&#39;</span>,qc_urb,<span class="stringliteral">&#39;TRL_URB&#39;</span>,trl_urb,   &amp;</div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span>                <span class="stringliteral">&#39;TBL_URB&#39;</span>,tbl_urb,<span class="stringliteral">&#39;TGL_URB&#39;</span>,tgl_urb,<span class="stringliteral">&#39;XXXR_URB&#39;</span>,xxxr_urb,   &amp;</div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span>               <span class="stringliteral">&#39;XXXB_URB&#39;</span>,xxxb_urb,<span class="stringliteral">&#39;XXXG_URB&#39;</span>,xxxg_urb,<span class="stringliteral">&#39;XXXC_URB&#39;</span>,xxxc_urb,&amp;</div>
<div class="line"><a id="l03694" name="l03694"></a><span class="lineno"> 3694</span>               <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb,<span class="stringliteral">&#39;QS_URB&#39;</span>,qs_urb,<span class="stringliteral">&#39;SH_URB&#39;</span>,sh_urb,<span class="stringliteral">&#39;LH_URB&#39;</span>,   &amp;</div>
<div class="line"><a id="l03695" name="l03695"></a><span class="lineno"> 3695</span>               lh_urb, <span class="stringliteral">&#39;LH_KINEMATIC_URB&#39;</span>,lh_kinematic_urb,<span class="stringliteral">&#39;SW_URB&#39;</span>,sw_urb,&amp;</div>
<div class="line"><a id="l03696" name="l03696"></a><span class="lineno"> 3696</span>               <span class="stringliteral">&#39;ALB_URB&#39;</span>,alb_urb,<span class="stringliteral">&#39;LW_URB&#39;</span>,lw_urb,<span class="stringliteral">&#39;G_URB&#39;</span>,g_urb,<span class="stringliteral">&#39;RN_URB&#39;</span>,   &amp;</div>
<div class="line"><a id="l03697" name="l03697"></a><span class="lineno"> 3697</span>                rn_urb, <span class="stringliteral">&#39;PSIM_URB&#39;</span>,psim_urb,<span class="stringliteral">&#39;PSIH_URB&#39;</span>,psih_urb,          &amp;</div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span>               <span class="stringliteral">&#39;U10_URB&#39;</span>,u10_urb,<span class="stringliteral">&#39;V10_URB&#39;</span>,v10_urb,<span class="stringliteral">&#39;TH2_URB&#39;</span>,th2_urb,      &amp;</div>
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"> 3699</span>                <span class="stringliteral">&#39;Q2_URB&#39;</span>,q2_urb,<span class="stringliteral">&#39;CHS_URB&#39;</span>,chs_urb,<span class="stringliteral">&#39;CHS2_URB&#39;</span>,chs2_urb</div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span><span class="keywordflow">                 endif</span></div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span>                  ts_urb2d(i,j) = ts_urb</div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span>      </div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>                  albedo(i,j) = frc_urb2d(i,j)*alb_urb+(1-frc_urb2d(i,j))*albedok   <span class="comment">![-]</span></div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span>                  hfx(i,j) = frc_urb2d(i,j)*sh_urb+(1-frc_urb2d(i,j))*sheat         <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>                  qfx(i,j) = frc_urb2d(i,j)*lh_kinematic_urb &amp;</div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span>                           + (1-frc_urb2d(i,j))*eta_kinematic                <span class="comment">![kg/m/m/s]</span></div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span>                  lh(i,j) = frc_urb2d(i,j)*lh_urb+(1-frc_urb2d(i,j))*eta            <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span>                  grdflx(i,j) = frc_urb2d(i,j)*g_urb+(1-frc_urb2d(i,j))*ssoil       <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>                  tsk(i,j) = frc_urb2d(i,j)*ts_urb+(1-frc_urb2d(i,j))*t1            <span class="comment">![K]</span></div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>                  q1 = frc_urb2d(i,j)*qs_urb+(1-frc_urb2d(i,j))*q1            <span class="comment">![-]</span></div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>      <span class="comment">! Convert QSFC back to mixing ratio</span></div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span>                  qsfc(i,j)= q1/(1.0-q1)</div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>                  ust(i,j)= frc_urb2d(i,j)*ust_urb+(1-frc_urb2d(i,j))*ust(i,j)      <span class="comment">![m/s]</span></div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>                  znt(i,j)= exp(frc_urb2d(i,j)*alog(znt_urb)+(1-frc_urb2d(i,j))* alog(znt(i,j)))   <span class="comment">! ADD BY DAN</span></div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span> </div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span><span class="preprocessor"></span>          <span class="keywordflow">IF</span>(iprint)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>      </div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>          print*, <span class="stringliteral">&#39; FRC_URB2D&#39;</span>, frc_urb2d,                        &amp;</div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span>          <span class="stringliteral">&#39;ALB_URB&#39;</span>,alb_urb, <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok, &amp;</div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>          <span class="stringliteral">&#39;ALBEDO(I,J)&#39;</span>,  albedo(i,j),                  &amp;</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>          <span class="stringliteral">&#39;SH_URB&#39;</span>,sh_urb,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat, <span class="stringliteral">&#39;HFX(I,J)&#39;</span>,hfx(i,j),  &amp;</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>          <span class="stringliteral">&#39;LH_KINEMATIC_URB&#39;</span>,lh_kinematic_urb,<span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,  &amp;</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span>           eta_kinematic, <span class="stringliteral">&#39;QFX(I,J)&#39;</span>,qfx(i,j),                  &amp;</div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span>          <span class="stringliteral">&#39;LH_URB&#39;</span>,lh_urb, <span class="stringliteral">&#39;ETA&#39;</span>,eta, <span class="stringliteral">&#39;LH(I,J)&#39;</span>,lh(i,j),        &amp;</div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span>          <span class="stringliteral">&#39;G_URB&#39;</span>,g_urb,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;GRDFLX(I,J)&#39;</span>, grdflx(i,j),&amp;</div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span>          <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb,<span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;TSK(I,J)&#39;</span>,tsk(i,j),          &amp;</div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>          <span class="stringliteral">&#39;QS_URB&#39;</span>,qs_urb,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;QSFC(I,J)&#39;</span>,qsfc(i,j)</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span><span class="keywordflow">           endif</span></div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>      <span class="comment">! Renew Urban State Varialbes</span></div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>      </div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span>                  tr_urb2d(i,j) = tr_urb</div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>                  tb_urb2d(i,j) = tb_urb</div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span>                  tg_urb2d(i,j) = tg_urb</div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span>                  tc_urb2d(i,j) = tc_urb</div>
<div class="line"><a id="l03740" name="l03740"></a><span class="lineno"> 3740</span>                  qc_urb2d(i,j) = qc_urb</div>
<div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>                  uc_urb2d(i,j) = uc_urb</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>      </div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span>                  <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span>                    trl_urb3d(i,k,j) = trl_urb(k)</div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>                    smr_urb3d(i,k,j) = smr_urb(k)</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>                    tgrl_urb3d(i,k,j)= tgrl_urb(k)</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>                  <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span>                    tbl_urb3d(i,k,j) = tbl_urb(k)</div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>                  <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>                    tgl_urb3d(i,k,j) = tgl_urb(k)</div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"> 3754</span> </div>
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>                  tgr_urb2d(i,j) =tgr_urb </div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>                  cmcr_urb2d(i,j)=cmcr_urb</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>                    flxhumr_urb2d(i,j)=flxhumr_urb </div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>                  flxhumb_urb2d(i,j)=flxhumb_urb</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>                  flxhumg_urb2d(i,j)=flxhumg_urb</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>                  drelr_urb2d(i,j) = drelr_urb </div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>                  drelb_urb2d(i,j) = drelb_urb </div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>                  drelg_urb2d(i,j) = drelg_urb</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span>           </div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span>                  xxxr_urb2d(i,j) = xxxr_urb</div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span>                  xxxb_urb2d(i,j) = xxxb_urb</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>                  xxxg_urb2d(i,j) = xxxg_urb</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>                  xxxc_urb2d(i,j) = xxxc_urb</div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span>      </div>
<div class="line"><a id="l03769" name="l03769"></a><span class="lineno"> 3769</span>                  sh_urb2d(i,j)    = sh_urb</div>
<div class="line"><a id="l03770" name="l03770"></a><span class="lineno"> 3770</span>                  lh_urb2d(i,j)    = lh_urb</div>
<div class="line"><a id="l03771" name="l03771"></a><span class="lineno"> 3771</span>                  g_urb2d(i,j)     = g_urb</div>
<div class="line"><a id="l03772" name="l03772"></a><span class="lineno"> 3772</span>                  rn_urb2d(i,j)    = rn_urb</div>
<div class="line"><a id="l03773" name="l03773"></a><span class="lineno"> 3773</span>                  psim_urb2d(i,j)  = psim_urb</div>
<div class="line"><a id="l03774" name="l03774"></a><span class="lineno"> 3774</span>                  psih_urb2d(i,j)  = psih_urb</div>
<div class="line"><a id="l03775" name="l03775"></a><span class="lineno"> 3775</span>                  gz1oz0_urb2d(i,j)= gz1oz0_urb</div>
<div class="line"><a id="l03776" name="l03776"></a><span class="lineno"> 3776</span>                  u10_urb2d(i,j)   = u10_urb</div>
<div class="line"><a id="l03777" name="l03777"></a><span class="lineno"> 3777</span>                  v10_urb2d(i,j)   = v10_urb</div>
<div class="line"><a id="l03778" name="l03778"></a><span class="lineno"> 3778</span>                  th2_urb2d(i,j)   = th2_urb</div>
<div class="line"><a id="l03779" name="l03779"></a><span class="lineno"> 3779</span>                  q2_urb2d(i,j)    = q2_urb</div>
<div class="line"><a id="l03780" name="l03780"></a><span class="lineno"> 3780</span>                  ust_urb2d(i,j)   = ust_urb</div>
<div class="line"><a id="l03781" name="l03781"></a><span class="lineno"> 3781</span>                  akms_urb2d(i,j)  = karman * ust_urb2d(i,j)/(gz1oz0_urb2d(i,j)-psim_urb2d(i,j))</div>
<div class="line"><a id="l03782" name="l03782"></a><span class="lineno"> 3782</span>                  <span class="keywordflow">IF</span> (<span class="keyword">PRESENT</span>(cmr_sfcdif)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03783" name="l03783"></a><span class="lineno"> 3783</span>                     cmr_sfcdif(i,j) = cmr_urb</div>
<div class="line"><a id="l03784" name="l03784"></a><span class="lineno"> 3784</span>                     chr_sfcdif(i,j) = chr_urb</div>
<div class="line"><a id="l03785" name="l03785"></a><span class="lineno"> 3785</span>                     cmgr_sfcdif(i,j) = cmgr_urb</div>
<div class="line"><a id="l03786" name="l03786"></a><span class="lineno"> 3786</span>                     chgr_sfcdif(i,j) = chgr_urb</div>
<div class="line"><a id="l03787" name="l03787"></a><span class="lineno"> 3787</span>                     cmc_sfcdif(i,j) = cmc_urb</div>
<div class="line"><a id="l03788" name="l03788"></a><span class="lineno"> 3788</span>                     chc_sfcdif(i,j) = chc_urb</div>
<div class="line"><a id="l03789" name="l03789"></a><span class="lineno"> 3789</span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a id="l03790" name="l03790"></a><span class="lineno"> 3790</span>                  </div>
<div class="line"><a id="l03791" name="l03791"></a><span class="lineno"> 3791</span>                     <span class="comment">! 2D to 3D  mosaic danli</span></div>
<div class="line"><a id="l03792" name="l03792"></a><span class="lineno"> 3792</span>                              </div>
<div class="line"><a id="l03793" name="l03793"></a><span class="lineno"> 3793</span>                                       tr_urb2d_mosaic(i,mosaic_i,j)=tr_urb2d(i,j)                               </div>
<div class="line"><a id="l03794" name="l03794"></a><span class="lineno"> 3794</span>                                       tb_urb2d_mosaic(i,mosaic_i,j)=tb_urb2d(i,j)                                   </div>
<div class="line"><a id="l03795" name="l03795"></a><span class="lineno"> 3795</span>                                       tg_urb2d_mosaic(i,mosaic_i,j)=tg_urb2d(i,j)                                   </div>
<div class="line"><a id="l03796" name="l03796"></a><span class="lineno"> 3796</span>                                       tc_urb2d_mosaic(i,mosaic_i,j)=tc_urb2d(i,j)                                  </div>
<div class="line"><a id="l03797" name="l03797"></a><span class="lineno"> 3797</span>                                       qc_urb2d_mosaic(i,mosaic_i,j)=qc_urb2d(i,j)                                   </div>
<div class="line"><a id="l03798" name="l03798"></a><span class="lineno"> 3798</span>                                       uc_urb2d_mosaic(i,mosaic_i,j)=uc_urb2d(i,j)                                   </div>
<div class="line"><a id="l03799" name="l03799"></a><span class="lineno"> 3799</span>                                       ts_urb2d_mosaic(i,mosaic_i,j)=ts_urb2d(i,j)                                   </div>
<div class="line"><a id="l03800" name="l03800"></a><span class="lineno"> 3800</span>                                       ts_rul2d_mosaic(i,mosaic_i,j)=t1                                </div>
<div class="line"><a id="l03801" name="l03801"></a><span class="lineno"> 3801</span>                              </div>
<div class="line"><a id="l03802" name="l03802"></a><span class="lineno"> 3802</span>                                          <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l03803" name="l03803"></a><span class="lineno"> 3803</span>                                            trl_urb3d_mosaic(i,k+(mosaic_i-1)*num_roof_layers,j)=trl_urb3d(i,k,j) </div>
<div class="line"><a id="l03804" name="l03804"></a><span class="lineno"> 3804</span><span class="keywordflow">                                          END DO</span></div>
<div class="line"><a id="l03805" name="l03805"></a><span class="lineno"> 3805</span>                                          <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l03806" name="l03806"></a><span class="lineno"> 3806</span>                                            tbl_urb3d_mosaic(i,k+(mosaic_i-1)*num_roof_layers,j)=tbl_urb3d(i,k,j) </div>
<div class="line"><a id="l03807" name="l03807"></a><span class="lineno"> 3807</span><span class="keywordflow">                                          END DO</span></div>
<div class="line"><a id="l03808" name="l03808"></a><span class="lineno"> 3808</span>                                          <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l03809" name="l03809"></a><span class="lineno"> 3809</span>                                            tgl_urb3d_mosaic(i,k+(mosaic_i-1)*num_roof_layers,j)=tgl_urb3d(i,k,j) </div>
<div class="line"><a id="l03810" name="l03810"></a><span class="lineno"> 3810</span><span class="keywordflow">                                                END DO</span></div>
<div class="line"><a id="l03811" name="l03811"></a><span class="lineno"> 3811</span>                                    </div>
<div class="line"><a id="l03812" name="l03812"></a><span class="lineno"> 3812</span>                                      sh_urb2d_mosaic(i,mosaic_i,j) = sh_urb2d(i,j)</div>
<div class="line"><a id="l03813" name="l03813"></a><span class="lineno"> 3813</span>                                  lh_urb2d_mosaic(i,mosaic_i,j) = lh_urb2d(i,j)</div>
<div class="line"><a id="l03814" name="l03814"></a><span class="lineno"> 3814</span>                                      g_urb2d_mosaic(i,mosaic_i,j)  = g_urb2d(i,j)</div>
<div class="line"><a id="l03815" name="l03815"></a><span class="lineno"> 3815</span>                                    rn_urb2d_mosaic(i,mosaic_i,j) = rn_urb2d(i,j)</div>
<div class="line"><a id="l03816" name="l03816"></a><span class="lineno"> 3816</span>                                    </div>
<div class="line"><a id="l03817" name="l03817"></a><span class="lineno"> 3817</span><span class="keywordflow">                END IF</span></div>
<div class="line"><a id="l03818" name="l03818"></a><span class="lineno"> 3818</span>      </div>
<div class="line"><a id="l03819" name="l03819"></a><span class="lineno"> 3819</span><span class="keywordflow">               ENDIF</span>                                   <span class="comment">! end of UCM CALL if block</span></div>
<div class="line"><a id="l03820" name="l03820"></a><span class="lineno"> 3820</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l03821" name="l03821"></a><span class="lineno"> 3821</span>      <span class="comment">! Urban Part End - urban</span></div>
<div class="line"><a id="l03822" name="l03822"></a><span class="lineno"> 3822</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l03823" name="l03823"></a><span class="lineno"> 3823</span>      </div>
<div class="line"><a id="l03824" name="l03824"></a><span class="lineno"> 3824</span>      <span class="comment">!***  DIAGNOSTICS</span></div>
<div class="line"><a id="l03825" name="l03825"></a><span class="lineno"> 3825</span>                smstav(i,j)=soilw</div>
<div class="line"><a id="l03826" name="l03826"></a><span class="lineno"> 3826</span>                smstot(i,j)=soilm*1000.</div>
<div class="line"><a id="l03827" name="l03827"></a><span class="lineno"> 3827</span>                <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l03828" name="l03828"></a><span class="lineno"> 3828</span>                smcrel(i,ns,j)=smav(ns)</div>
<div class="line"><a id="l03829" name="l03829"></a><span class="lineno"> 3829</span><span class="keywordflow">                ENDDO</span></div>
<div class="line"><a id="l03830" name="l03830"></a><span class="lineno"> 3830</span>      </div>
<div class="line"><a id="l03831" name="l03831"></a><span class="lineno"> 3831</span>      <span class="comment">!         Convert the water unit into mm</span></div>
<div class="line"><a id="l03832" name="l03832"></a><span class="lineno"> 3832</span>                sfcrunoff(i,j)=sfcrunoff(i,j)+runoff1*dt*1000.0</div>
<div class="line"><a id="l03833" name="l03833"></a><span class="lineno"> 3833</span>                udrunoff(i,j)=udrunoff(i,j)+runoff2*dt*1000.0</div>
<div class="line"><a id="l03834" name="l03834"></a><span class="lineno"> 3834</span>      <span class="comment">! snow defined when fraction of frozen precip (FFROZP) &gt; 0.5,</span></div>
<div class="line"><a id="l03835" name="l03835"></a><span class="lineno"> 3835</span>                <span class="keywordflow">IF</span>(ffrozp.GT.0.5)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03836" name="l03836"></a><span class="lineno"> 3836</span>                  acsnow(i,j)=acsnow(i,j)+prcp*dt</div>
<div class="line"><a id="l03837" name="l03837"></a><span class="lineno"> 3837</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03838" name="l03838"></a><span class="lineno"> 3838</span>                <span class="keywordflow">IF</span>(snow(i,j).GT.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03839" name="l03839"></a><span class="lineno"> 3839</span>                  acsnom(i,j)=acsnom(i,j)+snomlt*1000.</div>
<div class="line"><a id="l03840" name="l03840"></a><span class="lineno"> 3840</span>      <span class="comment">! accumulated snow-melt energy</span></div>
<div class="line"><a id="l03841" name="l03841"></a><span class="lineno"> 3841</span>                  snopcx(i,j)=snopcx(i,j)-snomlt/fdtliw</div>
<div class="line"><a id="l03842" name="l03842"></a><span class="lineno"> 3842</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l03843" name="l03843"></a><span class="lineno"> 3843</span>      </div>
<div class="line"><a id="l03844" name="l03844"></a><span class="lineno"> 3844</span><span class="keywordflow">              ENDIF</span>                                                           <span class="comment">! endif of land-sea test</span></div>
<div class="line"><a id="l03845" name="l03845"></a><span class="lineno"> 3845</span>      </div>
<div class="line"><a id="l03846" name="l03846"></a><span class="lineno"> 3846</span>      <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03847" name="l03847"></a><span class="lineno"> 3847</span>      <span class="comment">! Done with the Noah-UCM MOSAIC  DANLI</span></div>
<div class="line"><a id="l03848" name="l03848"></a><span class="lineno"> 3848</span>      <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03849" name="l03849"></a><span class="lineno"> 3849</span>      </div>
<div class="line"><a id="l03850" name="l03850"></a><span class="lineno"> 3850</span>                  tsk_mosaic(i,mosaic_i,j)=tsk(i,j)                           <span class="comment">! from 2D to 3D</span></div>
<div class="line"><a id="l03851" name="l03851"></a><span class="lineno"> 3851</span>                  qsfc_mosaic(i,mosaic_i,j)=qsfc(i,j)</div>
<div class="line"><a id="l03852" name="l03852"></a><span class="lineno"> 3852</span>                  canwat_mosaic(i,mosaic_i,j)=canwat(i,j) </div>
<div class="line"><a id="l03853" name="l03853"></a><span class="lineno"> 3853</span>                  snow_mosaic(i,mosaic_i,j)=snow(i,j) </div>
<div class="line"><a id="l03854" name="l03854"></a><span class="lineno"> 3854</span>                  snowh_mosaic(i,mosaic_i,j)=snowh(i,j)  </div>
<div class="line"><a id="l03855" name="l03855"></a><span class="lineno"> 3855</span>                  snowc_mosaic(i,mosaic_i,j)=snowc(i,j) </div>
<div class="line"><a id="l03856" name="l03856"></a><span class="lineno"> 3856</span>      </div>
<div class="line"><a id="l03857" name="l03857"></a><span class="lineno"> 3857</span>                  albedo_mosaic(i,mosaic_i,j)=albedo(i,j) </div>
<div class="line"><a id="l03858" name="l03858"></a><span class="lineno"> 3858</span>                  albbck_mosaic(i,mosaic_i,j)=albbck(i,j)  </div>
<div class="line"><a id="l03859" name="l03859"></a><span class="lineno"> 3859</span>                  emiss_mosaic(i,mosaic_i,j)=emiss(i,j) </div>
<div class="line"><a id="l03860" name="l03860"></a><span class="lineno"> 3860</span>                  embck_mosaic(i,mosaic_i,j)=embck(i,j)  </div>
<div class="line"><a id="l03861" name="l03861"></a><span class="lineno"> 3861</span>                  znt_mosaic(i,mosaic_i,j)=znt(i,j)  </div>
<div class="line"><a id="l03862" name="l03862"></a><span class="lineno"> 3862</span>                  z0_mosaic(i,mosaic_i,j)=z0(i,j)    </div>
<div class="line"><a id="l03863" name="l03863"></a><span class="lineno"> 3863</span>                  lai_mosaic(i,mosaic_i,j)=xlai</div>
<div class="line"><a id="l03864" name="l03864"></a><span class="lineno"> 3864</span>                  rc_mosaic(i,mosaic_i,j)=rc</div>
<div class="line"><a id="l03865" name="l03865"></a><span class="lineno"> 3865</span>                                                                                       </div>
<div class="line"><a id="l03866" name="l03866"></a><span class="lineno"> 3866</span>                  hfx_mosaic(i,mosaic_i,j)=hfx(i,j) </div>
<div class="line"><a id="l03867" name="l03867"></a><span class="lineno"> 3867</span>                  qfx_mosaic(i,mosaic_i,j)=qfx(i,j)  </div>
<div class="line"><a id="l03868" name="l03868"></a><span class="lineno"> 3868</span>                  lh_mosaic(i,mosaic_i,j)=lh(i,j)  </div>
<div class="line"><a id="l03869" name="l03869"></a><span class="lineno"> 3869</span>                  grdflx_mosaic(i,mosaic_i,j)=grdflx(i,j) </div>
<div class="line"><a id="l03870" name="l03870"></a><span class="lineno"> 3870</span>                  snotime_mosaic(i,mosaic_i,j)=snotime(i,j) </div>
<div class="line"><a id="l03871" name="l03871"></a><span class="lineno"> 3871</span>       </div>
<div class="line"><a id="l03872" name="l03872"></a><span class="lineno"> 3872</span>                  <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l03873" name="l03873"></a><span class="lineno"> 3873</span>        </div>
<div class="line"><a id="l03874" name="l03874"></a><span class="lineno"> 3874</span>                  tslb_mosaic(i,nsoil*(mosaic_i-1)+ns,j)=tslb(i,ns,j)</div>
<div class="line"><a id="l03875" name="l03875"></a><span class="lineno"> 3875</span>                  smois_mosaic(i,nsoil*(mosaic_i-1)+ns,j)=smois(i,ns,j)</div>
<div class="line"><a id="l03876" name="l03876"></a><span class="lineno"> 3876</span>                  sh2o_mosaic(i,nsoil*(mosaic_i-1)+ns,j)=sh2o(i,ns,j)  </div>
<div class="line"><a id="l03877" name="l03877"></a><span class="lineno"> 3877</span>      </div>
<div class="line"><a id="l03878" name="l03878"></a><span class="lineno"> 3878</span><span class="keywordflow">                  ENDDO</span></div>
<div class="line"><a id="l03879" name="l03879"></a><span class="lineno"> 3879</span>                  </div>
<div class="line"><a id="l03880" name="l03880"></a><span class="lineno"> 3880</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l03881" name="l03881"></a><span class="lineno"> 3881</span><span class="preprocessor"></span>            <span class="keywordflow">IF</span>(tsk_mosaic(i,mosaic_i,j) &gt; 350 .OR. tsk_mosaic(i,mosaic_i,j) &lt; 250 .OR. abs(hfx_mosaic(i,mosaic_i,j)) &gt; 700 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03882" name="l03882"></a><span class="lineno"> 3882</span>                  print*, <span class="stringliteral">&#39;I&#39;</span>, i, <span class="stringliteral">&#39;J&#39;</span>, j, <span class="stringliteral">&#39;MOSAIC_I&#39;</span>, mosaic_i</div>
<div class="line"><a id="l03883" name="l03883"></a><span class="lineno"> 3883</span>                  print*, <span class="stringliteral">&#39;mosaic_cat_index&#39;</span>,mosaic_cat_index(i,mosaic_i,j), <span class="stringliteral">&#39;landusef2&#39;</span>,landusef2(i,mosaic_i,j)</div>
<div class="line"><a id="l03884" name="l03884"></a><span class="lineno"> 3884</span>                  print*, <span class="stringliteral">&#39;TSK_mosaic&#39;</span>, tsk_mosaic(i,mosaic_i,j), <span class="stringliteral">&#39;HFX_mosaic&#39;</span>, hfx_mosaic(i,mosaic_i,j), &amp;</div>
<div class="line"><a id="l03885" name="l03885"></a><span class="lineno"> 3885</span>                          <span class="stringliteral">&#39;LH_mosaic&#39;</span>,lh_mosaic(i,mosaic_i,j),<span class="stringliteral">&#39;GRDFLX_mosaic&#39;</span>,grdflx_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03886" name="l03886"></a><span class="lineno"> 3886</span>                  print*, <span class="stringliteral">&#39;ZNT_mosaic&#39;</span>, znt_mosaic(i, mosaic_i,j), <span class="stringliteral">&#39;Z0_mosaic&#39;</span>, z0_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03887" name="l03887"></a><span class="lineno"> 3887</span>                  print*, <span class="stringliteral">&#39;LAI_mosaic&#39;</span>, lai_mosaic(i, mosaic_i,j)</div>
<div class="line"><a id="l03888" name="l03888"></a><span class="lineno"> 3888</span>                  print*, <span class="stringliteral">&#39;FRC_URB2D&#39;</span>,frc_urb2d(i,j)</div>
<div class="line"><a id="l03889" name="l03889"></a><span class="lineno"> 3889</span>                  print*, <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb2d(i,j),<span class="stringliteral">&#39;T1&#39;</span>,t1</div>
<div class="line"><a id="l03890" name="l03890"></a><span class="lineno"> 3890</span>                  print*, <span class="stringliteral">&#39;SH_URB2D&#39;</span>,sh_urb2d(i,j),<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat</div>
<div class="line"><a id="l03891" name="l03891"></a><span class="lineno"> 3891</span>                  print*, <span class="stringliteral">&#39;LH_URB&#39;</span>,lh_urb2d(i,j),<span class="stringliteral">&#39;ETA&#39;</span>,eta</div>
<div class="line"><a id="l03892" name="l03892"></a><span class="lineno"> 3892</span>                  print*, <span class="stringliteral">&#39;TS_RUL2D&#39;</span>,ts_rul2d_mosaic(i,mosaic_i,j)</div>
<div class="line"><a id="l03893" name="l03893"></a><span class="lineno"> 3893</span>                  </div>
<div class="line"><a id="l03894" name="l03894"></a><span class="lineno"> 3894</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l03895" name="l03895"></a><span class="lineno"> 3895</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03896" name="l03896"></a><span class="lineno"> 3896</span><span class="preprocessor"></span>                  </div>
<div class="line"><a id="l03897" name="l03897"></a><span class="lineno"> 3897</span>      <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03898" name="l03898"></a><span class="lineno"> 3898</span>      <span class="comment">! Now let&#39;s do the grid-averaging</span></div>
<div class="line"><a id="l03899" name="l03899"></a><span class="lineno"> 3899</span>      <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03900" name="l03900"></a><span class="lineno"> 3900</span>      </div>
<div class="line"><a id="l03901" name="l03901"></a><span class="lineno"> 3901</span>                  farea  = landusef2(i,mosaic_i,j)</div>
<div class="line"><a id="l03902" name="l03902"></a><span class="lineno"> 3902</span>      </div>
<div class="line"><a id="l03903" name="l03903"></a><span class="lineno"> 3903</span>                  tsk_mosaic_avg(i,j) = tsk_mosaic_avg(i,j) + (emiss_mosaic(i,mosaic_i,j)*tsk_mosaic(i,mosaic_i,j)**4)*farea    <span class="comment">! conserve the longwave radiation</span></div>
<div class="line"><a id="l03904" name="l03904"></a><span class="lineno"> 3904</span>                  </div>
<div class="line"><a id="l03905" name="l03905"></a><span class="lineno"> 3905</span>                  qsfc_mosaic_avg(i,j) = qsfc_mosaic_avg(i,j) + qsfc_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03906" name="l03906"></a><span class="lineno"> 3906</span>                  canwat_mosaic_avg(i,j) = canwat_mosaic_avg(i,j) + canwat_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03907" name="l03907"></a><span class="lineno"> 3907</span>                  snow_mosaic_avg(i,j) = snow_mosaic_avg(i,j) + snow_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03908" name="l03908"></a><span class="lineno"> 3908</span>                  snowh_mosaic_avg(i,j) = snowh_mosaic_avg(i,j) + snowh_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03909" name="l03909"></a><span class="lineno"> 3909</span>                  snowc_mosaic_avg(i,j) = snowc_mosaic_avg(i,j) + snowc_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03910" name="l03910"></a><span class="lineno"> 3910</span>      </div>
<div class="line"><a id="l03911" name="l03911"></a><span class="lineno"> 3911</span>                   <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l03912" name="l03912"></a><span class="lineno"> 3912</span>      </div>
<div class="line"><a id="l03913" name="l03913"></a><span class="lineno"> 3913</span>                 tslb_mosaic_avg(i,ns,j)=tslb_mosaic_avg(i,ns,j) + tslb_mosaic(i,ns*mosaic_i,j)*farea</div>
<div class="line"><a id="l03914" name="l03914"></a><span class="lineno"> 3914</span>                 smois_mosaic_avg(i,ns,j)=smois_mosaic_avg(i,ns,j) + smois_mosaic(i,ns*mosaic_i,j)*farea</div>
<div class="line"><a id="l03915" name="l03915"></a><span class="lineno"> 3915</span>                 sh2o_mosaic_avg(i,ns,j)=sh2o_mosaic_avg(i,ns,j) + sh2o_mosaic(i,ns*mosaic_i,j)*farea</div>
<div class="line"><a id="l03916" name="l03916"></a><span class="lineno"> 3916</span>      </div>
<div class="line"><a id="l03917" name="l03917"></a><span class="lineno"> 3917</span><span class="keywordflow">                   ENDDO</span></div>
<div class="line"><a id="l03918" name="l03918"></a><span class="lineno"> 3918</span>      </div>
<div class="line"><a id="l03919" name="l03919"></a><span class="lineno"> 3919</span>                  farea_mosaic_avg(i,j)=farea_mosaic_avg(i,j)+farea</div>
<div class="line"><a id="l03920" name="l03920"></a><span class="lineno"> 3920</span>                  hfx_mosaic_avg(i,j) = hfx_mosaic_avg(i,j) + hfx_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03921" name="l03921"></a><span class="lineno"> 3921</span>                  qfx_mosaic_avg(i,j) = qfx_mosaic_avg(i,j) + qfx_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03922" name="l03922"></a><span class="lineno"> 3922</span>                  lh_mosaic_avg(i,j) = lh_mosaic_avg(i,j) + lh_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03923" name="l03923"></a><span class="lineno"> 3923</span>                  grdflx_mosaic_avg(i,j)=grdflx_mosaic_avg(i,j)+grdflx_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03924" name="l03924"></a><span class="lineno"> 3924</span>                  </div>
<div class="line"><a id="l03925" name="l03925"></a><span class="lineno"> 3925</span>                  albedo_mosaic_avg(i,j)=albedo_mosaic_avg(i,j)+albedo_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03926" name="l03926"></a><span class="lineno"> 3926</span>                  albbck_mosaic_avg(i,j)=albbck_mosaic_avg(i,j)+albbck_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03927" name="l03927"></a><span class="lineno"> 3927</span>                  emiss_mosaic_avg(i,j)=emiss_mosaic_avg(i,j)+emiss_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03928" name="l03928"></a><span class="lineno"> 3928</span>                  embck_mosaic_avg(i,j)=embck_mosaic_avg(i,j)+embck_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03929" name="l03929"></a><span class="lineno"> 3929</span>                  znt_mosaic_avg(i,j)=znt_mosaic_avg(i,j)+alog(znt_mosaic(i,mosaic_i,j))*farea</div>
<div class="line"><a id="l03930" name="l03930"></a><span class="lineno"> 3930</span>                  z0_mosaic_avg(i,j)=z0_mosaic_avg(i,j)+alog(z0_mosaic(i,mosaic_i,j))*farea</div>
<div class="line"><a id="l03931" name="l03931"></a><span class="lineno"> 3931</span>                  lai_mosaic_avg(i,j)=lai_mosaic_avg(i,j)+lai_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03932" name="l03932"></a><span class="lineno"> 3932</span>                  <span class="keywordflow">if</span>(rc_mosaic(i,mosaic_i,j) .Gt. 0.0) <span class="keywordflow">Then</span></div>
<div class="line"><a id="l03933" name="l03933"></a><span class="lineno"> 3933</span>                     rc_mosaic_avg(i,j) = rc_mosaic_avg(i,j)+1.0/rc_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03934" name="l03934"></a><span class="lineno"> 3934</span>                  <span class="keywordflow">else</span> </div>
<div class="line"><a id="l03935" name="l03935"></a><span class="lineno"> 3935</span>                     rc_mosaic_avg(i,j) = rc_mosaic_avg(i,j) + rc_mosaic(i,mosaic_i,j)*farea</div>
<div class="line"><a id="l03936" name="l03936"></a><span class="lineno"> 3936</span><span class="keywordflow">                  End If</span></div>
<div class="line"><a id="l03937" name="l03937"></a><span class="lineno"> 3937</span><span class="keywordflow">                  ENDDO</span>                     <span class="comment">! ENDDO FOR mosaic_i = 1, mosaic_cat</span></div>
<div class="line"><a id="l03938" name="l03938"></a><span class="lineno"> 3938</span> </div>
<div class="line"><a id="l03939" name="l03939"></a><span class="lineno"> 3939</span>      <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03940" name="l03940"></a><span class="lineno"> 3940</span>      <span class="comment">! Now let&#39;s send the 3D values to the 2D variables that might be needed in other routines</span></div>
<div class="line"><a id="l03941" name="l03941"></a><span class="lineno"> 3941</span>      <span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a id="l03942" name="l03942"></a><span class="lineno"> 3942</span>      </div>
<div class="line"><a id="l03943" name="l03943"></a><span class="lineno"> 3943</span>          ivgtyp(i,j)=ivgtyp_dominant(i,j)                                 <span class="comment">! the dominant vege category </span></div>
<div class="line"><a id="l03944" name="l03944"></a><span class="lineno"> 3944</span>          albedo(i,j)=albedo_mosaic_avg(i,j)</div>
<div class="line"><a id="l03945" name="l03945"></a><span class="lineno"> 3945</span>          albbck(i,j)=albbck_mosaic_avg(i,j) </div>
<div class="line"><a id="l03946" name="l03946"></a><span class="lineno"> 3946</span>          emiss(i,j)= emiss_mosaic_avg(i,j) </div>
<div class="line"><a id="l03947" name="l03947"></a><span class="lineno"> 3947</span>          embck(i,j)= embck_mosaic_avg(i,j)  </div>
<div class="line"><a id="l03948" name="l03948"></a><span class="lineno"> 3948</span>          znt(i,j)= exp(znt_mosaic_avg(i,j)/farea_mosaic_avg(i,j))</div>
<div class="line"><a id="l03949" name="l03949"></a><span class="lineno"> 3949</span>          z0(i,j)= exp(z0_mosaic_avg(i,j)/farea_mosaic_avg(i,j))</div>
<div class="line"><a id="l03950" name="l03950"></a><span class="lineno"> 3950</span>          xlai2(i,j)= lai_mosaic_avg(i,j)</div>
<div class="line"><a id="l03951" name="l03951"></a><span class="lineno"> 3951</span>          <span class="keywordflow">IF</span> (rc_mosaic_avg(i,j) .Gt. 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03952" name="l03952"></a><span class="lineno"> 3952</span>              rc2(i,j) = 1.0/(rc_mosaic_avg(i,j))</div>
<div class="line"><a id="l03953" name="l03953"></a><span class="lineno"> 3953</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03954" name="l03954"></a><span class="lineno"> 3954</span><span class="comment">!RC_mosaic_avg was zero for all tiles (cell over water), thus RC2 set to zero to avoid infinity</span></div>
<div class="line"><a id="l03955" name="l03955"></a><span class="lineno"> 3955</span>              rc2(i,j) = rc_mosaic_avg(i,j)</div>
<div class="line"><a id="l03956" name="l03956"></a><span class="lineno"> 3956</span><span class="keywordflow">          END IF</span></div>
<div class="line"><a id="l03957" name="l03957"></a><span class="lineno"> 3957</span>          tsk(i,j)=(tsk_mosaic_avg(i,j)/emiss_mosaic_avg(i,j))**(0.25)                                  <span class="comment">! from 3D to 2D</span></div>
<div class="line"><a id="l03958" name="l03958"></a><span class="lineno"> 3958</span>          qsfc(i,j)=qsfc_mosaic_avg(i,j)</div>
<div class="line"><a id="l03959" name="l03959"></a><span class="lineno"> 3959</span>          canwat(i,j) = canwat_mosaic_avg(i,j)</div>
<div class="line"><a id="l03960" name="l03960"></a><span class="lineno"> 3960</span>          snow(i,j) = snow_mosaic_avg(i,j)</div>
<div class="line"><a id="l03961" name="l03961"></a><span class="lineno"> 3961</span>          snowh(i,j) = snowh_mosaic_avg(i,j)  </div>
<div class="line"><a id="l03962" name="l03962"></a><span class="lineno"> 3962</span>          snowc(i,j) = snowc_mosaic_avg(i,j)    </div>
<div class="line"><a id="l03963" name="l03963"></a><span class="lineno"> 3963</span>          </div>
<div class="line"><a id="l03964" name="l03964"></a><span class="lineno"> 3964</span>          hfx(i,j) = hfx_mosaic_avg(i,j) </div>
<div class="line"><a id="l03965" name="l03965"></a><span class="lineno"> 3965</span>          qfx(i,j) = qfx_mosaic_avg(i,j) </div>
<div class="line"><a id="l03966" name="l03966"></a><span class="lineno"> 3966</span>          lh(i,j) = lh_mosaic_avg(i,j) </div>
<div class="line"><a id="l03967" name="l03967"></a><span class="lineno"> 3967</span>          grdflx(i,j)=grdflx_mosaic_avg(i,j)</div>
<div class="line"><a id="l03968" name="l03968"></a><span class="lineno"> 3968</span>        </div>
<div class="line"><a id="l03969" name="l03969"></a><span class="lineno"> 3969</span>                    <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l03970" name="l03970"></a><span class="lineno"> 3970</span>      </div>
<div class="line"><a id="l03971" name="l03971"></a><span class="lineno"> 3971</span>               tslb(i,ns,j)=tslb_mosaic_avg(i,ns,j)</div>
<div class="line"><a id="l03972" name="l03972"></a><span class="lineno"> 3972</span>               smois(i,ns,j)=smois_mosaic_avg(i,ns,j)</div>
<div class="line"><a id="l03973" name="l03973"></a><span class="lineno"> 3973</span>               sh2o(i,ns,j)=sh2o_mosaic_avg(i,ns,j)</div>
<div class="line"><a id="l03974" name="l03974"></a><span class="lineno"> 3974</span>      </div>
<div class="line"><a id="l03975" name="l03975"></a><span class="lineno"> 3975</span><span class="keywordflow">                    ENDDO</span></div>
<div class="line"><a id="l03976" name="l03976"></a><span class="lineno"> 3976</span>      </div>
<div class="line"><a id="l03977" name="l03977"></a><span class="lineno"> 3977</span>      <span class="keywordflow">ELSE</span>    <span class="comment">! This corresponds to IF ((sf_surface_mosaic == 1) .AND. ((XLAND(I,J)-1.5).LT.0.) .AND. (XICE(I,J) &lt; XICE_THRESHOLD) ) THEN</span></div>
<div class="line"><a id="l03978" name="l03978"></a><span class="lineno"> 3978</span>      </div>
<div class="line"><a id="l03979" name="l03979"></a><span class="lineno"> 3979</span>      <span class="comment">! surface pressure</span></div>
<div class="line"><a id="l03980" name="l03980"></a><span class="lineno"> 3980</span>              psfc=p8w3d(i,1,j)</div>
<div class="line"><a id="l03981" name="l03981"></a><span class="lineno"> 3981</span>      <span class="comment">! pressure in middle of lowest layer</span></div>
<div class="line"><a id="l03982" name="l03982"></a><span class="lineno"> 3982</span>              sfcprs=(p8w3d(i,kts+1,j)+p8w3d(i,kts,j))*0.5</div>
<div class="line"><a id="l03983" name="l03983"></a><span class="lineno"> 3983</span>      <span class="comment">! convert from mixing ratio to specific humidity</span></div>
<div class="line"><a id="l03984" name="l03984"></a><span class="lineno"> 3984</span>               q2k=qv3d(i,1,j)/(1.0+qv3d(i,1,j))</div>
<div class="line"><a id="l03985" name="l03985"></a><span class="lineno"> 3985</span>      <span class="comment">!</span></div>
<div class="line"><a id="l03986" name="l03986"></a><span class="lineno"> 3986</span>      <span class="comment">!         Q2SAT=QGH(I,j)</span></div>
<div class="line"><a id="l03987" name="l03987"></a><span class="lineno"> 3987</span>               q2sat=qgh(i,j)/(1.0+qgh(i,j))        <span class="comment">! Q2SAT is sp humidity</span></div>
<div class="line"><a id="l03988" name="l03988"></a><span class="lineno"> 3988</span>      <span class="comment">! add check on myj=.true.</span></div>
<div class="line"><a id="l03989" name="l03989"></a><span class="lineno"> 3989</span>      <span class="comment">!        IF((Q2K.GE.Q2SAT*TRESH).AND.Q2K.LT.QZ0(I,J))THEN</span></div>
<div class="line"><a id="l03990" name="l03990"></a><span class="lineno"> 3990</span>              <span class="keywordflow">IF</span>((myj).AND.(q2k.GE.q2sat*tresh).AND.q2k.LT.qz0(i,j))<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l03991" name="l03991"></a><span class="lineno"> 3991</span>                satflg=0.</div>
<div class="line"><a id="l03992" name="l03992"></a><span class="lineno"> 3992</span>                chklowq(i,j)=0.</div>
<div class="line"><a id="l03993" name="l03993"></a><span class="lineno"> 3993</span>              <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l03994" name="l03994"></a><span class="lineno"> 3994</span>                satflg=1.0</div>
<div class="line"><a id="l03995" name="l03995"></a><span class="lineno"> 3995</span>                chklowq(i,j)=1.</div>
<div class="line"><a id="l03996" name="l03996"></a><span class="lineno"> 3996</span><span class="keywordflow">              ENDIF</span></div>
<div class="line"><a id="l03997" name="l03997"></a><span class="lineno"> 3997</span>      </div>
<div class="line"><a id="l03998" name="l03998"></a><span class="lineno"> 3998</span>              sfctmp=t3d(i,1,j)</div>
<div class="line"><a id="l03999" name="l03999"></a><span class="lineno"> 3999</span>              zlvl=0.5*dz8w(i,1,j)</div>
<div class="line"><a id="l04000" name="l04000"></a><span class="lineno"> 4000</span>      </div>
<div class="line"><a id="l04001" name="l04001"></a><span class="lineno"> 4001</span>      <span class="comment">!        TH2=SFCTMP+(0.0097545*ZLVL)</span></div>
<div class="line"><a id="l04002" name="l04002"></a><span class="lineno"> 4002</span>      <span class="comment">! calculate SFCTH2 via Exner function vs lapse-rate (above)</span></div>
<div class="line"><a id="l04003" name="l04003"></a><span class="lineno"> 4003</span>               apes=(1.e5/psfc)**capa</div>
<div class="line"><a id="l04004" name="l04004"></a><span class="lineno"> 4004</span>               apelm=(1.e5/sfcprs)**capa</div>
<div class="line"><a id="l04005" name="l04005"></a><span class="lineno"> 4005</span>               sfcth2=sfctmp*apelm</div>
<div class="line"><a id="l04006" name="l04006"></a><span class="lineno"> 4006</span>               th2=sfcth2/apes</div>
<div class="line"><a id="l04007" name="l04007"></a><span class="lineno"> 4007</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04008" name="l04008"></a><span class="lineno"> 4008</span>               emissi = emiss(i,j)</div>
<div class="line"><a id="l04009" name="l04009"></a><span class="lineno"> 4009</span>               lwdn=glw(i,j)*emissi</div>
<div class="line"><a id="l04010" name="l04010"></a><span class="lineno"> 4010</span>      <span class="comment">! SOLDN is total incoming solar</span></div>
<div class="line"><a id="l04011" name="l04011"></a><span class="lineno"> 4011</span>              soldn=swdown(i,j)</div>
<div class="line"><a id="l04012" name="l04012"></a><span class="lineno"> 4012</span>      <span class="comment">! GSW is net downward solar</span></div>
<div class="line"><a id="l04013" name="l04013"></a><span class="lineno"> 4013</span>      <span class="comment">!        SOLNET=GSW(I,J)</span></div>
<div class="line"><a id="l04014" name="l04014"></a><span class="lineno"> 4014</span>      <span class="comment">! use mid-day albedo to determine net downward solar (no solar zenith angle correction)</span></div>
<div class="line"><a id="l04015" name="l04015"></a><span class="lineno"> 4015</span>              solnet=soldn*(1.-albedo(i,j))</div>
<div class="line"><a id="l04016" name="l04016"></a><span class="lineno"> 4016</span>              prcp=rainbl(i,j)/dt</div>
<div class="line"><a id="l04017" name="l04017"></a><span class="lineno"> 4017</span>              vegtyp=ivgtyp(i,j)</div>
<div class="line"><a id="l04018" name="l04018"></a><span class="lineno"> 4018</span>              soiltyp=isltyp(i,j)</div>
<div class="line"><a id="l04019" name="l04019"></a><span class="lineno"> 4019</span>              shdfac=vegfra(i,j)/100.</div>
<div class="line"><a id="l04020" name="l04020"></a><span class="lineno"> 4020</span>              t1=tsk(i,j)</div>
<div class="line"><a id="l04021" name="l04021"></a><span class="lineno"> 4021</span>              chk=chs(i,j)</div>
<div class="line"><a id="l04022" name="l04022"></a><span class="lineno"> 4022</span>              shmin=shdmin(i,j)/100. <span class="comment">!NEW</span></div>
<div class="line"><a id="l04023" name="l04023"></a><span class="lineno"> 4023</span>              shmax=shdmax(i,j)/100. <span class="comment">!NEW</span></div>
<div class="line"><a id="l04024" name="l04024"></a><span class="lineno"> 4024</span>      <span class="comment">! convert snow water equivalent from mm to meter</span></div>
<div class="line"><a id="l04025" name="l04025"></a><span class="lineno"> 4025</span>              sneqv=snow(i,j)*0.001</div>
<div class="line"><a id="l04026" name="l04026"></a><span class="lineno"> 4026</span>      <span class="comment">! snow depth in meters</span></div>
<div class="line"><a id="l04027" name="l04027"></a><span class="lineno"> 4027</span>              snowhk=snowh(i,j)</div>
<div class="line"><a id="l04028" name="l04028"></a><span class="lineno"> 4028</span>              sncovr=snowc(i,j)</div>
<div class="line"><a id="l04029" name="l04029"></a><span class="lineno"> 4029</span>      </div>
<div class="line"><a id="l04030" name="l04030"></a><span class="lineno"> 4030</span>      <span class="comment">! if &quot;SR&quot; present, set frac of frozen precip (&quot;FFROZP&quot;) = snow-ratio (&quot;SR&quot;, range:0-1)</span></div>
<div class="line"><a id="l04031" name="l04031"></a><span class="lineno"> 4031</span>      <span class="comment">! SR from e.g. Ferrier microphysics</span></div>
<div class="line"><a id="l04032" name="l04032"></a><span class="lineno"> 4032</span>      <span class="comment">! otherwise define from 1st atmos level temperature</span></div>
<div class="line"><a id="l04033" name="l04033"></a><span class="lineno"> 4033</span>             <span class="keywordflow">IF</span>(frpcpn) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04034" name="l04034"></a><span class="lineno"> 4034</span>                ffrozp=sr(i,j)</div>
<div class="line"><a id="l04035" name="l04035"></a><span class="lineno"> 4035</span>              <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04036" name="l04036"></a><span class="lineno"> 4036</span>                <span class="keywordflow">IF</span> (sfctmp &lt;=  273.15) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04037" name="l04037"></a><span class="lineno"> 4037</span>                  ffrozp = 1.0</div>
<div class="line"><a id="l04038" name="l04038"></a><span class="lineno"> 4038</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04039" name="l04039"></a><span class="lineno"> 4039</span>            ffrozp = 0.0</div>
<div class="line"><a id="l04040" name="l04040"></a><span class="lineno"> 4040</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l04041" name="l04041"></a><span class="lineno"> 4041</span><span class="keywordflow">              ENDIF</span></div>
<div class="line"><a id="l04042" name="l04042"></a><span class="lineno"> 4042</span>      <span class="comment">!***</span></div>
<div class="line"><a id="l04043" name="l04043"></a><span class="lineno"> 4043</span>              <span class="keywordflow">IF</span>((xland(i,j)-1.5).GE.0.)<span class="keywordflow">THEN</span>                                  <span class="comment">! begining of land/sea if block</span></div>
<div class="line"><a id="l04044" name="l04044"></a><span class="lineno"> 4044</span>      <span class="comment">! Open water points</span></div>
<div class="line"><a id="l04045" name="l04045"></a><span class="lineno"> 4045</span>                tsk_rural(i,j)=tsk(i,j)</div>
<div class="line"><a id="l04046" name="l04046"></a><span class="lineno"> 4046</span>                hfx_rural(i,j)=hfx(i,j)</div>
<div class="line"><a id="l04047" name="l04047"></a><span class="lineno"> 4047</span>                qfx_rural(i,j)=qfx(i,j)</div>
<div class="line"><a id="l04048" name="l04048"></a><span class="lineno"> 4048</span>                lh_rural(i,j)=lh(i,j)</div>
<div class="line"><a id="l04049" name="l04049"></a><span class="lineno"> 4049</span>                emiss_rural(i,j)=emiss(i,j)</div>
<div class="line"><a id="l04050" name="l04050"></a><span class="lineno"> 4050</span>                grdflx_rural(i,j)=grdflx(i,j)</div>
<div class="line"><a id="l04051" name="l04051"></a><span class="lineno"> 4051</span>              <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04052" name="l04052"></a><span class="lineno"> 4052</span>      <span class="comment">! Land or sea-ice case</span></div>
<div class="line"><a id="l04053" name="l04053"></a><span class="lineno"> 4053</span>      </div>
<div class="line"><a id="l04054" name="l04054"></a><span class="lineno"> 4054</span>                <span class="keywordflow">IF</span> (xice(i,j) &gt;= xice_threshold) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04055" name="l04055"></a><span class="lineno"> 4055</span>                   <span class="comment">! Sea-ice point</span></div>
<div class="line"><a id="l04056" name="l04056"></a><span class="lineno"> 4056</span>                   ice = 1</div>
<div class="line"><a id="l04057" name="l04057"></a><span class="lineno"> 4057</span>                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> ( vegtyp == isice ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04058" name="l04058"></a><span class="lineno"> 4058</span>                   <span class="comment">! Land-ice point</span></div>
<div class="line"><a id="l04059" name="l04059"></a><span class="lineno"> 4059</span>                   ice = -1</div>
<div class="line"><a id="l04060" name="l04060"></a><span class="lineno"> 4060</span>                <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04061" name="l04061"></a><span class="lineno"> 4061</span>                   <span class="comment">! Neither sea ice or land ice.</span></div>
<div class="line"><a id="l04062" name="l04062"></a><span class="lineno"> 4062</span>                   ice=0</div>
<div class="line"><a id="l04063" name="l04063"></a><span class="lineno"> 4063</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04064" name="l04064"></a><span class="lineno"> 4064</span>                dqsdt2=q2sat*a23m4/(sfctmp-a4)**2</div>
<div class="line"><a id="l04065" name="l04065"></a><span class="lineno"> 4065</span>      </div>
<div class="line"><a id="l04066" name="l04066"></a><span class="lineno"> 4066</span>                <span class="keywordflow">IF</span>(snow(i,j).GT.0.0)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04067" name="l04067"></a><span class="lineno"> 4067</span>      <span class="comment">! snow on surface (use ice saturation properties)</span></div>
<div class="line"><a id="l04068" name="l04068"></a><span class="lineno"> 4068</span>                  sfctsno=sfctmp</div>
<div class="line"><a id="l04069" name="l04069"></a><span class="lineno"> 4069</span>                  e2sat=611.2*exp(6174.*(1./273.15 - 1./sfctsno))</div>
<div class="line"><a id="l04070" name="l04070"></a><span class="lineno"> 4070</span>                  q2sati=0.622*e2sat/(sfcprs-e2sat)</div>
<div class="line"><a id="l04071" name="l04071"></a><span class="lineno"> 4071</span>                  q2sati=q2sati/(1.0+q2sati)    <span class="comment">! spec. hum.</span></div>
<div class="line"><a id="l04072" name="l04072"></a><span class="lineno"> 4072</span>                  <span class="keywordflow">IF</span> (t1 .GT. 273.14) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04073" name="l04073"></a><span class="lineno"> 4073</span>      <span class="comment">! warm ground temps, weight the saturation between ice and water according to SNOWC</span></div>
<div class="line"><a id="l04074" name="l04074"></a><span class="lineno"> 4074</span>                    q2sat=q2sat*(1.-snowc(i,j)) + q2sati*snowc(i,j)</div>
<div class="line"><a id="l04075" name="l04075"></a><span class="lineno"> 4075</span>                    dqsdt2=dqsdt2*(1.-snowc(i,j)) + q2sati*6174./(sfctsno**2)*snowc(i,j)</div>
<div class="line"><a id="l04076" name="l04076"></a><span class="lineno"> 4076</span>                  <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04077" name="l04077"></a><span class="lineno"> 4077</span>      <span class="comment">! cold ground temps, use ice saturation only</span></div>
<div class="line"><a id="l04078" name="l04078"></a><span class="lineno"> 4078</span>                    q2sat=q2sati</div>
<div class="line"><a id="l04079" name="l04079"></a><span class="lineno"> 4079</span>                    dqsdt2=q2sati*6174./(sfctsno**2)</div>
<div class="line"><a id="l04080" name="l04080"></a><span class="lineno"> 4080</span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a id="l04081" name="l04081"></a><span class="lineno"> 4081</span>      <span class="comment">! for snow cover fraction at 0 C, ground temp will not change, so DQSDT2 effectively zero</span></div>
<div class="line"><a id="l04082" name="l04082"></a><span class="lineno"> 4082</span>                  <span class="keywordflow">IF</span>(t1 .GT. 273. .AND. snowc(i,j) .GT. 0.)dqsdt2=dqsdt2*(1.-snowc(i,j))</div>
<div class="line"><a id="l04083" name="l04083"></a><span class="lineno"> 4083</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04084" name="l04084"></a><span class="lineno"> 4084</span>      </div>
<div class="line"><a id="l04085" name="l04085"></a><span class="lineno"> 4085</span>                <span class="comment">! Land-ice or land points use the usual deep-soil temperature.</span></div>
<div class="line"><a id="l04086" name="l04086"></a><span class="lineno"> 4086</span>                tbot=tmn(i,j)</div>
<div class="line"><a id="l04087" name="l04087"></a><span class="lineno"> 4087</span>      </div>
<div class="line"><a id="l04088" name="l04088"></a><span class="lineno"> 4088</span>                <span class="keywordflow">IF</span>(vegtyp.EQ.25) shdfac=0.0000</div>
<div class="line"><a id="l04089" name="l04089"></a><span class="lineno"> 4089</span>                <span class="keywordflow">IF</span>(vegtyp.EQ.26) shdfac=0.0000</div>
<div class="line"><a id="l04090" name="l04090"></a><span class="lineno"> 4090</span>                <span class="keywordflow">IF</span>(vegtyp.EQ.27) shdfac=0.0000</div>
<div class="line"><a id="l04091" name="l04091"></a><span class="lineno"> 4091</span>                <span class="keywordflow">IF</span>(soiltyp.EQ.14.AND.xice(i,j).EQ.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04092" name="l04092"></a><span class="lineno"> 4092</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l04093" name="l04093"></a><span class="lineno"> 4093</span><span class="preprocessor"></span>               <span class="keywordflow">IF</span>(iprint)print*,<span class="stringliteral">&#39; SOIL TYPE FOUND TO BE WATER AT A LAND-POINT&#39;</span></div>
<div class="line"><a id="l04094" name="l04094"></a><span class="lineno"> 4094</span>               <span class="keywordflow">IF</span>(iprint)print*,i,j,<span class="stringliteral">&#39;RESET SOIL in surfce.F&#39;</span></div>
<div class="line"><a id="l04095" name="l04095"></a><span class="lineno"> 4095</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04096" name="l04096"></a><span class="lineno"> 4096</span><span class="preprocessor"></span>                  soiltyp=7</div>
<div class="line"><a id="l04097" name="l04097"></a><span class="lineno"> 4097</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04098" name="l04098"></a><span class="lineno"> 4098</span>                snoalb1 = snoalb(i,j)</div>
<div class="line"><a id="l04099" name="l04099"></a><span class="lineno"> 4099</span>                cmc=canwat(i,j)/1000.</div>
<div class="line"><a id="l04100" name="l04100"></a><span class="lineno"> 4100</span>      </div>
<div class="line"><a id="l04101" name="l04101"></a><span class="lineno"> 4101</span>      <span class="comment">!-------------------------------------------</span></div>
<div class="line"><a id="l04102" name="l04102"></a><span class="lineno"> 4102</span>      <span class="comment">!*** convert snow depth from mm to meter</span></div>
<div class="line"><a id="l04103" name="l04103"></a><span class="lineno"> 4103</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04104" name="l04104"></a><span class="lineno"> 4104</span>      <span class="comment">!          IF(RDMAXALB) THEN</span></div>
<div class="line"><a id="l04105" name="l04105"></a><span class="lineno"> 4105</span>      <span class="comment">!           SNOALB=ALBMAX(I,J)*0.01</span></div>
<div class="line"><a id="l04106" name="l04106"></a><span class="lineno"> 4106</span>      <span class="comment">!         ELSE</span></div>
<div class="line"><a id="l04107" name="l04107"></a><span class="lineno"> 4107</span>      <span class="comment">!           SNOALB=MAXALB(IVGTPK)*0.01</span></div>
<div class="line"><a id="l04108" name="l04108"></a><span class="lineno"> 4108</span>      <span class="comment">!         ENDIF</span></div>
<div class="line"><a id="l04109" name="l04109"></a><span class="lineno"> 4109</span>      </div>
<div class="line"><a id="l04110" name="l04110"></a><span class="lineno"> 4110</span>      <span class="comment">!        SNOALB1=0.80</span></div>
<div class="line"><a id="l04111" name="l04111"></a><span class="lineno"> 4111</span>      <span class="comment">!        SHMIN=0.00</span></div>
<div class="line"><a id="l04112" name="l04112"></a><span class="lineno"> 4112</span>              albbrd=albbck(i,j)</div>
<div class="line"><a id="l04113" name="l04113"></a><span class="lineno"> 4113</span>              z0brd=z0(i,j)</div>
<div class="line"><a id="l04114" name="l04114"></a><span class="lineno"> 4114</span>              embrd=embck(i,j)</div>
<div class="line"><a id="l04115" name="l04115"></a><span class="lineno"> 4115</span>              snotime1 = snotime(i,j)</div>
<div class="line"><a id="l04116" name="l04116"></a><span class="lineno"> 4116</span>              ribb=rib(i,j)</div>
<div class="line"><a id="l04117" name="l04117"></a><span class="lineno"> 4117</span>      <span class="comment">!FEI: temporaray arrays above need to be changed later by using SI</span></div>
<div class="line"><a id="l04118" name="l04118"></a><span class="lineno"> 4118</span>      </div>
<div class="line"><a id="l04119" name="l04119"></a><span class="lineno"> 4119</span>                <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l04120" name="l04120"></a><span class="lineno"> 4120</span>                  smc(ns)=smois(i,ns,j)</div>
<div class="line"><a id="l04121" name="l04121"></a><span class="lineno"> 4121</span>                  stc(ns)=tslb(i,ns,j)                                          <span class="comment">!STEMP</span></div>
<div class="line"><a id="l04122" name="l04122"></a><span class="lineno"> 4122</span>                  swc(ns)=sh2o(i,ns,j)</div>
<div class="line"><a id="l04123" name="l04123"></a><span class="lineno"> 4123</span><span class="keywordflow">                ENDDO</span></div>
<div class="line"><a id="l04124" name="l04124"></a><span class="lineno"> 4124</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04125" name="l04125"></a><span class="lineno"> 4125</span>                <span class="keywordflow">if</span> ( (sneqv.ne.0..AND.snowhk.eq.0.).or.(snowhk.le.sneqv) )<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04126" name="l04126"></a><span class="lineno"> 4126</span>                  snowhk= 5.*sneqv</div>
<div class="line"><a id="l04127" name="l04127"></a><span class="lineno"> 4127</span><span class="keywordflow">                endif</span></div>
<div class="line"><a id="l04128" name="l04128"></a><span class="lineno"> 4128</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04129" name="l04129"></a><span class="lineno"> 4129</span>      </div>
<div class="line"><a id="l04130" name="l04130"></a><span class="lineno"> 4130</span>      <span class="comment">!Fei: urban. for urban surface, if calling UCM, redefine the natural surface in cities as</span></div>
<div class="line"><a id="l04131" name="l04131"></a><span class="lineno"> 4131</span>      <span class="comment">! the &quot;NATURAL&quot; category in the VEGPARM.TBL</span></div>
<div class="line"><a id="l04132" name="l04132"></a><span class="lineno"> 4132</span>        </div>
<div class="line"><a id="l04133" name="l04133"></a><span class="lineno"> 4133</span>           <span class="keywordflow">IF</span>(sf_urban_physics == 1.OR. sf_urban_physics==2.OR.sf_urban_physics==3 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04134" name="l04134"></a><span class="lineno"> 4134</span>                      <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l04135" name="l04135"></a><span class="lineno"> 4135</span>                        ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04136" name="l04136"></a><span class="lineno"> 4136</span>             vegtyp = natural</div>
<div class="line"><a id="l04137" name="l04137"></a><span class="lineno"> 4137</span>                       shdfac = shdtbl(natural)</div>
<div class="line"><a id="l04138" name="l04138"></a><span class="lineno"> 4138</span>                       albedok =0.2         <span class="comment">!  0.2</span></div>
<div class="line"><a id="l04139" name="l04139"></a><span class="lineno"> 4139</span>                       albbrd  =0.2         <span class="comment">!0.2</span></div>
<div class="line"><a id="l04140" name="l04140"></a><span class="lineno"> 4140</span>                       emissi = 0.98                                 <span class="comment">!for VEGTYP=5</span></div>
<div class="line"><a id="l04141" name="l04141"></a><span class="lineno"> 4141</span>             <span class="keywordflow">IF</span> ( frc_urb2d(i,j) &lt; 0.99 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04142" name="l04142"></a><span class="lineno"> 4142</span>                   <span class="keywordflow">if</span>(sf_urban_physics.eq.1)<span class="keywordflow">then</span></div>
<div class="line"><a id="l04143" name="l04143"></a><span class="lineno"> 4143</span>                     t1= ( tsk(i,j) -frc_urb2d(i,j) * ts_urb2d(i,j) )/ (1-frc_urb2d(i,j))</div>
<div class="line"><a id="l04144" name="l04144"></a><span class="lineno"> 4144</span>                   <span class="keywordflow">elseif</span>((sf_urban_physics.eq.2).OR.(sf_urban_physics.eq.3))<span class="keywordflow">then</span></div>
<div class="line"><a id="l04145" name="l04145"></a><span class="lineno"> 4145</span>                     t1=tsk_rural_bep(i,j)</div>
<div class="line"><a id="l04146" name="l04146"></a><span class="lineno"> 4146</span><span class="keywordflow">                   endif</span></div>
<div class="line"><a id="l04147" name="l04147"></a><span class="lineno"> 4147</span>                 <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04148" name="l04148"></a><span class="lineno"> 4148</span>             t1 = tsk(i,j)</div>
<div class="line"><a id="l04149" name="l04149"></a><span class="lineno"> 4149</span><span class="keywordflow">                       ENDIF</span></div>
<div class="line"><a id="l04150" name="l04150"></a><span class="lineno"> 4150</span><span class="keywordflow">                      ENDIF</span></div>
<div class="line"><a id="l04151" name="l04151"></a><span class="lineno"> 4151</span>                 <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04152" name="l04152"></a><span class="lineno"> 4152</span>                       <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l04153" name="l04153"></a><span class="lineno"> 4153</span>                        ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04154" name="l04154"></a><span class="lineno"> 4154</span>                        vegtyp = isurban</div>
<div class="line"><a id="l04155" name="l04155"></a><span class="lineno"> 4155</span><span class="keywordflow">                     ENDIF</span></div>
<div class="line"><a id="l04156" name="l04156"></a><span class="lineno"> 4156</span><span class="keywordflow">                 ENDIF</span></div>
<div class="line"><a id="l04157" name="l04157"></a><span class="lineno"> 4157</span> </div>
<div class="line"><a id="l04158" name="l04158"></a><span class="lineno"> 4158</span> </div>
<div class="line"><a id="l04159" name="l04159"></a><span class="lineno"> 4159</span><span class="comment">!===Yang, 2014/10/08, hydrological processes for urban vegetation in single layer UCM===</span></div>
<div class="line"><a id="l04160" name="l04160"></a><span class="lineno"> 4160</span>           aoasis = 1.0</div>
<div class="line"><a id="l04161" name="l04161"></a><span class="lineno"> 4161</span>           usoil = 1</div>
<div class="line"><a id="l04162" name="l04162"></a><span class="lineno"> 4162</span>           dsoil = 2</div>
<div class="line"><a id="l04163" name="l04163"></a><span class="lineno"> 4163</span>           irioption=iri_scheme</div>
<div class="line"><a id="l04164" name="l04164"></a><span class="lineno"> 4164</span>           omg= omg_urb2d(i,j)   </div>
<div class="line"><a id="l04165" name="l04165"></a><span class="lineno"> 4165</span>           tloc=mod(int(omg/3.14159*180./15.+12.+0.5 ),24)</div>
<div class="line"><a id="l04166" name="l04166"></a><span class="lineno"> 4166</span>           <span class="keywordflow">if</span> (tloc.lt.0) tloc=tloc+24</div>
<div class="line"><a id="l04167" name="l04167"></a><span class="lineno"> 4167</span>           <span class="keywordflow">if</span> (tloc==0) tloc=24</div>
<div class="line"><a id="l04168" name="l04168"></a><span class="lineno"> 4168</span>           <span class="keyword">CALL </span>cal_mon_day(julian,julyr,jmonth,jday) </div>
<div class="line"><a id="l04169" name="l04169"></a><span class="lineno"> 4169</span>      <span class="keywordflow">IF</span>(sf_urban_physics == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04170" name="l04170"></a><span class="lineno"> 4170</span>           <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l04171" name="l04171"></a><span class="lineno"> 4171</span>                ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) == high_intensity_industrial) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04172" name="l04172"></a><span class="lineno"> 4172</span>            aoasis = oasis  <span class="comment">! urban oasis effect</span></div>
<div class="line"><a id="l04173" name="l04173"></a><span class="lineno"> 4173</span>                   <span class="keywordflow">IF</span> (irioption ==1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04174" name="l04174"></a><span class="lineno"> 4174</span>                   <span class="keywordflow">IF</span> (tloc==21 .or. tloc==22) <span class="keywordflow">THEN</span>  <span class="comment">!irrigation on vegetaion in urban area, MAY-SEP, 9-10pm</span></div>
<div class="line"><a id="l04175" name="l04175"></a><span class="lineno"> 4175</span>                   <span class="keywordflow">IF</span> (jmonth==5 .or. jmonth==6 .or. jmonth==7 .or. jmonth==8 .or. jmonth==9) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04176" name="l04176"></a><span class="lineno"> 4176</span>                      <span class="keywordflow">IF</span> (smc(usoil) .LT. smcref) smc(usoil)= refsmc(isltyp(i,j))</div>
<div class="line"><a id="l04177" name="l04177"></a><span class="lineno"> 4177</span>                      <span class="keywordflow">IF</span> (smc(dsoil) .LT. smcref) smc(dsoil)= refsmc(isltyp(i,j))</div>
<div class="line"><a id="l04178" name="l04178"></a><span class="lineno"> 4178</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l04179" name="l04179"></a><span class="lineno"> 4179</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l04180" name="l04180"></a><span class="lineno"> 4180</span><span class="keywordflow">                   ENDIF</span></div>
<div class="line"><a id="l04181" name="l04181"></a><span class="lineno"> 4181</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04182" name="l04182"></a><span class="lineno"> 4182</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l04183" name="l04183"></a><span class="lineno"> 4183</span> </div>
<div class="line"><a id="l04184" name="l04184"></a><span class="lineno"> 4184</span>      <span class="keywordflow">IF</span>(sf_urban_physics == 2 .or. sf_urban_physics == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04185" name="l04185"></a><span class="lineno"> 4185</span>          <span class="keywordflow">IF</span>(aoasis &gt; 1.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04186" name="l04186"></a><span class="lineno"> 4186</span>          <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;Urban oasis option is for SF_URBAN_PHYSICS == 1 only&#39;</span>)</div>
<div class="line"><a id="l04187" name="l04187"></a><span class="lineno"> 4187</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l04188" name="l04188"></a><span class="lineno"> 4188</span>          <span class="keywordflow">IF</span>(irioption == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04189" name="l04189"></a><span class="lineno"> 4189</span>          <span class="keyword">CALL </span>wrf_error_fatal(<span class="stringliteral">&#39;Urban irrigation option is for SF_URBAN_PHYSICS == 1 only&#39;</span>)</div>
<div class="line"><a id="l04190" name="l04190"></a><span class="lineno"> 4190</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l04191" name="l04191"></a><span class="lineno"> 4191</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l04192" name="l04192"></a><span class="lineno"> 4192</span> </div>
<div class="line"><a id="l04193" name="l04193"></a><span class="lineno"> 4193</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l04194" name="l04194"></a><span class="lineno"> 4194</span><span class="preprocessor"></span>                <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04195" name="l04195"></a><span class="lineno"> 4195</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04196" name="l04196"></a><span class="lineno"> 4196</span>             print*, <span class="stringliteral">&#39;BEFORE SFLX, in Noahlsm_driver&#39;</span></div>
<div class="line"><a id="l04197" name="l04197"></a><span class="lineno"> 4197</span>             print*, <span class="stringliteral">&#39;ICE&#39;</span>, ice, <span class="stringliteral">&#39;DT&#39;</span>,dt, <span class="stringliteral">&#39;ZLVL&#39;</span>,zlvl, <span class="stringliteral">&#39;NSOIL&#39;</span>, nsoil,   &amp;</div>
<div class="line"><a id="l04198" name="l04198"></a><span class="lineno"> 4198</span>             <span class="stringliteral">&#39;SLDPTH&#39;</span>, sldpth, <span class="stringliteral">&#39;LOCAL&#39;</span>,local, <span class="stringliteral">&#39;LUTYPE&#39;</span>,&amp;</div>
<div class="line"><a id="l04199" name="l04199"></a><span class="lineno"> 4199</span>              lutype, <span class="stringliteral">&#39;SLTYPE&#39;</span>,sltype, <span class="stringliteral">&#39;LWDN&#39;</span>,lwdn, <span class="stringliteral">&#39;SOLDN&#39;</span>,soldn,      &amp;</div>
<div class="line"><a id="l04200" name="l04200"></a><span class="lineno"> 4200</span>              <span class="stringliteral">&#39;SFCPRS&#39;</span>,sfcprs, <span class="stringliteral">&#39;PRCP&#39;</span>,prcp,<span class="stringliteral">&#39;SFCTMP&#39;</span>,sfctmp,<span class="stringliteral">&#39;Q2K&#39;</span>,q2k,   &amp;</div>
<div class="line"><a id="l04201" name="l04201"></a><span class="lineno"> 4201</span>               <span class="stringliteral">&#39;TH2&#39;</span>,th2,<span class="stringliteral">&#39;Q2SAT&#39;</span>,q2sat,<span class="stringliteral">&#39;DQSDT2&#39;</span>,dqsdt2,<span class="stringliteral">&#39;VEGTYP&#39;</span>, vegtyp,&amp;</div>
<div class="line"><a id="l04202" name="l04202"></a><span class="lineno"> 4202</span>               <span class="stringliteral">&#39;SOILTYP&#39;</span>,soiltyp, <span class="stringliteral">&#39;SLOPETYP&#39;</span>,slopetyp, <span class="stringliteral">&#39;SHDFAC&#39;</span>,shdfac,&amp;</div>
<div class="line"><a id="l04203" name="l04203"></a><span class="lineno"> 4203</span>               <span class="stringliteral">&#39;SHMIN&#39;</span>,shmin, <span class="stringliteral">&#39;ALBBRD&#39;</span>,albbrd,<span class="stringliteral">&#39;SNOALB1&#39;</span>,snoalb1,<span class="stringliteral">&#39;TBOT&#39;</span>,&amp;</div>
<div class="line"><a id="l04204" name="l04204"></a><span class="lineno"> 4204</span>                tbot, <span class="stringliteral">&#39;Z0BRD&#39;</span>,z0brd, <span class="stringliteral">&#39;Z0K&#39;</span>,z0k, <span class="stringliteral">&#39;CMC&#39;</span>,cmc, <span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;STC&#39;</span>,&amp;</div>
<div class="line"><a id="l04205" name="l04205"></a><span class="lineno"> 4205</span>                stc, <span class="stringliteral">&#39;SMC&#39;</span>,smc, <span class="stringliteral">&#39;SWC&#39;</span>,swc,<span class="stringliteral">&#39;SNOWHK&#39;</span>,snowhk,<span class="stringliteral">&#39;SNEQV&#39;</span>,sneqv,&amp;</div>
<div class="line"><a id="l04206" name="l04206"></a><span class="lineno"> 4206</span>                <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok,<span class="stringliteral">&#39;CHK&#39;</span>,chk,<span class="stringliteral">&#39;ETA&#39;</span>,eta,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat,      &amp;</div>
<div class="line"><a id="l04207" name="l04207"></a><span class="lineno"> 4207</span>                <span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,eta_kinematic, <span class="stringliteral">&#39;FDOWN&#39;</span>,fdown,<span class="stringliteral">&#39;EC&#39;</span>,ec,   &amp;</div>
<div class="line"><a id="l04208" name="l04208"></a><span class="lineno"> 4208</span>                <span class="stringliteral">&#39;EDIR&#39;</span>,edir,<span class="stringliteral">&#39;ET&#39;</span>,et,<span class="stringliteral">&#39;ETT&#39;</span>,ett,<span class="stringliteral">&#39;ESNOW&#39;</span>,esnow,<span class="stringliteral">&#39;DRIP&#39;</span>,drip,&amp;</div>
<div class="line"><a id="l04209" name="l04209"></a><span class="lineno"> 4209</span>                <span class="stringliteral">&#39;DEW&#39;</span>,dew,<span class="stringliteral">&#39;BETA&#39;</span>,beta,<span class="stringliteral">&#39;ETP&#39;</span>,etp,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;FLX1&#39;</span>,flx1,&amp;</div>
<div class="line"><a id="l04210" name="l04210"></a><span class="lineno"> 4210</span>                <span class="stringliteral">&#39;FLX2&#39;</span>,flx2,<span class="stringliteral">&#39;FLX3&#39;</span>,flx3,<span class="stringliteral">&#39;SNOMLT&#39;</span>,snomlt,<span class="stringliteral">&#39;SNCOVR&#39;</span>,sncovr,&amp;</div>
<div class="line"><a id="l04211" name="l04211"></a><span class="lineno"> 4211</span>                <span class="stringliteral">&#39;RUNOFF1&#39;</span>,runoff1,<span class="stringliteral">&#39;RUNOFF2&#39;</span>,runoff2,<span class="stringliteral">&#39;RUNOFF3&#39;</span>,runoff3, &amp;</div>
<div class="line"><a id="l04212" name="l04212"></a><span class="lineno"> 4212</span>                <span class="stringliteral">&#39;RC&#39;</span>,rc, <span class="stringliteral">&#39;PC&#39;</span>,pc,<span class="stringliteral">&#39;RSMIN&#39;</span>,rsmin,<span class="stringliteral">&#39;XLAI&#39;</span>,xlai,<span class="stringliteral">&#39;RCS&#39;</span>,rcs,  &amp;</div>
<div class="line"><a id="l04213" name="l04213"></a><span class="lineno"> 4213</span>                <span class="stringliteral">&#39;RCT&#39;</span>,rct,<span class="stringliteral">&#39;RCQ&#39;</span>,rcq,<span class="stringliteral">&#39;RCSOIL&#39;</span>,rcsoil,<span class="stringliteral">&#39;SOILW&#39;</span>,soilw,     &amp;</div>
<div class="line"><a id="l04214" name="l04214"></a><span class="lineno"> 4214</span>                <span class="stringliteral">&#39;SOILM&#39;</span>,soilm,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;SMCWLT&#39;</span>,smcwlt,<span class="stringliteral">&#39;SMCDRY&#39;</span>,smcdry,&amp;</div>
<div class="line"><a id="l04215" name="l04215"></a><span class="lineno"> 4215</span>                <span class="stringliteral">&#39;SMCREF&#39;</span>,smcref,<span class="stringliteral">&#39;SMCMAX&#39;</span>,smcmax,<span class="stringliteral">&#39;NROOT&#39;</span>,nroot</div>
<div class="line"><a id="l04216" name="l04216"></a><span class="lineno"> 4216</span><span class="keywordflow">                 endif</span></div>
<div class="line"><a id="l04217" name="l04217"></a><span class="lineno"> 4217</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04218" name="l04218"></a><span class="lineno"> 4218</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l04219" name="l04219"></a><span class="lineno"> 4219</span>                <span class="keywordflow">IF</span> (rdlai2d) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04220" name="l04220"></a><span class="lineno"> 4220</span>                   xlai = lai(i,j)</div>
<div class="line"><a id="l04221" name="l04221"></a><span class="lineno"> 4221</span><span class="keywordflow">                endif</span></div>
<div class="line"><a id="l04222" name="l04222"></a><span class="lineno"> 4222</span>      </div>
<div class="line"><a id="l04223" name="l04223"></a><span class="lineno"> 4223</span>          <span class="keywordflow">IF</span> ( ice == 1 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04224" name="l04224"></a><span class="lineno"> 4224</span>      </div>
<div class="line"><a id="l04225" name="l04225"></a><span class="lineno"> 4225</span>             <span class="comment">! Sea-ice case</span></div>
<div class="line"><a id="l04226" name="l04226"></a><span class="lineno"> 4226</span>      </div>
<div class="line"><a id="l04227" name="l04227"></a><span class="lineno"> 4227</span>             <span class="keywordflow">DO</span> ns = 1, nsoil</div>
<div class="line"><a id="l04228" name="l04228"></a><span class="lineno"> 4228</span>                sh2o(i,ns,j) = 1.0</div>
<div class="line"><a id="l04229" name="l04229"></a><span class="lineno"> 4229</span><span class="keywordflow">             ENDDO</span></div>
<div class="line"><a id="l04230" name="l04230"></a><span class="lineno"> 4230</span>             lai(i,j) = 0.01</div>
<div class="line"><a id="l04231" name="l04231"></a><span class="lineno"> 4231</span>      </div>
<div class="line"><a id="l04232" name="l04232"></a><span class="lineno"> 4232</span>             cycle iloop</div>
<div class="line"><a id="l04233" name="l04233"></a><span class="lineno"> 4233</span>      </div>
<div class="line"><a id="l04234" name="l04234"></a><span class="lineno"> 4234</span>          <span class="keywordflow">ELSEIF</span> (ice == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04235" name="l04235"></a><span class="lineno"> 4235</span>      </div>
<div class="line"><a id="l04236" name="l04236"></a><span class="lineno"> 4236</span>             <span class="comment">! Non-glacial land</span></div>
<div class="line"><a id="l04237" name="l04237"></a><span class="lineno"> 4237</span>      </div>
<div class="line"><a id="l04238" name="l04238"></a><span class="lineno"> 4238</span>             <span class="keyword">CALL </span>sflx (i,j,ffrozp, isurban, dt,zlvl,nsoil,sldpth,       &amp;    <span class="comment">!C</span></div>
<div class="line"><a id="l04239" name="l04239"></a><span class="lineno"> 4239</span>                       local,                                            &amp;    <span class="comment">!L</span></div>
<div class="line"><a id="l04240" name="l04240"></a><span class="lineno"> 4240</span>                       lutype, sltype,                                   &amp;    <span class="comment">!CL</span></div>
<div class="line"><a id="l04241" name="l04241"></a><span class="lineno"> 4241</span>                       lwdn,soldn,solnet,sfcprs,prcp,sfctmp,q2k,dummy,   &amp;    <span class="comment">!F</span></div>
<div class="line"><a id="l04242" name="l04242"></a><span class="lineno"> 4242</span>                       dummy,dummy, dummy,                               &amp;    <span class="comment">!F PRCPRAIN not used</span></div>
<div class="line"><a id="l04243" name="l04243"></a><span class="lineno"> 4243</span>                       th2,q2sat,dqsdt2,                                 &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l04244" name="l04244"></a><span class="lineno"> 4244</span>                       vegtyp,soiltyp,slopetyp,shdfac,shmin,shmax,       &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l04245" name="l04245"></a><span class="lineno"> 4245</span>                       albbrd, snoalb1,tbot, z0brd, z0k, emissi, embrd,  &amp;    <span class="comment">!S</span></div>
<div class="line"><a id="l04246" name="l04246"></a><span class="lineno"> 4246</span>                       cmc,t1,stc,smc,swc,snowhk,sneqv,albedok,chk,dummy,&amp;    <span class="comment">!H</span></div>
<div class="line"><a id="l04247" name="l04247"></a><span class="lineno"> 4247</span>                       eta,sheat, eta_kinematic,fdown,                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04248" name="l04248"></a><span class="lineno"> 4248</span>                       ec,edir,et,ett,esnow,drip,dew,                    &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04249" name="l04249"></a><span class="lineno"> 4249</span>                       beta,etp,ssoil,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04250" name="l04250"></a><span class="lineno"> 4250</span>                       flx1,flx2,flx3,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04251" name="l04251"></a><span class="lineno"> 4251</span>             flx4,fvb,fbur,fgsn,ua_phys,                             &amp;    <span class="comment">!UA </span></div>
<div class="line"><a id="l04252" name="l04252"></a><span class="lineno"> 4252</span>                       snomlt,sncovr,                                    &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04253" name="l04253"></a><span class="lineno"> 4253</span>                       runoff1,runoff2,runoff3,                          &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04254" name="l04254"></a><span class="lineno"> 4254</span>                       rc,pc,rsmin,xlai,rcs,rct,rcq,rcsoil,              &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04255" name="l04255"></a><span class="lineno"> 4255</span>                       soilw,soilm,q1,smav,                              &amp;    <span class="comment">!D</span></div>
<div class="line"><a id="l04256" name="l04256"></a><span class="lineno"> 4256</span>                       rdlai2d,usemonalb,                                &amp;</div>
<div class="line"><a id="l04257" name="l04257"></a><span class="lineno"> 4257</span>                       snotime1,                                         &amp;</div>
<div class="line"><a id="l04258" name="l04258"></a><span class="lineno"> 4258</span>                       ribb,                                             &amp;</div>
<div class="line"><a id="l04259" name="l04259"></a><span class="lineno"> 4259</span>                       smcwlt,smcdry,smcref,smcmax,nroot,                &amp;</div>
<div class="line"><a id="l04260" name="l04260"></a><span class="lineno"> 4260</span>                       sfcheadrt(i,j),                                   &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l04261" name="l04261"></a><span class="lineno"> 4261</span>                       infxsrt(i,j),etpnd1,opt_thcnd,aoasis              &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04262" name="l04262"></a><span class="lineno"> 4262</span>                ,xsda_qfx, hfx_phy, qfx_phy, xqnorm, fasdas, hcpct_fasdas    &amp; <span class="comment">! fasdas vars</span></div>
<div class="line"><a id="l04263" name="l04263"></a><span class="lineno"> 4263</span>                       )</div>
<div class="line"><a id="l04264" name="l04264"></a><span class="lineno"> 4264</span>      </div>
<div class="line"><a id="l04265" name="l04265"></a><span class="lineno"> 4265</span><span class="preprocessor">#ifdef WRF_HYDRO</span></div>
<div class="line"><a id="l04266" name="l04266"></a><span class="lineno"> 4266</span><span class="preprocessor"></span>                       soldrain(i,j) = runoff2*dt*1000.0</div>
<div class="line"><a id="l04267" name="l04267"></a><span class="lineno"> 4267</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04268" name="l04268"></a><span class="lineno"> 4268</span><span class="preprocessor"></span>          <span class="keywordflow">ELSEIF</span> (ice == -1) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04269" name="l04269"></a><span class="lineno"> 4269</span>      </div>
<div class="line"><a id="l04270" name="l04270"></a><span class="lineno"> 4270</span>             <span class="comment">!</span></div>
<div class="line"><a id="l04271" name="l04271"></a><span class="lineno"> 4271</span>             <span class="comment">! Set values that the LSM is expected to update,</span></div>
<div class="line"><a id="l04272" name="l04272"></a><span class="lineno"> 4272</span>             <span class="comment">! but don&#39;t get updated for glacial points.</span></div>
<div class="line"><a id="l04273" name="l04273"></a><span class="lineno"> 4273</span>             <span class="comment">!</span></div>
<div class="line"><a id="l04274" name="l04274"></a><span class="lineno"> 4274</span>             soilm = 0.0 <span class="comment">!BSINGH(PNNL)- SOILM is undefined for this case, it is used for diagnostics so setting it to zero</span></div>
<div class="line"><a id="l04275" name="l04275"></a><span class="lineno"> 4275</span>             xlai = 0.01 <span class="comment">! KWM Should this be Zero over land ice?  Does this value matter?</span></div>
<div class="line"><a id="l04276" name="l04276"></a><span class="lineno"> 4276</span>             runoff2 = 0.0</div>
<div class="line"><a id="l04277" name="l04277"></a><span class="lineno"> 4277</span>             runoff3 = 0.0</div>
<div class="line"><a id="l04278" name="l04278"></a><span class="lineno"> 4278</span>             <span class="keywordflow">DO</span> ns = 1, nsoil</div>
<div class="line"><a id="l04279" name="l04279"></a><span class="lineno"> 4279</span>                swc(ns) = 1.0</div>
<div class="line"><a id="l04280" name="l04280"></a><span class="lineno"> 4280</span>                smc(ns) = 1.0</div>
<div class="line"><a id="l04281" name="l04281"></a><span class="lineno"> 4281</span>                smav(ns) = 1.0</div>
<div class="line"><a id="l04282" name="l04282"></a><span class="lineno"> 4282</span><span class="keywordflow">             ENDDO</span></div>
<div class="line"><a id="l04283" name="l04283"></a><span class="lineno"> 4283</span>             <span class="keyword">CALL </span>sflx_glacial(i,j,isice,ffrozp,dt,zlvl,nsoil,sldpth,   &amp;    <span class="comment">!C</span></div>
<div class="line"><a id="l04284" name="l04284"></a><span class="lineno"> 4284</span>                  &amp;    lwdn,solnet,sfcprs,prcp,sfctmp,q2k,              &amp;    <span class="comment">!F</span></div>
<div class="line"><a id="l04285" name="l04285"></a><span class="lineno"> 4285</span>                  &amp;    th2,q2sat,dqsdt2,                                &amp;    <span class="comment">!I</span></div>
<div class="line"><a id="l04286" name="l04286"></a><span class="lineno"> 4286</span>                  &amp;    albbrd, snoalb1,tbot, z0brd, z0k, emissi, embrd, &amp;    <span class="comment">!S</span></div>
<div class="line"><a id="l04287" name="l04287"></a><span class="lineno"> 4287</span>                  &amp;    t1,stc(1:nsoil),snowhk,sneqv,albedok,chk,        &amp;    <span class="comment">!H</span></div>
<div class="line"><a id="l04288" name="l04288"></a><span class="lineno"> 4288</span>                  &amp;    eta,sheat,eta_kinematic,fdown,                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04289" name="l04289"></a><span class="lineno"> 4289</span>                  &amp;    esnow,dew,                                       &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04290" name="l04290"></a><span class="lineno"> 4290</span>                  &amp;    etp,ssoil,                                       &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04291" name="l04291"></a><span class="lineno"> 4291</span>                  &amp;    flx1,flx2,flx3,                                  &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04292" name="l04292"></a><span class="lineno"> 4292</span>                  &amp;    snomlt,sncovr,                                   &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04293" name="l04293"></a><span class="lineno"> 4293</span>                  &amp;    runoff1,                                         &amp;    <span class="comment">!O</span></div>
<div class="line"><a id="l04294" name="l04294"></a><span class="lineno"> 4294</span>                  &amp;    q1,                                              &amp;    <span class="comment">!D</span></div>
<div class="line"><a id="l04295" name="l04295"></a><span class="lineno"> 4295</span>                  &amp;    snotime1,                                        &amp;</div>
<div class="line"><a id="l04296" name="l04296"></a><span class="lineno"> 4296</span>                  &amp;    ribb)</div>
<div class="line"><a id="l04297" name="l04297"></a><span class="lineno"> 4297</span>      </div>
<div class="line"><a id="l04298" name="l04298"></a><span class="lineno"> 4298</span><span class="keywordflow">          ENDIF</span></div>
<div class="line"><a id="l04299" name="l04299"></a><span class="lineno"> 4299</span>      </div>
<div class="line"><a id="l04300" name="l04300"></a><span class="lineno"> 4300</span>             lai(i,j) = xlai</div>
<div class="line"><a id="l04301" name="l04301"></a><span class="lineno"> 4301</span> </div>
<div class="line"><a id="l04302" name="l04302"></a><span class="lineno"> 4302</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l04303" name="l04303"></a><span class="lineno"> 4303</span><span class="preprocessor"></span>                <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04304" name="l04304"></a><span class="lineno"> 4304</span>      </div>
<div class="line"><a id="l04305" name="l04305"></a><span class="lineno"> 4305</span>             print*, <span class="stringliteral">&#39;AFTER SFLX, in Noahlsm_driver&#39;</span></div>
<div class="line"><a id="l04306" name="l04306"></a><span class="lineno"> 4306</span>             print*, <span class="stringliteral">&#39;ICE&#39;</span>, ice, <span class="stringliteral">&#39;DT&#39;</span>,dt, <span class="stringliteral">&#39;ZLVL&#39;</span>,zlvl, <span class="stringliteral">&#39;NSOIL&#39;</span>, nsoil,   &amp;</div>
<div class="line"><a id="l04307" name="l04307"></a><span class="lineno"> 4307</span>             <span class="stringliteral">&#39;SLDPTH&#39;</span>, sldpth, <span class="stringliteral">&#39;LOCAL&#39;</span>,local, <span class="stringliteral">&#39;LUTYPE&#39;</span>,&amp;</div>
<div class="line"><a id="l04308" name="l04308"></a><span class="lineno"> 4308</span>              lutype, <span class="stringliteral">&#39;SLTYPE&#39;</span>,sltype, <span class="stringliteral">&#39;LWDN&#39;</span>,lwdn, <span class="stringliteral">&#39;SOLDN&#39;</span>,soldn,      &amp;</div>
<div class="line"><a id="l04309" name="l04309"></a><span class="lineno"> 4309</span>              <span class="stringliteral">&#39;SFCPRS&#39;</span>,sfcprs, <span class="stringliteral">&#39;PRCP&#39;</span>,prcp,<span class="stringliteral">&#39;SFCTMP&#39;</span>,sfctmp,<span class="stringliteral">&#39;Q2K&#39;</span>,q2k,   &amp;</div>
<div class="line"><a id="l04310" name="l04310"></a><span class="lineno"> 4310</span>               <span class="stringliteral">&#39;TH2&#39;</span>,th2,<span class="stringliteral">&#39;Q2SAT&#39;</span>,q2sat,<span class="stringliteral">&#39;DQSDT2&#39;</span>,dqsdt2,<span class="stringliteral">&#39;VEGTYP&#39;</span>, vegtyp,&amp;</div>
<div class="line"><a id="l04311" name="l04311"></a><span class="lineno"> 4311</span>                <span class="stringliteral">&#39;SOILTYP&#39;</span>,soiltyp, <span class="stringliteral">&#39;SLOPETYP&#39;</span>,slopetyp, <span class="stringliteral">&#39;SHDFAC&#39;</span>,shdfac,&amp;</div>
<div class="line"><a id="l04312" name="l04312"></a><span class="lineno"> 4312</span>               <span class="stringliteral">&#39;SHDMIN&#39;</span>,shmin, <span class="stringliteral">&#39;ALBBRD&#39;</span>,albbrd,<span class="stringliteral">&#39;SNOALB&#39;</span>,snoalb1,<span class="stringliteral">&#39;TBOT&#39;</span>,&amp;</div>
<div class="line"><a id="l04313" name="l04313"></a><span class="lineno"> 4313</span>                tbot, <span class="stringliteral">&#39;Z0BRD&#39;</span>,z0brd, <span class="stringliteral">&#39;Z0K&#39;</span>,z0k, <span class="stringliteral">&#39;CMC&#39;</span>,cmc, <span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;STC&#39;</span>,&amp;</div>
<div class="line"><a id="l04314" name="l04314"></a><span class="lineno"> 4314</span>                stc, <span class="stringliteral">&#39;SMC&#39;</span>,smc, <span class="stringliteral">&#39;SWc&#39;</span>,swc,<span class="stringliteral">&#39;SNOWHK&#39;</span>,snowhk,<span class="stringliteral">&#39;SNEQV&#39;</span>,sneqv,&amp;</div>
<div class="line"><a id="l04315" name="l04315"></a><span class="lineno"> 4315</span>                <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok,<span class="stringliteral">&#39;CHK&#39;</span>,chk,<span class="stringliteral">&#39;ETA&#39;</span>,eta,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat,      &amp;</div>
<div class="line"><a id="l04316" name="l04316"></a><span class="lineno"> 4316</span>                <span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,eta_kinematic, <span class="stringliteral">&#39;FDOWN&#39;</span>,fdown,<span class="stringliteral">&#39;EC&#39;</span>,ec,   &amp;</div>
<div class="line"><a id="l04317" name="l04317"></a><span class="lineno"> 4317</span>                <span class="stringliteral">&#39;EDIR&#39;</span>,edir,<span class="stringliteral">&#39;ET&#39;</span>,et,<span class="stringliteral">&#39;ETT&#39;</span>,ett,<span class="stringliteral">&#39;ESNOW&#39;</span>,esnow,<span class="stringliteral">&#39;DRIP&#39;</span>,drip,&amp;</div>
<div class="line"><a id="l04318" name="l04318"></a><span class="lineno"> 4318</span>                <span class="stringliteral">&#39;DEW&#39;</span>,dew,<span class="stringliteral">&#39;BETA&#39;</span>,beta,<span class="stringliteral">&#39;ETP&#39;</span>,etp,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;FLX1&#39;</span>,flx1,&amp;</div>
<div class="line"><a id="l04319" name="l04319"></a><span class="lineno"> 4319</span>                <span class="stringliteral">&#39;FLX2&#39;</span>,flx2,<span class="stringliteral">&#39;FLX3&#39;</span>,flx3,<span class="stringliteral">&#39;SNOMLT&#39;</span>,snomlt,<span class="stringliteral">&#39;SNCOVR&#39;</span>,sncovr,&amp;</div>
<div class="line"><a id="l04320" name="l04320"></a><span class="lineno"> 4320</span>                <span class="stringliteral">&#39;RUNOFF1&#39;</span>,runoff1,<span class="stringliteral">&#39;RUNOFF2&#39;</span>,runoff2,<span class="stringliteral">&#39;RUNOFF3&#39;</span>,runoff3, &amp;</div>
<div class="line"><a id="l04321" name="l04321"></a><span class="lineno"> 4321</span>                <span class="stringliteral">&#39;RC&#39;</span>,rc, <span class="stringliteral">&#39;PC&#39;</span>,pc,<span class="stringliteral">&#39;RSMIN&#39;</span>,rsmin,<span class="stringliteral">&#39;XLAI&#39;</span>,xlai,<span class="stringliteral">&#39;RCS&#39;</span>,rcs,  &amp;</div>
<div class="line"><a id="l04322" name="l04322"></a><span class="lineno"> 4322</span>                <span class="stringliteral">&#39;RCT&#39;</span>,rct,<span class="stringliteral">&#39;RCQ&#39;</span>,rcq,<span class="stringliteral">&#39;RCSOIL&#39;</span>,rcsoil,<span class="stringliteral">&#39;SOILW&#39;</span>,soilw,     &amp;</div>
<div class="line"><a id="l04323" name="l04323"></a><span class="lineno"> 4323</span>                <span class="stringliteral">&#39;SOILM&#39;</span>,soilm,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;SMCWLT&#39;</span>,smcwlt,<span class="stringliteral">&#39;SMCDRY&#39;</span>,smcdry,&amp;</div>
<div class="line"><a id="l04324" name="l04324"></a><span class="lineno"> 4324</span>                <span class="stringliteral">&#39;SMCREF&#39;</span>,smcref,<span class="stringliteral">&#39;SMCMAX&#39;</span>,smcmax,<span class="stringliteral">&#39;NROOT&#39;</span>,nroot</div>
<div class="line"><a id="l04325" name="l04325"></a><span class="lineno"> 4325</span><span class="keywordflow">                 endif</span></div>
<div class="line"><a id="l04326" name="l04326"></a><span class="lineno"> 4326</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04327" name="l04327"></a><span class="lineno"> 4327</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l04328" name="l04328"></a><span class="lineno"> 4328</span>      <span class="comment">!***  UPDATE STATE VARIABLES</span></div>
<div class="line"><a id="l04329" name="l04329"></a><span class="lineno"> 4329</span>                canwat(i,j)=cmc*1000.</div>
<div class="line"><a id="l04330" name="l04330"></a><span class="lineno"> 4330</span>                snow(i,j)=sneqv*1000.</div>
<div class="line"><a id="l04331" name="l04331"></a><span class="lineno"> 4331</span>      <span class="comment">!          SNOWH(I,J)=SNOWHK*1000.</span></div>
<div class="line"><a id="l04332" name="l04332"></a><span class="lineno"> 4332</span>                snowh(i,j)=snowhk                   <span class="comment">! SNOWHK in meters</span></div>
<div class="line"><a id="l04333" name="l04333"></a><span class="lineno"> 4333</span>                albedo(i,j)=albedok</div>
<div class="line"><a id="l04334" name="l04334"></a><span class="lineno"> 4334</span>                alb_rural(i,j)=albedok</div>
<div class="line"><a id="l04335" name="l04335"></a><span class="lineno"> 4335</span>                albbck(i,j)=albbrd</div>
<div class="line"><a id="l04336" name="l04336"></a><span class="lineno"> 4336</span>                z0(i,j)=z0brd</div>
<div class="line"><a id="l04337" name="l04337"></a><span class="lineno"> 4337</span>                emiss(i,j) = emissi</div>
<div class="line"><a id="l04338" name="l04338"></a><span class="lineno"> 4338</span>                emiss_rural(i,j) = emissi</div>
<div class="line"><a id="l04339" name="l04339"></a><span class="lineno"> 4339</span>      <span class="comment">! Noah: activate time-varying roughness length (V3.3 Feb 2011)</span></div>
<div class="line"><a id="l04340" name="l04340"></a><span class="lineno"> 4340</span>                znt(i,j)=z0k</div>
<div class="line"><a id="l04341" name="l04341"></a><span class="lineno"> 4341</span>                tsk(i,j)=t1</div>
<div class="line"><a id="l04342" name="l04342"></a><span class="lineno"> 4342</span>                tsk_rural(i,j)=t1</div>
<div class="line"><a id="l04343" name="l04343"></a><span class="lineno"> 4343</span>                hfx(i,j)=sheat</div>
<div class="line"><a id="l04344" name="l04344"></a><span class="lineno"> 4344</span>                hfx_rural(i,j)=sheat</div>
<div class="line"><a id="l04345" name="l04345"></a><span class="lineno"> 4345</span>      <span class="comment">! MEk Jul07 add potential evap accum</span></div>
<div class="line"><a id="l04346" name="l04346"></a><span class="lineno"> 4346</span>              potevp(i,j)=potevp(i,j)+etp*fdtw</div>
<div class="line"><a id="l04347" name="l04347"></a><span class="lineno"> 4347</span>                qfx(i,j)=eta_kinematic</div>
<div class="line"><a id="l04348" name="l04348"></a><span class="lineno"> 4348</span>                qfx_rural(i,j)=eta_kinematic</div>
<div class="line"><a id="l04349" name="l04349"></a><span class="lineno"> 4349</span>      </div>
<div class="line"><a id="l04350" name="l04350"></a><span class="lineno"> 4350</span><span class="preprocessor">#ifdef WRF_HYDRO</span></div>
<div class="line"><a id="l04351" name="l04351"></a><span class="lineno"> 4351</span><span class="preprocessor"></span>      <span class="comment">!added by Wei Yu</span></div>
<div class="line"><a id="l04352" name="l04352"></a><span class="lineno"> 4352</span>      <span class="comment">!         QFX(I,J) = QFX(I,J) + ETPND1</span></div>
<div class="line"><a id="l04353" name="l04353"></a><span class="lineno"> 4353</span>      <span class="comment">!         ETA = ETA + ETPND1/2.501E6*dt</span></div>
<div class="line"><a id="l04354" name="l04354"></a><span class="lineno"> 4354</span>      <span class="comment">!end added by Wei Yu</span></div>
<div class="line"><a id="l04355" name="l04355"></a><span class="lineno"> 4355</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04356" name="l04356"></a><span class="lineno"> 4356</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l04357" name="l04357"></a><span class="lineno"> 4357</span>                lh(i,j)=eta</div>
<div class="line"><a id="l04358" name="l04358"></a><span class="lineno"> 4358</span>                lh_rural(i,j)=eta</div>
<div class="line"><a id="l04359" name="l04359"></a><span class="lineno"> 4359</span>                grdflx(i,j)=ssoil</div>
<div class="line"><a id="l04360" name="l04360"></a><span class="lineno"> 4360</span>                grdflx_rural(i,j)=ssoil</div>
<div class="line"><a id="l04361" name="l04361"></a><span class="lineno"> 4361</span>                snowc(i,j)=sncovr</div>
<div class="line"><a id="l04362" name="l04362"></a><span class="lineno"> 4362</span>                chs2(i,j)=cqs2(i,j)</div>
<div class="line"><a id="l04363" name="l04363"></a><span class="lineno"> 4363</span>                snotime(i,j) = snotime1</div>
<div class="line"><a id="l04364" name="l04364"></a><span class="lineno"> 4364</span>      <span class="comment">!      prevent diagnostic ground q (q1) from being greater than qsat(tsk)</span></div>
<div class="line"><a id="l04365" name="l04365"></a><span class="lineno"> 4365</span>      <span class="comment">!      as happens over snow cover where the cqs2 value also becomes irrelevant</span></div>
<div class="line"><a id="l04366" name="l04366"></a><span class="lineno"> 4366</span>      <span class="comment">!      by setting cqs2=chs in this situation the 2m q should become just qv(k=1)</span></div>
<div class="line"><a id="l04367" name="l04367"></a><span class="lineno"> 4367</span>                <span class="keywordflow">IF</span> (q1 .GT. qsfc(i,j)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04368" name="l04368"></a><span class="lineno"> 4368</span>                  cqs2(i,j) = chs(i,j)</div>
<div class="line"><a id="l04369" name="l04369"></a><span class="lineno"> 4369</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04370" name="l04370"></a><span class="lineno"> 4370</span>      <span class="comment">!          QSFC(I,J)=Q1</span></div>
<div class="line"><a id="l04371" name="l04371"></a><span class="lineno"> 4371</span>      <span class="comment">! Convert QSFC back to mixing ratio</span></div>
<div class="line"><a id="l04372" name="l04372"></a><span class="lineno"> 4372</span>                 qsfc(i,j)= q1/(1.0-q1)</div>
<div class="line"><a id="l04373" name="l04373"></a><span class="lineno"> 4373</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04374" name="l04374"></a><span class="lineno"> 4374</span>                 <span class="comment">! QSFC_RURAL(I,J)= Q1/(1.0-Q1)</span></div>
<div class="line"><a id="l04375" name="l04375"></a><span class="lineno"> 4375</span>      <span class="comment">! Calculate momentum flux from rural surface for use with multi-layer UCM (Martilli et al. 2002)</span></div>
<div class="line"><a id="l04376" name="l04376"></a><span class="lineno"> 4376</span>      </div>
<div class="line"><a id="l04377" name="l04377"></a><span class="lineno"> 4377</span>                <span class="keywordflow">DO</span> 80 ns=1,nsoil</div>
<div class="line"><a id="l04378" name="l04378"></a><span class="lineno"> 4378</span>                 smois(i,ns,j)=smc(ns)</div>
<div class="line"><a id="l04379" name="l04379"></a><span class="lineno"> 4379</span>                 tslb(i,ns,j)=stc(ns)                                        <span class="comment">!  STEMP</span></div>
<div class="line"><a id="l04380" name="l04380"></a><span class="lineno"> 4380</span>                 sh2o(i,ns,j)=swc(ns)</div>
<div class="line"><a id="l04381" name="l04381"></a><span class="lineno"> 4381</span>         80     <span class="keywordflow">CONTINUE</span></div>
<div class="line"><a id="l04382" name="l04382"></a><span class="lineno"> 4382</span>      <span class="comment">!       ENDIF</span></div>
<div class="line"><a id="l04383" name="l04383"></a><span class="lineno"> 4383</span>      </div>
<div class="line"><a id="l04384" name="l04384"></a><span class="lineno"> 4384</span>              flx4_2d(i,j)  = flx4</div>
<div class="line"><a id="l04385" name="l04385"></a><span class="lineno"> 4385</span>        fvb_2d(i,j)   = fvb</div>
<div class="line"><a id="l04386" name="l04386"></a><span class="lineno"> 4386</span>        fbur_2d(i,j)  = fbur</div>
<div class="line"><a id="l04387" name="l04387"></a><span class="lineno"> 4387</span>        fgsn_2d(i,j)  = fgsn</div>
<div class="line"><a id="l04388" name="l04388"></a><span class="lineno"> 4388</span>           <span class="comment">!</span></div>
<div class="line"><a id="l04389" name="l04389"></a><span class="lineno"> 4389</span>           <span class="comment">! Residual of surface energy balance equation terms</span></div>
<div class="line"><a id="l04390" name="l04390"></a><span class="lineno"> 4390</span>           <span class="comment">!</span></div>
<div class="line"><a id="l04391" name="l04391"></a><span class="lineno"> 4391</span>      </div>
<div class="line"><a id="l04392" name="l04392"></a><span class="lineno"> 4392</span>           <span class="keywordflow">IF</span> ( ua_phys ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04393" name="l04393"></a><span class="lineno"> 4393</span>               noahres(i,j) = ( solnet + lwdn ) - sheat + ssoil - eta &amp;</div>
<div class="line"><a id="l04394" name="l04394"></a><span class="lineno"> 4394</span>                    - ( emissi * stbolt * (t1**4) ) - flx1 - flx2 - flx3 - flx4</div>
<div class="line"><a id="l04395" name="l04395"></a><span class="lineno"> 4395</span>      </div>
<div class="line"><a id="l04396" name="l04396"></a><span class="lineno"> 4396</span>           <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04397" name="l04397"></a><span class="lineno"> 4397</span>               noahres(i,j) = ( solnet + lwdn ) - sheat + ssoil - eta &amp;</div>
<div class="line"><a id="l04398" name="l04398"></a><span class="lineno"> 4398</span>                    - ( emissi * stbolt * (t1**4) ) - flx1 - flx2 - flx3</div>
<div class="line"><a id="l04399" name="l04399"></a><span class="lineno"> 4399</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l04400" name="l04400"></a><span class="lineno"> 4400</span>      </div>
<div class="line"><a id="l04401" name="l04401"></a><span class="lineno"> 4401</span>              <span class="keywordflow">IF</span> (sf_urban_physics == 1 ) <span class="keywordflow">THEN</span>                                              <span class="comment">! Beginning of UCM CALL if block</span></div>
<div class="line"><a id="l04402" name="l04402"></a><span class="lineno"> 4402</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l04403" name="l04403"></a><span class="lineno"> 4403</span>      <span class="comment">! URBAN CANOPY MODEL START - urban</span></div>
<div class="line"><a id="l04404" name="l04404"></a><span class="lineno"> 4404</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l04405" name="l04405"></a><span class="lineno"> 4405</span>      <span class="comment">! Input variables lsm --&gt; urban</span></div>
<div class="line"><a id="l04406" name="l04406"></a><span class="lineno"> 4406</span>      </div>
<div class="line"><a id="l04407" name="l04407"></a><span class="lineno"> 4407</span>                <span class="keywordflow">IF</span>( ivgtyp(i,j) == isurban .or. ivgtyp(i,j) == low_density_residential .or. &amp;</div>
<div class="line"><a id="l04408" name="l04408"></a><span class="lineno"> 4408</span>                    ivgtyp(i,j) == high_density_residential .or. ivgtyp(i,j) ==  high_intensity_industrial) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04409" name="l04409"></a><span class="lineno"> 4409</span>      </div>
<div class="line"><a id="l04410" name="l04410"></a><span class="lineno"> 4410</span>      <span class="comment">! Call urban</span></div>
<div class="line"><a id="l04411" name="l04411"></a><span class="lineno"> 4411</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04412" name="l04412"></a><span class="lineno"> 4412</span>                  utype_urb = utype_urb2d(i,j) <span class="comment">!urban type (low, high or industrial)</span></div>
<div class="line"><a id="l04413" name="l04413"></a><span class="lineno"> 4413</span>      </div>
<div class="line"><a id="l04414" name="l04414"></a><span class="lineno"> 4414</span>                  ta_urb    = sfctmp           <span class="comment">! [K]</span></div>
<div class="line"><a id="l04415" name="l04415"></a><span class="lineno"> 4415</span>                  qa_urb    = q2k              <span class="comment">! [kg/kg]</span></div>
<div class="line"><a id="l04416" name="l04416"></a><span class="lineno"> 4416</span>                  ua_urb    = sqrt(u_phy(i,1,j)**2.+v_phy(i,1,j)**2.)</div>
<div class="line"><a id="l04417" name="l04417"></a><span class="lineno"> 4417</span>                  u1_urb    = u_phy(i,1,j)</div>
<div class="line"><a id="l04418" name="l04418"></a><span class="lineno"> 4418</span>                  v1_urb    = v_phy(i,1,j)</div>
<div class="line"><a id="l04419" name="l04419"></a><span class="lineno"> 4419</span>                  <span class="keywordflow">IF</span>(ua_urb &lt; 1.) ua_urb=1.    <span class="comment">! [m/s]</span></div>
<div class="line"><a id="l04420" name="l04420"></a><span class="lineno"> 4420</span>                  ssg_urb   = soldn            <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l04421" name="l04421"></a><span class="lineno"> 4421</span>                  ssgd_urb  = 0.8*soldn        <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l04422" name="l04422"></a><span class="lineno"> 4422</span>                  ssgq_urb  = ssg_urb-ssgd_urb <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l04423" name="l04423"></a><span class="lineno"> 4423</span>                  llg_urb   = glw(i,j)         <span class="comment">! [W/m/m]</span></div>
<div class="line"><a id="l04424" name="l04424"></a><span class="lineno"> 4424</span>                  rain_urb  = rainbl(i,j)      <span class="comment">! [mm]</span></div>
<div class="line"><a id="l04425" name="l04425"></a><span class="lineno"> 4425</span>                  rhoo_urb  = sfcprs / (287.04 * sfctmp * (1.0+ 0.61 * q2k)) <span class="comment">![kg/m/m/m]</span></div>
<div class="line"><a id="l04426" name="l04426"></a><span class="lineno"> 4426</span>                  za_urb    = zlvl             <span class="comment">! [m]</span></div>
<div class="line"><a id="l04427" name="l04427"></a><span class="lineno"> 4427</span>                  delt_urb  = dt               <span class="comment">! [sec]</span></div>
<div class="line"><a id="l04428" name="l04428"></a><span class="lineno"> 4428</span>                  xlat_urb  = xlat_urb2d(i,j)  <span class="comment">! [deg]</span></div>
<div class="line"><a id="l04429" name="l04429"></a><span class="lineno"> 4429</span>                  cosz_urb  = cosz_urb2d(i,j)  <span class="comment">!</span></div>
<div class="line"><a id="l04430" name="l04430"></a><span class="lineno"> 4430</span>                  omg_urb   = omg_urb2d(i,j)   <span class="comment">!</span></div>
<div class="line"><a id="l04431" name="l04431"></a><span class="lineno"> 4431</span>                  znt_urb   = znt(i,j)</div>
<div class="line"><a id="l04432" name="l04432"></a><span class="lineno"> 4432</span>      </div>
<div class="line"><a id="l04433" name="l04433"></a><span class="lineno"> 4433</span>                  lsolar_urb = .false.</div>
<div class="line"><a id="l04434" name="l04434"></a><span class="lineno"> 4434</span>      </div>
<div class="line"><a id="l04435" name="l04435"></a><span class="lineno"> 4435</span>                  tr_urb = tr_urb2d(i,j)</div>
<div class="line"><a id="l04436" name="l04436"></a><span class="lineno"> 4436</span>                  tb_urb = tb_urb2d(i,j)</div>
<div class="line"><a id="l04437" name="l04437"></a><span class="lineno"> 4437</span>                  tg_urb = tg_urb2d(i,j)</div>
<div class="line"><a id="l04438" name="l04438"></a><span class="lineno"> 4438</span>                  tc_urb = tc_urb2d(i,j)</div>
<div class="line"><a id="l04439" name="l04439"></a><span class="lineno"> 4439</span>                  qc_urb = qc_urb2d(i,j)</div>
<div class="line"><a id="l04440" name="l04440"></a><span class="lineno"> 4440</span>                  uc_urb = uc_urb2d(i,j)</div>
<div class="line"><a id="l04441" name="l04441"></a><span class="lineno"> 4441</span>      </div>
<div class="line"><a id="l04442" name="l04442"></a><span class="lineno"> 4442</span>                  <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l04443" name="l04443"></a><span class="lineno"> 4443</span>                    trl_urb(k) = trl_urb3d(i,k,j)</div>
<div class="line"><a id="l04444" name="l04444"></a><span class="lineno"> 4444</span>                    smr_urb(k) = smr_urb3d(i,k,j)</div>
<div class="line"><a id="l04445" name="l04445"></a><span class="lineno"> 4445</span>                      tgrl_urb(k)= tgrl_urb3d(i,k,j)</div>
<div class="line"><a id="l04446" name="l04446"></a><span class="lineno"> 4446</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l04447" name="l04447"></a><span class="lineno"> 4447</span>                  <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l04448" name="l04448"></a><span class="lineno"> 4448</span>                    tbl_urb(k) = tbl_urb3d(i,k,j)</div>
<div class="line"><a id="l04449" name="l04449"></a><span class="lineno"> 4449</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l04450" name="l04450"></a><span class="lineno"> 4450</span>                  <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l04451" name="l04451"></a><span class="lineno"> 4451</span>                    tgl_urb(k) = tgl_urb3d(i,k,j)</div>
<div class="line"><a id="l04452" name="l04452"></a><span class="lineno"> 4452</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l04453" name="l04453"></a><span class="lineno"> 4453</span> </div>
<div class="line"><a id="l04454" name="l04454"></a><span class="lineno"> 4454</span>                  tgr_urb   = tgr_urb2d(i,j)</div>
<div class="line"><a id="l04455" name="l04455"></a><span class="lineno"> 4455</span>                  cmcr_urb  = cmcr_urb2d(i,j)</div>
<div class="line"><a id="l04456" name="l04456"></a><span class="lineno"> 4456</span>                  flxhumr_urb = flxhumr_urb2d(i,j)</div>
<div class="line"><a id="l04457" name="l04457"></a><span class="lineno"> 4457</span>                  flxhumb_urb = flxhumb_urb2d(i,j)</div>
<div class="line"><a id="l04458" name="l04458"></a><span class="lineno"> 4458</span>                  flxhumg_urb = flxhumg_urb2d(i,j)</div>
<div class="line"><a id="l04459" name="l04459"></a><span class="lineno"> 4459</span>                  drelr_urb = drelr_urb2d(i,j)</div>
<div class="line"><a id="l04460" name="l04460"></a><span class="lineno"> 4460</span>                  drelb_urb = drelb_urb2d(i,j)</div>
<div class="line"><a id="l04461" name="l04461"></a><span class="lineno"> 4461</span>                  drelg_urb = drelg_urb2d(i,j)</div>
<div class="line"><a id="l04462" name="l04462"></a><span class="lineno"> 4462</span>      </div>
<div class="line"><a id="l04463" name="l04463"></a><span class="lineno"> 4463</span>                  xxxr_urb = xxxr_urb2d(i,j)</div>
<div class="line"><a id="l04464" name="l04464"></a><span class="lineno"> 4464</span>                  xxxb_urb = xxxb_urb2d(i,j)</div>
<div class="line"><a id="l04465" name="l04465"></a><span class="lineno"> 4465</span>                  xxxg_urb = xxxg_urb2d(i,j)</div>
<div class="line"><a id="l04466" name="l04466"></a><span class="lineno"> 4466</span>                  xxxc_urb = xxxc_urb2d(i,j)</div>
<div class="line"><a id="l04467" name="l04467"></a><span class="lineno"> 4467</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04468" name="l04468"></a><span class="lineno"> 4468</span>      <span class="comment">!      Limits to avoid dividing by small number</span></div>
<div class="line"><a id="l04469" name="l04469"></a><span class="lineno"> 4469</span>                  <span class="keywordflow">if</span> (chs(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04470" name="l04470"></a><span class="lineno"> 4470</span>                     chs(i,j)  = 1.0e-02</div>
<div class="line"><a id="l04471" name="l04471"></a><span class="lineno"> 4471</span><span class="keywordflow">                  endif</span></div>
<div class="line"><a id="l04472" name="l04472"></a><span class="lineno"> 4472</span>                  <span class="keywordflow">if</span> (chs2(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04473" name="l04473"></a><span class="lineno"> 4473</span>                     chs2(i,j)  = 1.0e-02</div>
<div class="line"><a id="l04474" name="l04474"></a><span class="lineno"> 4474</span><span class="keywordflow">                  endif</span></div>
<div class="line"><a id="l04475" name="l04475"></a><span class="lineno"> 4475</span>                  <span class="keywordflow">if</span> (cqs2(i,j) &lt; 1.0e-02) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04476" name="l04476"></a><span class="lineno"> 4476</span>                     cqs2(i,j)  = 1.0e-02</div>
<div class="line"><a id="l04477" name="l04477"></a><span class="lineno"> 4477</span><span class="keywordflow">                  endif</span></div>
<div class="line"><a id="l04478" name="l04478"></a><span class="lineno"> 4478</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04479" name="l04479"></a><span class="lineno"> 4479</span>                  chs_urb  = chs(i,j)</div>
<div class="line"><a id="l04480" name="l04480"></a><span class="lineno"> 4480</span>                  chs2_urb = chs2(i,j)</div>
<div class="line"><a id="l04481" name="l04481"></a><span class="lineno"> 4481</span>                  <span class="keywordflow">IF</span> (<span class="keyword">PRESENT</span>(cmr_sfcdif)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04482" name="l04482"></a><span class="lineno"> 4482</span>                     cmr_urb = cmr_sfcdif(i,j)</div>
<div class="line"><a id="l04483" name="l04483"></a><span class="lineno"> 4483</span>                     chr_urb = chr_sfcdif(i,j)</div>
<div class="line"><a id="l04484" name="l04484"></a><span class="lineno"> 4484</span>                     cmgr_urb = cmgr_sfcdif(i,j)</div>
<div class="line"><a id="l04485" name="l04485"></a><span class="lineno"> 4485</span>                     chgr_urb = chgr_sfcdif(i,j)</div>
<div class="line"><a id="l04486" name="l04486"></a><span class="lineno"> 4486</span>                     cmc_urb = cmc_sfcdif(i,j)</div>
<div class="line"><a id="l04487" name="l04487"></a><span class="lineno"> 4487</span>                     chc_urb = chc_sfcdif(i,j)</div>
<div class="line"><a id="l04488" name="l04488"></a><span class="lineno"> 4488</span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a id="l04489" name="l04489"></a><span class="lineno"> 4489</span>      </div>
<div class="line"><a id="l04490" name="l04490"></a><span class="lineno"> 4490</span>      <span class="comment">! NUDAPT for SLUCM</span></div>
<div class="line"><a id="l04491" name="l04491"></a><span class="lineno"> 4491</span>                  mh_urb = mh_urb2d(i,j)</div>
<div class="line"><a id="l04492" name="l04492"></a><span class="lineno"> 4492</span>                  stdh_urb = stdh_urb2d(i,j)</div>
<div class="line"><a id="l04493" name="l04493"></a><span class="lineno"> 4493</span>                  lp_urb = lp_urb2d(i,j)</div>
<div class="line"><a id="l04494" name="l04494"></a><span class="lineno"> 4494</span>                  hgt_urb = hgt_urb2d(i,j)</div>
<div class="line"><a id="l04495" name="l04495"></a><span class="lineno"> 4495</span>                  lf_urb = 0.0</div>
<div class="line"><a id="l04496" name="l04496"></a><span class="lineno"> 4496</span>                  <span class="keywordflow">DO</span> k = 1,4</div>
<div class="line"><a id="l04497" name="l04497"></a><span class="lineno"> 4497</span>                    lf_urb(k)=lf_urb2d(i,k,j)</div>
<div class="line"><a id="l04498" name="l04498"></a><span class="lineno"> 4498</span><span class="keywordflow">                  ENDDO</span></div>
<div class="line"><a id="l04499" name="l04499"></a><span class="lineno"> 4499</span>                  frc_urb = frc_urb2d(i,j)</div>
<div class="line"><a id="l04500" name="l04500"></a><span class="lineno"> 4500</span>                  lb_urb = lb_urb2d(i,j)</div>
<div class="line"><a id="l04501" name="l04501"></a><span class="lineno"> 4501</span>                  check = 0</div>
<div class="line"><a id="l04502" name="l04502"></a><span class="lineno"> 4502</span>                  <span class="keywordflow">if</span> (i.eq.73.and.j.eq.125)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04503" name="l04503"></a><span class="lineno"> 4503</span>                     check = 1</div>
<div class="line"><a id="l04504" name="l04504"></a><span class="lineno"> 4504</span><span class="keywordflow">                  end if</span></div>
<div class="line"><a id="l04505" name="l04505"></a><span class="lineno"> 4505</span>      <span class="comment">!</span></div>
<div class="line"><a id="l04506" name="l04506"></a><span class="lineno"> 4506</span>      <span class="comment">! Call urban</span></div>
<div class="line"><a id="l04507" name="l04507"></a><span class="lineno"> 4507</span>                  <span class="keyword">CALL </span>cal_mon_day(julian,julyr,jmonth,jday)        </div>
<div class="line"><a id="l04508" name="l04508"></a><span class="lineno"> 4508</span>                  <span class="keyword">CALL </span>urban(lsolar_urb,                                      &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l04509" name="l04509"></a><span class="lineno"> 4509</span>                             num_roof_layers,num_wall_layers,num_road_layers, &amp; <span class="comment">! C</span></div>
<div class="line"><a id="l04510" name="l04510"></a><span class="lineno"> 4510</span>                             dzr,dzb,dzg,                                     &amp; <span class="comment">! C</span></div>
<div class="line"><a id="l04511" name="l04511"></a><span class="lineno"> 4511</span>                             utype_urb,ta_urb,qa_urb,ua_urb,u1_urb,v1_urb,ssg_urb, &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l04512" name="l04512"></a><span class="lineno"> 4512</span>                             ssgd_urb,ssgq_urb,llg_urb,rain_urb,rhoo_urb,     &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l04513" name="l04513"></a><span class="lineno"> 4513</span>                             za_urb,declin_urb,cosz_urb,omg_urb,              &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l04514" name="l04514"></a><span class="lineno"> 4514</span>                             xlat_urb,delt_urb,znt_urb,                       &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l04515" name="l04515"></a><span class="lineno"> 4515</span>                             chs_urb, chs2_urb,                               &amp; <span class="comment">! I</span></div>
<div class="line"><a id="l04516" name="l04516"></a><span class="lineno"> 4516</span>                             tr_urb, tb_urb, tg_urb, tc_urb, qc_urb,uc_urb,   &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l04517" name="l04517"></a><span class="lineno"> 4517</span>                             trl_urb,tbl_urb,tgl_urb,                         &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l04518" name="l04518"></a><span class="lineno"> 4518</span>                             xxxr_urb, xxxb_urb, xxxg_urb, xxxc_urb,          &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l04519" name="l04519"></a><span class="lineno"> 4519</span>                             ts_urb,qs_urb,sh_urb,lh_urb,lh_kinematic_urb,    &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l04520" name="l04520"></a><span class="lineno"> 4520</span>                             sw_urb,alb_urb,lw_urb,g_urb,rn_urb,psim_urb,psih_urb, &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l04521" name="l04521"></a><span class="lineno"> 4521</span>                             gz1oz0_urb,                                      &amp; <span class="comment">!O</span></div>
<div class="line"><a id="l04522" name="l04522"></a><span class="lineno"> 4522</span>                             cmr_urb, chr_urb, cmc_urb, chc_urb,              &amp;</div>
<div class="line"><a id="l04523" name="l04523"></a><span class="lineno"> 4523</span>                             u10_urb, v10_urb, th2_urb, q2_urb,               &amp; <span class="comment">! O</span></div>
<div class="line"><a id="l04524" name="l04524"></a><span class="lineno"> 4524</span>                             ust_urb,mh_urb, stdh_urb, lf_urb, lp_urb,        &amp; <span class="comment">! 0</span></div>
<div class="line"><a id="l04525" name="l04525"></a><span class="lineno"> 4525</span>                             hgt_urb,frc_urb,lb_urb, check,cmcr_urb,tgr_urb,  &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l04526" name="l04526"></a><span class="lineno"> 4526</span>                             tgrl_urb,smr_urb,cmgr_urb,chgr_urb,jmonth,       &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l04527" name="l04527"></a><span class="lineno"> 4527</span>                             drelr_urb,drelb_urb,                             &amp; <span class="comment">! H</span></div>
<div class="line"><a id="l04528" name="l04528"></a><span class="lineno"> 4528</span>                             drelg_urb,flxhumr_urb,flxhumb_urb,flxhumg_urb)  </div>
<div class="line"><a id="l04529" name="l04529"></a><span class="lineno"> 4529</span>      </div>
<div class="line"><a id="l04530" name="l04530"></a><span class="lineno"> 4530</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l04531" name="l04531"></a><span class="lineno"> 4531</span><span class="preprocessor"></span>                <span class="keywordflow">IF</span>(iprint) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04532" name="l04532"></a><span class="lineno"> 4532</span>      </div>
<div class="line"><a id="l04533" name="l04533"></a><span class="lineno"> 4533</span>             print*, <span class="stringliteral">&#39;AFTER CALL URBAN&#39;</span></div>
<div class="line"><a id="l04534" name="l04534"></a><span class="lineno"> 4534</span>             print*,<span class="stringliteral">&#39;num_roof_layers&#39;</span>,num_roof_layers, <span class="stringliteral">&#39;num_wall_layers&#39;</span>,  &amp;</div>
<div class="line"><a id="l04535" name="l04535"></a><span class="lineno"> 4535</span>              num_wall_layers,                                             &amp;</div>
<div class="line"><a id="l04536" name="l04536"></a><span class="lineno"> 4536</span>             <span class="stringliteral">&#39;DZR&#39;</span>,dzr,<span class="stringliteral">&#39;DZB&#39;</span>,dzb,<span class="stringliteral">&#39;DZG&#39;</span>,dzg,<span class="stringliteral">&#39;UTYPE_URB&#39;</span>,utype_urb,<span class="stringliteral">&#39;TA_URB&#39;</span>, &amp;</div>
<div class="line"><a id="l04537" name="l04537"></a><span class="lineno"> 4537</span>              ta_urb,                                                      &amp;</div>
<div class="line"><a id="l04538" name="l04538"></a><span class="lineno"> 4538</span>              <span class="stringliteral">&#39;QA_URB&#39;</span>,qa_urb,<span class="stringliteral">&#39;UA_URB&#39;</span>,ua_urb,<span class="stringliteral">&#39;U1_URB&#39;</span>,u1_urb,<span class="stringliteral">&#39;V1_URB&#39;</span>,    &amp;</div>
<div class="line"><a id="l04539" name="l04539"></a><span class="lineno"> 4539</span>               v1_urb,                                                     &amp;</div>
<div class="line"><a id="l04540" name="l04540"></a><span class="lineno"> 4540</span>               <span class="stringliteral">&#39;SSG_URB&#39;</span>,ssg_urb,<span class="stringliteral">&#39;SSGD_URB&#39;</span>,ssgd_urb,<span class="stringliteral">&#39;SSGQ_URB&#39;</span>,ssgq_urb,  &amp;</div>
<div class="line"><a id="l04541" name="l04541"></a><span class="lineno"> 4541</span>              <span class="stringliteral">&#39;LLG_URB&#39;</span>,llg_urb,<span class="stringliteral">&#39;RAIN_URB&#39;</span>,rain_urb,<span class="stringliteral">&#39;RHOO_URB&#39;</span>,rhoo_urb,   &amp;</div>
<div class="line"><a id="l04542" name="l04542"></a><span class="lineno"> 4542</span>              <span class="stringliteral">&#39;ZA_URB&#39;</span>,za_urb, <span class="stringliteral">&#39;DECLIN_URB&#39;</span>,declin_urb,<span class="stringliteral">&#39;COSZ_URB&#39;</span>,cosz_urb,&amp;</div>
<div class="line"><a id="l04543" name="l04543"></a><span class="lineno"> 4543</span>              <span class="stringliteral">&#39;OMG_URB&#39;</span>,omg_urb,<span class="stringliteral">&#39;XLAT_URB&#39;</span>,xlat_urb,<span class="stringliteral">&#39;DELT_URB&#39;</span>,delt_urb,   &amp;</div>
<div class="line"><a id="l04544" name="l04544"></a><span class="lineno"> 4544</span>               <span class="stringliteral">&#39;ZNT_URB&#39;</span>,znt_urb,<span class="stringliteral">&#39;TR_URB&#39;</span>,tr_urb, <span class="stringliteral">&#39;TB_URB&#39;</span>,tb_urb,<span class="stringliteral">&#39;TG_URB&#39;</span>,&amp;</div>
<div class="line"><a id="l04545" name="l04545"></a><span class="lineno"> 4545</span>               tg_urb,<span class="stringliteral">&#39;TC_URB&#39;</span>,tc_urb,<span class="stringliteral">&#39;QC_URB&#39;</span>,qc_urb,<span class="stringliteral">&#39;TRL_URB&#39;</span>,trl_urb,   &amp;</div>
<div class="line"><a id="l04546" name="l04546"></a><span class="lineno"> 4546</span>                <span class="stringliteral">&#39;TBL_URB&#39;</span>,tbl_urb,<span class="stringliteral">&#39;TGL_URB&#39;</span>,tgl_urb,<span class="stringliteral">&#39;XXXR_URB&#39;</span>,xxxr_urb,   &amp;</div>
<div class="line"><a id="l04547" name="l04547"></a><span class="lineno"> 4547</span>               <span class="stringliteral">&#39;XXXB_URB&#39;</span>,xxxb_urb,<span class="stringliteral">&#39;XXXG_URB&#39;</span>,xxxg_urb,<span class="stringliteral">&#39;XXXC_URB&#39;</span>,xxxc_urb,&amp;</div>
<div class="line"><a id="l04548" name="l04548"></a><span class="lineno"> 4548</span>               <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb,<span class="stringliteral">&#39;QS_URB&#39;</span>,qs_urb,<span class="stringliteral">&#39;SH_URB&#39;</span>,sh_urb,<span class="stringliteral">&#39;LH_URB&#39;</span>,   &amp;</div>
<div class="line"><a id="l04549" name="l04549"></a><span class="lineno"> 4549</span>               lh_urb, <span class="stringliteral">&#39;LH_KINEMATIC_URB&#39;</span>,lh_kinematic_urb,<span class="stringliteral">&#39;SW_URB&#39;</span>,sw_urb,&amp;</div>
<div class="line"><a id="l04550" name="l04550"></a><span class="lineno"> 4550</span>               <span class="stringliteral">&#39;ALB_URB&#39;</span>,alb_urb,<span class="stringliteral">&#39;LW_URB&#39;</span>,lw_urb,<span class="stringliteral">&#39;G_URB&#39;</span>,g_urb,<span class="stringliteral">&#39;RN_URB&#39;</span>,   &amp;</div>
<div class="line"><a id="l04551" name="l04551"></a><span class="lineno"> 4551</span>                rn_urb, <span class="stringliteral">&#39;PSIM_URB&#39;</span>,psim_urb,<span class="stringliteral">&#39;PSIH_URB&#39;</span>,psih_urb,          &amp;</div>
<div class="line"><a id="l04552" name="l04552"></a><span class="lineno"> 4552</span>               <span class="stringliteral">&#39;U10_URB&#39;</span>,u10_urb,<span class="stringliteral">&#39;V10_URB&#39;</span>,v10_urb,<span class="stringliteral">&#39;TH2_URB&#39;</span>,th2_urb,      &amp;</div>
<div class="line"><a id="l04553" name="l04553"></a><span class="lineno"> 4553</span>                <span class="stringliteral">&#39;Q2_URB&#39;</span>,q2_urb,<span class="stringliteral">&#39;CHS_URB&#39;</span>,chs_urb,<span class="stringliteral">&#39;CHS2_URB&#39;</span>,chs2_urb</div>
<div class="line"><a id="l04554" name="l04554"></a><span class="lineno"> 4554</span><span class="keywordflow">                 endif</span></div>
<div class="line"><a id="l04555" name="l04555"></a><span class="lineno"> 4555</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04556" name="l04556"></a><span class="lineno"> 4556</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l04557" name="l04557"></a><span class="lineno"> 4557</span>                  ts_urb2d(i,j) = ts_urb</div>
<div class="line"><a id="l04558" name="l04558"></a><span class="lineno"> 4558</span>      </div>
<div class="line"><a id="l04559" name="l04559"></a><span class="lineno"> 4559</span>                  albedo(i,j) = frc_urb2d(i,j)*alb_urb+(1-frc_urb2d(i,j))*albedok   <span class="comment">![-]</span></div>
<div class="line"><a id="l04560" name="l04560"></a><span class="lineno"> 4560</span>                  hfx(i,j) = frc_urb2d(i,j)*sh_urb+(1-frc_urb2d(i,j))*sheat         <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l04561" name="l04561"></a><span class="lineno"> 4561</span>                  qfx(i,j) = frc_urb2d(i,j)*lh_kinematic_urb &amp;</div>
<div class="line"><a id="l04562" name="l04562"></a><span class="lineno"> 4562</span>                           + (1-frc_urb2d(i,j))*eta_kinematic                <span class="comment">![kg/m/m/s]</span></div>
<div class="line"><a id="l04563" name="l04563"></a><span class="lineno"> 4563</span>                  lh(i,j) = frc_urb2d(i,j)*lh_urb+(1-frc_urb2d(i,j))*eta            <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l04564" name="l04564"></a><span class="lineno"> 4564</span>                  grdflx(i,j) = frc_urb2d(i,j)*g_urb+(1-frc_urb2d(i,j))*ssoil       <span class="comment">![W/m/m]</span></div>
<div class="line"><a id="l04565" name="l04565"></a><span class="lineno"> 4565</span>                  tsk(i,j) = frc_urb2d(i,j)*ts_urb+(1-frc_urb2d(i,j))*t1            <span class="comment">![K]</span></div>
<div class="line"><a id="l04566" name="l04566"></a><span class="lineno"> 4566</span>                  q1 = frc_urb2d(i,j)*qs_urb+(1-frc_urb2d(i,j))*q1            <span class="comment">![-]</span></div>
<div class="line"><a id="l04567" name="l04567"></a><span class="lineno"> 4567</span>      <span class="comment">! Convert QSFC back to mixing ratio</span></div>
<div class="line"><a id="l04568" name="l04568"></a><span class="lineno"> 4568</span>                  qsfc(i,j)= q1/(1.0-q1)</div>
<div class="line"><a id="l04569" name="l04569"></a><span class="lineno"> 4569</span>                  ust(i,j)= frc_urb2d(i,j)*ust_urb+(1-frc_urb2d(i,j))*ust(i,j)      <span class="comment">![m/s]</span></div>
<div class="line"><a id="l04570" name="l04570"></a><span class="lineno"> 4570</span>      </div>
<div class="line"><a id="l04571" name="l04571"></a><span class="lineno"> 4571</span><span class="preprocessor">#if 0</span></div>
<div class="line"><a id="l04572" name="l04572"></a><span class="lineno"> 4572</span><span class="preprocessor"></span>          <span class="keywordflow">IF</span>(iprint)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04573" name="l04573"></a><span class="lineno"> 4573</span>      </div>
<div class="line"><a id="l04574" name="l04574"></a><span class="lineno"> 4574</span>          print*, <span class="stringliteral">&#39; FRC_URB2D&#39;</span>, frc_urb2d,                        &amp;</div>
<div class="line"><a id="l04575" name="l04575"></a><span class="lineno"> 4575</span>          <span class="stringliteral">&#39;ALB_URB&#39;</span>,alb_urb, <span class="stringliteral">&#39;ALBEDOK&#39;</span>,albedok, &amp;</div>
<div class="line"><a id="l04576" name="l04576"></a><span class="lineno"> 4576</span>          <span class="stringliteral">&#39;ALBEDO(I,J)&#39;</span>,  albedo(i,j),                  &amp;</div>
<div class="line"><a id="l04577" name="l04577"></a><span class="lineno"> 4577</span>          <span class="stringliteral">&#39;SH_URB&#39;</span>,sh_urb,<span class="stringliteral">&#39;SHEAT&#39;</span>,sheat, <span class="stringliteral">&#39;HFX(I,J)&#39;</span>,hfx(i,j),  &amp;</div>
<div class="line"><a id="l04578" name="l04578"></a><span class="lineno"> 4578</span>          <span class="stringliteral">&#39;LH_KINEMATIC_URB&#39;</span>,lh_kinematic_urb,<span class="stringliteral">&#39;ETA_KINEMATIC&#39;</span>,  &amp;</div>
<div class="line"><a id="l04579" name="l04579"></a><span class="lineno"> 4579</span>           eta_kinematic, <span class="stringliteral">&#39;QFX(I,J)&#39;</span>,qfx(i,j),                  &amp;</div>
<div class="line"><a id="l04580" name="l04580"></a><span class="lineno"> 4580</span>          <span class="stringliteral">&#39;LH_URB&#39;</span>,lh_urb, <span class="stringliteral">&#39;ETA&#39;</span>,eta, <span class="stringliteral">&#39;LH(I,J)&#39;</span>,lh(i,j),        &amp;</div>
<div class="line"><a id="l04581" name="l04581"></a><span class="lineno"> 4581</span>          <span class="stringliteral">&#39;G_URB&#39;</span>,g_urb,<span class="stringliteral">&#39;SSOIL&#39;</span>,ssoil,<span class="stringliteral">&#39;GRDFLX(I,J)&#39;</span>, grdflx(i,j),&amp;</div>
<div class="line"><a id="l04582" name="l04582"></a><span class="lineno"> 4582</span>          <span class="stringliteral">&#39;TS_URB&#39;</span>,ts_urb,<span class="stringliteral">&#39;T1&#39;</span>,t1,<span class="stringliteral">&#39;TSK(I,J)&#39;</span>,tsk(i,j),          &amp;</div>
<div class="line"><a id="l04583" name="l04583"></a><span class="lineno"> 4583</span>          <span class="stringliteral">&#39;QS_URB&#39;</span>,qs_urb,<span class="stringliteral">&#39;Q1&#39;</span>,q1,<span class="stringliteral">&#39;QSFC(I,J)&#39;</span>,qsfc(i,j)</div>
<div class="line"><a id="l04584" name="l04584"></a><span class="lineno"> 4584</span><span class="keywordflow">           endif</span></div>
<div class="line"><a id="l04585" name="l04585"></a><span class="lineno"> 4585</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04586" name="l04586"></a><span class="lineno"> 4586</span><span class="preprocessor"></span>      </div>
<div class="line"><a id="l04587" name="l04587"></a><span class="lineno"> 4587</span>      <span class="comment">! Renew Urban State Varialbes</span></div>
<div class="line"><a id="l04588" name="l04588"></a><span class="lineno"> 4588</span>      </div>
<div class="line"><a id="l04589" name="l04589"></a><span class="lineno"> 4589</span>                  tr_urb2d(i,j) = tr_urb</div>
<div class="line"><a id="l04590" name="l04590"></a><span class="lineno"> 4590</span>                  tb_urb2d(i,j) = tb_urb</div>
<div class="line"><a id="l04591" name="l04591"></a><span class="lineno"> 4591</span>                  tg_urb2d(i,j) = tg_urb</div>
<div class="line"><a id="l04592" name="l04592"></a><span class="lineno"> 4592</span>                  tc_urb2d(i,j) = tc_urb</div>
<div class="line"><a id="l04593" name="l04593"></a><span class="lineno"> 4593</span>                  qc_urb2d(i,j) = qc_urb</div>
<div class="line"><a id="l04594" name="l04594"></a><span class="lineno"> 4594</span>                  uc_urb2d(i,j) = uc_urb</div>
<div class="line"><a id="l04595" name="l04595"></a><span class="lineno"> 4595</span>      </div>
<div class="line"><a id="l04596" name="l04596"></a><span class="lineno"> 4596</span>                  <span class="keywordflow">DO</span> k = 1,num_roof_layers</div>
<div class="line"><a id="l04597" name="l04597"></a><span class="lineno"> 4597</span>                    trl_urb3d(i,k,j) = trl_urb(k)</div>
<div class="line"><a id="l04598" name="l04598"></a><span class="lineno"> 4598</span>                    smr_urb3d(i,k,j) = smr_urb(k)</div>
<div class="line"><a id="l04599" name="l04599"></a><span class="lineno"> 4599</span>                    tgrl_urb3d(i,k,j)= tgrl_urb(k)</div>
<div class="line"><a id="l04600" name="l04600"></a><span class="lineno"> 4600</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l04601" name="l04601"></a><span class="lineno"> 4601</span>                  <span class="keywordflow">DO</span> k = 1,num_wall_layers</div>
<div class="line"><a id="l04602" name="l04602"></a><span class="lineno"> 4602</span>                    tbl_urb3d(i,k,j) = tbl_urb(k)</div>
<div class="line"><a id="l04603" name="l04603"></a><span class="lineno"> 4603</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l04604" name="l04604"></a><span class="lineno"> 4604</span>                  <span class="keywordflow">DO</span> k = 1,num_road_layers</div>
<div class="line"><a id="l04605" name="l04605"></a><span class="lineno"> 4605</span>                    tgl_urb3d(i,k,j) = tgl_urb(k)</div>
<div class="line"><a id="l04606" name="l04606"></a><span class="lineno"> 4606</span><span class="keywordflow">                  END DO</span></div>
<div class="line"><a id="l04607" name="l04607"></a><span class="lineno"> 4607</span>                 </div>
<div class="line"><a id="l04608" name="l04608"></a><span class="lineno"> 4608</span>                  tgr_urb2d(i,j) =tgr_urb </div>
<div class="line"><a id="l04609" name="l04609"></a><span class="lineno"> 4609</span>                  cmcr_urb2d(i,j)=cmcr_urb</div>
<div class="line"><a id="l04610" name="l04610"></a><span class="lineno"> 4610</span>                  flxhumr_urb2d(i,j)=flxhumr_urb </div>
<div class="line"><a id="l04611" name="l04611"></a><span class="lineno"> 4611</span>                  flxhumb_urb2d(i,j)=flxhumb_urb</div>
<div class="line"><a id="l04612" name="l04612"></a><span class="lineno"> 4612</span>                  flxhumg_urb2d(i,j)=flxhumg_urb</div>
<div class="line"><a id="l04613" name="l04613"></a><span class="lineno"> 4613</span>                  drelr_urb2d(i,j) = drelr_urb </div>
<div class="line"><a id="l04614" name="l04614"></a><span class="lineno"> 4614</span>                  drelb_urb2d(i,j) = drelb_urb </div>
<div class="line"><a id="l04615" name="l04615"></a><span class="lineno"> 4615</span>                  drelg_urb2d(i,j) = drelg_urb</div>
<div class="line"><a id="l04616" name="l04616"></a><span class="lineno"> 4616</span> </div>
<div class="line"><a id="l04617" name="l04617"></a><span class="lineno"> 4617</span>                  xxxr_urb2d(i,j) = xxxr_urb</div>
<div class="line"><a id="l04618" name="l04618"></a><span class="lineno"> 4618</span>                  xxxb_urb2d(i,j) = xxxb_urb</div>
<div class="line"><a id="l04619" name="l04619"></a><span class="lineno"> 4619</span>                  xxxg_urb2d(i,j) = xxxg_urb</div>
<div class="line"><a id="l04620" name="l04620"></a><span class="lineno"> 4620</span>                  xxxc_urb2d(i,j) = xxxc_urb</div>
<div class="line"><a id="l04621" name="l04621"></a><span class="lineno"> 4621</span>      </div>
<div class="line"><a id="l04622" name="l04622"></a><span class="lineno"> 4622</span>                  sh_urb2d(i,j)    = sh_urb</div>
<div class="line"><a id="l04623" name="l04623"></a><span class="lineno"> 4623</span>                  lh_urb2d(i,j)    = lh_urb</div>
<div class="line"><a id="l04624" name="l04624"></a><span class="lineno"> 4624</span>                  g_urb2d(i,j)     = g_urb</div>
<div class="line"><a id="l04625" name="l04625"></a><span class="lineno"> 4625</span>                  rn_urb2d(i,j)    = rn_urb</div>
<div class="line"><a id="l04626" name="l04626"></a><span class="lineno"> 4626</span>                  psim_urb2d(i,j)  = psim_urb</div>
<div class="line"><a id="l04627" name="l04627"></a><span class="lineno"> 4627</span>                  psih_urb2d(i,j)  = psih_urb</div>
<div class="line"><a id="l04628" name="l04628"></a><span class="lineno"> 4628</span>                  gz1oz0_urb2d(i,j)= gz1oz0_urb</div>
<div class="line"><a id="l04629" name="l04629"></a><span class="lineno"> 4629</span>                  u10_urb2d(i,j)   = u10_urb</div>
<div class="line"><a id="l04630" name="l04630"></a><span class="lineno"> 4630</span>                  v10_urb2d(i,j)   = v10_urb</div>
<div class="line"><a id="l04631" name="l04631"></a><span class="lineno"> 4631</span>                  th2_urb2d(i,j)   = th2_urb</div>
<div class="line"><a id="l04632" name="l04632"></a><span class="lineno"> 4632</span>                  q2_urb2d(i,j)    = q2_urb</div>
<div class="line"><a id="l04633" name="l04633"></a><span class="lineno"> 4633</span>                  ust_urb2d(i,j)   = ust_urb</div>
<div class="line"><a id="l04634" name="l04634"></a><span class="lineno"> 4634</span>                  akms_urb2d(i,j)  = karman * ust_urb2d(i,j)/(gz1oz0_urb2d(i,j)-psim_urb2d(i,j))</div>
<div class="line"><a id="l04635" name="l04635"></a><span class="lineno"> 4635</span>                  <span class="keywordflow">IF</span> (<span class="keyword">PRESENT</span>(cmr_sfcdif)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04636" name="l04636"></a><span class="lineno"> 4636</span>                     cmr_sfcdif(i,j) = cmr_urb</div>
<div class="line"><a id="l04637" name="l04637"></a><span class="lineno"> 4637</span>                     chr_sfcdif(i,j) = chr_urb</div>
<div class="line"><a id="l04638" name="l04638"></a><span class="lineno"> 4638</span>                     cmgr_sfcdif(i,j) = cmgr_urb</div>
<div class="line"><a id="l04639" name="l04639"></a><span class="lineno"> 4639</span>                     chgr_sfcdif(i,j) = chgr_urb</div>
<div class="line"><a id="l04640" name="l04640"></a><span class="lineno"> 4640</span>                     cmc_sfcdif(i,j) = cmc_urb</div>
<div class="line"><a id="l04641" name="l04641"></a><span class="lineno"> 4641</span>                     chc_sfcdif(i,j) = chc_urb</div>
<div class="line"><a id="l04642" name="l04642"></a><span class="lineno"> 4642</span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a id="l04643" name="l04643"></a><span class="lineno"> 4643</span><span class="keywordflow">                END IF</span></div>
<div class="line"><a id="l04644" name="l04644"></a><span class="lineno"> 4644</span>      </div>
<div class="line"><a id="l04645" name="l04645"></a><span class="lineno"> 4645</span><span class="keywordflow">               ENDIF</span>                                   <span class="comment">! end of UCM CALL if block</span></div>
<div class="line"><a id="l04646" name="l04646"></a><span class="lineno"> 4646</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l04647" name="l04647"></a><span class="lineno"> 4647</span>      <span class="comment">! Urban Part End - urban</span></div>
<div class="line"><a id="l04648" name="l04648"></a><span class="lineno"> 4648</span>      <span class="comment">!--------------------------------------</span></div>
<div class="line"><a id="l04649" name="l04649"></a><span class="lineno"> 4649</span>      </div>
<div class="line"><a id="l04650" name="l04650"></a><span class="lineno"> 4650</span>      <span class="comment">!***  DIAGNOSTICS</span></div>
<div class="line"><a id="l04651" name="l04651"></a><span class="lineno"> 4651</span>                smstav(i,j)=soilw</div>
<div class="line"><a id="l04652" name="l04652"></a><span class="lineno"> 4652</span>                smstot(i,j)=soilm*1000.</div>
<div class="line"><a id="l04653" name="l04653"></a><span class="lineno"> 4653</span>                <span class="keywordflow">DO</span> ns=1,nsoil</div>
<div class="line"><a id="l04654" name="l04654"></a><span class="lineno"> 4654</span>                smcrel(i,ns,j)=smav(ns)</div>
<div class="line"><a id="l04655" name="l04655"></a><span class="lineno"> 4655</span><span class="keywordflow">                ENDDO</span></div>
<div class="line"><a id="l04656" name="l04656"></a><span class="lineno"> 4656</span>      </div>
<div class="line"><a id="l04657" name="l04657"></a><span class="lineno"> 4657</span>      <span class="comment">!         Convert the water unit into mm</span></div>
<div class="line"><a id="l04658" name="l04658"></a><span class="lineno"> 4658</span>                sfcrunoff(i,j)=sfcrunoff(i,j)+runoff1*dt*1000.0</div>
<div class="line"><a id="l04659" name="l04659"></a><span class="lineno"> 4659</span>                udrunoff(i,j)=udrunoff(i,j)+runoff2*dt*1000.0</div>
<div class="line"><a id="l04660" name="l04660"></a><span class="lineno"> 4660</span>      <span class="comment">! snow defined when fraction of frozen precip (FFROZP) &gt; 0.5,</span></div>
<div class="line"><a id="l04661" name="l04661"></a><span class="lineno"> 4661</span>                <span class="keywordflow">IF</span>(ffrozp.GT.0.5)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04662" name="l04662"></a><span class="lineno"> 4662</span>                  acsnow(i,j)=acsnow(i,j)+prcp*dt</div>
<div class="line"><a id="l04663" name="l04663"></a><span class="lineno"> 4663</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04664" name="l04664"></a><span class="lineno"> 4664</span>                <span class="keywordflow">IF</span>(snow(i,j).GT.0.)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04665" name="l04665"></a><span class="lineno"> 4665</span>                  acsnom(i,j)=acsnom(i,j)+snomlt*1000.</div>
<div class="line"><a id="l04666" name="l04666"></a><span class="lineno"> 4666</span>      <span class="comment">! accumulated snow-melt energy</span></div>
<div class="line"><a id="l04667" name="l04667"></a><span class="lineno"> 4667</span>                  snopcx(i,j)=snopcx(i,j)-snomlt/fdtliw</div>
<div class="line"><a id="l04668" name="l04668"></a><span class="lineno"> 4668</span><span class="keywordflow">                ENDIF</span></div>
<div class="line"><a id="l04669" name="l04669"></a><span class="lineno"> 4669</span>      </div>
<div class="line"><a id="l04670" name="l04670"></a><span class="lineno"> 4670</span><span class="keywordflow">              ENDIF</span>                                                           <span class="comment">! endif of land-sea test</span></div>
<div class="line"><a id="l04671" name="l04671"></a><span class="lineno"> 4671</span> </div>
<div class="line"><a id="l04672" name="l04672"></a><span class="lineno"> 4672</span><span class="keywordflow">      ENDIF</span>                                           <span class="comment">! ENDIF FOR MOSAIC DANLI  ! This corresponds to IF ((sf_surface_mosaic == 1) .AND. ((XLAND(I,J)-1.5).LT.0.) .AND. (XICE(I,J) &lt; XICE_THRESHOLD) ) THEN</span></div>
<div class="line"><a id="l04673" name="l04673"></a><span class="lineno"> 4673</span> </div>
<div class="line"><a id="l04674" name="l04674"></a><span class="lineno"> 4674</span><span class="keywordflow">      ENDDO</span> iloop                                                       <span class="comment">! of I loop</span></div>
<div class="line"><a id="l04675" name="l04675"></a><span class="lineno"> 4675</span><span class="keywordflow">   ENDDO</span> jloop                                                          <span class="comment">! of J loop   </span></div>
<div class="line"><a id="l04676" name="l04676"></a><span class="lineno"> 4676</span>       </div>
<div class="line"><a id="l04677" name="l04677"></a><span class="lineno"> 4677</span><span class="comment">!------------------------------------------------------</span></div>
<div class="line"><a id="l04678" name="l04678"></a><span class="lineno"> 4678</span>   <span class="keyword">END SUBROUTINE </span><a class="code hl_function" href="namespacemodule__sf__noahdrv.html#abb5d9a7134268d50cc5cca58ecd9b0ea">lsm_mosaic</a></div>
<div class="line"><a id="l04679" name="l04679"></a><span class="lineno"> 4679</span><span class="comment">!------------------------------------------------------</span></div>
<div class="line"><a id="l04680" name="l04680"></a><span class="lineno"> 4680</span><span class="comment">!===========================================================================</span></div>
<div class="line"><a id="l04681" name="l04681"></a><span class="lineno"> 4681</span><span class="comment">!</span></div>
<div class="line"><a id="l04682" name="l04682"></a><span class="lineno"> 4682</span><span class="comment">! subroutine lsm_mosaic_init: initialization of mosaic state variables</span></div>
<div class="line"><a id="l04683" name="l04683"></a><span class="lineno"> 4683</span><span class="comment">!</span></div>
<div class="line"><a id="l04684" name="l04684"></a><span class="lineno"> 4684</span><span class="comment">!===========================================================================   </span></div>
<div class="line"><a id="l04685" name="l04685"></a><span class="lineno"> 4685</span>  </div>
<div class="line"><a id="l04686" name="l04686"></a><span class="lineno"><a class="line" href="namespacemodule__sf__noahdrv.html#a2391e63d2b4c5f0af015817d4034b152"> 4686</a></span>   <span class="keyword">SUBROUTINE </span><a class="code hl_function" href="namespacemodule__sf__noahdrv.html#a2391e63d2b4c5f0af015817d4034b152">lsm_mosaic_init</a>(IVGTYP,ISWATER,ISURBAN,ISICE, XLAND, XICE,fractional_seaice, &amp;</div>
<div class="line"><a id="l04687" name="l04687"></a><span class="lineno"> 4687</span>                  TSK,TSLB,SMOIS,SH2O,SNOW,SNOWC,SNOWH,CANWAT,    &amp;</div>
<div class="line"><a id="l04688" name="l04688"></a><span class="lineno"> 4688</span>                  ids,ide, jds,jde, kds,kde,                      &amp;</div>
<div class="line"><a id="l04689" name="l04689"></a><span class="lineno"> 4689</span>                  ims,ime, jms,jme, kms,kme,                      &amp;</div>
<div class="line"><a id="l04690" name="l04690"></a><span class="lineno"> 4690</span>                  its,ite, jts,jte, kts,kte, restart,             &amp;</div>
<div class="line"><a id="l04691" name="l04691"></a><span class="lineno"> 4691</span>                  landusef,landusef2,NLCAT,num_soil_layers        &amp; </div>
<div class="line"><a id="l04692" name="l04692"></a><span class="lineno"> 4692</span>                  ,sf_surface_mosaic, mosaic_cat                  &amp; </div>
<div class="line"><a id="l04693" name="l04693"></a><span class="lineno"> 4693</span>                  ,mosaic_cat_index                               &amp;   </div>
<div class="line"><a id="l04694" name="l04694"></a><span class="lineno"> 4694</span>                  ,TSK_mosaic,TSLB_mosaic                         &amp;</div>
<div class="line"><a id="l04695" name="l04695"></a><span class="lineno"> 4695</span>                  ,SMOIS_mosaic,SH2O_mosaic                       &amp; </div>
<div class="line"><a id="l04696" name="l04696"></a><span class="lineno"> 4696</span>                  ,CANWAT_mosaic,SNOW_mosaic                      &amp;</div>
<div class="line"><a id="l04697" name="l04697"></a><span class="lineno"> 4697</span>                  ,SNOWH_mosaic,SNOWC_mosaic                      &amp;</div>
<div class="line"><a id="l04698" name="l04698"></a><span class="lineno"> 4698</span>                  ,ALBEDO,ALBBCK, EMISS, EMBCK,Z0                 &amp;  !danli  </div>
<div class="line"><a id="l04699" name="l04699"></a><span class="lineno"> 4699</span>                  ,ALBEDO_mosaic,ALBBCK_mosaic, EMISS_mosaic      &amp;  !danli</div>
<div class="line"><a id="l04700" name="l04700"></a><span class="lineno"> 4700</span>                  ,EMBCK_mosaic, ZNT_mosaic, Z0_mosaic            &amp;  !danli</div>
<div class="line"><a id="l04701" name="l04701"></a><span class="lineno"> 4701</span>                  ,TR_URB2D_mosaic,TB_URB2D_mosaic                &amp;  !danli mosaic </div>
<div class="line"><a id="l04702" name="l04702"></a><span class="lineno"> 4702</span>                  ,TG_URB2D_mosaic,TC_URB2D_mosaic                &amp;  !danli mosaic </div>
<div class="line"><a id="l04703" name="l04703"></a><span class="lineno"> 4703</span>                  ,QC_URB2D_mosaic                                &amp;  !danli mosaic                  </div>
<div class="line"><a id="l04704" name="l04704"></a><span class="lineno"> 4704</span>                  ,TRL_URB3D_mosaic,TBL_URB3D_mosaic              &amp;  !danli mosaic </div>
<div class="line"><a id="l04705" name="l04705"></a><span class="lineno"> 4705</span>                  ,TGL_URB3D_mosaic                               &amp;  !danli mosaic </div>
<div class="line"><a id="l04706" name="l04706"></a><span class="lineno"> 4706</span>                  ,SH_URB2D_mosaic,LH_URB2D_mosaic                &amp;  !danli mosaic </div>
<div class="line"><a id="l04707" name="l04707"></a><span class="lineno"> 4707</span>                  ,G_URB2D_mosaic,RN_URB2D_mosaic                 &amp;  !danli mosaic </div>
<div class="line"><a id="l04708" name="l04708"></a><span class="lineno"> 4708</span>                  ,TS_URB2D_mosaic                                &amp;  !danli mosaic </div>
<div class="line"><a id="l04709" name="l04709"></a><span class="lineno"> 4709</span>                  ,TS_RUL2D_mosaic                                &amp;  !danli mosaic                    </div>
<div class="line"><a id="l04710" name="l04710"></a><span class="lineno"> 4710</span>                   ) </div>
<div class="line"><a id="l04711" name="l04711"></a><span class="lineno"> 4711</span>  </div>
<div class="line"><a id="l04712" name="l04712"></a><span class="lineno"> 4712</span>    <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN)</span>   ::       ids,ide, jds,jde, kds,kde,  &amp;</div>
<div class="line"><a id="l04713" name="l04713"></a><span class="lineno"> 4713</span>                                    ims,ime, jms,jme, kms,kme,  &amp;</div>
<div class="line"><a id="l04714" name="l04714"></a><span class="lineno"> 4714</span>                                    its,ite, jts,jte, kts,kte </div>
<div class="line"><a id="l04715" name="l04715"></a><span class="lineno"> 4715</span> </div>
<div class="line"><a id="l04716" name="l04716"></a><span class="lineno"> 4716</span>   <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>       ::     NLCAT, num_soil_layers, ISWATER,ISURBAN, ISICE, fractional_seaice</div>
<div class="line"><a id="l04717" name="l04717"></a><span class="lineno"> 4717</span> </div>
<div class="line"><a id="l04718" name="l04718"></a><span class="lineno"> 4718</span>   <span class="keywordtype">LOGICAL</span> , <span class="keywordtype">INTENT(IN)</span> :: restart </div>
<div class="line"><a id="l04719" name="l04719"></a><span class="lineno"> 4719</span> </div>
<div class="line"><a id="l04720" name="l04720"></a><span class="lineno"> 4720</span><span class="comment">!   REAL,    DIMENSION( num_soil_layers), INTENT(INOUT) :: ZS, DZS</span></div>
<div class="line"><a id="l04721" name="l04721"></a><span class="lineno"> 4721</span> </div>
<div class="line"><a id="l04722" name="l04722"></a><span class="lineno"> 4722</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, num_soil_layers, jms:jme )</span>    , &amp;</div>
<div class="line"><a id="l04723" name="l04723"></a><span class="lineno"> 4723</span>            <span class="keywordtype">INTENT(IN)</span>    ::                             SMOIS, &amp;  <span class="comment">!Total soil moisture</span></div>
<div class="line"><a id="l04724" name="l04724"></a><span class="lineno"> 4724</span>                                                         SH2O,  &amp;  <span class="comment">!liquid soil moisture       </span></div>
<div class="line"><a id="l04725" name="l04725"></a><span class="lineno"> 4725</span>                                                         TSLB      <span class="comment">!STEMP</span></div>
<div class="line"><a id="l04726" name="l04726"></a><span class="lineno"> 4726</span> </div>
<div class="line"><a id="l04727" name="l04727"></a><span class="lineno"> 4727</span><span class="keywordtype">   REAL</span>,    <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>                     , &amp;</div>
<div class="line"><a id="l04728" name="l04728"></a><span class="lineno"> 4728</span>            <span class="keywordtype">INTENT(IN)</span>    ::                           SNOW, &amp;</div>
<div class="line"><a id="l04729" name="l04729"></a><span class="lineno"> 4729</span>                                                         SNOWH, &amp;</div>
<div class="line"><a id="l04730" name="l04730"></a><span class="lineno"> 4730</span>                                                         SNOWC, &amp;</div>
<div class="line"><a id="l04731" name="l04731"></a><span class="lineno"> 4731</span>                                                        CANWAT, &amp;</div>
<div class="line"><a id="l04732" name="l04732"></a><span class="lineno"> 4732</span>                                                        TSK, XICE, XLAND         </div>
<div class="line"><a id="l04733" name="l04733"></a><span class="lineno"> 4733</span>  </div>
<div class="line"><a id="l04734" name="l04734"></a><span class="lineno"> 4734</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: sf_surface_mosaic  </div>
<div class="line"><a id="l04735" name="l04735"></a><span class="lineno"> 4735</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: mosaic_cat</div>
<div class="line"><a id="l04736" name="l04736"></a><span class="lineno"> 4736</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span>,<span class="keywordtype">INTENT(IN)</span> :: IVGTYP</div>
<div class="line"><a id="l04737" name="l04737"></a><span class="lineno"> 4737</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, NLCAT, jms:jme )</span> , <span class="keywordtype">INTENT(IN)</span>::   LANDUSEF</div>
<div class="line"><a id="l04738" name="l04738"></a><span class="lineno"> 4738</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, NLCAT, jms:jme )</span> , <span class="keywordtype">INTENT(INOUT)</span>::   LANDUSEF2</div>
<div class="line"><a id="l04739" name="l04739"></a><span class="lineno"> 4739</span>  </div>
<div class="line"><a id="l04740" name="l04740"></a><span class="lineno"> 4740</span>  <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION( ims:ime, NLCAT, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: mosaic_cat_index </div>
<div class="line"><a id="l04741" name="l04741"></a><span class="lineno"> 4741</span> </div>
<div class="line"><a id="l04742" name="l04742"></a><span class="lineno"> 4742</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span> , <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l04743" name="l04743"></a><span class="lineno"> 4743</span>        TSK_mosaic, CANWAT_mosaic, SNOW_mosaic,SNOWH_mosaic, SNOWC_mosaic </div>
<div class="line"><a id="l04744" name="l04744"></a><span class="lineno"> 4744</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_soil_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l04745" name="l04745"></a><span class="lineno"> 4745</span>        TSLB_mosaic,SMOIS_mosaic,SH2O_mosaic</div>
<div class="line"><a id="l04746" name="l04746"></a><span class="lineno"> 4746</span>  </div>
<div class="line"><a id="l04747" name="l04747"></a><span class="lineno"> 4747</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, jms:jme )</span> , <span class="keywordtype">INTENT(IN)</span>::   ALBEDO, ALBBCK, EMISS, EMBCK, Z0 </div>
<div class="line"><a id="l04748" name="l04748"></a><span class="lineno"> 4748</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span> , <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l04749" name="l04749"></a><span class="lineno"> 4749</span>        ALBEDO_mosaic,ALBBCK_mosaic, EMISS_mosaic, EMBCK_mosaic, ZNT_mosaic, Z0_mosaic</div>
<div class="line"><a id="l04750" name="l04750"></a><span class="lineno"> 4750</span> </div>
<div class="line"><a id="l04751" name="l04751"></a><span class="lineno"> 4751</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:mosaic_cat, jms:jme )</span> , <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">INTENT(INOUT)</span>::   &amp;</div>
<div class="line"><a id="l04752" name="l04752"></a><span class="lineno"> 4752</span>        TR_URB2D_mosaic, TB_URB2D_mosaic, TG_URB2D_mosaic, TC_URB2D_mosaic,QC_URB2D_mosaic,  &amp;</div>
<div class="line"><a id="l04753" name="l04753"></a><span class="lineno"> 4753</span>        SH_URB2D_mosaic,LH_URB2D_mosaic,G_URB2D_mosaic,RN_URB2D_mosaic,TS_URB2D_mosaic, TS_RUL2D_mosaic  </div>
<div class="line"><a id="l04754" name="l04754"></a><span class="lineno"> 4754</span>                    </div>
<div class="line"><a id="l04755" name="l04755"></a><span class="lineno"> 4755</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_soil_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TRL_URB3D_mosaic</div>
<div class="line"><a id="l04756" name="l04756"></a><span class="lineno"> 4756</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_soil_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TBL_URB3D_mosaic</div>
<div class="line"><a id="l04757" name="l04757"></a><span class="lineno"> 4757</span><span class="keywordtype">  REAL</span>, <span class="keywordtype">OPTIONAL</span>, <span class="keywordtype">DIMENSION( ims:ime, 1:num_soil_layers*mosaic_cat, jms:jme )</span>, <span class="keywordtype">INTENT(INOUT)</span> :: TGL_URB3D_mosaic    </div>
<div class="line"><a id="l04758" name="l04758"></a><span class="lineno"> 4758</span> </div>
<div class="line"><a id="l04759" name="l04759"></a><span class="lineno"> 4759</span>  <span class="keywordtype">INTEGER</span> :: ij,i,j,mosaic_i,LastSwap,NumPairs,soil_k, Temp2,Temp5,Temp7, ICE,temp_index</div>
<div class="line"><a id="l04760" name="l04760"></a><span class="lineno"> 4760</span><span class="keywordtype">  REAL</span> :: Temp, Temp3,Temp4,Temp6,xice_threshold</div>
<div class="line"><a id="l04761" name="l04761"></a><span class="lineno"> 4761</span>  <span class="keywordtype">LOGICAL</span> :: IPRINT</div>
<div class="line"><a id="l04762" name="l04762"></a><span class="lineno"> 4762</span>  <span class="keywordtype">CHARACTER(len=256)</span> :: message_text</div>
<div class="line"><a id="l04763" name="l04763"></a><span class="lineno"> 4763</span> </div>
<div class="line"><a id="l04764" name="l04764"></a><span class="lineno"> 4764</span>  iprint=.false.</div>
<div class="line"><a id="l04765" name="l04765"></a><span class="lineno"> 4765</span> </div>
<div class="line"><a id="l04766" name="l04766"></a><span class="lineno"> 4766</span>  <span class="keywordflow">if</span> ( fractional_seaice == 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04767" name="l04767"></a><span class="lineno"> 4767</span>     xice_threshold = 0.5</div>
<div class="line"><a id="l04768" name="l04768"></a><span class="lineno"> 4768</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fractional_seaice == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04769" name="l04769"></a><span class="lineno"> 4769</span>     xice_threshold = 0.02</div>
<div class="line"><a id="l04770" name="l04770"></a><span class="lineno"> 4770</span><span class="keywordflow">  endif</span></div>
<div class="line"><a id="l04771" name="l04771"></a><span class="lineno"> 4771</span> </div>
<div class="line"><a id="l04772" name="l04772"></a><span class="lineno"> 4772</span>    <span class="keywordflow">IF</span>(.not.restart)<span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04773" name="l04773"></a><span class="lineno"> 4773</span>  <span class="comment">!===========================================================================   </span></div>
<div class="line"><a id="l04774" name="l04774"></a><span class="lineno"> 4774</span>  <span class="comment">! CHOOSE THE TILES</span></div>
<div class="line"><a id="l04775" name="l04775"></a><span class="lineno"> 4775</span>  <span class="comment">!===========================================================================  </span></div>
<div class="line"><a id="l04776" name="l04776"></a><span class="lineno"> 4776</span>  </div>
<div class="line"><a id="l04777" name="l04777"></a><span class="lineno"> 4777</span>  itf=min0(ite,ide-1)</div>
<div class="line"><a id="l04778" name="l04778"></a><span class="lineno"> 4778</span>  jtf=min0(jte,jde-1)</div>
<div class="line"><a id="l04779" name="l04779"></a><span class="lineno"> 4779</span> </div>
<div class="line"><a id="l04780" name="l04780"></a><span class="lineno"> 4780</span>  <span class="comment">! simple test</span></div>
<div class="line"><a id="l04781" name="l04781"></a><span class="lineno"> 4781</span>   </div>
<div class="line"><a id="l04782" name="l04782"></a><span class="lineno"> 4782</span>  <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l04783" name="l04783"></a><span class="lineno"> 4783</span>     <span class="keywordflow">DO</span> j = jts,jtf </div>
<div class="line"><a id="l04784" name="l04784"></a><span class="lineno"> 4784</span>        <span class="keywordflow">IF</span> ((xland(i,j).LT. 1.5 ) .AND. (ivgtyp(i,j) .EQ. iswater)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04785" name="l04785"></a><span class="lineno"> 4785</span>           print*, <span class="stringliteral">&#39;BEFORE MOSAIC_INIT&#39;</span></div>
<div class="line"><a id="l04786" name="l04786"></a><span class="lineno"> 4786</span>           <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;BEFORE MOSAIC_INIT&quot;</span>)</div>
<div class="line"><a id="l04787" name="l04787"></a><span class="lineno"> 4787</span>           <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,2I6,2F8.2,2I6)&#39;</span>) <span class="stringliteral">&#39;I,J,xland,xice,mosaic_cat_index,ivgtyp = &#39;</span>, &amp;</div>
<div class="line"><a id="l04788" name="l04788"></a><span class="lineno"> 4788</span>                 i,j,xland(i,j),xice(i,j),mosaic_cat_index(i,1,j),ivgtyp(i,j)</div>
<div class="line"><a id="l04789" name="l04789"></a><span class="lineno"> 4789</span>           <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04790" name="l04790"></a><span class="lineno"> 4790</span><span class="keywordflow">        ENDIF</span></div>
<div class="line"><a id="l04791" name="l04791"></a><span class="lineno"> 4791</span><span class="keywordflow">     ENDDO</span></div>
<div class="line"><a id="l04792" name="l04792"></a><span class="lineno"> 4792</span><span class="keywordflow">  ENDDO</span></div>
<div class="line"><a id="l04793" name="l04793"></a><span class="lineno"> 4793</span> </div>
<div class="line"><a id="l04794" name="l04794"></a><span class="lineno"> 4794</span>     <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l04795" name="l04795"></a><span class="lineno"> 4795</span>        <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l04796" name="l04796"></a><span class="lineno"> 4796</span>           <span class="keywordflow">DO</span> mosaic_i=1,nlcat</div>
<div class="line"><a id="l04797" name="l04797"></a><span class="lineno"> 4797</span>              landusef2(i,mosaic_i,j)=landusef(i,mosaic_i,j)</div>
<div class="line"><a id="l04798" name="l04798"></a><span class="lineno"> 4798</span>              mosaic_cat_index(i,mosaic_i,j)=mosaic_i</div>
<div class="line"><a id="l04799" name="l04799"></a><span class="lineno"> 4799</span><span class="keywordflow">           ENDDO</span></div>
<div class="line"><a id="l04800" name="l04800"></a><span class="lineno"> 4800</span><span class="keywordflow">        ENDDO</span></div>
<div class="line"><a id="l04801" name="l04801"></a><span class="lineno"> 4801</span><span class="keywordflow">     ENDDO</span></div>
<div class="line"><a id="l04802" name="l04802"></a><span class="lineno"> 4802</span> </div>
<div class="line"><a id="l04803" name="l04803"></a><span class="lineno"> 4803</span>     <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l04804" name="l04804"></a><span class="lineno"> 4804</span>        <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l04805" name="l04805"></a><span class="lineno"> 4805</span>          </div>
<div class="line"><a id="l04806" name="l04806"></a><span class="lineno"> 4806</span>          numpairs=nlcat-1</div>
<div class="line"><a id="l04807" name="l04807"></a><span class="lineno"> 4807</span>          </div>
<div class="line"><a id="l04808" name="l04808"></a><span class="lineno"> 4808</span>          <span class="keywordflow">DO</span> </div>
<div class="line"><a id="l04809" name="l04809"></a><span class="lineno"> 4809</span>               <span class="keywordflow">IF</span> (numpairs == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a id="l04810" name="l04810"></a><span class="lineno"> 4810</span>                   lastswap = 1</div>
<div class="line"><a id="l04811" name="l04811"></a><span class="lineno"> 4811</span>          <span class="keywordflow">DO</span>  mosaic_i=1, numpairs</div>
<div class="line"><a id="l04812" name="l04812"></a><span class="lineno"> 4812</span>            <span class="keywordflow">IF</span>(landusef2(i,mosaic_i, j) &lt; landusef2(i,mosaic_i+1, j)  ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04813" name="l04813"></a><span class="lineno"> 4813</span>               temp = landusef2(i,mosaic_i, j)</div>
<div class="line"><a id="l04814" name="l04814"></a><span class="lineno"> 4814</span>               landusef2(i,mosaic_i, j)=landusef2(i,mosaic_i+1, j)</div>
<div class="line"><a id="l04815" name="l04815"></a><span class="lineno"> 4815</span>               landusef2(i,mosaic_i+1, j)=temp            </div>
<div class="line"><a id="l04816" name="l04816"></a><span class="lineno"> 4816</span>               lastswap = mosaic_i </div>
<div class="line"><a id="l04817" name="l04817"></a><span class="lineno"> 4817</span>            </div>
<div class="line"><a id="l04818" name="l04818"></a><span class="lineno"> 4818</span>               temp2 =  mosaic_cat_index(i,mosaic_i,j)</div>
<div class="line"><a id="l04819" name="l04819"></a><span class="lineno"> 4819</span>               mosaic_cat_index(i,mosaic_i,j)=mosaic_cat_index(i,mosaic_i+1,j)</div>
<div class="line"><a id="l04820" name="l04820"></a><span class="lineno"> 4820</span>               mosaic_cat_index(i,mosaic_i+1,j)=temp2</div>
<div class="line"><a id="l04821" name="l04821"></a><span class="lineno"> 4821</span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a id="l04822" name="l04822"></a><span class="lineno"> 4822</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l04823" name="l04823"></a><span class="lineno"> 4823</span>               numpairs = lastswap - 1</div>
<div class="line"><a id="l04824" name="l04824"></a><span class="lineno"> 4824</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l04825" name="l04825"></a><span class="lineno"> 4825</span>          </div>
<div class="line"><a id="l04826" name="l04826"></a><span class="lineno"> 4826</span><span class="keywordflow">        ENDDO</span></div>
<div class="line"><a id="l04827" name="l04827"></a><span class="lineno"> 4827</span><span class="keywordflow">      ENDDO</span></div>
<div class="line"><a id="l04828" name="l04828"></a><span class="lineno"> 4828</span> </div>
<div class="line"><a id="l04829" name="l04829"></a><span class="lineno"> 4829</span>  <span class="comment">!===========================================================================   </span></div>
<div class="line"><a id="l04830" name="l04830"></a><span class="lineno"> 4830</span>  <span class="comment">! For non-seaice grids, eliminate the seaice-tiles</span></div>
<div class="line"><a id="l04831" name="l04831"></a><span class="lineno"> 4831</span>  <span class="comment">!=========================================================================== </span></div>
<div class="line"><a id="l04832" name="l04832"></a><span class="lineno"> 4832</span> </div>
<div class="line"><a id="l04833" name="l04833"></a><span class="lineno"> 4833</span>     <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l04834" name="l04834"></a><span class="lineno"> 4834</span>        <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l04835" name="l04835"></a><span class="lineno"> 4835</span>        </div>
<div class="line"><a id="l04836" name="l04836"></a><span class="lineno"> 4836</span>         <span class="keywordflow">IF</span>   (xland(i,j).LT.1.5)  <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04837" name="l04837"></a><span class="lineno"> 4837</span> </div>
<div class="line"><a id="l04838" name="l04838"></a><span class="lineno"> 4838</span>             ice = 0</div>
<div class="line"><a id="l04839" name="l04839"></a><span class="lineno"> 4839</span>                 <span class="keywordflow">IF</span>( xice(i,j).GE. xice_threshold ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04840" name="l04840"></a><span class="lineno"> 4840</span>                   <span class="keyword">WRITE</span> (message_text,fmt=<span class="stringliteral">&#39;(a,2I5)&#39;</span>) <span class="stringliteral">&#39;sea-ice at point, I and J = &#39;</span>, i,j</div>
<div class="line"><a id="l04841" name="l04841"></a><span class="lineno"> 4841</span>                   <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04842" name="l04842"></a><span class="lineno"> 4842</span>                 ice = 1</div>
<div class="line"><a id="l04843" name="l04843"></a><span class="lineno"> 4843</span><span class="keywordflow">                 ENDIF</span>   </div>
<div class="line"><a id="l04844" name="l04844"></a><span class="lineno"> 4844</span>           </div>
<div class="line"><a id="l04845" name="l04845"></a><span class="lineno"> 4845</span>          <span class="keywordflow">IF</span> (ice == 1)   <span class="keywordflow">Then</span>         <span class="comment">! sea-ice case , eliminate sea-ice if they are not the dominant ones</span></div>
<div class="line"><a id="l04846" name="l04846"></a><span class="lineno"> 4846</span> </div>
<div class="line"><a id="l04847" name="l04847"></a><span class="lineno"> 4847</span>          <span class="keywordflow">IF</span> (ivgtyp(i,j) == isice)  <span class="keywordflow">THEN</span>    <span class="comment">! if this grid cell is dominanted by ice, then do nothing</span></div>
<div class="line"><a id="l04848" name="l04848"></a><span class="lineno"> 4848</span> </div>
<div class="line"><a id="l04849" name="l04849"></a><span class="lineno"> 4849</span>          <span class="keywordflow">ELSE</span></div>
<div class="line"><a id="l04850" name="l04850"></a><span class="lineno"> 4850</span> </div>
<div class="line"><a id="l04851" name="l04851"></a><span class="lineno"> 4851</span>                <span class="keywordflow">DO</span> mosaic_i=2,mosaic_cat</div>
<div class="line"><a id="l04852" name="l04852"></a><span class="lineno"> 4852</span>                   <span class="keywordflow">IF</span> (mosaic_cat_index(i,mosaic_i,j) == isice ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04853" name="l04853"></a><span class="lineno"> 4853</span>                       temp4=landusef2(i,mosaic_i,j)</div>
<div class="line"><a id="l04854" name="l04854"></a><span class="lineno"> 4854</span>                       temp5=mosaic_cat_index(i,mosaic_i,j)</div>
<div class="line"><a id="l04855" name="l04855"></a><span class="lineno"> 4855</span> </div>
<div class="line"><a id="l04856" name="l04856"></a><span class="lineno"> 4856</span>                       landusef2(i,mosaic_i:nlcat-1,j)=landusef2(i,mosaic_i+1:nlcat,j)                       </div>
<div class="line"><a id="l04857" name="l04857"></a><span class="lineno"> 4857</span>                       mosaic_cat_index(i,mosaic_i:nlcat-1,j)=mosaic_cat_index(i,mosaic_i+1:nlcat,j)</div>
<div class="line"><a id="l04858" name="l04858"></a><span class="lineno"> 4858</span> </div>
<div class="line"><a id="l04859" name="l04859"></a><span class="lineno"> 4859</span>                       landusef2(i,nlcat,j)=temp4</div>
<div class="line"><a id="l04860" name="l04860"></a><span class="lineno"> 4860</span>                       mosaic_cat_index(i,nlcat,j)=temp5</div>
<div class="line"><a id="l04861" name="l04861"></a><span class="lineno"> 4861</span><span class="keywordflow">                   ENDIF</span> </div>
<div class="line"><a id="l04862" name="l04862"></a><span class="lineno"> 4862</span><span class="keywordflow">                 ENDDO</span></div>
<div class="line"><a id="l04863" name="l04863"></a><span class="lineno"> 4863</span> </div>
<div class="line"><a id="l04864" name="l04864"></a><span class="lineno"> 4864</span><span class="keywordflow">          ENDIF</span>   <span class="comment">! for (IVGTYP(i,j) == isice )</span></div>
<div class="line"><a id="l04865" name="l04865"></a><span class="lineno"> 4865</span>          </div>
<div class="line"><a id="l04866" name="l04866"></a><span class="lineno"> 4866</span>          <span class="keywordflow">ELSEIF</span> (ice ==0)  <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04867" name="l04867"></a><span class="lineno"> 4867</span>          </div>
<div class="line"><a id="l04868" name="l04868"></a><span class="lineno"> 4868</span>          <span class="keywordflow">IF</span> ((mosaic_cat_index(i,1,j) .EQ. iswater)) <span class="keywordflow">THEN</span>    </div>
<div class="line"><a id="l04869" name="l04869"></a><span class="lineno"> 4869</span>          </div>
<div class="line"><a id="l04870" name="l04870"></a><span class="lineno"> 4870</span>          <span class="comment">! xland &lt; 1.5 but the dominant land use category based on our calculation is water</span></div>
<div class="line"><a id="l04871" name="l04871"></a><span class="lineno"> 4871</span>                 </div>
<div class="line"><a id="l04872" name="l04872"></a><span class="lineno"> 4872</span>           <span class="keywordflow">IF</span> (ivgtyp(i,j) .EQ. iswater) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a id="l04873" name="l04873"></a><span class="lineno"> 4873</span>           </div>
<div class="line"><a id="l04874" name="l04874"></a><span class="lineno"> 4874</span>           <span class="comment">! xland &lt; 1.5 but the dominant land use category based on the geogrid calculation is water, this must be wrong</span></div>
<div class="line"><a id="l04875" name="l04875"></a><span class="lineno"> 4875</span>           </div>
<div class="line"><a id="l04876" name="l04876"></a><span class="lineno"> 4876</span>              <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;IN MOSAIC_INIT&quot;</span>)</div>
<div class="line"><a id="l04877" name="l04877"></a><span class="lineno"> 4877</span>              <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,3I6,2F8.2)&#39;</span>) <span class="stringliteral">&#39;I,J,IVGTYP,XLAND,XICE = &#39;</span>,i,j,ivgtyp(i,j),xland(i,j),xice(i,j) </div>
<div class="line"><a id="l04878" name="l04878"></a><span class="lineno"> 4878</span>              <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04879" name="l04879"></a><span class="lineno"> 4879</span>              <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;xland &lt; 1.5 but the dominant land use category based on our calculation is water.&quot;</span>//&amp;</div>
<div class="line"><a id="l04880" name="l04880"></a><span class="lineno"> 4880</span>                   <span class="stringliteral">&quot;In addition, the dominant land use category based on the geogrid calculation is water, this must be wrong&quot;</span>)</div>
<div class="line"><a id="l04881" name="l04881"></a><span class="lineno"> 4881</span>           </div>
<div class="line"><a id="l04882" name="l04882"></a><span class="lineno"> 4882</span><span class="keywordflow">           ENDIF</span>  <span class="comment">! for (IVGTYP(i,j) .EQ. ISWATER)</span></div>
<div class="line"><a id="l04883" name="l04883"></a><span class="lineno"> 4883</span>           </div>
<div class="line"><a id="l04884" name="l04884"></a><span class="lineno"> 4884</span>           <span class="keywordflow">IF</span> (ivgtyp(i,j) .NE. iswater) <span class="keywordflow">THEN</span> </div>
<div class="line"><a id="l04885" name="l04885"></a><span class="lineno"> 4885</span>           </div>
<div class="line"><a id="l04886" name="l04886"></a><span class="lineno"> 4886</span>           <span class="comment">! xland &lt; 1.5,   the dominant land use category based on our calculation is water, but based on the geogrid calculation is not water, which might be due to the inconsistence between land use data and land-sea mask</span></div>
<div class="line"><a id="l04887" name="l04887"></a><span class="lineno"> 4887</span>           </div>
<div class="line"><a id="l04888" name="l04888"></a><span class="lineno"> 4888</span>           temp4=landusef2(i,1,j)</div>
<div class="line"><a id="l04889" name="l04889"></a><span class="lineno"> 4889</span>           temp5=mosaic_cat_index(i,1,j)</div>
<div class="line"><a id="l04890" name="l04890"></a><span class="lineno"> 4890</span>      </div>
<div class="line"><a id="l04891" name="l04891"></a><span class="lineno"> 4891</span>           landusef2(i,1:nlcat-1,j)=landusef2(i,2:nlcat,j)                       </div>
<div class="line"><a id="l04892" name="l04892"></a><span class="lineno"> 4892</span>           mosaic_cat_index(i,1:nlcat-1,j)=mosaic_cat_index(i,2:nlcat,j)</div>
<div class="line"><a id="l04893" name="l04893"></a><span class="lineno"> 4893</span>      </div>
<div class="line"><a id="l04894" name="l04894"></a><span class="lineno"> 4894</span>           landusef2(i,nlcat,j)=temp4</div>
<div class="line"><a id="l04895" name="l04895"></a><span class="lineno"> 4895</span>           mosaic_cat_index(i,nlcat,j)=temp5</div>
<div class="line"><a id="l04896" name="l04896"></a><span class="lineno"> 4896</span>                 </div>
<div class="line"><a id="l04897" name="l04897"></a><span class="lineno"> 4897</span>              <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;IN MOSAIC_INIT&quot;</span>)</div>
<div class="line"><a id="l04898" name="l04898"></a><span class="lineno"> 4898</span>              <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,3I6,2F8.2)&#39;</span>) <span class="stringliteral">&#39;I,J,IVGTYP,XLAND,XICE = &#39;</span>,i,j,ivgtyp(i,j),xland(i,j),xice(i,j) </div>
<div class="line"><a id="l04899" name="l04899"></a><span class="lineno"> 4899</span>              <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04900" name="l04900"></a><span class="lineno"> 4900</span>              <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;xland &lt; 1.5 but the dominant land use category based on our calculation is water.&quot;</span>//&amp;</div>
<div class="line"><a id="l04901" name="l04901"></a><span class="lineno"> 4901</span>                   <span class="stringliteral">&quot;this is fine as long as we change our calculation so that the dominant land use category is&quot;</span>//&amp;</div>
<div class="line"><a id="l04902" name="l04902"></a><span class="lineno"> 4902</span>                   <span class="stringliteral">&quot;stwiched back to not water.&quot;</span>)</div>
<div class="line"><a id="l04903" name="l04903"></a><span class="lineno"> 4903</span>              <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,2I6)&#39;</span>) <span class="stringliteral">&#39;land use category has been switched, before and after values are &#39;</span>, &amp;</div>
<div class="line"><a id="l04904" name="l04904"></a><span class="lineno"> 4904</span>                   temp5,mosaic_cat_index(i,1,j)</div>
<div class="line"><a id="l04905" name="l04905"></a><span class="lineno"> 4905</span>              <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04906" name="l04906"></a><span class="lineno"> 4906</span>              <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,2I6)&#39;</span>) <span class="stringliteral">&#39;new dominant and second dominant cat are &#39;</span>, mosaic_cat_index(i,1,j),mosaic_cat_index(i,2,j)</div>
<div class="line"><a id="l04907" name="l04907"></a><span class="lineno"> 4907</span>              <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04908" name="l04908"></a><span class="lineno"> 4908</span>                 </div>
<div class="line"><a id="l04909" name="l04909"></a><span class="lineno"> 4909</span><span class="keywordflow">           ENDIF</span>  <span class="comment">! for (IVGTYP(i,j) .NE. ISWATER)</span></div>
<div class="line"><a id="l04910" name="l04910"></a><span class="lineno"> 4910</span>          </div>
<div class="line"><a id="l04911" name="l04911"></a><span class="lineno"> 4911</span>           <span class="keywordflow">ELSE</span>    <span class="comment">!  for (mosaic_cat_index(I,1,J) .EQ. ISWATER)</span></div>
<div class="line"><a id="l04912" name="l04912"></a><span class="lineno"> 4912</span>           </div>
<div class="line"><a id="l04913" name="l04913"></a><span class="lineno"> 4913</span>                     <span class="keywordflow">DO</span> mosaic_i=2,mosaic_cat</div>
<div class="line"><a id="l04914" name="l04914"></a><span class="lineno"> 4914</span>                    <span class="keywordflow">IF</span> (mosaic_cat_index(i,mosaic_i,j) == iswater ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04915" name="l04915"></a><span class="lineno"> 4915</span>                       temp4=landusef2(i,mosaic_i,j)</div>
<div class="line"><a id="l04916" name="l04916"></a><span class="lineno"> 4916</span>                       temp5=mosaic_cat_index(i,mosaic_i,j)</div>
<div class="line"><a id="l04917" name="l04917"></a><span class="lineno"> 4917</span>       </div>
<div class="line"><a id="l04918" name="l04918"></a><span class="lineno"> 4918</span>                       landusef2(i,mosaic_i:nlcat-1,j)=landusef2(i,mosaic_i+1:nlcat,j)                       </div>
<div class="line"><a id="l04919" name="l04919"></a><span class="lineno"> 4919</span>                       mosaic_cat_index(i,mosaic_i:nlcat-1,j)=mosaic_cat_index(i,mosaic_i+1:nlcat,j)</div>
<div class="line"><a id="l04920" name="l04920"></a><span class="lineno"> 4920</span>      </div>
<div class="line"><a id="l04921" name="l04921"></a><span class="lineno"> 4921</span>                       landusef2(i,nlcat,j)=temp4</div>
<div class="line"><a id="l04922" name="l04922"></a><span class="lineno"> 4922</span>                       mosaic_cat_index(i,nlcat,j)=temp5</div>
<div class="line"><a id="l04923" name="l04923"></a><span class="lineno"> 4923</span><span class="keywordflow">                    ENDIF</span> </div>
<div class="line"><a id="l04924" name="l04924"></a><span class="lineno"> 4924</span><span class="keywordflow">                  ENDDO</span></div>
<div class="line"><a id="l04925" name="l04925"></a><span class="lineno"> 4925</span>             </div>
<div class="line"><a id="l04926" name="l04926"></a><span class="lineno"> 4926</span><span class="keywordflow">           ENDIF</span> <span class="comment">!  for (mosaic_cat_index(I,1,J) .EQ. ISWATER)</span></div>
<div class="line"><a id="l04927" name="l04927"></a><span class="lineno"> 4927</span>             </div>
<div class="line"><a id="l04928" name="l04928"></a><span class="lineno"> 4928</span><span class="keywordflow">          ENDIF</span>  <span class="comment">!  for ICE == 1</span></div>
<div class="line"><a id="l04929" name="l04929"></a><span class="lineno"> 4929</span>          </div>
<div class="line"><a id="l04930" name="l04930"></a><span class="lineno"> 4930</span>      <span class="keywordflow">ELSE</span>  <span class="comment">! FOR (XLAND(I,J).LT.1.5)</span></div>
<div class="line"><a id="l04931" name="l04931"></a><span class="lineno"> 4931</span>      </div>
<div class="line"><a id="l04932" name="l04932"></a><span class="lineno"> 4932</span>                 ice = 0</div>
<div class="line"><a id="l04933" name="l04933"></a><span class="lineno"> 4933</span>      </div>
<div class="line"><a id="l04934" name="l04934"></a><span class="lineno"> 4934</span>                     <span class="keywordflow">IF</span>( xice(i,j).GE. xice_threshold ) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l04935" name="l04935"></a><span class="lineno"> 4935</span>                       <span class="keyword">WRITE</span> (message_text,fmt=<span class="stringliteral">&#39;(a,2I6)&#39;</span>) <span class="stringliteral">&#39;sea-ice at water point, I and J = &#39;</span>, i,j</div>
<div class="line"><a id="l04936" name="l04936"></a><span class="lineno"> 4936</span>                       <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04937" name="l04937"></a><span class="lineno"> 4937</span>                       ice = 1</div>
<div class="line"><a id="l04938" name="l04938"></a><span class="lineno"> 4938</span><span class="keywordflow">                     ENDIF</span>  </div>
<div class="line"><a id="l04939" name="l04939"></a><span class="lineno"> 4939</span>      </div>
<div class="line"><a id="l04940" name="l04940"></a><span class="lineno"> 4940</span>           <span class="keywordflow">IF</span> ((mosaic_cat_index(i,1,j) .NE. iswater)) <span class="keywordflow">THEN</span>    </div>
<div class="line"><a id="l04941" name="l04941"></a><span class="lineno"> 4941</span>                </div>
<div class="line"><a id="l04942" name="l04942"></a><span class="lineno"> 4942</span>                <span class="comment">! xland &gt; 1.5 and the dominant land use category based on our calculation is not water</span></div>
<div class="line"><a id="l04943" name="l04943"></a><span class="lineno"> 4943</span>                     </div>
<div class="line"><a id="l04944" name="l04944"></a><span class="lineno"> 4944</span>                 <span class="keywordflow">IF</span> (ivgtyp(i,j) .NE. iswater) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a id="l04945" name="l04945"></a><span class="lineno"> 4945</span>                 </div>
<div class="line"><a id="l04946" name="l04946"></a><span class="lineno"> 4946</span>                 <span class="comment">! xland &gt; 1.5 but the dominant land use category based on the geogrid calculation is not water, this must be wrong</span></div>
<div class="line"><a id="l04947" name="l04947"></a><span class="lineno"> 4947</span>                 <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;IN MOSAIC_INIT&quot;</span>)</div>
<div class="line"><a id="l04948" name="l04948"></a><span class="lineno"> 4948</span>                 <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,3I6,2F8.2)&#39;</span>) <span class="stringliteral">&#39;I,J,IVGTYP,XLAND,XICE = &#39;</span>,i,j,ivgtyp(i,j),xland(i,j),xice(i,j)</div>
<div class="line"><a id="l04949" name="l04949"></a><span class="lineno"> 4949</span>                 <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04950" name="l04950"></a><span class="lineno"> 4950</span>                 <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;xland &gt; 1.5 but the dominant land use category based on our calculation is not water.&quot;</span>// &amp;</div>
<div class="line"><a id="l04951" name="l04951"></a><span class="lineno"> 4951</span>                      <span class="stringliteral">&quot;in addition, the dominant land use category based on the geogrid calculation is not water,&quot;</span>//  &amp;</div>
<div class="line"><a id="l04952" name="l04952"></a><span class="lineno"> 4952</span>                      <span class="stringliteral">&quot;this must be wrong.&quot;</span>)</div>
<div class="line"><a id="l04953" name="l04953"></a><span class="lineno"> 4953</span><span class="keywordflow">                 ENDIF</span>  <span class="comment">! for (IVGTYP(i,j) .NE. ISWATER)</span></div>
<div class="line"><a id="l04954" name="l04954"></a><span class="lineno"> 4954</span>                 </div>
<div class="line"><a id="l04955" name="l04955"></a><span class="lineno"> 4955</span>                 <span class="keywordflow">IF</span> (ivgtyp(i,j) .EQ. iswater) <span class="keywordflow">THEN</span> </div>
<div class="line"><a id="l04956" name="l04956"></a><span class="lineno"> 4956</span>                 </div>
<div class="line"><a id="l04957" name="l04957"></a><span class="lineno"> 4957</span>                 <span class="comment">! xland &gt; 1.5,   the dominant land use category based on our calculation is not water, but based on the geogrid calculation is water, which might be due to the inconsistence between land use data and land-sea mask</span></div>
<div class="line"><a id="l04958" name="l04958"></a><span class="lineno"> 4958</span> </div>
<div class="line"><a id="l04959" name="l04959"></a><span class="lineno"> 4959</span>                 <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;IN MOSAIC_INIT&quot;</span>)</div>
<div class="line"><a id="l04960" name="l04960"></a><span class="lineno"> 4960</span>                 <span class="keyword">WRITE</span>(message_text,fmt=<span class="stringliteral">&#39;(a,3I6,2F8.2)&#39;</span>) <span class="stringliteral">&#39;I,J,IVGTYP,XLAND,XICE = &#39;</span>,i,j,ivgtyp(i,j),xland(i,j),xice(i,j)</div>
<div class="line"><a id="l04961" name="l04961"></a><span class="lineno"> 4961</span>                 <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04962" name="l04962"></a><span class="lineno"> 4962</span>                 <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;xland &gt; 1.5 but the dominant land use category based on our calculation is not water.&quot;</span>// &amp;</div>
<div class="line"><a id="l04963" name="l04963"></a><span class="lineno"> 4963</span>                      <span class="stringliteral">&quot;however, the dominant land use category based on the geogrid calculation is water&quot;</span>)</div>
<div class="line"><a id="l04964" name="l04964"></a><span class="lineno"> 4964</span>                 <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;This is fine. We do not need to do anyting because in the noaddrv, &quot;</span>//&amp;</div>
<div class="line"><a id="l04965" name="l04965"></a><span class="lineno"> 4965</span>                      <span class="stringliteral">&quot;we use xland as a criterion for whether using&quot;</span>// &amp;</div>
<div class="line"><a id="l04966" name="l04966"></a><span class="lineno"> 4966</span>                      <span class="stringliteral">&quot;mosaic or not when xland &gt; 1.5, no mosaic will be used anyway&quot;</span>)</div>
<div class="line"><a id="l04967" name="l04967"></a><span class="lineno"> 4967</span>                     </div>
<div class="line"><a id="l04968" name="l04968"></a><span class="lineno"> 4968</span><span class="keywordflow">                 ENDIF</span>  <span class="comment">! for (IVGTYP(i,j) .NE. ISWATER)</span></div>
<div class="line"><a id="l04969" name="l04969"></a><span class="lineno"> 4969</span>                </div>
<div class="line"><a id="l04970" name="l04970"></a><span class="lineno"> 4970</span><span class="keywordflow">           ENDIF</span> <span class="comment">!  for (mosaic_cat_index(I,1,J) .NE. ISWATER)</span></div>
<div class="line"><a id="l04971" name="l04971"></a><span class="lineno"> 4971</span>      </div>
<div class="line"><a id="l04972" name="l04972"></a><span class="lineno"> 4972</span><span class="keywordflow">        ENDIF</span>  <span class="comment">! FOR (XLAND(I,J).LT.1.5)</span></div>
<div class="line"><a id="l04973" name="l04973"></a><span class="lineno"> 4973</span> </div>
<div class="line"><a id="l04974" name="l04974"></a><span class="lineno"> 4974</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l04975" name="l04975"></a><span class="lineno"> 4975</span><span class="keywordflow">      ENDDO</span></div>
<div class="line"><a id="l04976" name="l04976"></a><span class="lineno"> 4976</span>      </div>
<div class="line"><a id="l04977" name="l04977"></a><span class="lineno"> 4977</span>  <span class="comment">!===========================================================================   </span></div>
<div class="line"><a id="l04978" name="l04978"></a><span class="lineno"> 4978</span>  <span class="comment">! normalize</span></div>
<div class="line"><a id="l04979" name="l04979"></a><span class="lineno"> 4979</span>  <span class="comment">!=========================================================================== </span></div>
<div class="line"><a id="l04980" name="l04980"></a><span class="lineno"> 4980</span> </div>
<div class="line"><a id="l04981" name="l04981"></a><span class="lineno"> 4981</span>     <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l04982" name="l04982"></a><span class="lineno"> 4982</span>        <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l04983" name="l04983"></a><span class="lineno"> 4983</span> </div>
<div class="line"><a id="l04984" name="l04984"></a><span class="lineno"> 4984</span>          temp6=0</div>
<div class="line"><a id="l04985" name="l04985"></a><span class="lineno"> 4985</span> </div>
<div class="line"><a id="l04986" name="l04986"></a><span class="lineno"> 4986</span>            <span class="keywordflow">DO</span> mosaic_i=1,mosaic_cat</div>
<div class="line"><a id="l04987" name="l04987"></a><span class="lineno"> 4987</span>               temp6=temp6+landusef2(i,mosaic_i,j)</div>
<div class="line"><a id="l04988" name="l04988"></a><span class="lineno"> 4988</span><span class="keywordflow">            ENDDO</span></div>
<div class="line"><a id="l04989" name="l04989"></a><span class="lineno"> 4989</span>            </div>
<div class="line"><a id="l04990" name="l04990"></a><span class="lineno"> 4990</span>            <span class="keywordflow">if</span> (temp6 .LT. 1e-5)  <span class="keywordflow">then</span></div>
<div class="line"><a id="l04991" name="l04991"></a><span class="lineno"> 4991</span>            </div>
<div class="line"><a id="l04992" name="l04992"></a><span class="lineno"> 4992</span>            temp6 = 1e-5</div>
<div class="line"><a id="l04993" name="l04993"></a><span class="lineno"> 4993</span>            <span class="keyword">WRITE</span> (message_text,fmt=<span class="stringliteral">&#39;(a,e8.1)&#39;</span>) <span class="stringliteral">&#39;the total land surface fraction is less than &#39;</span>, temp6</div>
<div class="line"><a id="l04994" name="l04994"></a><span class="lineno"> 4994</span>            <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04995" name="l04995"></a><span class="lineno"> 4995</span>            <span class="keyword">WRITE</span> (message_text,fmt=<span class="stringliteral">&#39;(a,2I6,4F8.2)&#39;</span>) <span class="stringliteral">&#39;some landusef values at i,j are &#39;</span>, &amp;</div>
<div class="line"><a id="l04996" name="l04996"></a><span class="lineno"> 4996</span>                 i,j,landusef2(i,1,j),landusef2(i,2,j),landusef2(i,3,j),landusef2(i,4,j)</div>
<div class="line"><a id="l04997" name="l04997"></a><span class="lineno"> 4997</span>            <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l04998" name="l04998"></a><span class="lineno"> 4998</span>            <span class="keyword">WRITE</span> (message_text,fmt=<span class="stringliteral">&#39;(a,2I6,3I6)&#39;</span>) <span class="stringliteral">&#39;some mosaic cat values at i,j are &#39;</span>, &amp;</div>
<div class="line"><a id="l04999" name="l04999"></a><span class="lineno"> 4999</span>                 i,j,mosaic_cat_index(i,1,j),mosaic_cat_index(i,2,j),mosaic_cat_index(i,3,j) </div>
<div class="line"><a id="l05000" name="l05000"></a><span class="lineno"> 5000</span>            <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l05001" name="l05001"></a><span class="lineno"> 5001</span>            </div>
<div class="line"><a id="l05002" name="l05002"></a><span class="lineno"> 5002</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l05003" name="l05003"></a><span class="lineno"> 5003</span> </div>
<div class="line"><a id="l05004" name="l05004"></a><span class="lineno"> 5004</span>            landusef2(i,1:mosaic_cat, j)=landusef2(i,1:mosaic_cat,j)*(1/temp6)</div>
<div class="line"><a id="l05005" name="l05005"></a><span class="lineno"> 5005</span> </div>
<div class="line"><a id="l05006" name="l05006"></a><span class="lineno"> 5006</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l05007" name="l05007"></a><span class="lineno"> 5007</span><span class="keywordflow">      ENDDO</span></div>
<div class="line"><a id="l05008" name="l05008"></a><span class="lineno"> 5008</span>      </div>
<div class="line"><a id="l05009" name="l05009"></a><span class="lineno"> 5009</span>  <span class="comment">!===========================================================================   </span></div>
<div class="line"><a id="l05010" name="l05010"></a><span class="lineno"> 5010</span>  <span class="comment">! initilize the variables</span></div>
<div class="line"><a id="l05011" name="l05011"></a><span class="lineno"> 5011</span>  <span class="comment">!===========================================================================   </span></div>
<div class="line"><a id="l05012" name="l05012"></a><span class="lineno"> 5012</span> </div>
<div class="line"><a id="l05013" name="l05013"></a><span class="lineno"> 5013</span>     <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l05014" name="l05014"></a><span class="lineno"> 5014</span>        <span class="keywordflow">DO</span> j = jts,jtf</div>
<div class="line"><a id="l05015" name="l05015"></a><span class="lineno"> 5015</span>    </div>
<div class="line"><a id="l05016" name="l05016"></a><span class="lineno"> 5016</span>             <span class="keywordflow">DO</span> mosaic_i=1,mosaic_cat</div>
<div class="line"><a id="l05017" name="l05017"></a><span class="lineno"> 5017</span>        </div>
<div class="line"><a id="l05018" name="l05018"></a><span class="lineno"> 5018</span>            tsk_mosaic(i,mosaic_i,j)=tsk(i,j)          </div>
<div class="line"><a id="l05019" name="l05019"></a><span class="lineno"> 5019</span>            canwat_mosaic(i,mosaic_i,j)=canwat(i,j) </div>
<div class="line"><a id="l05020" name="l05020"></a><span class="lineno"> 5020</span>            snow_mosaic(i,mosaic_i,j)=snow(i,j) </div>
<div class="line"><a id="l05021" name="l05021"></a><span class="lineno"> 5021</span>            snowh_mosaic(i,mosaic_i,j)=snowh(i,j)  </div>
<div class="line"><a id="l05022" name="l05022"></a><span class="lineno"> 5022</span>            snowc_mosaic(i,mosaic_i,j)=snowc(i,j) </div>
<div class="line"><a id="l05023" name="l05023"></a><span class="lineno"> 5023</span> </div>
<div class="line"><a id="l05024" name="l05024"></a><span class="lineno"> 5024</span>            albedo_mosaic(i,mosaic_i,j)=albedo(i,j)</div>
<div class="line"><a id="l05025" name="l05025"></a><span class="lineno"> 5025</span>            albbck_mosaic(i,mosaic_i,j)=albbck(i,j)</div>
<div class="line"><a id="l05026" name="l05026"></a><span class="lineno"> 5026</span>            emiss_mosaic(i,mosaic_i,j)=emiss(i,j) </div>
<div class="line"><a id="l05027" name="l05027"></a><span class="lineno"> 5027</span>            embck_mosaic(i,mosaic_i,j)=embck(i,j) </div>
<div class="line"><a id="l05028" name="l05028"></a><span class="lineno"> 5028</span>            znt_mosaic(i,mosaic_i,j)=z0(i,j)</div>
<div class="line"><a id="l05029" name="l05029"></a><span class="lineno"> 5029</span>            z0_mosaic(i,mosaic_i,j)=z0(i,j)</div>
<div class="line"><a id="l05030" name="l05030"></a><span class="lineno"> 5030</span>  </div>
<div class="line"><a id="l05031" name="l05031"></a><span class="lineno"> 5031</span>              <span class="keywordflow">DO</span> soil_k=1,num_soil_layers </div>
<div class="line"><a id="l05032" name="l05032"></a><span class="lineno"> 5032</span>  </div>
<div class="line"><a id="l05033" name="l05033"></a><span class="lineno"> 5033</span>            tslb_mosaic(i,num_soil_layers*(mosaic_i-1)+soil_k,j)=tslb(i,soil_k,j)</div>
<div class="line"><a id="l05034" name="l05034"></a><span class="lineno"> 5034</span>            smois_mosaic(i,num_soil_layers*(mosaic_i-1)+soil_k,j)=smois(i,soil_k,j)</div>
<div class="line"><a id="l05035" name="l05035"></a><span class="lineno"> 5035</span>            sh2o_mosaic(i,num_soil_layers*(mosaic_i-1)+soil_k,j)=sh2o(i,soil_k,j)  </div>
<div class="line"><a id="l05036" name="l05036"></a><span class="lineno"> 5036</span>          </div>
<div class="line"><a id="l05037" name="l05037"></a><span class="lineno"> 5037</span><span class="keywordflow">              ENDDO</span></div>
<div class="line"><a id="l05038" name="l05038"></a><span class="lineno"> 5038</span>           </div>
<div class="line"><a id="l05039" name="l05039"></a><span class="lineno"> 5039</span>           tr_urb2d_mosaic(i,mosaic_i,j)=tsk(i,j)   </div>
<div class="line"><a id="l05040" name="l05040"></a><span class="lineno"> 5040</span>           tb_urb2d_mosaic(i,mosaic_i,j)=tsk(i,j)   </div>
<div class="line"><a id="l05041" name="l05041"></a><span class="lineno"> 5041</span>           tg_urb2d_mosaic(i,mosaic_i,j)=tsk(i,j)   </div>
<div class="line"><a id="l05042" name="l05042"></a><span class="lineno"> 5042</span>           tc_urb2d_mosaic(i,mosaic_i,j)=tsk(i,j)   </div>
<div class="line"><a id="l05043" name="l05043"></a><span class="lineno"> 5043</span>           ts_urb2d_mosaic(i,mosaic_i,j)=tsk(i,j)   </div>
<div class="line"><a id="l05044" name="l05044"></a><span class="lineno"> 5044</span>           ts_rul2d_mosaic(i,mosaic_i,j)=tsk(i,j)   </div>
<div class="line"><a id="l05045" name="l05045"></a><span class="lineno"> 5045</span>           qc_urb2d_mosaic(i,mosaic_i,j)=0.01</div>
<div class="line"><a id="l05046" name="l05046"></a><span class="lineno"> 5046</span>           sh_urb2d_mosaic(i,mosaic_i,j)=0</div>
<div class="line"><a id="l05047" name="l05047"></a><span class="lineno"> 5047</span>           lh_urb2d_mosaic(i,mosaic_i,j)=0</div>
<div class="line"><a id="l05048" name="l05048"></a><span class="lineno"> 5048</span>           g_urb2d_mosaic(i,mosaic_i,j)=0</div>
<div class="line"><a id="l05049" name="l05049"></a><span class="lineno"> 5049</span>           rn_urb2d_mosaic(i,mosaic_i,j)=0</div>
<div class="line"><a id="l05050" name="l05050"></a><span class="lineno"> 5050</span>          </div>
<div class="line"><a id="l05051" name="l05051"></a><span class="lineno"> 5051</span>          trl_urb3d_mosaic(i,4*(mosaic_i-1)+1,j)=tslb(i,1,j)+0.</div>
<div class="line"><a id="l05052" name="l05052"></a><span class="lineno"> 5052</span>          trl_urb3d_mosaic(i,4*(mosaic_i-1)+2,j)=0.5*(tslb(i,1,j)+tslb(i,2,j))</div>
<div class="line"><a id="l05053" name="l05053"></a><span class="lineno"> 5053</span>          trl_urb3d_mosaic(i,4*(mosaic_i-1)+3,j)=tslb(i,2,j)+0.</div>
<div class="line"><a id="l05054" name="l05054"></a><span class="lineno"> 5054</span>          trl_urb3d_mosaic(i,4*(mosaic_i-1)+4,j)=tslb(i,2,j)+(tslb(i,3,j)-tslb(i,2,j))*0.29</div>
<div class="line"><a id="l05055" name="l05055"></a><span class="lineno"> 5055</span> </div>
<div class="line"><a id="l05056" name="l05056"></a><span class="lineno"> 5056</span>          tbl_urb3d_mosaic(i,4*(mosaic_i-1)+1,j)=tslb(i,1,j)+0.</div>
<div class="line"><a id="l05057" name="l05057"></a><span class="lineno"> 5057</span>          tbl_urb3d_mosaic(i,4*(mosaic_i-1)+2,j)=0.5*(tslb(i,1,j)+tslb(i,2,j))</div>
<div class="line"><a id="l05058" name="l05058"></a><span class="lineno"> 5058</span>          tbl_urb3d_mosaic(i,4*(mosaic_i-1)+3,j)=tslb(i,2,j)+0.</div>
<div class="line"><a id="l05059" name="l05059"></a><span class="lineno"> 5059</span>          tbl_urb3d_mosaic(i,4*(mosaic_i-1)+4,j)=tslb(i,2,j)+(tslb(i,3,j)-tslb(i,2,j))*0.29           </div>
<div class="line"><a id="l05060" name="l05060"></a><span class="lineno"> 5060</span>                    </div>
<div class="line"><a id="l05061" name="l05061"></a><span class="lineno"> 5061</span>          tgl_urb3d_mosaic(i,4*(mosaic_i-1)+1,j)=tslb(i,1,j)</div>
<div class="line"><a id="l05062" name="l05062"></a><span class="lineno"> 5062</span>          tgl_urb3d_mosaic(i,4*(mosaic_i-1)+2,j)=tslb(i,2,j)</div>
<div class="line"><a id="l05063" name="l05063"></a><span class="lineno"> 5063</span>          tgl_urb3d_mosaic(i,4*(mosaic_i-1)+3,j)=tslb(i,3,j)</div>
<div class="line"><a id="l05064" name="l05064"></a><span class="lineno"> 5064</span>          tgl_urb3d_mosaic(i,4*(mosaic_i-1)+4,j)=tslb(i,4,j)</div>
<div class="line"><a id="l05065" name="l05065"></a><span class="lineno"> 5065</span>           </div>
<div class="line"><a id="l05066" name="l05066"></a><span class="lineno"> 5066</span><span class="keywordflow">            ENDDO</span></div>
<div class="line"><a id="l05067" name="l05067"></a><span class="lineno"> 5067</span><span class="keywordflow">          ENDDO</span></div>
<div class="line"><a id="l05068" name="l05068"></a><span class="lineno"> 5068</span><span class="keywordflow">      ENDDO</span></div>
<div class="line"><a id="l05069" name="l05069"></a><span class="lineno"> 5069</span> </div>
<div class="line"><a id="l05070" name="l05070"></a><span class="lineno"> 5070</span>   <span class="comment">! simple test</span></div>
<div class="line"><a id="l05071" name="l05071"></a><span class="lineno"> 5071</span>   </div>
<div class="line"><a id="l05072" name="l05072"></a><span class="lineno"> 5072</span>       <span class="keywordflow">DO</span> i = its,itf</div>
<div class="line"><a id="l05073" name="l05073"></a><span class="lineno"> 5073</span>        <span class="keywordflow">DO</span> j = jts,jtf </div>
<div class="line"><a id="l05074" name="l05074"></a><span class="lineno"> 5074</span>   </div>
<div class="line"><a id="l05075" name="l05075"></a><span class="lineno"> 5075</span>           <span class="keywordflow">IF</span> ((xland(i,j).LT. 1.5 ) .AND. (mosaic_cat_index(i,1,j) .EQ. iswater)) <span class="keywordflow">THEN</span></div>
<div class="line"><a id="l05076" name="l05076"></a><span class="lineno"> 5076</span>             <span class="keyword">CALL </span>wrf_message(<span class="stringliteral">&quot;After MOSAIC_INIT&quot;</span>)</div>
<div class="line"><a id="l05077" name="l05077"></a><span class="lineno"> 5077</span>             <span class="keyword">WRITE</span> (message_text,fmt=<span class="stringliteral">&#39;(a,2I6,2F8.2,2I6)&#39;</span>) <span class="stringliteral">&#39;weird xland,xice,mosaic_cat_index and ivgtyp at I,J = &#39;</span>, &amp;</div>
<div class="line"><a id="l05078" name="l05078"></a><span class="lineno"> 5078</span>                i,j,xland(i,j),xice(i,j),mosaic_cat_index(i,1,j),ivgtyp(i,j)</div>
<div class="line"><a id="l05079" name="l05079"></a><span class="lineno"> 5079</span>             <span class="keyword">CALL </span>wrf_message(message_text)</div>
<div class="line"><a id="l05080" name="l05080"></a><span class="lineno"> 5080</span><span class="keywordflow">           ENDIF</span></div>
<div class="line"><a id="l05081" name="l05081"></a><span class="lineno"> 5081</span>           </div>
<div class="line"><a id="l05082" name="l05082"></a><span class="lineno"> 5082</span><span class="keywordflow">        ENDDO</span></div>
<div class="line"><a id="l05083" name="l05083"></a><span class="lineno"> 5083</span><span class="keywordflow">      ENDDO</span></div>
<div class="line"><a id="l05084" name="l05084"></a><span class="lineno"> 5084</span>      </div>
<div class="line"><a id="l05085" name="l05085"></a><span class="lineno"> 5085</span><span class="keywordflow"> ENDIF</span>      <span class="comment">!  for not restart</span></div>
<div class="line"><a id="l05086" name="l05086"></a><span class="lineno"> 5086</span>      </div>
<div class="line"><a id="l05087" name="l05087"></a><span class="lineno"> 5087</span><span class="comment">!--------------------------------      </span></div>
<div class="line"><a id="l05088" name="l05088"></a><span class="lineno"> 5088</span>  <span class="keyword">END SUBROUTINE </span><a class="code hl_function" href="namespacemodule__sf__noahdrv.html#a2391e63d2b4c5f0af015817d4034b152">lsm_mosaic_init</a>  </div>
<div class="line"><a id="l05089" name="l05089"></a><span class="lineno"> 5089</span><span class="comment">!--------------------------------  </span></div>
<div class="line"><a id="l05090" name="l05090"></a><span class="lineno"> 5090</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l05091" name="l05091"></a><span class="lineno"> 5091</span><span class="preprocessor"></span> </div>
<div class="line"><a id="l05092" name="l05092"></a><span class="lineno"> 5092</span><span class="keyword">END MODULE </span><a class="code hl_namespace" href="namespacemodule__sf__noahdrv.html">module_sf_noahdrv</a></div>
<div class="ttc" id="anamespacemodule__sf__bep__bem_html"><div class="ttname"><a href="namespacemodule__sf__bep__bem.html">module_sf_bep_bem</a></div><div class="ttdef"><b>Definition:</b> <a href="module__sf__bep__bem_8F_source.html#l00001">module_sf_bep_bem.F:1</a></div></div>
<div class="ttc" id="anamespacemodule__sf__bep__bem_html_a601edbeeb722b0b6d0732b33d4884462"><div class="ttname"><a href="namespacemodule__sf__bep__bem.html#a601edbeeb722b0b6d0732b33d4884462">module_sf_bep_bem::bep_bem</a></div><div class="ttdeci">subroutine bep_bem(FRC_URB2D, UTYPE_URB2D, itimestep, dz8w, dt, u_phy, v_phy, th_phy, rho, p_phy, swdown, glw, gmt, julday, xlong, xlat, declin_urb, cosz_urb2d, omg_urb2d, num_urban_layers, num_urban_hi, trb_urb4d, tw1_urb4d, tw2_urb4d, tgb_urb4d, tlev_urb3d, qlev_urb3d, tw1lev_urb3d, tw2lev_urb3d, tglev_urb3d, tflev_urb3d, sf_ac_urb3d, lf_ac_urb3d, cm_ac_urb3d, sfvent_urb3d, lfvent_urb3d, sfwin1_urb3d, sfwin2_urb3d, sfw1_urb3d, sfw2_urb3d, sfr_urb3d, sfg_urb3d, lp_urb2d, hi_urb2d, lb_urb2d, hgt_urb2d, a_u, a_v, a_t, a_e, b_u, b_v, b_t, b_e, b_q, dlg, dl_u, sf, vl, rl_up, rs_abs, emiss, grdflx_urb, qv_phy, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__bep__bem_8F_source.html#l00085">module_sf_bep_bem.F:103</a></div></div>
<div class="ttc" id="anamespacemodule__sf__bep_html"><div class="ttname"><a href="namespacemodule__sf__bep.html">module_sf_bep</a></div><div class="ttdef"><b>Definition:</b> <a href="module__sf__bep_8F_source.html#l00001">module_sf_bep.F:1</a></div></div>
<div class="ttc" id="anamespacemodule__sf__bep_html_a4e43ca6e75172d2dc55705c6adc6ed0d"><div class="ttname"><a href="namespacemodule__sf__bep.html#a4e43ca6e75172d2dc55705c6adc6ed0d">module_sf_bep::bep</a></div><div class="ttdeci">subroutine bep(FRC_URB2D, UTYPE_URB2D, itimestep, dz8w, dt, u_phy, v_phy, th_phy, rho, p_phy, swdown, glw, gmt, julday, xlong, xlat, declin_urb, cosz_urb2d, omg_urb2d, num_urban_layers, num_urban_hi, trb_urb4d, tw1_urb4d, tw2_urb4d, tgb_urb4d, sfw1_urb3d, sfw2_urb3d, sfr_urb3d, sfg_urb3d, lp_urb2d, hi_urb2d, lb_urb2d, hgt_urb2d, a_u, a_v, a_t, a_e, b_u, b_v, b_t, b_e, b_q, dlg, dl_u, sf, vl, rl_up, rs_abs, emiss, grdflx_urb, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__bep_8F_source.html#l00062">module_sf_bep.F:76</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahdrv_html"><div class="ttname"><a href="namespacemodule__sf__noahdrv.html">module_sf_noahdrv</a></div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahdrv_8F_source.html#l00001">module_sf_noahdrv.F:1</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahdrv_html_a2391e63d2b4c5f0af015817d4034b152"><div class="ttname"><a href="namespacemodule__sf__noahdrv.html#a2391e63d2b4c5f0af015817d4034b152">module_sf_noahdrv::lsm_mosaic_init</a></div><div class="ttdeci">subroutine lsm_mosaic_init(IVGTYP, ISWATER, ISURBAN, ISICE, XLAND, XICE, fractional_seaice, TSK, TSLB, SMOIS, SH2O, SNOW, SNOWC, SNOWH, CANWAT, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte, restart, landusef, landusef2, NLCAT, num_soil_layers, sf_surface_mosaic, mosaic_cat, mosaic_cat_index, TSK_mosaic, TSLB_mosaic, SMOIS_mosaic, SH2O_mosaic, CANWAT_mosaic, SNOW_mosaic, SNOWH_mosaic, SNOWC_mosaic, ALBEDO, ALBBCK, EMISS, EMBCK, Z0, ALBEDO_mosaic, ALBBCK_mosaic, EMISS_mosaic, EMBCK_mosaic, ZNT_mosaic, Z0_mosaic, TR_URB2D_mosaic, TB_URB2D_mosaic, TG_URB2D_mosaic, TC_URB2D_mosaic, QC_URB2D_mosaic, TRL_URB3D_mosaic, TBL_URB3D_mosaic, TGL_URB3D_mosaic, SH_URB2D_mosaic, LH_URB2D_mosaic, G_URB2D_mosaic, RN_URB2D_mosaic, TS_URB2D_mosaic, TS_RUL2D_mosaic)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahdrv_8F_source.html#l04686">module_sf_noahdrv.F:4711</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahdrv_html_a4c04acb56a9d85687443946a1d0a3cfe"><div class="ttname"><a href="namespacemodule__sf__noahdrv.html#a4c04acb56a9d85687443946a1d0a3cfe">module_sf_noahdrv::lsm</a></div><div class="ttdeci">subroutine lsm(DZ8W, QV3D, P8W3D, T3D, TSK, HFX, QFX, LH, GRDFLX, QGH, GSW, SWDOWN, GLW, SMSTAV, SMSTOT, SFCRUNOFF, UDRUNOFF, IVGTYP, ISLTYP, ISURBAN, ISICE, VEGFRA, ALBEDO, ALBBCK, ZNT, Z0, TMN, XLAND, XICE, EMISS, EMBCK, SNOWC, QSFC, RAINBL, MMINLU, num_soil_layers, DT, DZS, ITIMESTEP, SMOIS, TSLB, SNOW, CANWAT, CHS, CHS2, CQS2, CPM, ROVCP, SR, chklowq, lai, qz0, myj, frpcpn, SH2O, SNOWH, U_PHY, V_PHY, SNOALB, SHDMIN, SHDMAX, SNOTIME, ACSNOM, ACSNOW, SNOPCX, POTEVP, SMCREL, XICE_THRESHOLD, RDLAI2D, USEMONALB, RIB, NOAHRES, opt_thcnd, ua_phys, flx4_2d, fvb_2d, fbur_2d, fgsn_2d, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte, sf_urban_physics, CMR_SFCDIF, CHR_SFCDIF, CMC_SFCDIF, CHC_SFCDIF, CMGR_SFCDIF, CHGR_SFCDIF, TR_URB2D, TB_URB2D, TG_URB2D, TC_URB2D, QC_URB2D, UC_URB2D, XXXR_URB2D, XXXB_URB2D, XXXG_URB2D, XXXC_URB2D, TRL_URB3D, TBL_URB3D, TGL_URB3D, SH_URB2D, LH_URB2D, G_URB2D, RN_URB2D, TS_URB2D, PSIM_URB2D, PSIH_URB2D, U10_URB2D, V10_URB2D, GZ1OZ0_URB2D, AKMS_URB2D, TH2_URB2D, Q2_URB2D, UST_URB2D, DECLIN_URB, COSZ_URB2D, OMG_URB2D, XLAT_URB2D, num_roof_layers, num_wall_layers, num_road_layers, DZR, DZB, DZG, CMCR_URB2D, TGR_URB2D, TGRL_URB3D, SMR_URB3D, DRELR_URB2D, DRELB_URB2D, DRELG_URB2D, FLXHUMR_URB2D, FLXHUMB_URB2D, FLXHUMG_URB2D, julian, julyr, FRC_URB2D, UTYPE_URB2D, num_urban_layers, num_urban_hi, tsk_rural_bep, trb_urb4d, tw1_urb4d, tw2_urb4d, tgb_urb4d, tlev_urb3d, qlev_urb3d, tw1lev_urb3d, tw2lev_urb3d, tglev_urb3d, tflev_urb3d, sf_ac_urb3d, lf_ac_urb3d, cm_ac_urb3d, sfvent_urb3d, lfvent_urb3d, sfwin1_urb3d, sfwin2_urb3d, sfw1_urb3d, sfw2_urb3d, sfr_urb3d, sfg_urb3d, lp_urb2d, hi_urb2d, lb_urb2d, hgt_urb2d, mh_urb2d, stdh_urb2d, lf_urb2d, th_phy, rho, p_phy, ust, gmt, julday, xlong, xlat, a_u_bep, a_v_bep, a_t_bep, a_q_bep, a_e_bep, b_u_bep, b_v_bep, b_t_bep, b_q_bep, b_e_bep, dlg_bep, dl_u_bep, sf_bep, vl_bep, sfcheadrt, INFXSRT, soldrain, SDA_HFX, SDA_QFX, HFX_BOTH, QFX_BOTH, QNORM, fasdas, RC2, XLAI2)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahdrv_8F_source.html#l00039">module_sf_noahdrv.F:108</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahdrv_html_abb5d9a7134268d50cc5cca58ecd9b0ea"><div class="ttname"><a href="namespacemodule__sf__noahdrv.html#abb5d9a7134268d50cc5cca58ecd9b0ea">module_sf_noahdrv::lsm_mosaic</a></div><div class="ttdeci">subroutine lsm_mosaic(DZ8W, QV3D, P8W3D, T3D, TSK, HFX, QFX, LH, GRDFLX, QGH, GSW, SWDOWN, GLW, SMSTAV, SMSTOT, SFCRUNOFF, UDRUNOFF, IVGTYP, ISLTYP, ISURBAN, ISICE, VEGFRA, ALBEDO, ALBBCK, ZNT, Z0, TMN, XLAND, XICE, EMISS, EMBCK, SNOWC, QSFC, RAINBL, MMINLU, num_soil_layers, DT, DZS, ITIMESTEP, SMOIS, TSLB, SNOW, CANWAT, CHS, CHS2, CQS2, CPM, ROVCP, SR, chklowq, lai, qz0, myj, frpcpn, SH2O, SNOWH, U_PHY, V_PHY, SNOALB, SHDMIN, SHDMAX, SNOTIME, ACSNOM, ACSNOW, SNOPCX, POTEVP, SMCREL, XICE_THRESHOLD, RDLAI2D, USEMONALB, RIB, NOAHRES, OPT_THCND, NLCAT, landusef, landusef2, sf_surface_mosaic, mosaic_cat, mosaic_cat_index, TSK_mosaic, QSFC_mosaic, TSLB_mosaic, SMOIS_mosaic, SH2O_mosaic, CANWAT_mosaic, SNOW_mosaic, SNOWH_mosaic, SNOWC_mosaic, ALBEDO_mosaic, ALBBCK_mosaic, EMISS_mosaic, EMBCK_mosaic, ZNT_mosaic, Z0_mosaic, HFX_mosaic, QFX_mosaic, LH_mosaic, GRDFLX_mosaic, SNOTIME_mosaic, RC_mosaic, LAI_mosaic, ua_phys, flx4_2d, fvb_2d, fbur_2d, fgsn_2d, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte, sf_urban_physics, CMR_SFCDIF, CHR_SFCDIF, CMC_SFCDIF, CHC_SFCDIF, CMGR_SFCDIF, CHGR_SFCDIF, TR_URB2D, TB_URB2D, TG_URB2D, TC_URB2D, QC_URB2D, UC_URB2D, XXXR_URB2D, XXXB_URB2D, XXXG_URB2D, XXXC_URB2D, TRL_URB3D, TBL_URB3D, TGL_URB3D, SH_URB2D, LH_URB2D, G_URB2D, RN_URB2D, TS_URB2D, TR_URB2D_mosaic, TB_URB2D_mosaic, TG_URB2D_mosaic, TC_URB2D_mosaic, QC_URB2D_mosaic, UC_URB2D_mosaic, TRL_URB3D_mosaic, TBL_URB3D_mosaic, TGL_URB3D_mosaic, SH_URB2D_mosaic, LH_URB2D_mosaic, G_URB2D_mosaic, RN_URB2D_mosaic, TS_URB2D_mosaic, TS_RUL2D_mosaic, PSIM_URB2D, PSIH_URB2D, U10_URB2D, V10_URB2D, GZ1OZ0_URB2D, AKMS_URB2D, TH2_URB2D, Q2_URB2D, UST_URB2D, DECLIN_URB, COSZ_URB2D, OMG_URB2D, XLAT_URB2D, num_roof_layers, num_wall_layers, num_road_layers, DZR, DZB, DZG, CMCR_URB2D, TGR_URB2D, TGRL_URB3D, SMR_URB3D, julian, julyr, DRELR_URB2D, DRELB_URB2D, DRELG_URB2D, FLXHUMR_URB2D, FLXHUMB_URB2D, FLXHUMG_URB2D, FRC_URB2D, UTYPE_URB2D, num_urban_layers, num_urban_hi, tsk_rural_bep, trb_urb4d, tw1_urb4d, tw2_urb4d, tgb_urb4d, tlev_urb3d, qlev_urb3d, tw1lev_urb3d, tw2lev_urb3d, tglev_urb3d, tflev_urb3d, sf_ac_urb3d, lf_ac_urb3d, cm_ac_urb3d, sfvent_urb3d, lfvent_urb3d, sfwin1_urb3d, sfwin2_urb3d, sfw1_urb3d, sfw2_urb3d, sfr_urb3d, sfg_urb3d, lp_urb2d, hi_urb2d, lb_urb2d, hgt_urb2d, mh_urb2d, stdh_urb2d, lf_urb2d, th_phy, rho, p_phy, ust, gmt, julday, xlong, xlat, a_u_bep, a_v_bep, a_t_bep, a_q_bep, a_e_bep, b_u_bep, b_v_bep, b_t_bep, b_q_bep, b_e_bep, dlg_bep, dl_u_bep, sf_bep, vl_bep, sfcheadrt, INFXSRT, soldrain, SDA_HFX, SDA_QFX, HFX_BOTH, QFX_BOTH, QNORM, fasdas, RC2, XLAI2)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahdrv_8F_source.html#l02211">module_sf_noahdrv.F:2302</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm__glacial__only_html"><div class="ttname"><a href="namespacemodule__sf__noahlsm__glacial__only.html">module_sf_noahlsm_glacial_only</a></div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm__glacial__only_8F_source.html#l00001">module_sf_noahlsm_glacial_only.F:1</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm__glacial__only_html_afa7bc1c71f24bbd328e603892e6af3ba"><div class="ttname"><a href="namespacemodule__sf__noahlsm__glacial__only.html#afa7bc1c71f24bbd328e603892e6af3ba">module_sf_noahlsm_glacial_only::sflx_glacial</a></div><div class="ttdeci">subroutine sflx_glacial(IILOC, JJLOC, ISICE, FFROZP, DT, ZLVL, NSOIL, SLDPTH, LWDN, SOLNET, SFCPRS, PRCP, SFCTMP, Q2, TH2, Q2SAT, DQSDT2, ALB, SNOALB, TBOT, Z0BRD, Z0, EMISSI, EMBRD, T1, STC, SNOWH, SNEQV, ALBEDO, CH, ETA, SHEAT, ETA_KINEMATIC, FDOWN, ESNOW, DEW, ETP, SSOIL, FLX1, FLX2, FLX3, SNOMLT, SNCOVR, RUNOFF1, Q1, SNOTIME1, RIBB)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm__glacial__only_8F_source.html#l00031">module_sf_noahlsm_glacial_only.F:50</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html">module_sf_noahlsm</a></div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00001">module_sf_noahlsm.F:1</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a032dea1cb1492e469ff23cf4a34170ea"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a032dea1cb1492e469ff23cf4a34170ea">module_sf_noahlsm::hstbl</a></div><div class="ttdeci">real, dimension(1:nlus) hstbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a0500272007439fcc4870091db509d5e0"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a0500272007439fcc4870091db509d5e0">module_sf_noahlsm::rsmax_data</a></div><div class="ttdeci">real rsmax_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00043">module_sf_noahlsm.F:43</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a0de1ade2206d62259245f281a9751200"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a0de1ade2206d62259245f281a9751200">module_sf_noahlsm::cmcmax_data</a></div><div class="ttdeci">real cmcmax_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00043">module_sf_noahlsm.F:43</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a0f671f01ac448828a19839c29fe2a80d"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a0f671f01ac448828a19839c29fe2a80d">module_sf_noahlsm::rgltbl</a></div><div class="ttdeci">real, dimension(1:nlus) rgltbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a162eaa508d912b165fd5d5b59f9c8276"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a162eaa508d912b165fd5d5b59f9c8276">module_sf_noahlsm::high_density_residential</a></div><div class="ttdeci">integer high_density_residential</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00032">module_sf_noahlsm.F:32</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a1e5f83b829493815912f8e801edd7b17"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a1e5f83b829493815912f8e801edd7b17">module_sf_noahlsm::zbot_data</a></div><div class="ttdeci">real zbot_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a264ef4f6e4e0348d29a24399729c47b1"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a264ef4f6e4e0348d29a24399729c47b1">module_sf_noahlsm::qtz</a></div><div class="ttdeci">real, dimension(1:nsltype) qtz</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a2b8557df16e078c40e5bea80224b951c"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a2b8557df16e078c40e5bea80224b951c">module_sf_noahlsm::nsltype</a></div><div class="ttdeci">integer, parameter nsltype</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00047">module_sf_noahlsm.F:47</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a2c126e8a645fbfff910ba7d7415078e5"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a2c126e8a645fbfff910ba7d7415078e5">module_sf_noahlsm::laimaxtbl</a></div><div class="ttdeci">real, dimension(1:nlus) laimaxtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a2d3913e03c9d3f6dc2f1817689a70aa7"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a2d3913e03c9d3f6dc2f1817689a70aa7">module_sf_noahlsm::satpsi</a></div><div class="ttdeci">real, dimension(1:nsltype) satpsi</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a347f1f27afb384360fada49937ebf1cc"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a347f1f27afb384360fada49937ebf1cc">module_sf_noahlsm::slpcats</a></div><div class="ttdeci">integer slpcats</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00053">module_sf_noahlsm.F:53</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a3d56b3f7eeeccda9e1d6f7d0aecfb149"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a3d56b3f7eeeccda9e1d6f7d0aecfb149">module_sf_noahlsm::smlow_data</a></div><div class="ttdeci">real smlow_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a421c11109bef5a1c768d721cb746c495"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a421c11109bef5a1c768d721cb746c495">module_sf_noahlsm::bb</a></div><div class="ttdeci">real, dimension(1:nsltype) bb</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a49b5bd6e866a73374623128552be22ec"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a49b5bd6e866a73374623128552be22ec">module_sf_noahlsm::cfactr_data</a></div><div class="ttdeci">real cfactr_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00043">module_sf_noahlsm.F:43</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a5394697bf41b6a406cf68211008c2c05"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a5394697bf41b6a406cf68211008c2c05">module_sf_noahlsm::f11</a></div><div class="ttdeci">real, dimension(1:nsltype) f11</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a5620825a183522809f7fd87ce222bc75"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a5620825a183522809f7fd87ce222bc75">module_sf_noahlsm::albedomintbl</a></div><div class="ttdeci">real, dimension(1:nlus) albedomintbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a5beb42f74e1a357ccfc0e904f356b33a"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a5beb42f74e1a357ccfc0e904f356b33a">module_sf_noahlsm::frh2o</a></div><div class="ttdeci">subroutine frh2o(FREE, TKELV, SMC, SH2O, SMCMAX, BEXP, PSIS)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l01443">module_sf_noahlsm.F:1444</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a5e4d45f6d99b175703cb7cf1c2485e8a"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a5e4d45f6d99b175703cb7cf1c2485e8a">module_sf_noahlsm::zbotvtbl</a></div><div class="ttdeci">real, dimension(1:nlus) zbotvtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a5e842b9c23b43bc3ccf873a9bf9612af"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a5e842b9c23b43bc3ccf873a9bf9612af">module_sf_noahlsm::salp_data</a></div><div class="ttdeci">real salp_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a6029894190d9a2de7f0bfe83f84821ed"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a6029894190d9a2de7f0bfe83f84821ed">module_sf_noahlsm::low_density_residential</a></div><div class="ttdeci">integer low_density_residential</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00032">module_sf_noahlsm.F:32</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a66770731f9d207f81564cc084cdcd40e"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a66770731f9d207f81564cc084cdcd40e">module_sf_noahlsm::nslope</a></div><div class="ttdeci">integer, parameter nslope</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00054">module_sf_noahlsm.F:54</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a6c8c21728a7859d57a4e867f2df6d521"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a6c8c21728a7859d57a4e867f2df6d521">module_sf_noahlsm::czil_data</a></div><div class="ttdeci">real czil_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a6e407ba242e1b07a68eb56f1180447c6"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a6e407ba242e1b07a68eb56f1180447c6">module_sf_noahlsm::drysmc</a></div><div class="ttdeci">real, dimension(1:nsltype) drysmc</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a6eb802ec31e08c8d45492d3057202b09"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a6eb802ec31e08c8d45492d3057202b09">module_sf_noahlsm::nlus</a></div><div class="ttdeci">integer, parameter nlus</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00033">module_sf_noahlsm.F:33</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a6eefa55e3997176fcb176348dbabfa4e"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a6eefa55e3997176fcb176348dbabfa4e">module_sf_noahlsm::ztopvtbl</a></div><div class="ttdeci">real, dimension(1:nlus) ztopvtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a72bf7902c4cdf8a89ad09a592be5381a"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a72bf7902c4cdf8a89ad09a592be5381a">module_sf_noahlsm::z0maxtbl</a></div><div class="ttdeci">real, dimension(1:nlus) z0maxtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a786fd6e5794b80a6cbb602a290a6fd6a"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a786fd6e5794b80a6cbb602a290a6fd6a">module_sf_noahlsm::frzk_data</a></div><div class="ttdeci">real frzk_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a7a50ad4eacd814b850f723a4b67a8ead"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a7a50ad4eacd814b850f723a4b67a8ead">module_sf_noahlsm::refsmc</a></div><div class="ttdeci">real, dimension(1:nsltype) refsmc</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a80bccc6a8e3641348467b3867a35ca00"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a80bccc6a8e3641348467b3867a35ca00">module_sf_noahlsm::high_intensity_industrial</a></div><div class="ttdeci">integer high_intensity_industrial</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00032">module_sf_noahlsm.F:32</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a86862de601c92fc02c2501c1827c3da4"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a86862de601c92fc02c2501c1827c3da4">module_sf_noahlsm::slcats</a></div><div class="ttdeci">integer slcats</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00046">module_sf_noahlsm.F:46</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a89de2b557283473efeeec5d3d49c7e7e"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a89de2b557283473efeeec5d3d49c7e7e">module_sf_noahlsm::sflx</a></div><div class="ttdeci">subroutine sflx(IILOC, JJLOC, FFROZP, ISURBAN, DT, ZLVL, NSOIL, SLDPTH, LOCAL, LLANDUSE, LSOIL, LWDN, SOLDN, SOLNET, SFCPRS, PRCP, SFCTMP, Q2, SFCSPD, COSZ, PRCPRAIN, SOLARDIRECT, TH2, Q2SAT, DQSDT2, VEGTYP, SOILTYP, SLOPETYP, SHDFAC, SHDMIN, SHDMAX, ALB, SNOALB, TBOT, Z0BRD, Z0, EMISSI, EMBRD, CMC, T1, STC, SMC, SH2O, SNOWH, SNEQV, ALBEDO, CH, CM, ETA, SHEAT, ETA_KINEMATIC, FDOWN, EC, EDIR, ET, ETT, ESNOW, DRIP, DEW, BETA, ETP, SSOIL, FLX1, FLX2, FLX3, FLX4, FVB, FBUR, FGSN, UA_PHYS, SNOMLT, SNCOVR, RUNOFF1, RUNOFF2, RUNOFF3, RC, PC, RSMIN, XLAI, RCS, RCT, RCQ, RCSOIL, SOILW, SOILM, Q1, SMAV, RDLAI2D, USEMONALB, SNOTIME1, RIBB, SMCWLT, SMCDRY, SMCREF, SMCMAX, NROOT, SFHEAD1RT, INFXS1RT, ETPND1, OPT_THCND, AOASIS, XSDA_QFX, HFX_PHY, QFX_PHY, XQNORM, fasdas, HCPCT_FASDAS)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00069">module_sf_noahlsm.F:100</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a901df854f3a4654ea71bfa71ad88282f"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a901df854f3a4654ea71bfa71ad88282f">module_sf_noahlsm::shdtbl</a></div><div class="ttdeci">real, dimension(1:nlus) shdtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a935945ddf12582dad80c67c9c88034ac"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a935945ddf12582dad80c67c9c88034ac">module_sf_noahlsm::satdk</a></div><div class="ttdeci">real, dimension(1:nsltype) satdk</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a9b543a894e8a65d824249871d7f936d3"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a9b543a894e8a65d824249871d7f936d3">module_sf_noahlsm::topt_data</a></div><div class="ttdeci">real topt_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00043">module_sf_noahlsm.F:43</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_a9cb2add5ba6296cc7aac44442d42b2d4"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#a9cb2add5ba6296cc7aac44442d42b2d4">module_sf_noahlsm::albedomaxtbl</a></div><div class="ttdeci">real, dimension(1:nlus) albedomaxtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_aa0847a080464d5bff86f7fc48a8eae13"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#aa0847a080464d5bff86f7fc48a8eae13">module_sf_noahlsm::rstbl</a></div><div class="ttdeci">real, dimension(1:nlus) rstbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_aa1474706df3973c92ce572eb5517a6ca"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#aa1474706df3973c92ce572eb5517a6ca">module_sf_noahlsm::lucats</a></div><div class="ttdeci">integer lucats</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00030">module_sf_noahlsm.F:30</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_aa4d4ac6f0a95c2a6bce0c39cea8fe74d"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#aa4d4ac6f0a95c2a6bce0c39cea8fe74d">module_sf_noahlsm::emissmintbl</a></div><div class="ttdeci">real, dimension(1:nlus) emissmintbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_aae70644775d8b7023c8c3a7ba90616a8"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#aae70644775d8b7023c8c3a7ba90616a8">module_sf_noahlsm::sbeta_data</a></div><div class="ttdeci">real sbeta_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_aaf2ec4ae19423d4c1b907274266e1f75"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#aaf2ec4ae19423d4c1b907274266e1f75">module_sf_noahlsm::maxalb</a></div><div class="ttdeci">real, dimension(1:nlus) maxalb</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ab26c159cdc7754b2a7c741d846fb9e28"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ab26c159cdc7754b2a7c741d846fb9e28">module_sf_noahlsm::satdw</a></div><div class="ttdeci">real, dimension(1:nsltype) satdw</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ab273c118cc131cacda35bba9180402f9"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ab273c118cc131cacda35bba9180402f9">module_sf_noahlsm::wltsmc</a></div><div class="ttdeci">real, dimension(1:nsltype) wltsmc</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ab98144204f7c38b7c42ae05ce73403b2"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ab98144204f7c38b7c42ae05ce73403b2">module_sf_noahlsm::natural</a></div><div class="ttdeci">integer natural</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00031">module_sf_noahlsm.F:31</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ab9a5163c0bdd9b8af04056e8b88daa4e"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ab9a5163c0bdd9b8af04056e8b88daa4e">module_sf_noahlsm::laimintbl</a></div><div class="ttdeci">real, dimension(1:nlus) laimintbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_abe6654781f59a713e1ac61fda3eb633b"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#abe6654781f59a713e1ac61fda3eb633b">module_sf_noahlsm::sltype</a></div><div class="ttdeci">character(len=256) sltype</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00048">module_sf_noahlsm.F:48</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_abfdd114973412069ebbfb3a61af8d995"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#abfdd114973412069ebbfb3a61af8d995">module_sf_noahlsm::lvcoef_data</a></div><div class="ttdeci">real lvcoef_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00059">module_sf_noahlsm.F:59</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ac05feb2a0ff4bb9285433492b2eb10f4"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ac05feb2a0ff4bb9285433492b2eb10f4">module_sf_noahlsm::csoil_data</a></div><div class="ttdeci">real csoil_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_acbe287caffdd1287fb71954b6284d2f5"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#acbe287caffdd1287fb71954b6284d2f5">module_sf_noahlsm::refkdt_data</a></div><div class="ttdeci">real refkdt_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_acc9389a964a5c2195267b0d1b6a71ced"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#acc9389a964a5c2195267b0d1b6a71ced">module_sf_noahlsm::fxexp_data</a></div><div class="ttdeci">real fxexp_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ad1881be5e002e66566e6119f6ca6e032"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ad1881be5e002e66566e6119f6ca6e032">module_sf_noahlsm::smhigh_data</a></div><div class="ttdeci">real smhigh_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ae24910d9fdc3b5b4d0ed62901e8c53bd"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ae24910d9fdc3b5b4d0ed62901e8c53bd">module_sf_noahlsm::slope_data</a></div><div class="ttdeci">real, dimension(1:nslope) slope_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00055">module_sf_noahlsm.F:55</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ae38d77ba0e04158bf5681f63787f5615"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ae38d77ba0e04158bf5681f63787f5615">module_sf_noahlsm::lutype</a></div><div class="ttdeci">character(len=256) lutype</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00034">module_sf_noahlsm.F:34</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ae3fd374e34b9af10dd489dfc1965d827"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ae3fd374e34b9af10dd489dfc1965d827">module_sf_noahlsm::refdk_data</a></div><div class="ttdeci">real refdk_data</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00056">module_sf_noahlsm.F:56</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_ae7e9abc3699009623585d342ed700ea8"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#ae7e9abc3699009623585d342ed700ea8">module_sf_noahlsm::maxsmc</a></div><div class="ttdeci">real, dimension(1:nsltype) maxsmc</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00049">module_sf_noahlsm.F:49</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_aef1bae6bfa7f8eb613369181f2ca0bcd"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#aef1bae6bfa7f8eb613369181f2ca0bcd">module_sf_noahlsm::z0mintbl</a></div><div class="ttdeci">real, dimension(1:nlus) z0mintbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_af49267d813703d06dc522c006a0efdd8"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#af49267d813703d06dc522c006a0efdd8">module_sf_noahlsm::snuptbl</a></div><div class="ttdeci">real, dimension(1:nlus) snuptbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_af54c396581833689886321e9937a8b6b"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#af54c396581833689886321e9937a8b6b">module_sf_noahlsm::nrotbl</a></div><div class="ttdeci">integer, dimension(1:nlus) nrotbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00035">module_sf_noahlsm.F:35</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_af6a31bb1e4de31d7e62c196cbf6dc2ee"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#af6a31bb1e4de31d7e62c196cbf6dc2ee">module_sf_noahlsm::emissmaxtbl</a></div><div class="ttdeci">real, dimension(1:nlus) emissmaxtbl</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00036">module_sf_noahlsm.F:36</a></div></div>
<div class="ttc" id="anamespacemodule__sf__noahlsm_html_af967731a9437616e8e2b5bb6f3e1712e"><div class="ttname"><a href="namespacemodule__sf__noahlsm.html#af967731a9437616e8e2b5bb6f3e1712e">module_sf_noahlsm::bare</a></div><div class="ttdeci">integer bare</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__noahlsm_8F_source.html#l00030">module_sf_noahlsm.F:30</a></div></div>
<div class="ttc" id="anamespacemodule__sf__urban_html"><div class="ttname"><a href="namespacemodule__sf__urban.html">module_sf_urban</a></div><div class="ttdef"><b>Definition:</b> <a href="module__sf__urban_8F_source.html#l00001">module_sf_urban.F:1</a></div></div>
<div class="ttc" id="anamespacemodule__sf__urban_html_a71448e5d980be138624f3e59d6917431"><div class="ttname"><a href="namespacemodule__sf__urban.html#a71448e5d980be138624f3e59d6917431">module_sf_urban::iri_scheme</a></div><div class="ttdeci">integer iri_scheme</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__urban_8F_source.html#l00081">module_sf_urban.F:81</a></div></div>
<div class="ttc" id="anamespacemodule__sf__urban_html_a7f6ee8b847ffef398c59c26b4d7b42e7"><div class="ttname"><a href="namespacemodule__sf__urban.html#a7f6ee8b847ffef398c59c26b4d7b42e7">module_sf_urban::oasis</a></div><div class="ttdeci">real oasis</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__urban_8F_source.html#l00085">module_sf_urban.F:85</a></div></div>
<div class="ttc" id="anamespacemodule__sf__urban_html_abe7b6fac55e8d899aaeef36db2430d27"><div class="ttname"><a href="namespacemodule__sf__urban.html#abe7b6fac55e8d899aaeef36db2430d27">module_sf_urban::urban</a></div><div class="ttdeci">subroutine urban(LSOLAR, num_roof_layers, num_wall_layers, num_road_layers, DZR, DZB, DZG, UTYPE, TA, QA, UA, U1, V1, SSG, SSGD, SSGQ, LLG, RAIN, RHOO, ZA, DECLIN, COSZ, OMG, XLAT, DELT, ZNT, CHS, CHS2, TR, TB, TG, TC, QC, UC, TRL, TBL, TGL, XXXR, XXXB, XXXG, XXXC, TS, QS, SH, LH, LH_KINEMATIC, SW, ALB, LW, G, RN, PSIM, PSIH, GZ1OZ0, CMR_URB, CHR_URB, CMC_URB, CHC_URB, U10, V10, TH2, Q2, UST, mh_urb, stdh_urb, lf_urb, lp_urb, hgt_urb, frc_urb, lb_urb, zo_check, CMCR, TGR, TGRL, SMR, CMGR_URB, CHGR_URB, jmonth, DRELR, DRELB, DRELG, FLXHUMR, FLXHUMB, FLXHUMG)</div><div class="ttdef"><b>Definition:</b> <a href="module__sf__urban_8F_source.html#l00296">module_sf_urban.F:313</a></div></div>
<div class="ttc" id="anamespacempas__atmphys__date__time_html"><div class="ttname"><a href="namespacempas__atmphys__date__time.html">mpas_atmphys_date_time</a></div><div class="ttdef"><b>Definition:</b> <a href="core__atmosphere_2physics_2mpas__atmphys__date__time_8F_source.html#l00009">mpas_atmphys_date_time.F:9</a></div></div>
<div class="ttc" id="anamespacempas__atmphys__date__time_html_a45e2fa1d81544b9b5cf50beb24054503"><div class="ttname"><a href="namespacempas__atmphys__date__time.html#a45e2fa1d81544b9b5cf50beb24054503">mpas_atmphys_date_time::cal_mon_day</a></div><div class="ttdeci">subroutine, public cal_mon_day(julday, julyr, jmonth, jday)</div><div class="ttdef"><b>Definition:</b> <a href="core__atmosphere_2physics_2mpas__atmphys__date__time_8F_source.html#l00087">mpas_atmphys_date_time.F:88</a></div></div>
<div class="ttc" id="anamespacempas__atmphys__utilities_html"><div class="ttname"><a href="namespacempas__atmphys__utilities.html">mpas_atmphys_utilities</a></div><div class="ttdef"><b>Definition:</b> <a href="core__atmosphere_2physics_2mpas__atmphys__utilities_8F_source.html#l00009">mpas_atmphys_utilities.F:9</a></div></div>
<div class="ttc" id="anamespacempas__atmphys__utilities_html_aa49abb89b6ebc760010e08cbdade2706"><div class="ttname"><a href="namespacempas__atmphys__utilities.html#aa49abb89b6ebc760010e08cbdade2706">mpas_atmphys_utilities::physics_error_fatal</a></div><div class="ttdeci">subroutine, public physics_error_fatal(str)</div><div class="ttdef"><b>Definition:</b> <a href="core__atmosphere_2physics_2mpas__atmphys__utilities_8F_source.html#l00044">mpas_atmphys_utilities.F:45</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
